"use strict";(self.webpackChunkdelixia=self.webpackChunkdelixia||[]).push([["6840"],{4252:function(t,e,i){i.r(e),i.d(e,{AnimationGroup:()=>p,TargetedAnimation:()=>u});var a,n,s=i(56945),o=i(709),r=i(57718),l=i(85753),h=i(18592),m=i(58098);class _{get currentFrame(){return this._currentFrame}get weight(){return this._weight}get currentValue(){return this._currentValue}get targetPath(){return this._targetPath}get target(){return this._currentActiveTarget}get isAdditive(){return this._host&&this._host.isAdditive}constructor(t,e,i,a){if(this._events=[],this._currentFrame=0,this._originalValue=[],this._originalBlendValue=null,this._offsetsCache={},this._highLimitsCache={},this._stopped=!1,this._blendingFactor=0,this._currentValue=null,this._currentActiveTarget=null,this._directTarget=null,this._targetPath="",this._weight=1,this._absoluteFrameOffset=0,this._previousElapsedTime=0,this._yoyoDirection=1,this._previousAbsoluteFrame=0,this._targetIsArray=!1,this._animation=e,this._target=t,this._scene=i,this._host=a,this._activeTargets=[],e._runtimeAnimations.push(this),this._animationState={key:0,repeatCount:0,loopMode:this._getCorrectLoopMode()},this._animation.dataType===s.fw.ANIMATIONTYPE_MATRIX&&(this._animationState.workValue=m.y3.Zero()),this._keys=this._animation.getKeys(),this._minFrame=this._keys[0].frame,this._maxFrame=this._keys[this._keys.length-1].frame,this._minValue=this._keys[0].value,this._maxValue=this._keys[this._keys.length-1].value,0!==this._minFrame){let t={frame:0,value:this._minValue};this._keys.splice(0,0,t)}if(this._target instanceof Array){let t=0;for(let e of this._target)this._preparePath(e,t),this._getOriginalValues(t),t++;this._targetIsArray=!0}else this._preparePath(this._target),this._getOriginalValues(),this._targetIsArray=!1,this._directTarget=this._activeTargets[0];let n=e.getEvents();n&&n.length>0&&n.forEach(t=>{this._events.push(t._clone())}),this._enableBlending=t&&t.animationPropertiesOverride?t.animationPropertiesOverride.enableBlending:this._animation.enableBlending}_preparePath(t,e=0){let i=this._animation.targetPropertyPath;if(i.length>1){let a=t;for(let t=0;t<i.length-1;t++){let e=i[t];if(void 0===(a=a[e]))throw Error(`Invalid property (${e}) in property path (${i.join(".")})`)}this._targetPath=i[i.length-1],this._activeTargets[e]=a}else this._targetPath=i[0],this._activeTargets[e]=t;if(void 0===this._activeTargets[e][this._targetPath])throw Error(`Invalid property (${this._targetPath}) in property path (${i.join(".")})`)}get animation(){return this._animation}reset(t=!1){if(t)if(this._target instanceof Array){let t=0;for(let e of this._target)void 0!==this._originalValue[t]&&this._setValue(e,this._activeTargets[t],this._originalValue[t],-1,t),t++}else void 0!==this._originalValue[0]&&this._setValue(this._target,this._directTarget,this._originalValue[0],-1,0);this._offsetsCache={},this._highLimitsCache={},this._currentFrame=0,this._blendingFactor=0;for(let t=0;t<this._events.length;t++)this._events[t].isDone=!1}isStopped(){return this._stopped}dispose(){let t=this._animation.runtimeAnimations.indexOf(this);t>-1&&this._animation.runtimeAnimations.splice(t,1)}setValue(t,e){if(this._targetIsArray){for(let i=0;i<this._target.length;i++){let a=this._target[i];this._setValue(a,this._activeTargets[i],t,e,i)}return}this._setValue(this._target,this._directTarget,t,e,0)}_getOriginalValues(t=0){let e,i=this._activeTargets[t];(e=i.getLocalMatrix&&"_matrix"===this._targetPath?i.getLocalMatrix():i[this._targetPath])&&e.clone?this._originalValue[t]=e.clone():this._originalValue[t]=e}_registerTargetForLateAnimationBinding(t,e){let i=t.target;this._scene._registeredForLateAnimationBindings.pushNoDuplicate(i),i._lateAnimationHolders||(i._lateAnimationHolders={}),i._lateAnimationHolders[t.targetPath]||(i._lateAnimationHolders[t.targetPath]={totalWeight:0,totalAdditiveWeight:0,animations:[],additiveAnimations:[],originalValue:e}),t.isAdditive?(i._lateAnimationHolders[t.targetPath].additiveAnimations.push(t),i._lateAnimationHolders[t.targetPath].totalAdditiveWeight+=t.weight):(i._lateAnimationHolders[t.targetPath].animations.push(t),i._lateAnimationHolders[t.targetPath].totalWeight+=t.weight)}_setValue(t,e,i,a,n){if(this._currentActiveTarget=e,this._weight=a,this._enableBlending&&this._blendingFactor<=1){if(!this._originalBlendValue){let t=e[this._targetPath];t.clone?this._originalBlendValue=t.clone():this._originalBlendValue=t}this._originalBlendValue.m?s.fw.AllowMatrixDecomposeForInterpolation?this._currentValue?m.y3.DecomposeLerpToRef(this._originalBlendValue,i,this._blendingFactor,this._currentValue):this._currentValue=m.y3.DecomposeLerp(this._originalBlendValue,i,this._blendingFactor):this._currentValue?m.y3.LerpToRef(this._originalBlendValue,i,this._blendingFactor,this._currentValue):this._currentValue=m.y3.Lerp(this._originalBlendValue,i,this._blendingFactor):this._currentValue=s.fw._UniversalLerp(this._originalBlendValue,i,this._blendingFactor);let a=t&&t.animationPropertiesOverride?t.animationPropertiesOverride.blendingSpeed:this._animation.blendingSpeed;this._blendingFactor+=a}else this._currentValue?this._currentValue.copyFrom?this._currentValue.copyFrom(i):this._currentValue=i:i?.clone?this._currentValue=i.clone():this._currentValue=i;-1!==a?this._registerTargetForLateAnimationBinding(this,this._originalValue[n]):this._animationState.loopMode===s.fw.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT?this._currentValue.addToRef?this._currentValue.addToRef(this._originalValue[n],e[this._targetPath]):e[this._targetPath]=this._originalValue[n]+this._currentValue:e[this._targetPath]=this._currentValue,t.markAsDirty&&t.markAsDirty(this._animation.targetProperty)}_getCorrectLoopMode(){return this._target&&this._target.animationPropertiesOverride?this._target.animationPropertiesOverride.loopMode:this._animation.loopMode}goToFrame(t,e=-1){let i=this._animation.getKeys();t<i[0].frame?t=i[0].frame:t>i[i.length-1].frame&&(t=i[i.length-1].frame);let a=this._events;if(a.length)for(let e=0;e<a.length;e++)a[e].onlyOnce||(a[e].isDone=a[e].frame<t);this._currentFrame=t;let n=this._animation._interpolate(t,this._animationState);this.setValue(n,e)}_prepareForSpeedRatioChange(t){let e=this._previousElapsedTime*(this._animation.framePerSecond*t)/1e3;this._absoluteFrameOffset=this._previousAbsoluteFrame-e}animate(t,e,i,a,n,o=-1){let r,l,h=this._animation,m=h.targetPropertyPath;if(!m||m.length<1)return this._stopped=!0,!1;let _=!0;(e<this._minFrame||e>this._maxFrame)&&(e=this._minFrame),(i<this._minFrame||i>this._maxFrame)&&(i=this._maxFrame);let g=i-e,d=t*(h.framePerSecond*n)/1e3+this._absoluteFrameOffset,u=0,p=!1,f=a&&this._animationState.loopMode===s.fw.ANIMATIONLOOPMODE_YOYO;if(f){let t=Math.sin((d-e)/g*Math.PI);d=Math.abs(t)*g+e;let i=t>=0?1:-1;this._yoyoDirection!==i&&(p=!0),this._yoyoDirection=i}if(this._previousElapsedTime=t,this._previousAbsoluteFrame=d,!a&&i>=e&&(d>=g&&n>0||d<=0&&n<0))_=!1,u=h._getKeyValue(this._maxValue);else if(!a&&e>=i&&(d<=g&&n<0||d>=0&&n>0))_=!1,u=h._getKeyValue(this._minValue);else if(this._animationState.loopMode!==s.fw.ANIMATIONLOOPMODE_CYCLE){let t=i.toString()+e.toString();if(!this._offsetsCache[t]){this._animationState.repeatCount=0,this._animationState.loopMode=s.fw.ANIMATIONLOOPMODE_CYCLE;let a=h._interpolate(e,this._animationState),n=h._interpolate(i,this._animationState);switch(this._animationState.loopMode=this._getCorrectLoopMode(),h.dataType){case s.fw.ANIMATIONTYPE_FLOAT:this._offsetsCache[t]=n-a;break;case s.fw.ANIMATIONTYPE_QUATERNION:case s.fw.ANIMATIONTYPE_VECTOR3:case s.fw.ANIMATIONTYPE_VECTOR2:case s.fw.ANIMATIONTYPE_SIZE:case s.fw.ANIMATIONTYPE_COLOR3:this._offsetsCache[t]=n.subtract(a)}this._highLimitsCache[t]=n}u=this._highLimitsCache[t],r=this._offsetsCache[t]}if(void 0===r)switch(h.dataType){case s.fw.ANIMATIONTYPE_FLOAT:r=0;break;case s.fw.ANIMATIONTYPE_QUATERNION:r=s.sd;break;case s.fw.ANIMATIONTYPE_VECTOR3:r=s.cy;break;case s.fw.ANIMATIONTYPE_VECTOR2:r=s.Mj;break;case s.fw.ANIMATIONTYPE_SIZE:r=s.j4;break;case s.fw.ANIMATIONTYPE_COLOR3:r=s.S7;break;case s.fw.ANIMATIONTYPE_COLOR4:r=s.XP}if(this._host&&this._host.syncRoot){let t=this._host.syncRoot,i=(t.masterFrame-t.fromFrame)/(t.toFrame-t.fromFrame);l=e+g*i}else l=d>0&&e>i||d<0&&e<i?_&&0!==g?i+d%g:e:_&&0!==g?e+d%g:i;let c=this._events;if(!f&&(n>0&&this.currentFrame>l||n<0&&this.currentFrame<l)||f&&p){this._onLoop();for(let t=0;t<c.length;t++)c[t].onlyOnce||(c[t].isDone=!1);this._animationState.key=n>0?0:h.getKeys().length-1}this._currentFrame=l,this._animationState.repeatCount=0===g?0:d/g>>0,this._animationState.highLimitValue=u,this._animationState.offsetValue=r;let A=h._interpolate(l,this._animationState);if(this.setValue(A,o),c.length){for(let t=0;t<c.length;t++)if(g>=0&&l>=c[t].frame&&c[t].frame>=e||g<0&&l<=c[t].frame&&c[t].frame<=e){let e=c[t];e.isDone||(e.onlyOnce&&(c.splice(t,1),t--),e.isDone=!0,e.action(l))}}return _||(this._stopped=!0),_}}var g=i(47408);class d{get syncRoot(){return this._syncRoot}get masterFrame(){return 0===this._runtimeAnimations.length?0:this._runtimeAnimations[0].currentFrame}get weight(){return this._weight}set weight(t){if(-1===t){this._weight=-1;return}this._weight=Math.min(Math.max(t,0),1)}get speedRatio(){return this._speedRatio}set speedRatio(t){for(let e=0;e<this._runtimeAnimations.length;e++)this._runtimeAnimations[e]._prepareForSpeedRatioChange(t);this._speedRatio=t,null!==this._goToFrame&&this.goToFrame(this._goToFrame)}get elapsedTime(){return null===this._localDelayOffset?0:this._scene._animationTime-this._localDelayOffset}constructor(t,e,i=0,a=100,n=!1,s=1,r,l,h,m=!1,_=0){this.target=e,this.fromFrame=i,this.toFrame=a,this.loopAnimation=n,this.onAnimationEnd=r,this.onAnimationLoop=h,this.isAdditive=m,this.playOrder=_,this._localDelayOffset=null,this._pausedDelay=null,this._manualJumpDelay=null,this._runtimeAnimations=[],this._paused=!1,this._speedRatio=1,this._weight=-1,this._previousWeight=-1,this._syncRoot=null,this._frameToSyncFromJump=null,this._goToFrame=null,this.disposeOnEnd=!0,this.animationStarted=!1,this.onAnimationEndObservable=new o.y$,this.onAnimationLoopObservable=new o.y$,this._scene=t,l&&this.appendAnimations(e,l),this._speedRatio=s,t._activeAnimatables.push(this)}syncWith(t){if(this._syncRoot=t,t){let t=this._scene._activeAnimatables.indexOf(this);t>-1&&(this._scene._activeAnimatables.splice(t,1),this._scene._activeAnimatables.push(this))}return this}getAnimations(){return this._runtimeAnimations}appendAnimations(t,e){for(let i=0;i<e.length;i++){let a=new _(t,e[i],this._scene,this);a._onLoop=()=>{this.onAnimationLoopObservable.notifyObservers(this),this.onAnimationLoop&&this.onAnimationLoop()},this._runtimeAnimations.push(a)}}getAnimationByTargetProperty(t){let e=this._runtimeAnimations;for(let i=0;i<e.length;i++)if(e[i].animation.targetProperty===t)return e[i].animation;return null}getRuntimeAnimationByTargetProperty(t){let e=this._runtimeAnimations;for(let i=0;i<e.length;i++)if(e[i].animation.targetProperty===t)return e[i];return null}reset(){let t=this._runtimeAnimations;for(let e=0;e<t.length;e++)t[e].reset(!0);this._localDelayOffset=null,this._pausedDelay=null}enableBlending(t){let e=this._runtimeAnimations;for(let i=0;i<e.length;i++)e[i].animation.enableBlending=!0,e[i].animation.blendingSpeed=t}disableBlending(){let t=this._runtimeAnimations;for(let e=0;e<t.length;e++)t[e].animation.enableBlending=!1}goToFrame(t,e=!1){let i=this._runtimeAnimations;if(i[0]){let e=i[0].animation.framePerSecond;this._frameToSyncFromJump=this._frameToSyncFromJump??i[0].currentFrame;let a=0===this.speedRatio?0:(t-this._frameToSyncFromJump)/e*1e3/this.speedRatio;this._manualJumpDelay=-a}for(let a=0;a<i.length;a++)i[a].goToFrame(t,e?this._weight:-1);this._goToFrame=t}get paused(){return this._paused}pause(){this._paused||(this._paused=!0)}restart(){this._paused=!1}_raiseOnAnimationEnd(){this.onAnimationEnd&&this.onAnimationEnd(),this.onAnimationEndObservable.notifyObservers(this)}stop(t,e,i=!1,a=!1){if(t||e){let n=this._scene._activeAnimatables.indexOf(this);if(n>-1){let s=this._runtimeAnimations;for(let i=s.length-1;i>=0;i--){let a=s[i];(!t||a.animation.name==t)&&(!e||e(a.target))&&(a.dispose(),s.splice(i,1))}0==s.length&&(i||this._scene._activeAnimatables.splice(n,1),a||this._raiseOnAnimationEnd())}}else{let t=this._scene._activeAnimatables.indexOf(this);if(t>-1){i||this._scene._activeAnimatables.splice(t,1);let e=this._runtimeAnimations;for(let t=0;t<e.length;t++)e[t].dispose();this._runtimeAnimations.length=0,a||this._raiseOnAnimationEnd()}}}waitAsync(){return new Promise(t=>{this.onAnimationEndObservable.add(()=>{t(this)},void 0,void 0,this,!0)})}_animate(t){let e;if(this._paused)return this.animationStarted=!1,null===this._pausedDelay&&(this._pausedDelay=t),!0;if(null===this._localDelayOffset?(this._localDelayOffset=t,this._pausedDelay=null):null!==this._pausedDelay&&(this._localDelayOffset+=t-this._pausedDelay,this._pausedDelay=null),null!==this._manualJumpDelay&&(this._localDelayOffset+=this._manualJumpDelay,this._manualJumpDelay=null,this._frameToSyncFromJump=null),this._goToFrame=null,0===this._weight&&0===this._previousWeight)return!0;this._previousWeight=this._weight;let i=!1,a=this._runtimeAnimations;for(e=0;e<a.length;e++){let n=a[e].animate(t-this._localDelayOffset,this.fromFrame,this.toFrame,this.loopAnimation,this._speedRatio,this._weight);i=i||n}if(this.animationStarted=i,!i){if(this.disposeOnEnd)for(e=this._scene._activeAnimatables.indexOf(this),this._scene._activeAnimatables.splice(e,1),e=0;e<a.length;e++)a[e].dispose();this._raiseOnAnimationEnd(),this.disposeOnEnd&&(this.onAnimationEnd=null,this.onAnimationLoop=null,this.onAnimationLoopObservable.clear(),this.onAnimationEndObservable.clear())}return i}}a=i(2970).x,(n=h.N)&&(n.prototype.copyAnimationRange=function(t,e,i,a=!1,n=null){let o,r,l;0===this.animations.length&&(this.animations.push(new s.fw(this.name,"_matrix",t.animations[0].framePerSecond,s.fw.ANIMATIONTYPE_MATRIX,0)),this.animations[0].setKeys([]));let h=t.animations[0].getRange(e);if(!h)return!1;let m=h.from,_=h.to,g=t.animations[0].getKeys(),d=t.length,u=t.getParent(),p=this.getParent(),f=a&&u&&d&&this.length&&d!==this.length,c=f&&p&&u?p.length/u.length:1,A=a&&!p&&n&&(1!==n.x||1!==n.y||1!==n.z),b=this.animations[0].getKeys();for(let t=0,e=g.length;t<e;t++)(o=g[t]).frame>=m&&o.frame<=_&&(a?(l=o.value.clone(),f?(r=l.getTranslation(),l.setTranslation(r.scaleInPlace(c))):A&&n?(r=l.getTranslation(),l.setTranslation(r.multiplyInPlace(n))):l=o.value):l=o.value,b.push({frame:o.frame+i,value:l}));return this.animations[0].createRange(e,m+i,_+i),!0}),a&&(a.prototype._animate=function(t){if(!this.animationsEnabled)return;let e=g.F.Now;if(!this._animationTimeLast){if(this._pendingData.length>0)return;this._animationTimeLast=e}this.deltaTime=void 0!==t?t:this.useConstantAnimationDeltaTime?16:(e-this._animationTimeLast)*this.animationTimeScale,this._animationTimeLast=e;let i=this._activeAnimatables;if(0===i.length)return;this._animationTime+=this.deltaTime;let a=this._animationTime;for(let t=0;t<i.length;t++){let e=i[t];!e._animate(a)&&e.disposeOnEnd&&t--}!function(t){if(t._registeredForLateAnimationBindings.length){for(let e=0;e<t._registeredForLateAnimationBindings.length;e++){let i=t._registeredForLateAnimationBindings.data[e];for(let t in i._lateAnimationHolders){let e=i._lateAnimationHolders[t],a=e.animations[0],n=e.originalValue;if(null==n)continue;let o=s.fw.AllowMatrixDecomposeForInterpolation&&n.m,r=i[t];if(o)r=function(t){if(0===t.totalWeight&&0===t.totalAdditiveWeight)return t.originalValue;let e=1,i=m.jp.Vector3["0"],a=m.jp.Vector3["1"],n=m.jp.Quaternion["0"],s=0,o=t.animations[0],r=t.originalValue,l=1,h=!1;if(t.totalWeight<1)l=1-t.totalWeight,r.decompose(a,n,i);else{if(s=1,e=t.totalWeight,1==(l=o.weight/e))if(!t.totalAdditiveWeight)return o.currentValue;else h=!0;o.currentValue.decompose(a,n,i)}if(!h){a.scaleInPlace(l),i.scaleInPlace(l),n.scaleInPlace(l);for(let o=s;o<t.animations.length;o++){let s=t.animations[o];if(0===s.weight)continue;l=s.weight/e;let r=m.jp.Vector3["2"],h=m.jp.Vector3["3"],_=m.jp.Quaternion["1"];s.currentValue.decompose(h,_,r),h.scaleAndAddToRef(l,a),_.scaleAndAddToRef(m._f.Dot(n,_)>0?l:-l,n),r.scaleAndAddToRef(l,i)}n.normalize()}for(let e=0;e<t.additiveAnimations.length;e++){let s=t.additiveAnimations[e];if(0===s.weight)continue;let o=m.jp.Vector3["2"],r=m.jp.Vector3["3"],l=m.jp.Quaternion["1"];s.currentValue.decompose(r,l,o),r.multiplyToRef(a,r),m.P.LerpToRef(a,r,s.weight,a),n.multiplyToRef(l,l),m._f.SlerpToRef(n,l,s.weight,n),o.scaleAndAddToRef(s.weight,i)}let _=o?o._animationState.workValue:m.jp.Matrix["0"].clone();return m.y3.ComposeToRef(a,n,i,_),_}(e);else if(void 0!==n.w)r=function(t,e){if(0===t.totalWeight&&0===t.totalAdditiveWeight)return e;let i=t.animations[0],a=t.originalValue,n=e;if(0===t.totalWeight&&t.totalAdditiveWeight>0)n.copyFrom(a);else if(1===t.animations.length){if(m._f.SlerpToRef(a,i.currentValue,Math.min(1,t.totalWeight),n),0===t.totalAdditiveWeight)return n}else if(t.animations.length>1){let i,s,o=1;if(t.totalWeight<1){let e=1-t.totalWeight;s=[],(i=[]).push(a),s.push(e)}else{if(2===t.animations.length&&(m._f.SlerpToRef(t.animations[0].currentValue,t.animations[1].currentValue,t.animations[1].weight/t.totalWeight,e),0===t.totalAdditiveWeight))return e;i=[],s=[],o=t.totalWeight}for(let e=0;e<t.animations.length;e++){let a=t.animations[e];i.push(a.currentValue),s.push(a.weight/o)}let r=0;for(let t=0;t<i.length;){if(!t){m._f.SlerpToRef(i[t],i[t+1],s[t+1]/(s[t]+s[t+1]),e),n=e,r=s[t]+s[t+1],t+=2;continue}r+=s[t],m._f.SlerpToRef(n,i[t],s[t]/r,n),t++}}for(let e=0;e<t.additiveAnimations.length;e++){let i=t.additiveAnimations[e];0!==i.weight&&(n.multiplyToRef(i.currentValue,m.jp.Quaternion["0"]),m._f.SlerpToRef(n,m.jp.Quaternion["0"],i.weight,n))}return n}(e,r||m._f.Identity());else{let t=0,i=1,o=a&&a._animationState.loopMode===s.fw.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT;if(e.totalWeight<1)r=o?n.clone?n.clone():n:a&&n.scale?n.scale(1-e.totalWeight):a?n*(1-e.totalWeight):n.clone?n.clone():n;else if(a){i=e.totalWeight;let s=a.weight/i;r=1!==s?a.currentValue.scale?a.currentValue.scale(s):a.currentValue*s:a.currentValue,o&&(r.addToRef?r.addToRef(n,r):r+=n),t=1}for(let a=t;a<e.animations.length;a++){let t=e.animations[a],n=t.weight/i;n&&(t.currentValue.scaleAndAddToRef?t.currentValue.scaleAndAddToRef(n,r):r+=t.currentValue*n)}for(let t=0;t<e.additiveAnimations.length;t++){let i=e.additiveAnimations[t],a=i.weight;a&&(i.currentValue.scaleAndAddToRef?i.currentValue.scaleAndAddToRef(a,r):r+=i.currentValue*a)}}i[t]=r}i._lateAnimationHolders={}}t._registeredForLateAnimationBindings.reset()}}(this)},a.prototype.sortActiveAnimatables=function(){this._activeAnimatables.sort((t,e)=>t.playOrder-e.playOrder)},a.prototype.beginWeightedAnimation=function(t,e,i,a=1,n,s=1,o,r,l,h,m=!1){let _=this.beginAnimation(t,e,i,n,s,o,r,!1,l,h,m);return _.weight=a,_},a.prototype.beginAnimation=function(t,e,i,a,n=1,s,o,r=!0,l,h,m=!1){if(n<0){let t=e;e=i,i=t,n=-n}e>i&&(n=-n),r&&this.stopAnimation(t,void 0,l),o||(o=new d(this,t,e,i,a,n,s,void 0,h,m));let _=!l||l(t);if(t.animations&&_&&o.appendAnimations(t,t.animations),t.getAnimatables){let m=t.getAnimatables();for(let t=0;t<m.length;t++)this.beginAnimation(m[t],e,i,a,n,s,o,r,l,h)}return o.reset(),o},a.prototype.beginHierarchyAnimation=function(t,e,i,a,n,s=1,o,r,l=!0,h,m,_=!1){let g=t.getDescendants(e),d=[];for(let e of(d.push(this.beginAnimation(t,i,a,n,s,o,r,l,h,void 0,_)),g))d.push(this.beginAnimation(e,i,a,n,s,o,r,l,h,void 0,_));return d},a.prototype.beginDirectAnimation=function(t,e,i,a,n,s=1,o,r,l=!1){if(s<0){let t=i;i=a,a=t,s=-s}return i>a&&(s=-s),new d(this,t,i,a,n,s,o,e,r,l)},a.prototype.beginDirectHierarchyAnimation=function(t,e,i,a,n,s,o,r,l,h=!1){let m=t.getDescendants(e),_=[];for(let e of(_.push(this.beginDirectAnimation(t,i,a,n,s,o,r,l,h)),m))_.push(this.beginDirectAnimation(e,i,a,n,s,o,r,l,h));return _},a.prototype.getAnimatableByTarget=function(t){for(let e=0;e<this._activeAnimatables.length;e++)if(this._activeAnimatables[e].target===t)return this._activeAnimatables[e];return null},a.prototype.getAllAnimatablesByTarget=function(t){let e=[];for(let i=0;i<this._activeAnimatables.length;i++)this._activeAnimatables[i].target===t&&e.push(this._activeAnimatables[i]);return e},a.prototype.stopAnimation=function(t,e,i){for(let a of this.getAllAnimatablesByTarget(t))a.stop(e,i)},a.prototype.stopAllAnimations=function(){if(this._activeAnimatables){for(let t=0;t<this._activeAnimatables.length;t++)this._activeAnimatables[t].stop(void 0,void 0,!0);this._activeAnimatables.length=0}for(let t of this.animationGroups)t.stop()});class u{getClassName(){return"TargetedAnimation"}serialize(){let t={};return t.animation=this.animation.serialize(),t.targetId=this.target.id,t}}class p{get mask(){return this._mask}set mask(t){this._mask!==t&&(this._mask=t,this.syncWithMask(!0))}syncWithMask(t=!1){if(!this.mask&&!t){this._numActiveAnimatables=this._targetedAnimations.length;return}this._numActiveAnimatables=0;for(let t=0;t<this._animatables.length;++t){let e=this._animatables[t];!this.mask||this.mask.disabled||this.mask.retainsTarget(e.target.name)?(this._numActiveAnimatables++,e.paused&&e.restart()):e.paused||e.pause()}}removeUnmaskedAnimations(){if(this.mask&&!this.mask.disabled){for(let t=0;t<this._animatables.length;++t){let e=this._animatables[t];!this.mask.retainsTarget(e.target.name)&&(e.stop(),this._animatables.splice(t,1),--t)}for(let t=0;t<this._targetedAnimations.length;t++){let e=this._targetedAnimations[t];!this.mask.retainsTarget(e.target.name)&&(this._targetedAnimations.splice(t,1),--t)}}}get from(){return this._from}set from(t){if(this._from!==t){this._from=t;for(let t=0;t<this._animatables.length;t++)this._animatables[t].fromFrame=this._from}}get to(){return this._to}set to(t){if(this._to!==t){this._to=t;for(let t=0;t<this._animatables.length;t++)this._animatables[t].toFrame=this._to}}get isStarted(){return this._isStarted}get isPlaying(){return this._isStarted&&!this._isPaused}get speedRatio(){return this._speedRatio}set speedRatio(t){if(this._speedRatio!==t){this._speedRatio=t;for(let t=0;t<this._animatables.length;t++)this._animatables[t].speedRatio=this._speedRatio}}get loopAnimation(){return this._loopAnimation}set loopAnimation(t){if(this._loopAnimation!==t){this._loopAnimation=t;for(let t=0;t<this._animatables.length;t++)this._animatables[t].loopAnimation=this._loopAnimation}}get isAdditive(){return this._isAdditive}set isAdditive(t){if(this._isAdditive!==t){this._isAdditive=t;for(let t=0;t<this._animatables.length;t++)this._animatables[t].isAdditive=this._isAdditive}}get weight(){return this._weight}set weight(t){this._weight!==t&&(this._weight=t,this.setWeightForAllAnimatables(this._weight))}get targetedAnimations(){return this._targetedAnimations}get animatables(){return this._animatables}get children(){return this._targetedAnimations}get playOrder(){return this._playOrder}set playOrder(t){if(this._playOrder!==t&&(this._playOrder=t,this._animatables.length>0)){for(let t=0;t<this._animatables.length;t++)this._animatables[t].playOrder=this._playOrder;this._scene.sortActiveAnimatables()}}get enableBlending(){return this._enableBlending}set enableBlending(t){if(this._enableBlending!==t&&(this._enableBlending=t,null!==t))for(let e=0;e<this._targetedAnimations.length;++e)this._targetedAnimations[e].animation.enableBlending=t}get blendingSpeed(){return this._blendingSpeed}set blendingSpeed(t){if(this._blendingSpeed!==t&&(this._blendingSpeed=t,null!==t))for(let e=0;e<this._targetedAnimations.length;++e)this._targetedAnimations[e].animation.blendingSpeed=t}getLength(t,e){t=t??this._from,e=e??this._to;let i=this.targetedAnimations[0].animation.framePerSecond*this._speedRatio;return(e-t)/i}static MergeAnimationGroups(t,e=!0,i=!1,a){if(0===t.length)return null;a=a??t[0].weight;let n=Number.MAX_VALUE,s=-Number.MAX_VALUE;if(i)for(let e of t)e.from<n&&(n=e.from),e.to>s&&(s=e.to);let o=new p(t[0].name+"_merged",t[0]._scene,a);for(let a of t){for(let t of(i&&a.normalize(n,s),a.targetedAnimations))o.addTargetedAnimation(t.animation,t.target);e&&a.dispose()}return o}constructor(t,e=null,i=-1,a=0){this.name=t,this._targetedAnimations=[],this._animatables=[],this._from=Number.MAX_VALUE,this._to=-Number.MAX_VALUE,this._speedRatio=1,this._loopAnimation=!1,this._isAdditive=!1,this._weight=-1,this._playOrder=0,this._enableBlending=null,this._blendingSpeed=null,this._numActiveAnimatables=0,this._shouldStart=!0,this._parentContainer=null,this.onAnimationEndObservable=new o.y$,this.onAnimationLoopObservable=new o.y$,this.onAnimationGroupLoopObservable=new o.y$,this.onAnimationGroupEndObservable=new o.y$,this.onAnimationGroupPauseObservable=new o.y$,this.onAnimationGroupPlayObservable=new o.y$,this.metadata=null,this._mask=null,this._animationLoopFlags=[],this._scene=e||r.l.LastCreatedScene,this._weight=i,this._playOrder=a,this.uniqueId=this._scene.getUniqueId(),this._scene.addAnimationGroup(this)}addTargetedAnimation(t,e){let i=new u;i.animation=t,i.target=e;let a=t.getKeys();return this._from>a[0].frame&&(this._from=a[0].frame),this._to<a[a.length-1].frame&&(this._to=a[a.length-1].frame),null!==this._enableBlending&&(t.enableBlending=this._enableBlending),null!==this._blendingSpeed&&(t.blendingSpeed=this._blendingSpeed),this._targetedAnimations.push(i),this._shouldStart=!0,i}removeTargetedAnimation(t){for(let e=this._targetedAnimations.length-1;e>-1;e--)this._targetedAnimations[e].animation===t&&this._targetedAnimations.splice(e,1)}normalize(t=null,e=null){null==t&&(t=this._from),null==e&&(e=this._to);for(let i=0;i<this._targetedAnimations.length;i++){let a=this._targetedAnimations[i].animation.getKeys(),n=a[0],s=a[a.length-1];if(n.frame>t){let e={frame:t,value:n.value,inTangent:n.inTangent,outTangent:n.outTangent,interpolation:n.interpolation};a.splice(0,0,e)}if(s.frame<e){let t={frame:e,value:s.value,inTangent:s.inTangent,outTangent:s.outTangent,interpolation:s.interpolation};a.push(t)}}return this._from=t,this._to=e,this}_processLoop(t,e,i){t.onAnimationLoop=()=>{this.onAnimationLoopObservable.notifyObservers(e),this._animationLoopFlags[i]||(this._animationLoopFlags[i]=!0,this._animationLoopCount++,this._animationLoopCount===this._numActiveAnimatables&&(this.onAnimationGroupLoopObservable.notifyObservers(this),this._animationLoopCount=0,this._animationLoopFlags.length=0))}}start(t=!1,e=1,i,a,n){if(this._isStarted||0===this._targetedAnimations.length)return this;this._loopAnimation=t,this._shouldStart=!1,this._animationLoopCount=0,this._animationLoopFlags.length=0;for(let s=0;s<this._targetedAnimations.length;s++){let o=this._targetedAnimations[s],r=this._scene.beginDirectAnimation(o.target,[o.animation],void 0!==i?i:this._from,void 0!==a?a:this._to,t,e,void 0,void 0,void 0!==n?n:this._isAdditive);r.weight=this._weight,r.playOrder=this._playOrder,r.onAnimationEnd=()=>{this.onAnimationEndObservable.notifyObservers(o),this._checkAnimationGroupEnded(r)},this._processLoop(r,o,s),this._animatables.push(r)}return this.syncWithMask(),this._scene.sortActiveAnimatables(),this._speedRatio=e,this._isStarted=!0,this._isPaused=!1,this.onAnimationGroupPlayObservable.notifyObservers(this),this}pause(){if(!this._isStarted)return this;this._isPaused=!0;for(let t=0;t<this._animatables.length;t++)this._animatables[t].pause();return this.onAnimationGroupPauseObservable.notifyObservers(this),this}play(t){return this.isStarted&&this._animatables.length&&!this._shouldStart?(void 0!==t&&(this.loopAnimation=t),this.restart()):(this.stop(),this.start(t,this._speedRatio)),this}reset(){if(!this._isStarted)return this.play(),this.goToFrame(0),this.stop(!0),this;for(let t=0;t<this._animatables.length;t++)this._animatables[t].reset();return this}restart(){if(!this._isStarted)return this;for(let t=0;t<this._animatables.length;t++)this._animatables[t].restart();return this.syncWithMask(),this._isPaused=!1,this.onAnimationGroupPlayObservable.notifyObservers(this),this}stop(t=!1){if(!this._isStarted)return this;let e=this._animatables.slice();for(let i=0;i<e.length;i++)e[i].stop(void 0,void 0,!0,t);let i=0;for(let e=0;e<this._scene._activeAnimatables.length;e++){let a=this._scene._activeAnimatables[e];a._runtimeAnimations.length>0?this._scene._activeAnimatables[i++]=a:t&&this._checkAnimationGroupEnded(a,t)}return this._scene._activeAnimatables.length=i,this._isStarted=!1,this}setWeightForAllAnimatables(t){for(let e=0;e<this._animatables.length;e++)this._animatables[e].weight=t;return this}syncAllAnimationsWith(t){for(let e=0;e<this._animatables.length;e++)this._animatables[e].syncWith(t);return this}goToFrame(t,e=!1){if(!this._isStarted)return this;for(let i=0;i<this._animatables.length;i++)this._animatables[i].goToFrame(t,e);return this}getCurrentFrame(){return this.animatables[0]?.masterFrame||0}dispose(){this.isStarted&&this.stop(),this._targetedAnimations.length=0,this._animatables.length=0;let t=this._scene.animationGroups.indexOf(this);if(t>-1&&this._scene.animationGroups.splice(t,1),this._parentContainer){let t=this._parentContainer.animationGroups.indexOf(this);t>-1&&this._parentContainer.animationGroups.splice(t,1),this._parentContainer=null}this.onAnimationEndObservable.clear(),this.onAnimationGroupEndObservable.clear(),this.onAnimationGroupPauseObservable.clear(),this.onAnimationGroupPlayObservable.clear(),this.onAnimationLoopObservable.clear(),this.onAnimationGroupLoopObservable.clear()}_checkAnimationGroupEnded(t,e=!1){let i=this._animatables.indexOf(t);i>-1&&this._animatables.splice(i,1),this._animatables.length===this._targetedAnimations.length-this._numActiveAnimatables&&(this._isStarted=!1,e||this.onAnimationGroupEndObservable.notifyObservers(this),this._animatables.length=0)}clone(t,e,i=!1){let a=new p(t||this.name,this._scene,this._weight,this._playOrder);for(let t of(a._from=this.from,a._to=this.to,a._speedRatio=this.speedRatio,a._loopAnimation=this.loopAnimation,a._isAdditive=this.isAdditive,a._enableBlending=this.enableBlending,a._blendingSpeed=this.blendingSpeed,a.metadata=this.metadata,a.mask=this.mask,this._targetedAnimations))a.addTargetedAnimation(i?t.animation.clone():t.animation,e?e(t.target):t.target);return a}serialize(){let t={};t.name=this.name,t.from=this.from,t.to=this.to,t.speedRatio=this.speedRatio,t.loopAnimation=this.loopAnimation,t.isAdditive=this.isAdditive,t.weight=this.weight,t.playOrder=this.playOrder,t.enableBlending=this.enableBlending,t.blendingSpeed=this.blendingSpeed,t.targetedAnimations=[];for(let e=0;e<this.targetedAnimations.length;e++){let i=this.targetedAnimations[e];t.targetedAnimations[e]=i.serialize()}return l.$&&l.$.HasTags(this)&&(t.tags=l.$.GetTags(this)),this.metadata&&(t.metadata=this.metadata),t}static Parse(t,e){let i=new p(t.name,e,t.weight,t.playOrder);for(let a=0;a<t.targetedAnimations.length;a++){let n=t.targetedAnimations[a],o=s.fw.Parse(n.animation),r=n.targetId;if("influence"===n.animation.property){let t=e.getMorphTargetById(r);t&&i.addTargetedAnimation(o,t)}else{let t=e.getNodeById(r);null!=t&&i.addTargetedAnimation(o,t)}}return l.$&&l.$.AddTagsTo(i,t.tags),null!==t.from&&null!==t.to&&i.normalize(t.from,t.to),void 0!==t.speedRatio&&(i._speedRatio=t.speedRatio),void 0!==t.loopAnimation&&(i._loopAnimation=t.loopAnimation),void 0!==t.isAdditive&&(i._isAdditive=t.isAdditive),void 0!==t.weight&&(i._weight=t.weight),void 0!==t.playOrder&&(i._playOrder=t.playOrder),void 0!==t.enableBlending&&(i._enableBlending=t.enableBlending),void 0!==t.blendingSpeed&&(i._blendingSpeed=t.blendingSpeed),void 0!==t.metadata&&(i.metadata=t.metadata),i}static MakeAnimationAdditive(t,e,i,a=!1,n){let o,r=t;(o="object"==typeof e?e:{referenceFrame:e,range:i,cloneOriginalAnimationGroup:a,clonedAnimationName:n}).cloneOriginalAnimationGroup&&(r=t.clone(o.clonedAnimationGroupName||r.name));let l=r.targetedAnimations;for(let t=0;t<l.length;t++){let e=l[t];e.animation=s.fw.MakeAnimationAdditive(e.animation,o)}if(r.isAdditive=!0,o.clipKeys){let t=Number.MAX_VALUE,e=-Number.MAX_VALUE,i=r.targetedAnimations;for(let a=0;a<i.length;a++){let n=i[a].animation.getKeys();t>n[0].frame&&(t=n[0].frame),e<n[n.length-1].frame&&(e=n[n.length-1].frame)}r._from=t,r._to=e}return r}static ClipKeys(t,e,i,a,n){let s=t.clone(a||t.name);return p.ClipKeysInPlace(s,e,i,n)}static ClipKeysInPlace(t,e,i,a){return p.ClipInPlace(t,e,i,a,!1)}static ClipFrames(t,e,i,a,n){let s=t.clone(a||t.name);return p.ClipFramesInPlace(s,e,i,n)}static ClipFramesInPlace(t,e,i,a){return p.ClipInPlace(t,e,i,a,!0)}static ClipInPlace(t,e,i,a,n=!1){let s=Number.MAX_VALUE,o=-Number.MAX_VALUE,r=t.targetedAnimations;for(let t=0;t<r.length;t++){let l=r[t],h=a?l.animation:l.animation.clone();n&&(h.createKeyForFrame(e),h.createKeyForFrame(i));let m=h.getKeys(),_=[],g=Number.MAX_VALUE;for(let t=0;t<m.length;t++){let a=m[t];if(!n&&t>=e&&t<=i||n&&a.frame>=e&&a.frame<=i){let t={frame:a.frame,value:a.value.clone?a.value.clone():a.value,inTangent:a.inTangent,outTangent:a.outTangent,interpolation:a.interpolation,lockedTangent:a.lockedTangent};g===Number.MAX_VALUE&&(g=t.frame),t.frame-=g,_.push(t)}}if(0===_.length){r.splice(t,1),t--;continue}s>_[0].frame&&(s=_[0].frame),o<_[_.length-1].frame&&(o=_[_.length-1].frame),h.setKeys(_,!0),l.animation=h}return t._from=s,t._to=o,t}getClassName(){return"AnimationGroup"}toString(t){let e="Name: "+this.name;return e+=", type: "+this.getClassName(),t&&(e+=", from: "+this._from+", to: "+this._to+", isStarted: "+this._isStarted+", speedRatio: "+this._speedRatio+", targetedAnimations length: "+this._targetedAnimations.length+", animatables length: "+this._animatables),e}}}}]);