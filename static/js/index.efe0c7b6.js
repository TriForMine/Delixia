(()=>{"use strict";var e={49454:function(e,t,i){var s,o,n,a,r,l,h=i(85893),d=i(67294),c=i(20745),p=i(68827),u=i(61588);let m=[1e3,1001,1005,1006];var g=((s={}).DISCONNECTED="disconnected",s.CONNECTING="connecting",s.CONNECTED="connected",s.RECONNECTING="reconnecting",s.ERROR="error",s);function y(e){let t=e,i=new Set;return{get:()=>t,set:e=>{t=e,i.forEach(t=>t(e))},subscribe:e=>(i.add(e),()=>i.delete(e))}}let f=(e,t)=>{let i,s=new u.Client(e),o=y(void 0),n=y(void 0),a=y([]),r=y("disconnected"),l=y(null),h=!1,c=0,p=null,g=(e,t)=>{if(o.set(e),i=e.reconnectionToken,r.set("connected"),c=0,e.onError((e,t)=>{console.error(`Room error: ${e} - ${t}`),l.set({code:e,message:t}),m.includes(e)&&c<5?x():r.set("error")}),e.onLeave(e=>{o.set(void 0),m.includes(e)&&c<5?x():(n.set(void 0),a.set([]),r.set("disconnected"),i=void 0)}),t)e.onMessage("rooms",e=>{a.set(e)}),e.onMessage("+",e=>{let[t,i]=e,s=a.get(),o=s.findIndex(e=>e.roomId===t);if(-1!==o){let e=[...s];e[o]={...e[o],...i},a.set(e)}else a.set([...s,i])}),e.onMessage("-",e=>{a.set(a.get().filter(t=>t.roomId!==e))});else{n.set(e.state);let t={};e.onStateChange.once(i=>{let s=(0,u.getStateCallbacks)(e);for(let e of Object.keys(i)){let o=s(i)[e];"object"==typeof i[e]&&(t[e]=!1,o.onAdd(i=>{t[e]=!0,s(i).onChange(()=>{t[e]=!0})}),o.onRemove(()=>{t[e]=!0}))}}),e.onStateChange(e=>{if(!e)return;let i={...e};for(let[s,o]of Object.entries(t)){if(!o)continue;t[s]=!1;let n=e[s];n.clone&&(i[s]=n.clone())}n.set(i)})}},f=async e=>{let{roomName:i,roomId:n,forceCreate:a=!1,isLobby:d=!1,options:u={}}=e;if(!(h||o.get())){p={roomName:i,roomId:n,forceCreate:a,isLobby:d,options:u},r.set("connecting"),l.set(null),h=!0;try{let e;if(i)e=a?await s.create(i,u):await s.joinOrCreate(i,u);else if(n)e=await s.joinById(n,u,t);else throw Error("Must provide either roomName or roomId");g(e,d)}catch(e){console.error("Failed to connect to Colyseus!",e),l.set({message:e instanceof Error?e.message:"Unknown connection error"}),r.set("error"),c<5&&x()}finally{h=!1}}},x=async()=>{if(c>=5){console.error("Max reconnection attempts reached"),r.set("error");return}if(c++,r.set("reconnecting"),i&&1)try{let e=await s.reconnect(i);g(e,(null==p?void 0:p.isLobby)||!1)}catch(e){setTimeout(x,1e3*Math.pow(1.5,c))}else p?(h=!1,f(p)):r.set("error")};return{client:s,connect:f,disconnectFromColyseus:async()=>{c=0,p=null,i=void 0;let e=o.get();if(e){o.set(void 0),n.set(void 0),a.set([]),r.set("disconnected");try{await e.leave()}catch(e){console.error("Error during disconnection:",e)}}},useColyseusRoom:()=>(0,d.useSyncExternalStore)(e=>o.subscribe(e),()=>o.get()),useColyseusState:function(e){return(0,d.useSyncExternalStore)(e=>n.subscribe(e),()=>{let t=n.get();return t&&e?e(t):t})},useLobbyRooms:()=>(0,d.useSyncExternalStore)(e=>a.subscribe(e),()=>a.get()),useConnectionStatus:()=>(0,d.useSyncExternalStore)(e=>r.subscribe(e),()=>r.get()),useConnectionError:()=>(0,d.useSyncExternalStore)(e=>l.subscribe(e),()=>l.get())}},{connect:x,disconnectFromColyseus:P,useColyseusRoom:b,useColyseusState:v,useConnectionStatus:I,useConnectionError:S}=f((void 0)??"ws://localhost:2567"),{connect:M,disconnectFromColyseus:_,useLobbyRooms:w,useConnectionStatus:T,useConnectionError:z}=f((void 0)??"ws://localhost:2567");var k=i(27412),C=i(39621),E=i(87165),A=i(9263),N=i(83927),O=i(86564),D=i(36631),R=i(92962),B=i(58098),L=i(81823),F=i(78302),j=i(88251),U=i(36310),G=i(47117),V=i(82915),H=i(3248);i(7549);var K=i(99044),$=i(47059);class W{createLoadingUI(){var e;this.loadingDiv=document.createElement("div"),this.loadingDiv.className=`
      fixed inset-0
      flex flex-col
      bg-base-200 bg-opacity-90
      transition-opacity duration-500
      opacity-0
      z-50
      pointer-events-none
    `,this.loadingDiv.innerHTML=`
  <!-- Center container -->
  <div class="flex flex-col items-center justify-center h-full max-w-2xl mx-auto px-6">
    <!-- Game Title with gradient applied to text -->
    <div class="text-center mb-12">
      <h1 class="text-5xl md:text-6xl font-bold mb-2 tracking-wider animate-pulse bg-gradient-to-br from-purple-300 via-pink-200 to-yellow-100 bg-clip-text text-transparent">
        Delixia
      </h1>
      <div class="h-1 w-24 mx-auto bg-gradient-to-r from-purple-300 via-pink-200 to-yellow-100 rounded-full"></div>
    </div>

    <!-- Loading text (you can also apply a gradient here if needed) -->
    <div class="w-full text-center mb-8">
      <p id="loading-text" class="text-xl md:text-2xl font-medium text-base-content opacity-80 tracking-wide">
        Loading...
      </p>
    </div>

    <!-- Progress bar and indicator -->
    <div class="w-full">
      <div class="relative">
        <div class="absolute inset-0 bg-primary/20 rounded-full blur-md transform scale-105"></div>
        <div class="relative bg-base-100/80 rounded-full h-3 backdrop-blur-sm">
          <div
  id="progress-bar-fill"
  class="h-full bg-gradient-to-r from-purple-300 via-pink-200 to-yellow-100 rounded-full transition-all duration-300 shadow-lg shadow-yellow-200/50"
  style="width: 0%;"
></div>

        </div>
      </div>
      <div class="flex justify-center gap-2 mt-4">
  <div class="w-2 h-2 bg-gradient-to-r from-purple-300 via-pink-200 to-yellow-100 rounded-full animate-bounce" style="animation-delay: 0s"></div>
  <div class="w-2 h-2 bg-gradient-to-r from-purple-300 via-pink-200 to-yellow-100 rounded-full animate-bounce" style="animation-delay: 0.2s"></div>
  <div class="w-2 h-2 bg-gradient-to-r from-purple-300 via-pink-200 to-yellow-100 rounded-full animate-bounce" style="animation-delay: 0.4s"></div>
</div>

    </div>
  </div>
`,null==(e=this.canvas.parentElement)||e.appendChild(this.loadingDiv),this.progressBar=this.loadingDiv.querySelector("#progress-bar-fill")??void 0,this.loadingTextElement=this.loadingDiv.querySelector("#loading-text")??void 0}displayLoadingUI(){this.loadingDiv&&(this.loadingTextElement&&(this.loadingTextElement.innerText=this.loadingUIText||"Loading..."),this.loadingDiv.style.opacity="1")}hideLoadingUI(){this.loadingDiv&&(this.loadingDiv.style.opacity="0")}updateProgress(e){this.progressBar&&(this.progressBar.style.width=`${e.toFixed(0)}%`),this.loadingTextElement&&(this.loadingTextElement.innerText=this.loadingUIText)}constructor(e){(0,k._)(this,"loadingUIText",""),(0,k._)(this,"loadingUIBackgroundColor","rgba(0, 0, 0, 0.8)"),(0,k._)(this,"loadingDiv",void 0),(0,k._)(this,"progressBar",void 0),(0,k._)(this,"loadingTextElement",void 0),this.canvas=e,this.createLoadingUI()}}let q=e=>{let t,i,s,o,n,a,r,l,c,u,m,g,y,f=(0,p.c)(27);f[0]!==e?({antialias:i,engineOptions:s,adaptToDeviceRatio:t,sceneOptions:l,onRender:n,onSceneReady:a,onDispose:o,...r}=e,f[0]=e,f[1]=t,f[2]=i,f[3]=s,f[4]=o,f[5]=n,f[6]=a,f[7]=r,f[8]=l):(t=f[1],i=f[2],s=f[3],o=f[4],n=f[5],a=f[6],r=f[7],l=f[8]);let x=(0,d.useRef)(null),P=(0,d.useRef)(null),b=(0,d.useRef)(!1),[v,I]=d.useState(!1);return f[9]!==t||f[10]!==i||f[11]!==s||f[12]!==v||f[13]!==o?(c=()=>{let{current:e}=x;if(e&&!v)return(async()=>{let o;if(!P.current&&!b.current){if(b.current=!0,await $.f.IsSupportedAsync){let t=new $.f(e,s);await t.initAsync(),(o=t).compatibilityMode=!1}else o=new K.D(e,i,s,t);o.loadingScreen=new W(e),P.current=o,b.current=!1,I(!0),o.displayLoadingUI()}})().catch(console.error),()=>{I(!1),null==o||o(),P.current&&(P.current.dispose(),P.current=null)}},f[9]=t,f[10]=i,f[11]=s,f[12]=v,f[13]=o,f[14]=c):c=f[14],f[15]!==t||f[16]!==i||f[17]!==s?(u=[i,s,t],f[15]=t,f[16]=i,f[17]=s,f[18]=u):u=f[18],(0,d.useEffect)(c,u),f[19]!==v||f[20]!==n||f[21]!==a||f[22]!==l?(m=()=>{let e;if(v)return(async()=>{let t=P.current;e=new H.x(t,l);let i=async()=>{null==e||e.onBeforeRenderObservable.add(()=>{e&&(null==n||n(e))}),t.runRenderLoop(()=>{e&&e.activeCamera&&e.render()})};e.isReady()?(await a(e),await i()):e.onReadyObservable.addOnce(async e=>{await a(e),await i()});let s=()=>{t.resize(!0)};return window&&window.addEventListener("resize",s),()=>{null==e||e.getEngine().dispose(),window&&window.removeEventListener("resize",s)}})().catch(console.error),()=>{e&&e.dispose()}},g=[v,n,a,l],f[19]=v,f[20]=n,f[21]=a,f[22]=l,f[23]=m,f[24]=g):(m=f[23],g=f[24]),(0,d.useEffect)(m,g),f[25]!==r?(y=(0,h.jsx)("canvas",{ref:x,...r,tabIndex:0}),f[25]=r,f[26]=y):y=f[26],y};var J=i(40023),Q=((o={})[o.Fridge=0]="Fridge",o[o.Oven=1]="Oven",o[o.Counter=2]="Counter",o[o.ChoppingBoard=3]="ChoppingBoard",o[o.Sink=4]="Sink",o[o.Stock=5]="Stock",o[o.Ingredient=6]="Ingredient",o[o.Trash=7]="Trash",o[o.ServingOrder=8]="ServingOrder",o[o.ServingBoard=9]="ServingBoard",o),Z=((n={})[n.None=0]="None",n[n.Nori=1]="Nori",n[n.Rice=2]="Rice",n[n.Onigiri=3]="Onigiri",n[n.Plate=4]="Plate",n[n.CookedRice=5]="CookedRice",n[n.Ebi=6]="Ebi",n[n.Salmon=7]="Salmon",n[n.SalmonNigiri=8]="SalmonNigiri",n[n.EbiNigiri=9]="EbiNigiri",n[n.SeaUrchin=10]="SeaUrchin",n[n.SeaUrchinOpen=11]="SeaUrchinOpen",n[n.SeaUrchinRoll=12]="SeaUrchinRoll",n),X=i(8932),Y=i(72023);function ee(e){let t=JSON.stringify(e,(e,t)=>{if("hash"!==e){if(Array.isArray(t))return t.slice().sort((e,t)=>{let i=JSON.stringify(e),s=JSON.stringify(t);return i<s?-1:+(i>s)});if(t&&"object"==typeof t&&!(t instanceof Date)){let e={};return Object.keys(t).sort().forEach(i=>{e[i]=t[i]}),e}return t}});return(0,Y.sha256)(t)}let et=X.z.object({id:X.z.number().optional(),interactType:X.z.nativeEnum(Q),ingredient:X.z.nativeEnum(Z).optional()}),ei=X.z.object({map:X.z.string(),fileName:X.z.string(),defaultScaling:X.z.object({x:X.z.number().optional(),y:X.z.number().optional(),z:X.z.number().optional()}).optional(),billboardOffset:X.z.object({x:X.z.number(),y:X.z.number(),z:X.z.number()}).optional(),defaultPhysics:X.z.object({shapeType:X.z.nativeEnum(J.Bq),mass:X.z.number().optional(),friction:X.z.number().optional(),restitution:X.z.number().optional()}).optional(),interaction:et.optional(),instances:X.z.array(X.z.object({position:X.z.object({x:X.z.number(),y:X.z.number(),z:X.z.number()}),rotation:X.z.object({x:X.z.number().optional(),y:X.z.number().optional(),z:X.z.number().optional()}).optional(),scaling:X.z.object({x:X.z.number().optional(),y:X.z.number().optional(),z:X.z.number().optional()}).optional(),physics:X.z.object({shapeType:X.z.number(),mass:X.z.number().optional(),friction:X.z.number().optional(),restitution:X.z.number().optional()}).optional(),interaction:et.optional()})),hash:X.z.string().optional()}),es=function(e){for(let t of e)ei.parse(t);return e}(function(e){let t={};for(let i of e)for(let e of i.instances)if(e.interaction??i.interaction){if(i.interaction&&!e.interaction&&(e.interaction={...i.interaction}),!e.interaction)continue;let s=e.interaction.interactType,o=e.interaction.ingredient??Z.None,n=`${s}_${o}`;t[n]||(t[n]=0),e.interaction.id=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Z.None,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return(e+1)*1e6+1e3*t+Math.min(Math.max(i,0),999)}(s,o,t[n]),t[n]++}let i=ee(e);for(let t of e)t.hash=i;return e}([{map:"japan",fileName:"Table.glb",defaultScaling:{x:.5,y:.5,z:.5},defaultPhysics:{shapeType:J.Bq.BOX,mass:0,friction:.8,restitution:.1},instances:[{position:{x:5,y:3.5,z:-5},rotation:{y:Math.PI},scaling:{x:1,y:.5,z:1}},{position:{x:-5,y:3.5,z:-5},rotation:{y:Math.PI},scaling:{x:1,y:.5,z:1}},{position:{x:0,y:2,z:-2},rotation:{y:Math.PI/2},scaling:{x:2.5,y:.5,z:.75}},{position:{x:-8,y:0,z:-8},rotation:{y:Math.PI},scaling:{x:.75,y:.5,z:.75}},{position:{x:8,y:0,z:-8},rotation:{y:Math.PI},scaling:{x:.75,y:.5,z:.75}},{position:{x:0,y:0,z:-7.85},rotation:{y:Math.PI},scaling:{x:1,y:.5,z:1}},{position:{x:-8,y:0,z:8},rotation:{y:Math.PI},scaling:{x:.75,y:.5,z:.75}},{position:{x:8,y:0,z:8},rotation:{y:Math.PI},scaling:{x:.75,y:.5,z:.75}},{position:{x:-7.85,y:0,z:0},rotation:{y:Math.PI},scaling:{x:1,y:.5,z:1}},{position:{x:7.85,y:0,z:0},rotation:{y:Math.PI},scaling:{x:1,y:.5,z:1}}]},{map:"japan",fileName:"cloud1.glb",defaultScaling:{x:.2,y:.2,z:.2},defaultPhysics:{shapeType:J.Bq.BOX,mass:0,friction:.8,restitution:.1},instances:[{position:{x:5.95,y:3.5,z:-4.2},scaling:{x:.1,y:.1,z:.1}},{position:{x:4.07,y:3.5,z:-4.2},scaling:{x:.1,y:.1,z:.1}},{position:{x:5.95,y:3.5,z:-5.95},scaling:{x:.1,y:.1,z:.1}},{position:{x:4.07,y:3.5,z:-5.85},scaling:{x:.1,y:.1,z:.1}},{position:{x:-2.2,y:2,z:-1.3},scaling:{x:.2,y:.1,z:.1}},{position:{x:2.1,y:2,z:-1.3},scaling:{x:.2,y:.1,z:.1}},{position:{x:-2.2,y:2,z:-2.7},scaling:{x:.2,y:.1,z:.1}},{position:{x:2.1,y:2,z:-2.7},scaling:{x:.2,y:.1,z:.1}},{position:{x:-5.95,y:3.5,z:-4.2},scaling:{x:.1,y:.1,z:.1}},{position:{x:-4.07,y:3.5,z:-4.2},scaling:{x:.1,y:.1,z:.1}},{position:{x:-5.95,y:3.5,z:-5.95},scaling:{x:.1,y:.1,z:.1}},{position:{x:-4.07,y:3.5,z:-5.85},scaling:{x:.1,y:.1,z:.1}}]},{map:"japan",fileName:"cloud1.glb",defaultScaling:{x:.2,y:.2,z:.2},defaultPhysics:{shapeType:J.Bq.BOX,mass:0,friction:.8,restitution:.1},interaction:{interactType:Q.ServingOrder},instances:[{position:{x:8,y:.4,z:-7},rotation:{y:Math.PI}},{position:{x:7,y:.4,z:-8},rotation:{y:Math.PI/2}},{position:{x:-7,y:.4,z:-8},rotation:{y:-Math.PI/2}},{position:{x:-8,y:.4,z:-7},rotation:{y:Math.PI}},{position:{x:5,y:3.9,z:-3.5},rotation:{y:Math.PI}},{position:{x:5,y:3.9,z:-6.5}},{position:{x:3.5,y:3.9,z:-5},rotation:{y:Math.PI/2}},{position:{x:6.5,y:3.9,z:-5},rotation:{y:-Math.PI/2}},{position:{x:-5,y:3.9,z:-3.5},rotation:{y:Math.PI}},{position:{x:-5,y:3.9,z:-6.5}},{position:{x:-3.5,y:3.9,z:-5},rotation:{y:-Math.PI/2}},{position:{x:-6.5,y:3.9,z:-5},rotation:{y:Math.PI/2}},{position:{x:0,y:2.4,z:-.75},rotation:{y:Math.PI}},{position:{x:0,y:2.4,z:-3.2}},{position:{x:-1.5,y:2.4,z:-.75},rotation:{y:Math.PI}},{position:{x:-1.5,y:2.4,z:-3.2}},{position:{x:1.5,y:2.4,z:-.75},rotation:{y:Math.PI}},{position:{x:1.5,y:2.4,z:-3.2}},{position:{x:8,y:.4,z:7}},{position:{x:7,y:.4,z:8},rotation:{y:Math.PI/2}},{position:{x:-7,y:.4,z:8},rotation:{y:-Math.PI/2}},{position:{x:-8,y:.4,z:7}},{position:{x:-7.8,y:.4,z:1.35},rotation:{y:-Math.PI}},{position:{x:-6.5,y:.4,z:0},rotation:{y:-Math.PI/2}},{position:{x:-7.8,y:.4,z:-1.35}},{position:{x:7.8,y:.4,z:1.35},rotation:{y:Math.PI}},{position:{x:6.5,y:.4,z:0},rotation:{y:Math.PI/2}},{position:{x:7.8,y:.4,z:-1.35}},{position:{x:1.35,y:.4,z:-7.8},rotation:{y:-Math.PI/2}},{position:{x:0,y:.4,z:-6.5},rotation:{y:Math.PI}},{position:{x:-1.35,y:.4,z:-7.8},rotation:{y:Math.PI/2}}]},{map:"japan",fileName:"Shoji Wall.glb",defaultScaling:{x:.5,y:.5,z:.5},defaultPhysics:{shapeType:J.Bq.BOX,mass:0,friction:.8,restitution:.1},instances:[{position:{x:-8,y:.1,z:8}},{position:{x:-8,y:.1,z:8},rotation:{y:-Math.PI/2}},{position:{x:8,y:.1,z:8}},{position:{x:8,y:.1,z:8},rotation:{y:Math.PI/2}},{position:{x:8,y:.1,z:-8},rotation:{y:Math.PI/2}},{position:{x:8,y:.1,z:-8},rotation:{y:-Math.PI}},{position:{x:-8,y:.1,z:-8},rotation:{y:Math.PI}},{position:{x:-8,y:.1,z:-8},rotation:{y:-Math.PI/2}},{position:{x:0,y:.1,z:8}},{position:{x:0,y:.1,z:-8},rotation:{y:Math.PI}},{position:{x:-8,y:.1,z:0},rotation:{y:-Math.PI/2}},{position:{x:8,y:.1,z:0},rotation:{y:Math.PI/2}}]},{map:"japan",fileName:"Normal Wall.glb",defaultScaling:{x:.5,y:.5,z:.5},defaultPhysics:{shapeType:J.Bq.BOX,mass:0,friction:.8,restitution:.1},instances:[{position:{x:2,y:.1,z:8}},{position:{x:6,y:.1,z:8}},{position:{x:-2,y:.1,z:8}},{position:{x:-6,y:.1,z:8}},{position:{x:4,y:.1,z:8}},{position:{x:-4,y:.1,z:8}},{position:{x:2,y:.1,z:-8},rotation:{y:Math.PI}},{position:{x:6,y:.1,z:-8},rotation:{y:Math.PI}},{position:{x:-2,y:.1,z:-8},rotation:{y:Math.PI}},{position:{x:-6,y:.1,z:-8},rotation:{y:Math.PI}},{position:{x:-8,y:.1,z:2},rotation:{y:-Math.PI/2}},{position:{x:-8,y:.1,z:6},rotation:{y:-Math.PI/2}},{position:{x:-8,y:.1,z:-2},rotation:{y:-Math.PI/2}},{position:{x:-8,y:.1,z:-6},rotation:{y:-Math.PI/2}},{position:{x:8,y:.1,z:2},rotation:{y:Math.PI/2}},{position:{x:8,y:.1,z:6},rotation:{y:Math.PI/2}},{position:{x:8,y:.1,z:-2},rotation:{y:Math.PI/2}},{position:{x:8,y:.1,z:-6},rotation:{y:Math.PI/2}}]},{map:"japan",fileName:"Wall with Shelves.glb",defaultScaling:{x:.5,y:.5,z:.5},defaultPhysics:{shapeType:J.Bq.BOX,mass:0,friction:.8,restitution:.1},instances:[{position:{x:4,y:.1,z:-8},rotation:{y:Math.PI}},{position:{x:-4,y:.1,z:-8},rotation:{y:Math.PI}},{position:{x:-8,y:.1,z:4},rotation:{y:-Math.PI/2}},{position:{x:-8,y:.1,z:-4},rotation:{y:-Math.PI/2}},{position:{x:8,y:.1,z:4},rotation:{y:Math.PI/2}},{position:{x:8,y:.1,z:-4},rotation:{y:Math.PI/2}}]},{map:"japan",fileName:"Fridge.glb",defaultScaling:{x:.5,y:.5,z:.5},defaultPhysics:{shapeType:J.Bq.BOX,mass:0,friction:.8,restitution:.1},billboardOffset:{x:0,y:1,z:-.8},instances:[{position:{x:3,y:.15,z:8.6}},{position:{x:-3,y:.15,z:8.6}}]},{map:"japan",fileName:"Oven.glb",defaultScaling:{x:.375,y:.3,z:.5},defaultPhysics:{shapeType:J.Bq.BOX,mass:0,friction:.8,restitution:.1},billboardOffset:{x:0,y:1.5,z:0},instances:[{interaction:{interactType:Q.Oven},position:{x:-2,y:.1,z:8.57}},{interaction:{interactType:Q.Oven},position:{x:2,y:.1,z:8.57}}]},{map:"japan",fileName:"Cupcake.glb",defaultScaling:{x:.65,y:.65,z:.65},instances:[{position:{x:0,y:.67,z:2},rotation:{y:Math.PI}},{position:{x:4,y:.67,z:6.5},rotation:{y:Math.PI}},{position:{x:-4,y:.67,z:6.5},rotation:{y:Math.PI}},{position:{x:1.25,y:.67,z:8.5},rotation:{y:Math.PI}},{position:{x:-1.25,y:.67,z:8.5},rotation:{y:Math.PI}},{position:{x:3.1,y:.67,z:2},rotation:{y:Math.PI}},{position:{x:-3.1,y:.67,z:2},rotation:{y:Math.PI}},{position:{x:4,y:.67,z:2.8},rotation:{y:Math.PI}},{position:{x:-4,y:.67,z:2.8},rotation:{y:Math.PI}},{position:{x:4,y:.67,z:8.25},rotation:{y:Math.PI}},{position:{x:-4,y:.67,z:8.25},rotation:{y:Math.PI}}]},{map:"japan",fileName:"Lollipop 2.glb",defaultScaling:{x:.024,y:.024,z:.024},instances:[{position:{x:0,y:2.7,z:9},rotation:{x:-Math.PI/2}},{position:{x:0,y:2.7,z:-9},rotation:{x:-Math.PI/2}},{position:{x:9,y:2.7,z:0},rotation:{x:-Math.PI/2}},{position:{x:-9,y:2.7,z:0},rotation:{x:-Math.PI/2}}]},{map:"japan",fileName:"Dango.glb",defaultScaling:{x:1.75,y:1.75,z:1.75},instances:[{position:{x:1.875,y:3.25,z:9},rotation:{z:Math.PI/2}},{position:{x:-1.875,y:3.25,z:9},rotation:{z:Math.PI/2}},{position:{x:1.875,y:3.25,z:-9},rotation:{z:Math.PI/2}},{position:{x:-1.875,y:3.25,z:-9},rotation:{z:Math.PI/2}},{position:{x:9,y:3.25,z:1.875},rotation:{z:Math.PI/2}},{position:{x:9,y:3.25,z:-1.875},rotation:{z:Math.PI/2}},{position:{x:-9,y:3.25,z:1.875},rotation:{z:Math.PI/2}},{position:{x:-9,y:3.25,z:-1.875},rotation:{z:Math.PI/2}},{position:{x:5.625,y:3.25,z:9},rotation:{z:Math.PI/2}},{position:{x:-5.625,y:3.25,z:9},rotation:{z:Math.PI/2}},{position:{x:5.625,y:3.25,z:-9},rotation:{z:Math.PI/2}},{position:{x:-5.625,y:3.25,z:-9},rotation:{z:Math.PI/2}},{position:{x:9,y:3.25,z:5.625},rotation:{z:Math.PI/2}},{position:{x:9,y:3.25,z:-5.625},rotation:{z:Math.PI/2}},{position:{x:-9,y:3.25,z:5.625},rotation:{z:Math.PI/2}},{position:{x:-9,y:3.25,z:-5.625},rotation:{z:Math.PI/2}},{position:{x:9,y:3.25,z:9},rotation:{z:Math.PI/2}},{position:{x:9,y:3.25,z:-9},rotation:{z:Math.PI/2}},{position:{x:-9,y:3.25,z:-9},rotation:{z:Math.PI/2}},{position:{x:-9,y:3.25,z:9},rotation:{z:Math.PI/2}}]},{map:"japan",fileName:"Platform.glb",defaultScaling:{x:.5,y:.5,z:.5},defaultPhysics:{shapeType:J.Bq.BOX,mass:0,friction:.8,restitution:.1},instances:[{position:{x:6,y:1.9,z:2.75},rotation:{y:Math.PI/2}},{position:{x:-6,y:1.9,z:2.75},rotation:{y:Math.PI/2}},{position:{x:4.3,y:1.9,z:.75},rotation:{y:Math.PI/2}},{position:{x:-4.3,y:1.9,z:.75},rotation:{y:Math.PI/2}},{position:{x:5,y:3.8,z:0},rotation:{y:Math.PI/2}},{position:{x:-5,y:3.8,z:0},rotation:{y:Math.PI/2}},{position:{x:5,y:3.8,z:-1.5},rotation:{y:Math.PI/2}},{position:{x:-5,y:3.8,z:-1.5},rotation:{y:Math.PI/2}},{position:{x:6.4,y:3.8,z:-2.6},rotation:{y:Math.PI/2}},{position:{x:-6.4,y:3.8,z:-2.6},rotation:{y:Math.PI/2}},{position:{x:3.7,y:3.8,z:-2.6},rotation:{y:Math.PI/2}},{position:{x:-3.7,y:3.8,z:-2.6},rotation:{y:Math.PI/2}},{position:{x:2.1,y:3.8,z:-5.8},rotation:{y:Math.PI/2}},{position:{x:-2.1,y:3.8,z:-5.8},rotation:{y:Math.PI/2}},{position:{x:2.1,y:1,z:-5.5},rotation:{y:Math.PI/2}},{position:{x:-2.1,y:1,z:-5.5},rotation:{y:Math.PI/2}}]},{map:"japan",fileName:"Grass Platform.glb",defaultScaling:{x:2,y:2,z:2},defaultPhysics:{shapeType:J.Bq.BOX,mass:0,friction:.8,restitution:.1},instances:[{position:{x:7,y:.75,z:4},rotation:{y:Math.PI/2}},{position:{x:-7,y:.75,z:4},rotation:{y:Math.PI/2}},{position:{x:5.8,y:2.5,z:1.25},rotation:{y:Math.PI/2}},{position:{x:-5.8,y:2.5,z:1.25},rotation:{y:Math.PI/2}},{position:{x:2.65,y:1.6,z:.25},rotation:{y:Math.PI/2}},{position:{x:-2.65,y:1.6,z:.25},rotation:{y:Math.PI}},{position:{x:-.9,y:1.6,z:.25},rotation:{y:Math.PI/2}},{position:{x:.9,y:1.6,z:.25},rotation:{y:Math.PI/2}},{position:{x:7.7,y:3.5,z:-4},rotation:{y:Math.PI/2}},{position:{x:-7.7,y:3.5,z:-4},rotation:{y:Math.PI/2}},{position:{x:2.3,y:3.5,z:-4},rotation:{y:Math.PI/2}},{position:{x:-2.3,y:3.5,z:-4},rotation:{y:Math.PI/2}},{position:{x:.85,y:1.6,z:-4},rotation:{y:Math.PI/2}},{position:{x:-.85,y:1.6,z:-4},rotation:{y:Math.PI/2}},{position:{x:3.3,y:3.5,z:-7.3},rotation:{y:Math.PI/2}},{position:{x:-3.3,y:3.5,z:-7.3},rotation:{y:Math.PI/2}},{position:{x:0,y:2.5,z:-7.3},rotation:{y:Math.PI/2}},{position:{x:0,y:2.5,z:-5.5},rotation:{y:Math.PI/2}}]},{map:"japan",fileName:"Donut.glb",defaultScaling:{x:1,y:1,z:1},instances:[{position:{x:4,y:.6,z:2}},{position:{x:-4,y:.6,z:2}}]},{map:"japan",fileName:"Candy cane.glb",defaultScaling:{x:.03,y:.05,z:.035},instances:[{position:{x:4,y:0,z:3.9},rotation:{y:-Math.PI/2}},{position:{x:4,y:0,z:4.61},rotation:{y:Math.PI/2}},{position:{x:-4,y:0,z:3.9},rotation:{y:-Math.PI/2}},{position:{x:-4,y:0,z:4.61},rotation:{y:Math.PI/2}}]},{map:"japan",fileName:"Lollipop.glb",defaultScaling:{x:.25,y:.25,z:.25},instances:[{position:{x:7.5,y:2.7,z:9},rotation:{y:Math.PI/2},scaling:{x:.2,y:.2,z:.2}},{position:{x:3.75,y:2.7,z:9},rotation:{y:Math.PI/2}},{position:{x:-7.5,y:2.7,z:9},rotation:{y:Math.PI/2}},{position:{x:-3.75,y:2.7,z:9},rotation:{y:Math.PI/2},scaling:{x:.2,y:.2,z:.2}},{position:{x:3.75,y:2.7,z:-9},rotation:{y:Math.PI/2},scaling:{x:.2,y:.2,z:.2}},{position:{x:7.5,y:2.7,z:-9},rotation:{y:Math.PI/2}},{position:{x:-3.75,y:2.7,z:-9},rotation:{y:Math.PI/2}},{position:{x:-7.5,y:2.7,z:-9},rotation:{y:Math.PI/2},scaling:{x:.2,y:.2,z:.2}},{position:{x:9,y:2.7,z:3.75},rotation:{y:Math.PI},scaling:{x:.2,y:.2,z:.2}},{position:{x:9,y:2.7,z:7.5},rotation:{y:Math.PI}},{position:{x:9,y:2.7,z:-3.75},rotation:{y:Math.PI}},{position:{x:9,y:2.7,z:-7.75},rotation:{y:Math.PI},scaling:{x:.2,y:.2,z:.2}},{position:{x:-9,y:2.7,z:7.5},rotation:{y:Math.PI},scaling:{x:.2,y:.2,z:.2}},{position:{x:-9,y:2.7,z:3.75},rotation:{y:Math.PI}},{position:{x:-9,y:2.7,z:-7.5},rotation:{y:Math.PI}},{position:{x:-9,y:2.7,z:-3.75},rotation:{y:Math.PI},scaling:{x:.2,y:.2,z:.2}}]},{map:"japan",fileName:"Nori.glb",defaultScaling:{x:.4,y:.4,z:.4},defaultPhysics:{shapeType:J.Bq.BOX,mass:0,friction:.8,restitution:.1},billboardOffset:{x:0,y:.5,z:0},instances:[{position:{x:-1.05,y:.72,z:4.65},rotation:{x:0,y:0,z:0}},{interaction:{interactType:Q.Stock,ingredient:Z.Nori},position:{x:-1.05,y:.77,z:4.75},rotation:{x:0,y:0,z:0}},{position:{x:-1.05,y:.72,z:4.85},rotation:{x:0,y:0,z:0}}]},{map:"japan",fileName:"Rice Ball.glb",defaultScaling:{x:.4,y:.4,z:.4},defaultPhysics:{shapeType:J.Bq.BOX,mass:0,friction:.8,restitution:.1},billboardOffset:{x:0,y:.5,z:0},instances:[{interaction:{interactType:Q.Stock,ingredient:Z.Rice},position:{x:1.05,y:.77,z:4.75},rotation:{x:0,y:0,z:0}}]},{map:"japan",fileName:"Plate.glb",defaultScaling:{x:.7,y:.35,z:.7},defaultPhysics:{shapeType:J.Bq.BOX,mass:0,friction:.8,restitution:.1},billboardOffset:{x:0,y:.5,z:0},instances:[{position:{x:0,y:.67,z:4.75},rotation:{x:0,y:0,z:0}},{position:{x:0,y:.71,z:4.75},rotation:{x:0,y:0,z:0}},{position:{x:0,y:.75,z:4.75},rotation:{x:0,y:0,z:0}},{position:{x:0,y:.79,z:4.75},rotation:{x:0,y:0,z:0}},{interaction:{interactType:Q.Stock,ingredient:Z.Plate},position:{x:0,y:.83,z:4.75},rotation:{x:0,y:0,z:0}}]},{map:"japan",fileName:"Chopping board.glb",defaultScaling:{x:.4,y:.4,z:.4},defaultPhysics:{shapeType:J.Bq.BOX,mass:0,friction:.8,restitution:.1},billboardOffset:{x:0,y:.5,z:0},instances:[{position:{x:.5,y:.67,z:8.5},rotation:{x:0,y:0,z:0},interaction:{interactType:Q.ChoppingBoard}},{position:{x:-.5,y:.67,z:8.5},rotation:{x:0,y:0,z:0},interaction:{interactType:Q.ChoppingBoard}}]},{map:"japan",fileName:"Counter Straight.glb",defaultScaling:{x:.5,y:.3,z:.5},defaultPhysics:{shapeType:J.Bq.BOX,mass:0,friction:.8,restitution:.1},instances:[{position:{x:0,y:.1,z:2},rotation:{y:Math.PI}},{position:{x:4,y:.1,z:6},rotation:{y:Math.PI/2}},{position:{x:4,y:.1,z:8},rotation:{y:Math.PI/2}},{position:{x:4,y:.1,z:3},rotation:{y:Math.PI/2},scaling:{x:.5,y:.3,z:.25}},{position:{x:-4,y:.1,z:6},rotation:{y:-Math.PI/2}},{position:{x:-4,y:.1,z:8},rotation:{y:-Math.PI/2}},{position:{x:-4,y:.1,z:3},rotation:{y:-Math.PI/2},scaling:{x:.5,y:.3,z:.25}},{position:{x:0,y:.1,z:8.6},rotation:{y:Math.PI},scaling:{x:.8,y:.3,z:.6}},{position:{x:0,y:.1,z:5.25},scaling:{x:.9,y:.3,z:1.25}}]},{map:"japan",fileName:"Counter Corner.glb",defaultScaling:{x:.5,y:.3,z:.5},defaultPhysics:{shapeType:J.Bq.MESH,mass:0,friction:.8,restitution:.1},instances:[{position:{x:4,y:.1,z:2},rotation:{y:Math.PI/2}},{position:{x:-4,y:.1,z:2},rotation:{y:Math.PI}}]},{map:"japan",fileName:"Counter Sink.glb",defaultScaling:{x:.5,y:.3,z:.5},defaultPhysics:{shapeType:J.Bq.MESH,mass:0,friction:.8,restitution:.1},billboardOffset:{x:0,y:1.5,z:0},instances:[{position:{x:-2,y:.1,z:2},rotation:{y:Math.PI},interaction:{interactType:Q.Trash}},{position:{x:2,y:.1,z:2},rotation:{y:Math.PI},interaction:{interactType:Q.Trash}}]},{map:"fastfood",fileName:"Crate.glb",defaultScaling:{x:.35,y:.3,z:.35},defaultPhysics:{shapeType:J.Bq.MESH,mass:0,friction:.8,restitution:.1},instances:[{position:{x:1.05,y:.67,z:4.75},rotation:{y:Math.PI}},{position:{x:-1.05,y:.67,z:4.75},rotation:{y:Math.PI}},{position:{x:-1.05,y:.67,z:5.75},rotation:{y:Math.PI}},{position:{x:0,y:.67,z:5.75},rotation:{y:Math.PI}},{position:{x:1.05,y:.67,z:5.75},rotation:{y:Math.PI}}]},{map:"fastfood",fileName:"Pot A.glb",defaultScaling:{x:.5,y:.7,z:.5},defaultPhysics:{shapeType:J.Bq.MESH,mass:0,friction:.8,restitution:.1},instances:[{position:{x:2,y:.77,z:8.4},rotation:{y:Math.PI}},{position:{x:-2,y:.77,z:8.4},rotation:{y:Math.PI}}]},{map:"japan",fileName:"Salmon.glb",defaultScaling:{x:.65,y:.5,z:.6},defaultPhysics:{shapeType:J.Bq.MESH,mass:0,friction:.8,restitution:.1},billboardOffset:{x:0,y:.5,z:0},instances:[{position:{x:.05,y:.67,z:5.77},rotation:{y:Math.PI},interaction:{interactType:Q.Stock,ingredient:Z.Salmon}}]},{map:"japan",fileName:"Sea Urchin.glb",defaultScaling:{x:.35,y:.35,z:.35},defaultPhysics:{shapeType:J.Bq.MESH,mass:0,friction:.8,restitution:.1},billboardOffset:{x:0,y:.5,z:0},instances:[{position:{x:1.17,y:.77,z:5.85},rotation:{y:Math.PI}},{position:{x:.93,y:.77,z:5.85},rotation:{y:Math.PI}},{position:{x:1.05,y:.77,z:5.66},rotation:{y:Math.PI},interaction:{interactType:Q.Stock,ingredient:Z.SeaUrchin}}]},{map:"japan",fileName:"Ebi.glb",defaultScaling:{x:.75,y:.75,z:.75},defaultPhysics:{shapeType:J.Bq.MESH,mass:0,friction:.8,restitution:.1},billboardOffset:{x:0,y:.5,z:0},instances:[{position:{x:-1.17,y:.67,z:5.85},rotation:{y:Math.PI}},{position:{x:-.93,y:.67,z:5.85},rotation:{y:Math.PI}},{position:{x:-1.05,y:.67,z:5.66},rotation:{y:Math.PI},interaction:{interactType:Q.Stock,ingredient:Z.Ebi}}]},{map:"japan",fileName:"Board.glb",defaultScaling:{x:.15,y:.05,z:.25},defaultPhysics:{shapeType:J.Bq.MESH,mass:0,friction:.8,restitution:.1},billboardOffset:{x:0,y:.5,z:0},interaction:{interactType:Q.ServingBoard},instances:[{position:{x:-4,y:.67,z:5.85},rotation:{y:Math.PI}},{position:{x:4,y:.67,z:5.85},rotation:{x:Math.PI}},{position:{x:-4,y:.67,z:7.15},rotation:{y:-Math.PI}},{position:{x:4,y:.67,z:7.15},rotation:{x:-Math.PI}},{position:{x:-.65,y:.67,z:2},scaling:{x:.25,y:.05,z:.15},rotation:{y:Math.PI/2}},{position:{x:.65,y:.67,z:2},scaling:{x:.25,y:.05,z:.15},rotation:{y:Math.PI/2}}]},{map:"japan",fileName:"Wood Floor.glb",defaultScaling:{x:.5,y:.5,z:.5},defaultPhysics:{shapeType:J.Bq.BOX,mass:0,friction:.8,restitution:.1},instances:(()=>{let e=[];for(let t=-4;t<5;t++)for(let i=-4;i<5;i++)e.push({position:{x:2*t,y:.1,z:2*i}});return e})()}]));var eo=i(92538),en=i(32963),ea=i(91783),er=i(9197);let el={[Z.Plate]:{scale:{x:.6,y:.6,z:.6}},[Z.Rice]:{scale:{x:.4,y:.4,z:.4},onBoard:{positionOffset:{x:0,y:-.1,z:0}}},[Z.CookedRice]:{scale:{x:.4,y:.4,z:.4},onBoard:{positionOffset:{x:0,y:-.1,z:0}}},[Z.Nori]:{scale:{x:.4,y:.4,z:.4},onBoard:{positionOffset:{x:0,y:-.05,z:0}}},[Z.Ebi]:{onBoard:{positionOffset:{x:0,y:-.05,z:0}}},[Z.EbiNigiri]:{scale:{x:.6,y:.6,z:.6}},[Z.Salmon]:{onBoard:{positionOffset:{x:.23,y:-.1,z:0}}},[Z.SalmonNigiri]:{scale:{x:.6,y:.6,z:.6}},[Z.SeaUrchinRoll]:{scale:{x:.4,y:.4,z:.4},onBoard:{positionOffset:{x:0,y:-.1,z:0}}},[Z.Onigiri]:{scale:{x:.5,y:.5,z:.5},onBoard:{positionOffset:{x:0,y:-.1,z:0}}}},eh={[Z.None]:{id:Z.None,name:"None",icon:"",model:""},[Z.Nori]:{id:Z.Nori,name:"Nori",icon:"nori",model:"Nori.glb"},[Z.Rice]:{id:Z.Rice,name:"Rice",icon:"rice",model:"Rice Ball.glb"},[Z.CookedRice]:{id:Z.CookedRice,name:"Cooked Rice",icon:"rice",model:"Rice Ball.glb",isResult:!0},[Z.Onigiri]:{id:Z.Onigiri,name:"Onigiri",icon:"onigiri",model:"Onigiri.glb",isResult:!0,isFinal:!0},[Z.Plate]:{id:Z.Plate,name:"Plate",icon:"plate",model:"Plate.glb",isPlate:!0},[Z.Ebi]:{id:Z.Ebi,name:"Ebi",icon:"ebi",model:"Ebi.glb"},[Z.Salmon]:{id:Z.Salmon,name:"Salmon",icon:"salmon",model:"Salmon.glb"},[Z.SalmonNigiri]:{id:Z.SalmonNigiri,name:"Salmon Nigiri",icon:"salmon_nigiri",model:"Salmon Nigiri.glb",isResult:!0,isFinal:!0},[Z.EbiNigiri]:{id:Z.EbiNigiri,name:"Ebi Nigiri",icon:"ebi_nigiri",model:"Ebi Nigiri.glb",isResult:!0,isFinal:!0},[Z.SeaUrchin]:{id:Z.SeaUrchin,name:"Sea Urchin",icon:"sea_urchin",model:"Sea Urchin.glb"},[Z.SeaUrchinOpen]:{id:Z.SeaUrchinOpen,name:"Sea Urchin Open",icon:"sea_urchin_open",model:"Sea Urchin Open.glb",isResult:!0},[Z.SeaUrchinRoll]:{id:Z.SeaUrchinRoll,name:"Sea Urchin Roll",icon:"sea_urchin_roll",model:"Sea Urchin Roll.glb",isResult:!0,isFinal:!0}};var ed=i(40383);class ec{_setupHorizontalProgressBar(){this.progressBarPlane=eo.VO7.CreatePlane(`${this.mesh.name}_progressBarPlane`,{width:this.progressBarPlaneWidth,height:this.progressBarPlaneHeight},this.scene),this.progressBarPlane.setAbsolutePosition(this.mesh.getAbsolutePosition().add(this.billboardOffset)),this.progressBarPlane.billboardMode=eo.Kj0.BILLBOARDMODE_ALL,this.progressBarPlane.renderingGroupId=1,this.progressBarPlane.isPickable=!1,this.progressBarPlane.setEnabled(!1),this.progressBarTexture=new ea.c(`${this.mesh.name}_progressBarTexture`,{width:this.progressBarTextureWidth,height:this.progressBarTextureHeight},this.scene,!1,O.x.BILINEAR_SAMPLINGMODE),this.progressBarTexture.hasAlpha=!0,this.progressBarMaterial=new D.K(`${this.mesh.name}_progressBarMat`,this.scene),this.progressBarMaterial.diffuseTexture=this.progressBarTexture,this.progressBarMaterial.opacityTexture=this.progressBarTexture,this.progressBarMaterial.useAlphaFromDiffuseTexture=!1,this.progressBarMaterial.emissiveColor=R.Wo.White(),this.progressBarMaterial.disableLighting=!0,this.progressBarMaterial.backFaceCulling=!1,this.progressBarPlane.material=this.progressBarMaterial}_updateHorizontalProgressBar(e){if(!this.isCooking||!this.progressBarTexture||!this.progressBarPlane||!this.progressBarPlane.isEnabled)return;let t=this.cookingTotalDuration>0?ed.Rus.Clamp((e-this.cookingStartTime)/this.cookingTotalDuration,0,1):0,i=this.progressBarTexture.getContext();if(!i)return void console.error(`[${this.id}] ERROR: Failed to get context from progressBarTexture!`);let s=this.progressBarTextureWidth,o=this.progressBarTextureHeight,n=s-8,a=o-8,r=n*t;if(i.clearRect(0,0,s,o),i.fillStyle="rgba(30, 30, 30, 0.8)",i.fillRect(4,4,n,a),r>0){let e="#86EFAC";t>=.8?e="#F87171":t>=1&&(e="#808080"),i.fillStyle=e,i.fillRect(4,4,r,a)}i.strokeStyle="rgba(200, 200, 200, 0.9)",i.lineWidth=2,i.strokeRect(4,4,n,a),this.progressBarTexture.update()}_setupPromptMaterial(e){let t,i=`prompt_${e}`;if(ec.promptTextures.has(i))t=ec.promptTextures.get(i);else{let s=(t=new ea.c(i,{width:64,height:64},this.scene,!1)).getContext();s.fillRect(0,0,64,64),s.fillStyle="#FF9999",s.font='bold 32px "Patrick Hand"',s.textAlign="center",s.textBaseline="middle",s.fillText(e.toUpperCase(),32,34),t.update(!0),ec.promptTextures.set(i,t)}let s=new D.K("promptMat",this.scene);s.diffuseTexture=t,s.opacityTexture=t,s.useAlphaFromDiffuseTexture=!1,s.emissiveColor=R.Wo.White(),s.disableLighting=!0,this.promptDisc.material=s}_setupRenderObserver(){this._renderObserver&&this.scene.onBeforeRenderObservable.remove(this._renderObserver),this._renderObserver=this.scene.onBeforeRenderObservable.add(()=>{let e=Date.now();if(this.promptDisc.isEnabled()&&(this.mesh.getAbsolutePosition().addToRef(this.billboardOffset,this._positionUpdateTemp),this._positionUpdateTemp.y+=.15*Math.sin(.0015*Date.now()),this.promptDisc.setAbsolutePosition(this._positionUpdateTemp)),this.displayedIngredientInfos.length>0||this.cookingVisualInfo){let e=this.ingredientAnchor.getWorldMatrix();for(let t of this.displayedIngredientInfos)B.P.TransformCoordinatesToRef(t.localOffset,e,this._positionUpdateTemp),t.mesh.setAbsolutePosition(this._positionUpdateTemp),this.ingredientAnchor.absoluteRotationQuaternion.multiplyToRef(t.localRotation,t.mesh.rotationQuaternion),t.mesh.scaling.copyFrom(t.localScale);this.cookingVisualInfo&&(B.P.TransformCoordinatesToRef(this.cookingVisualInfo.localOffset,e,this._positionUpdateTemp),this.cookingVisualInfo.mesh.setAbsolutePosition(this._positionUpdateTemp),this.ingredientAnchor.absoluteRotationQuaternion.multiplyToRef(this.cookingVisualInfo.localRotation,this.cookingVisualInfo.mesh.rotationQuaternion),this.cookingVisualInfo.mesh.scaling.copyFrom(this.cookingVisualInfo.localScale))}this.isCooking&&this.interactType===Q.Oven&&this.progressBarPlane&&(this.mesh.getAbsolutePosition().addToRef(this.billboardOffset,this._positionUpdateTemp),this.progressBarPlane.setAbsolutePosition(this._positionUpdateTemp),e-this.lastProgressBarUpdateTime>this.progressBarUpdateInterval&&(this._updateHorizontalProgressBar(e),this.lastProgressBarUpdateTime=e))})}static reset(){this.promptTextures.forEach(e=>e.dispose()),this.promptTextures.clear(),this.particleTextures.forEach(e=>e.dispose()),this.particleTextures.clear()}createSparkleEffect(){this.sparkleSystem=new en.p(`${this.mesh.name}_sparkles`,15,this.scene),this.sparkleSystem.disposeOnStop=!0,this.sparkleSystem.emitter=this.promptDisc;let e=new B.P(-.1,-.1,-.1),t=new B.P(.1,.1,.1);this.sparkleSystem.minEmitBox=e,this.sparkleSystem.maxEmitBox=t,this.sparkleSystem.color1=new R.HE(1,.85,.9,.6),this.sparkleSystem.color2=new R.HE(.85,.9,1,.6),this.sparkleSystem.colorDead=new R.HE(0,0,0,0),this.sparkleSystem.minSize=.02,this.sparkleSystem.maxSize=.06,this.sparkleSystem.minLifeTime=1,this.sparkleSystem.maxLifeTime=2,this.sparkleSystem.emitRate=5,this.sparkleSystem.blendMode=en.p.BLENDMODE_ADD,this.sparkleSystem.gravity=new B.P(0,-.02,0);let i=new B.P(-.15,.3,-.15),s=new B.P(.15,.6,.15);this.sparkleSystem.direction1=i,this.sparkleSystem.direction2=s,this.sparkleSystem.minEmitPower=.03,this.sparkleSystem.maxEmitPower=.08,this.sparkleSystem.updateSpeed=.02,this.sparkleSystem.preWarmCycles=0,this.sparkleSystem.disposeOnStop=!1,this.sparkleSystem.stop()}setDisabled(e){this.disabled=e,e&&this.showPrompt(!1)}isDisabled(){return this.disabled}showPrompt(e){(this.disabled||this.isActive)&&(e=!1),this.promptDisc.isEnabled()!==e&&(this.promptDisc.setEnabled(e),this.sparkleSystem&&(e?this.sparkleSystem.start():this.sparkleSystem.stop()))}activate(e,t){if(this.isActive)return;this.isActive=!0,this.showPrompt(!1);let i=this.interactType===Q.Oven,s=e&&t&&t>e;i&&s&&(this._startOvenEffects(),this.startCookingVisuals(e,t))}deactivate(){this.isActive&&(this.isActive=!1,this.activeParticleSystems.forEach(e=>{e.stop()}),this.activeParticleSystems=[],this.interactType===Q.Oven&&this.stopCookingVisuals())}startCookingVisuals(e,t){if(this.interactType!==Q.Oven||!this.progressBarPlane||!this.progressBarTexture)return void console.error(`[${this.id}] Cannot start cooking visuals: Progress bar not setup correctly or not an Oven.`);this.cookingStartTime=e,this.cookingTotalDuration=Math.max(1,t-e),this.isCooking=!0,this.progressBarPlane.setEnabled(!0),this.lastProgressBarUpdateTime=0;let i=Date.now();this._updateHorizontalProgressBar(i),this.lastProgressBarUpdateTime=i}stopCookingVisuals(){if(this.isCooking){if(this.isCooking=!1,this.progressBarPlane&&this.progressBarPlane.setEnabled(!1),this.progressBarTexture){let e=this.progressBarTexture.getContext();e&&(e.clearRect(0,0,this.progressBarTextureWidth,this.progressBarTextureHeight),this.progressBarTexture.update())}this.lastProgressBarUpdateTime=0}}_startOvenEffects(){let e,t,i="assets/particles/Star-Texture.png";ec.particleTextures.has(i)?e=ec.particleTextures.get(i):((e=new O.x(i,this.scene)).hasAlpha=!0,ec.particleTextures.set(i,e));let s=new en.p("fire",600,this.scene);s.particleTexture=e.clone();let o=new B.P;o.copyFrom(this.mesh.getAbsolutePosition()),o.y+=.4,o.z-=.2;let n=new B.P;n.copyFrom(o),n.y+=.4,s.emitter=o;let a=new B.P(-.3,0,-.3),r=new B.P(.3,.1,.3);s.minEmitBox=a,s.maxEmitBox=r,s.color1=new R.HE(1,.7,0,1),s.color2=new R.HE(1,.3,0,1),s.colorDead=new R.HE(.2,0,0,0),s.addColorGradient(0,new R.HE(1,.8,.1,1)),s.addColorGradient(.4,new R.HE(1,.5,0,.9)),s.addColorGradient(.8,new R.HE(.9,.1,0,.5)),s.addColorGradient(1,s.colorDead.clone()),s.minSize=.03,s.maxSize=.15,s.minLifeTime=.15,s.maxLifeTime=.25,s.addSizeGradient(0,.03),s.addSizeGradient(.5,.15),s.addSizeGradient(1,.01),s.emitRate=400,s.blendMode=en.p.BLENDMODE_ADD,s.minInitialRotation=0,s.maxInitialRotation=2*Math.PI,s.minAngularSpeed=-(2*Math.PI),s.maxAngularSpeed=2*Math.PI,s.gravity=new B.P(0,0,0);let l=new B.P(-.2,1.5,-.2),h=new B.P(.2,3,.2);s.direction1=l,s.direction2=h,s.minEmitPower=.5,s.maxEmitPower=1,s.updateSpeed=.008,s.disposeOnStop=!0;let d="assets/particles/ExplosionTexture-Smoke-1.png";ec.particleTextures.has(d)?t=ec.particleTextures.get(d):((t=new O.x(d,this.scene)).hasAlpha=!0,ec.particleTextures.set(d,t));let c=new en.p("smoke",150,this.scene);c.particleTexture=t.clone(),c.emitter=n,c.minEmitBox=new B.P(-.3,.1,-.3),c.maxEmitBox=new B.P(.3,.2,.3),c.color1=new R.HE(1,1,1,.05),c.color2=new R.HE(.9,.9,.9,.03),c.colorDead=new R.HE(1,1,1,0),c.addColorGradient(0,new R.HE(1,1,1,0)),c.addColorGradient(.3,new R.HE(1,1,1,.05)),c.addColorGradient(.7,new R.HE(.9,.9,.9,.02)),c.addColorGradient(1,new R.HE(1,1,1,0)),c.minSize=.5,c.maxSize=1.5,c.addSizeGradient(0,.4),c.addSizeGradient(.5,1.2),c.addSizeGradient(1,1.8),c.minLifeTime=1.2,c.maxLifeTime=2.5,c.emitRate=6,c.blendMode=en.p.BLENDMODE_STANDARD,c.minInitialRotation=0,c.maxInitialRotation=2*Math.PI,c.minAngularSpeed=-.2,c.maxAngularSpeed=.2,c.gravity=new B.P(0,.2,0),c.direction1=new B.P(-.05,.8,-.05),c.direction2=new B.P(.05,1.2,.05),c.minEmitPower=.02,c.maxEmitPower=.08,c.updateSpeed=.02,c.disposeOnStop=!0,s.start(),c.start(),this.activeParticleSystems.push(s,c)}interact(){if(this.disabled&&!this.isActive)return}_prepareIngredientVisual(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:B._f.Identity();if(!this.ingredientLoader)return null;let s=this.ingredientLoader.getIngredientMesh(e);if(!s)return null;s.isPickable=!1,s.getChildMeshes(!1,e=>e instanceof eo.Kj0).forEach(e=>e.isPickable=!1),s.setEnabled(!0);let o=el[e],n=(null==o?void 0:o.onBoard)??(null==o?void 0:o.hand),a=new B.P(.5,.5,.5),r=(null==o?void 0:o.scale)?new B.P(o.scale.x,o.scale.y,o.scale.z):a,l=(null==n?void 0:n.rotationOffset)?new B._f(n.rotationOffset.x,n.rotationOffset.y,n.rotationOffset.z,n.rotationOffset.w):B._f.Identity(),h=i.multiply(l),d=(null==n?void 0:n.positionOffset)?new B.P(n.positionOffset.x,n.positionOffset.y,n.positionOffset.z):B.P.Zero();return{mesh:s,localOffset:t.add(d).clone(),localRotation:h.clone(),localScale:r.clone()}}updateIngredientsOnBoard(e){if(!(e.length!==this.lastIngredientsOnBoard.length||!e.every((e,t)=>e===this.lastIngredientsOnBoard[t]))&&this.displayedIngredientInfos.length>0)return;let t=e.find(e=>{var t;return null==(t=eh[e])?void 0:t.isFinal}),i=this.lastIngredientsOnBoard.find(e=>{var t;return null==(t=eh[e])?void 0:t.isFinal});if(this.clearIngredientsOnBoard(),!this.ingredientLoader){console.warn("IngredientLoader not available for updating board visuals."),this.lastIngredientsOnBoard=[...e];return}let s=null,o=null,n=[];if(this.interactType===Q.ServingBoard){let t=e.includes(Z.Plate),i=e.find(e=>{var t;return e!==Z.Plate&&(null==(t=eh[e])?void 0:t.isFinal)});if(t&&(s=this._prepareIngredientVisual(Z.Plate,B.P.Zero()))&&this.displayedIngredientInfos.push(s),i){let e=new B.P(0,t?.12:.05,0);(o=this._prepareIngredientVisual(i,e))&&this.displayedIngredientInfos.push(o)}}else if(this.interactType===Q.ChoppingBoard||this.interactType===Q.Oven){let t=this.interactType===Q.Oven,i=3*!!t,s=.37*!!t,o=e.filter(e=>e!==Z.Plate),a=o.length;o.forEach((e,t)=>{let o=new B.P(a>1?(t-(a-1)/2)*.15:0,i+.05*t,s),r=this._prepareIngredientVisual(e,o);r&&n.push(r)}),this.displayedIngredientInfos.push(...n)}t&&!i&&this.playCraftCompleteEffect(),this.lastIngredientsOnBoard=[...e]}showCookingVisual(e){if(!this.cookingVisualInfo&&this.ingredientLoader&&e===Z.Rice&&this.interactType===Q.Oven){let t=new B.P(0,3,.37),i=this._prepareIngredientVisual(e,t);i&&(this.cookingVisualInfo=i)}}hideCookingVisual(){this.cookingVisualInfo&&(this.cookingVisualInfo.mesh.dispose(),this.cookingVisualInfo=null)}playCraftCompleteEffect(){let e,t=new en.p(`${this.mesh.name}_craft_complete`,50,this.scene);t.emitter=this.mesh.getAbsolutePosition().add(new B.P(0,.3,0)),t.particleEmitterType=t.createSphereEmitter(1.2);let i="assets/particles/Star-Texture.png";ec.particleTextures.has(i)?e=ec.particleTextures.get(i):((e=new O.x(i,this.scene)).hasAlpha=!0,ec.particleTextures.set(i,e)),t.particleTexture=e,t.color1=new R.HE(1,1,.5,1),t.color2=new R.HE(1,.8,.2,1),t.colorDead=new R.HE(0,0,0,0),t.minSize=.05,t.maxSize=.15,t.minLifeTime=.3,t.maxLifeTime=.8,t.emitRate=50/t.maxLifeTime,t.manualEmitCount=50,t.maxEmitPower=2,t.minEmitPower=1,t.updateSpeed=.01,t.gravity=new B.P(0,-3,0),t.direction1=new B.P(-1,2,-1),t.direction2=new B.P(1,4,1),t.blendMode=en.p.BLENDMODE_ADD,t.start(),setTimeout(()=>{t&&t.stop()},(t.maxLifeTime+.2)*1e3)}clearIngredientsOnBoard(){this.displayedIngredientInfos.forEach(e=>{e.mesh.dispose()}),this.displayedIngredientInfos=[]}dispose(){console.log(`Disposing InteractableObject ${this.id} (${this.mesh.name})`),this.stopCookingVisuals(),this.deactivate(),this.clearIngredientsOnBoard(),this.hideCookingVisual(),this.sparkleSystem&&(this.sparkleSystem.stop(),this.sparkleSystem.dispose()),this.progressBarPlane&&(this.progressBarPlane.dispose(),this.progressBarPlane=null),this.progressBarTexture&&(this.progressBarTexture.dispose(),this.progressBarTexture=null),this.progressBarMaterial&&(this.progressBarMaterial.dispose(),this.progressBarMaterial=null),this.promptDisc.dispose(),this.ingredientAnchor.dispose(),this._renderObserver&&(this.scene.onBeforeRenderObservable.remove(this._renderObserver),this._renderObserver=null)}constructor(e,t,i,s,o,n="E",a){(0,k._)(this,"isActive",!1),(0,k._)(this,"mesh",void 0),(0,k._)(this,"interactionDistance",2.5),(0,k._)(this,"promptDisc",void 0),(0,k._)(this,"scene",void 0),(0,k._)(this,"billboardOffset",void 0),(0,k._)(this,"interactType",void 0),(0,k._)(this,"id",void 0),(0,k._)(this,"sparkleSystem",void 0),(0,k._)(this,"ingredientLoader",void 0),(0,k._)(this,"ingredientAnchor",void 0),(0,k._)(this,"displayedIngredientInfos",[]),(0,k._)(this,"cookingVisualInfo",null),(0,k._)(this,"lastIngredientsOnBoard",[]),(0,k._)(this,"_positionUpdateTemp",new B.P),(0,k._)(this,"_renderObserver",null),(0,k._)(this,"activeParticleSystems",[]),(0,k._)(this,"disabled",!1),(0,k._)(this,"progressBarPlane",null),(0,k._)(this,"progressBarTexture",null),(0,k._)(this,"progressBarMaterial",null),(0,k._)(this,"progressBarTextureWidth",512),(0,k._)(this,"progressBarTextureHeight",64),(0,k._)(this,"progressBarPlaneWidth",.8),(0,k._)(this,"progressBarPlaneHeight",.15),(0,k._)(this,"isCooking",!1),(0,k._)(this,"cookingStartTime",0),(0,k._)(this,"cookingTotalDuration",0),(0,k._)(this,"lastProgressBarUpdateTime",0),(0,k._)(this,"progressBarUpdateInterval",150),this.mesh=e,this.scene=t,this.billboardOffset=(null==o?void 0:o.clone())??new B.P(0,2,0),this.ingredientLoader=a,this.interactType=i,this.id=s,this.ingredientAnchor=new er.Y(`${e.name}_ingredientAnchor`,t),this.ingredientAnchor.setParent(this.mesh),this.ingredientAnchor.position=new B.P(0,.1,0),this.ingredientAnchor.rotationQuaternion=B._f.Identity(),this.ingredientAnchor.scaling=B.P.One(),this.promptDisc=eo.VO7.CreateDisc(`${e.name}_prompt_disc`,{radius:.25,tessellation:16},t),this.promptDisc.billboardMode=eo.Kj0.BILLBOARDMODE_ALL,this.promptDisc.isPickable=!1,this.promptDisc.renderingGroupId=1,this.promptDisc.setEnabled(!1),this._setupPromptMaterial(n),this.createSparkleEffect(),this.interactType===Q.Oven&&this._setupHorizontalProgressBar(),this._setupRenderObserver()}}(0,k._)(ec,"promptTextures",new Map),(0,k._)(ec,"particleTextures",new Map);var ep=i(68989),eu=i(25677),em=i(78583),eg=i(42881),ey=((a={}).Escape="Escape",a.Digit1="Digit1",a.Digit2="Digit2",a.Digit3="Digit3",a.Digit4="Digit4",a.Digit5="Digit5",a.Digit6="Digit6",a.Digit7="Digit7",a.Digit8="Digit8",a.Digit9="Digit9",a.Digit0="Digit0",a.Minus="Minus",a.Equal="Equal",a.Backspace="Backspace",a.Tab="Tab",a.KeyQ="KeyQ",a.KeyW="KeyW",a.KeyE="KeyE",a.KeyR="KeyR",a.KeyT="KeyT",a.KeyY="KeyY",a.KeyU="KeyU",a.KeyI="KeyI",a.KeyO="KeyO",a.KeyP="KeyP",a.BracketLeft="BracketLeft",a.BracketRight="BracketRight",a.Enter="Enter",a.ControlLeft="ControlLeft",a.KeyA="KeyA",a.KeyS="KeyS",a.KeyD="KeyD",a.KeyF="KeyF",a.KeyG="KeyG",a.KeyH="KeyH",a.KeyJ="KeyJ",a.KeyK="KeyK",a.KeyL="KeyL",a.Semicolon="Semicolon",a.Quote="Quote",a.Backquote="Backquote",a.ShiftLeft="ShiftLeft",a.Backslash="Backslash",a.KeyZ="KeyZ",a.KeyX="KeyX",a.KeyC="KeyC",a.KeyV="KeyV",a.KeyB="KeyB",a.KeyN="KeyN",a.KeyM="KeyM",a.Comma="Comma",a.Period="Period",a.Slash="Slash",a.ShiftRight="ShiftRight",a.NumpadMultiply="NumpadMultiply",a.AltLeft="AltLeft",a.Space="Space",a.CapsLock="CapsLock",a.F1="F1",a.F2="F2",a.F3="F3",a.F4="F4",a.F5="F5",a.F6="F6",a.F7="F7",a.F8="F8",a.F9="F9",a.F10="F10",a.Numpad7="Numpad7",a.Numpad8="Numpad8",a.Numpad9="Numpad9",a.NumpadSubtract="NumpadSubtract",a.Numpad4="Numpad4",a.Numpad5="Numpad5",a.Numpad6="Numpad6",a.NumpadAdd="NumpadAdd",a.Numpad1="Numpad1",a.Numpad2="Numpad2",a.Numpad3="Numpad3",a.Numpad0="Numpad0",a.NumpadDecimal="NumpadDecimal",a.IntlBackslash="IntlBackslash",a.F11="F11",a.F12="F12",a.NumpadEqual="NumpadEqual",a.F13="F13",a.F14="F14",a.F15="F15",a.F16="F16",a.F17="F17",a.F18="F18",a.F19="F19",a.F20="F20",a.Lang2="Lang2",a.Lang1="Lang1",a.IntlRo="IntlRo",a.IntlYen="IntlYen",a.NumpadComma="NumpadComma",a.NumpadEnter="NumpadEnter",a.ControlRight="ControlRight",a.NumpadDivide="NumpadDivide",a.AltRight="AltRight",a.NumLock="NumLock",a.Home="Home",a.ArrowUp="ArrowUp",a.PageUp="PageUp",a.ArrowLeft="ArrowLeft",a.ArrowRight="ArrowRight",a.End="End",a.ArrowDown="ArrowDown",a.PageDown="PageDown",a.Delete="Delete",a.MetaLeft="MetaLeft",a.MetaRight="MetaRight",a.ContextMenu="ContextMenu",a),ef=i(38526);function ex(e,t,i){return Math.abs(t-e)<=i?t:e+Math.sign(t-e)*i}var eP=((r={}).IDLE="IDLE",r.WALKING="WALKING",r.JUMPING="JUMPING",r.LANDING="LANDING",r.FALLING="FALLING",r.DANCING="DANCING",r);class eb{clearHeldItemVisuals(){this.currentIngredientMesh&&(this.currentIngredientMesh.dispose(),this.currentIngredientMesh=void 0),this.plateMesh&&(this.plateMesh.dispose(),this.plateMesh=void 0)}updateHeldItemVisuals(){this.clearHeldItemVisuals();let e=el[Z.Plate],t=el[this.ingredient],i=eh[this.ingredient],s=new B.P(.5,.5,.5);if(this.holdingPlate&&(this.plateMesh=this.ingredientLoader.getIngredientMesh(Z.Plate),this.plateMesh)){this.plateMesh.parent=this.holdAttachmentPoint;let t=(null==e?void 0:e.scale)?new B.P(e.scale.x,e.scale.y,e.scale.z):s;this.plateMesh.scaling=t;let i=null==e?void 0:e.hand,o=B.P.Zero();this.plateMesh.position=(null==i?void 0:i.positionOffset)?new B.P(i.positionOffset.x,i.positionOffset.y,i.positionOffset.z):o,this.plateMesh.rotationQuaternion=(null==i?void 0:i.rotationOffset)?new B._f(i.rotationOffset.x,i.rotationOffset.y,i.rotationOffset.z,i.rotationOffset.w):B._f.Identity(),this.plateMesh.isPickable=!1,this.plateMesh.getChildMeshes().forEach(e=>e.isPickable=!1)}if(this.ingredient!==Z.None&&i&&(this.currentIngredientMesh=this.ingredientLoader.getIngredientMesh(this.ingredient),this.currentIngredientMesh)){let e,i,o=this.holdAttachmentPoint;this.holdingPlate&&this.plateMesh?(o=this.plateMesh,e=null==t?void 0:t.onPlate,i=new B.P(0,.1,0)):(o=this.holdAttachmentPoint,e=null==t?void 0:t.hand,i=new B.P(0,-.1,.1)),this.currentIngredientMesh.parent=o;let n=(null==t?void 0:t.scale)?new B.P(t.scale.x,t.scale.y,t.scale.z):s;this.holdingPlate&&this.plateMesh&&(n=new B.P(n.x/.5,n.y/.5,n.z/.5)),this.currentIngredientMesh.scaling=n;let a=(null==e?void 0:e.positionOffset)?new B.P(e.positionOffset.x,e.positionOffset.y,e.positionOffset.z):B.P.Zero();this.currentIngredientMesh.position=i.add(a),this.currentIngredientMesh.rotationQuaternion=(null==e?void 0:e.rotationOffset)?new B._f(e.rotationOffset.x,e.rotationOffset.y,e.rotationOffset.z,e.rotationOffset.w):B._f.Identity(),this.currentIngredientMesh.isPickable=!1,this.currentIngredientMesh.getChildMeshes().forEach(e=>e.isPickable=!1)}}dropIngredient(){this.ingredient=Z.None,this.updateHeldItemVisuals()}dropPlate(){if(this.holdingPlate){if(this.holdingPlate=!1,this.ingredient!==Z.None){let e=eh[this.ingredient];(null==e?void 0:e.isFinal)&&(this.ingredient=Z.None)}this.updateHeldItemVisuals()}}pickupIngredient(e){if(this.ingredient)return;let t=eh[e];(!this.holdingPlate||(null==t?void 0:t.isFinal))&&this.forceSetIngredient(e)}forceSetIngredient(e){this.ingredient!==e&&(this.ingredient=e,this.updateHeldItemVisuals())}pickupPlate(){var e;let t=this.ingredient,i=t!==Z.None&&!!(null==(e=eh[t])?void 0:e.isFinal);if(t!==Z.None&&!i)return void console.warn("Client: Cannot pick up plate while holding non-final.");this.forcePickupPlate()}forcePickupPlate(){this.holdingPlate||(this.holdingPlate=!0,this.updateHeldItemVisuals())}get holdedIngredient(){return this.ingredient}get isHoldingPlate(){return this.holdingPlate}set isHoldingPlate(e){e&&!this.holdingPlate?this.pickupPlate():!e&&this.holdingPlate&&this.dropPlate()}get position(){return this.impostorMesh.position}get rotation(){return this.impostorMesh.rotationQuaternion}get getTargetAnim(){return this.targetAnim}getTransform(){return this.impostorMesh}setPosition(e){this.impostorMesh.position=e}setRotation(e){this.impostorMesh.rotationQuaternion=e}setRotationY(e){this.impostorMesh.rotationQuaternion=B._f.RotationAxis(B.P.Up(),e)}update(e){}dispose(){this.clearHeldItemVisuals(),this.holdAttachmentPoint.dispose(),this.impostorMesh.dispose(),this.model.dispose(),this.physicsAggregate.dispose()}updateAnimations(e){let t=this.idleAnim;switch(this.currentState){case eP.IDLE:t=this.idleAnim;break;case eP.WALKING:t=this.walkAnim;break;case eP.JUMPING:t=this.jumpAnim;break;case eP.FALLING:t=this.fallingAnim;break;case eP.LANDING:t=this.landingAnim;break;case eP.DANCING:t=this.sambaDanceAnim}this.targetAnim=t;let i=0;for(let s of this.nonIdleAnimations){let o=+(s===t);if(s.weight=ex(s.weight,o,this.animationBlendSpeed*e),s===t&&s.weight>.01&&!s.isPlaying){let e=s===this.fallingAnim||s===this.walkAnim||s===this.sambaDanceAnim;e||s.goToFrame(0),s.play(e)}else s!==t&&s.weight<.01&&s.isPlaying&&(s.pause(),s.loopAnimation||s.goToFrame(0));i+=s.weight}this.idleAnim.weight=ex(this.idleAnim.weight,Math.max(0,1-i),this.animationBlendSpeed*e),this.idleAnim.weight>.01&&!this.idleAnim.isPlaying?this.idleAnim.play(!0):this.idleAnim.weight<.01&&this.idleAnim.isPlaying&&this.idleAnim.pause()}isAnimationFinished(e){return e.loopAnimation?e.weight<.1:!e.isPlaying&&e.weight<.1}constructor(e,t,i,s,o){(0,k._)(this,"audioManager",void 0),(0,k._)(this,"ingredientLoader",void 0),(0,k._)(this,"currentIngredientMesh",void 0),(0,k._)(this,"plateMesh",void 0),(0,k._)(this,"scene",void 0),(0,k._)(this,"model",void 0),(0,k._)(this,"physicsAggregate",void 0),(0,k._)(this,"moveSpeed",1.8),(0,k._)(this,"rotationSpeed",6),(0,k._)(this,"animationBlendSpeed",4),(0,k._)(this,"jumpForce",5),(0,k._)(this,"walkAnim",void 0),(0,k._)(this,"idleAnim",void 0),(0,k._)(this,"jumpAnim",void 0),(0,k._)(this,"landingAnim",void 0),(0,k._)(this,"fallingAnim",void 0),(0,k._)(this,"sambaDanceAnim",void 0),(0,k._)(this,"nonIdleAnimations",void 0),(0,k._)(this,"thirdPersonCamera",void 0),(0,k._)(this,"targetAnim",void 0),(0,k._)(this,"impostorMesh",void 0),(0,k._)(this,"currentState",eP.IDLE),(0,k._)(this,"ingredient",Z.None),(0,k._)(this,"holdingPlate",!1),(0,k._)(this,"holdAttachmentPoint",void 0),this.scene=t,this.ingredientLoader=i,this.audioManager=o,this.impostorMesh=F.V.CreateCapsule("CharacterTransform",{height:1.5,radius:.3},t),this.impostorMesh.visibility=0,this.impostorMesh.rotationQuaternion=B._f.Identity(),this.impostorMesh.position.y=1,this.impostorMesh.position.x=0,this.impostorMesh.position.z=3.5,this.impostorMesh.isPickable=!1,this.holdAttachmentPoint=new er.Y("holdAttachmentPoint",t),this.holdAttachmentPoint.parent=this.impostorMesh,this.holdAttachmentPoint.position=new B.P(0,-.2,-.4),this.holdAttachmentPoint.rotationQuaternion=B._f.Identity(),this.holdAttachmentPoint.scaling=B.P.One(),this.model=e,this.model.parent=this.impostorMesh,this.model.rotate(B.P.Up(),Math.PI),this.model.position.y=-.75,e.isPickable=!1,this.model.getChildMeshes().forEach(e=>{e.isPickable=!1,e.receiveShadows=!0});let n=s.find(e=>"Walking"===e.name);if(void 0===n)throw Error("'Walking' animation not found");this.walkAnim=n,this.walkAnim.weight=0;let a=s.find(e=>"SambaDancing"===e.name);if(void 0===a)throw Error("'SambaDancing' animation not found");this.sambaDanceAnim=a,this.sambaDanceAnim.weight=0;let r=s.find(e=>"Jump"===e.name);if(void 0===r)throw Error("'Jumping' animation not found");this.jumpAnim=r,this.jumpAnim.weight=0;let l=s.find(e=>"Fall"===e.name);if(void 0===l)throw Error("'Falling' animation not found");this.fallingAnim=l,this.fallingAnim.weight=0;let h=s.find(e=>"Land"===e.name);if(void 0===h)throw Error("'Landing' animation not found");this.landingAnim=h,this.landingAnim.weight=0,this.landingAnim.loopAnimation=!1;let d=s.find(e=>"Idle"===e.name);if(void 0===d)throw Error("'Idle' animation not found");this.idleAnim=d,this.idleAnim.weight=1,this.idleAnim.play(!0),this.targetAnim=this.idleAnim,this.nonIdleAnimations=[this.walkAnim,this.sambaDanceAnim,this.jumpAnim,this.fallingAnim,this.landingAnim],this.physicsAggregate=new ef.p(this.getTransform(),J.Bq.CAPSULE,{mass:1,friction:.5}),this.physicsAggregate.body.setMassProperties({inertia:B.P.ZeroReadOnly}),this.physicsAggregate.body.setAngularDamping(100),this.physicsAggregate.body.setLinearDamping(10)}}var ev=((l={})[l.UNSUPPORTED=0]="UNSUPPORTED",l[l.SLIDING=1]="SLIDING",l[l.SUPPORTED=2]="SUPPORTED",l);class eI extends eb{update(e){this._startPosTemp.copyFrom(this.getTransform().position),this._velocityTemp.copyFrom(this.physicsAggregate.body.getLinearVelocity()),this._velocityTemp.scaleInPlace(e),this._startPosTemp.addToRef(this._velocityTemp,this._endPosTemp),this._castWithCollectors(this._startPosTemp,this._endPosTemp),this._updateManifold(),this.isGrounded=this.checkGrounded(),this.handleInput(),this.updateState(),this.updateMovement(),this.updateAnimations(e),this.updateCameraCollision(),this.updateFootstepSounds(e),this.updateCharacterVisibilityFade(e)}updateFootstepSounds(e){if(this.currentState===eP.WALKING&&this.isGrounded){if(this.timeSinceLastStep+=e,this.timeSinceLastStep>=this.stepInterval){let e;do e=Math.floor(Math.random()*this.footstepSoundNames.length);while(this.footstepSoundNames.length>1&&e===this.lastFootstepIndex);let t=this.footstepSoundNames[e];this.lastFootstepIndex=e,this.audioManager.playSound(t,.55,!1),this.timeSinceLastStep-=this.stepInterval}this.isPlayingFootsteps=!0}else this.isPlayingFootsteps&&(this.isPlayingFootsteps=!1,this.timeSinceLastStep=0,this.lastFootstepIndex=-1)}handleInput(){let e=this.inputMap.get(this.keyJump)||!1;e&&!this.previousJumpKeyState&&this.isGrounded&&!this.isJumping&&(this.isJumping=!0,this.jumpAnim.reset(),this.jumpAnim.play(!1),this.physicsAggregate.body.applyImpulse(new B.P(0,7e3,0),new B.P(0,0,0))),this.previousJumpKeyState=e;let t=this.inputMap.get(this.keyInteract)||!1;t&&!this.previousInteractKeyState&&this.gameEngine.tryInteract(this),this.previousInteractKeyState=t}updateState(){let e,t=this.checkSupport(),i=this.physicsAggregate.body.getLinearVelocity().y,s=this.isAnyMovementKeyDown();this.isLandingAnimationActive&&this.landingAnim.weight<.1&&(this.isLandingAnimationActive=!1,this.landingAnim.isPlaying||this.landingAnim.goToFrame(0)),this.inputMap.get(this.keyDance)?(e=eP.DANCING,this.isJumping=!1,this.isLandingAnimationActive=!1):t===ev.SUPPORTED?this.currentState===eP.FALLING||this.currentState===eP.JUMPING?(e=eP.LANDING,this.isJumping=!1,this.isLandingAnimationActive=!0,this.gameEngine.playSfx("jumpLand",.65,!1)):this.isLandingAnimationActive?s?(e=eP.WALKING,this.isLandingAnimationActive=!1):e=eP.LANDING:(e=s?eP.WALKING:eP.IDLE,this.isJumping=!1):(t===ev.SLIDING?(e=eP.FALLING,this.isJumping=!1):this.isJumping&&i>.05?e=eP.JUMPING:(e=eP.FALLING,this.isJumping&&(this.isJumping=!1)),this.isLandingAnimationActive=!1),this.currentState=e}updateMovement(){this._cameraForwardTemp.copyFrom(this.thirdPersonCamera.getForwardRay().direction),this._forwardTemp.set(this._cameraForwardTemp.x,0,this._cameraForwardTemp.z),this._forwardTemp.normalize(),this._rightTemp.set(this._forwardTemp.z,0,-this._forwardTemp.x),this._rightTemp.normalize(),this._moveDirectionTemp.setAll(0),this.inputMap.get(this.keyForward)&&this._moveDirectionTemp.addInPlace(this._forwardTemp),this.inputMap.get(this.keyBackward)&&this._moveDirectionTemp.subtractInPlace(this._forwardTemp),this.inputMap.get(this.keyLeft)&&this._moveDirectionTemp.subtractInPlace(this._rightTemp),this.inputMap.get(this.keyRight)&&this._moveDirectionTemp.addInPlace(this._rightTemp),this._moveDirectionTemp.normalize();let e=this.getTransform().rotationQuaternion;if(!e)throw Error("Character rotation quaternion is null");for(let t of(this._moveDirectionTemp.lengthSquared()>.01?B._f.FromLookDirectionLHToRef(this._moveDirectionTemp,B.P.UpReadOnly,this._desiredRotationTemp):this._desiredRotationTemp.copyFrom(e),this.applySmoothRotation(e,this._desiredRotationTemp),this._moveDirectionTemp.scaleToRef(this.moveSpeed,this._desiredVelocityTemp),this._adjustedVelocityTemp.copyFrom(this._desiredVelocityTemp),this.manifold)){let e=t.normal,i=this._adjustedVelocityTemp.dot(e);i<0&&(e.scaleToRef(i,this._projectionTemp),this._adjustedVelocityTemp.subtractInPlace(this._projectionTemp))}this._currentVelocityTemp.copyFrom(this.physicsAggregate.body.getLinearVelocity()),this._newVelocityTemp.set(this._adjustedVelocityTemp.x,this._currentVelocityTemp.y,this._adjustedVelocityTemp.z),this.physicsAggregate.body.setLinearVelocity(this._newVelocityTemp)}applySmoothRotation(e,t){if(t.equals(e))this._angularVelocityTemp.setAll(0),this.physicsAggregate.body.setAngularVelocity(this._angularVelocityTemp);else{B._f.InverseToRef(e,this._rotationDeltaTemp),this._rotationDeltaTemp.multiplyInPlace(t),this._rotationDeltaTemp.toEulerAnglesToRef(this._rotationDeltaEulerTemp);let i=this._rotationDeltaEulerTemp.y*this.rotationSpeed;this._angularVelocityTemp.set(0,i,0),this.physicsAggregate.body.setAngularVelocity(this._angularVelocityTemp)}}checkGroundWithShapeCast(e){let t=this.scene.getPhysicsEngine().getPhysicsPlugin(),i=t._hknp;this._groundCheckStartPos.copyFrom(this.getTransform().position),this._groundCheckEndPos.copyFrom(this._groundCheckStartPos),this._groundCheckEndPos.y-=e;let s=[this.physicsAggregate.shape._pluginData,[0,0,0,1],[this._groundCheckStartPos.x,this._groundCheckStartPos.y,this._groundCheckStartPos.z],[this._groundCheckEndPos.x,this._groundCheckEndPos.y,this._groundCheckEndPos.z],!1,[BigInt(0)]];if(i.HP_World_ShapeCastWithCollector(t.world,this._castCollector,s),i.HP_QueryCollector_GetNumHits(this._castCollector)[1]>0){let[e,,t]=i.HP_QueryCollector_GetShapeCastResult(this._castCollector,0)[1];if(e<1)return B.P.FromArrayToRef(t[4],0,this._groundNormalTemp),{isGrounded:!0,groundNormal:this._groundNormalTemp}}return{isGrounded:!1,groundNormal:null}}checkGrounded(){return this.checkGroundWithShapeCast(this.groundCheckDistance).isGrounded}_castWithCollectors(e,t){let i=this.scene.getPhysicsEngine().getPhysicsPlugin(),s=i._hknp,o=[e.x,e.y,e.z],n=[0,0,0,1],a=[this.physicsAggregate.shape._pluginData,o,n,this.keepDistance+this.keepContactTolerance,!1,[BigInt(0)]];s.HP_World_ShapeProximityWithCollector(i.world,this._startCollector,a);let r=[this.physicsAggregate.shape._pluginData,n,o,[t.x,t.y,t.z],!1,[BigInt(0)]];s.HP_World_ShapeCastWithCollector(i.world,this._castCollector,r)}_updateManifold(){let e=this.scene.getPhysicsEngine().getPhysicsPlugin(),t=e._hknp;this.manifold=[];let i=t.HP_QueryCollector_GetNumHits(this._startCollector)[1];for(let s=0;s<i;s++){let[i,,o]=t.HP_QueryCollector_GetShapeProximityResult(this._startCollector,s)[1],n=B.P.FromArray(o[3]),a=B.P.FromArray(o[4]),r=o[0][0],l=e._bodies.get(r);if(l){let e={position:n,normal:a,distance:i,fraction:0,bodyB:l.body,allowedPenetration:Math.min(Math.max(this.keepDistance-i,0),this.keepDistance)};this.manifold.push(e)}}}checkSupport(){let e=!1,t=B.P.Zero(),i=0;for(let s of this.manifold)s.normal.dot(B.P.Up())>.1&&(e=!0,t.addInPlace(s.normal),i++);return e?(t.scaleInPlace(1/i),t.dot(B.P.Up())>this.maxSlopeCosine?ev.SUPPORTED:ev.SLIDING):ev.UNSUPPORTED}updateCameraCollision(){let e=this.thirdPersonCamera;this._cameraTargetTemp=this.cameraAttachPoint.getAbsolutePosition(),e.position.subtractToRef(this._cameraTargetTemp,this._cameraDirectionTemp);let t=this._cameraDirectionTemp.length();if(t<1e-4)return;this._cameraDirectionTemp.normalizeToRef(this._cameraDirectionTemp),this._cameraRay.origin.copyFrom(this._cameraTargetTemp),this._cameraRay.direction.copyFrom(this._cameraDirectionTemp),this._cameraRay.length=t;let i=this.scene.pickWithRay(this._cameraRay,e=>null!=e.physicsBody&&e.isEnabled()&&e!==this.getTransform()&&e.isPickable),s=Number.POSITIVE_INFINITY;i&&i.hit&&i.distance<t&&(s=Math.max(i.distance-.01,e.lowerRadiusLimit??1));let o=Math.min(e.radius,s);o=Math.max(o=Math.min(o,e.upperRadiusLimit??9999999),e.lowerRadiusLimit??1);let n=1-Math.exp(-15*this.scene.getEngine().getDeltaTime()/1e3);e.radius=ed.Rus.Lerp(e.radius,o,n),.01>Math.abs(e.radius-o)&&(e.radius=o)}isAnyMovementKeyDown(){return!0===(this.inputMap.get(this.keyForward)||this.inputMap.get(this.keyBackward)||this.inputMap.get(this.keyLeft)||this.inputMap.get(this.keyRight))}dropIngredient(){super.dropIngredient(),this.gameEngine.playSfx("trash")}dropPlate(){super.dropPlate(),this.gameEngine.playSfx("trash")}updateCharacterVisibilityFade(e){let t=this.thirdPersonCamera;if("number"!=typeof t.lowerRadiusLimit)this.targetVisibility=1;else{let e=t.radius<=t.lowerRadiusLimit+this.visibilityThresholdPadding;this.targetVisibility=e?this.invisibleVisibilityValue:1}if(.01>Math.abs(this.currentVisibility-this.targetVisibility)){this.currentVisibility!==this.targetVisibility&&(this.currentVisibility=this.targetVisibility,this.model.visibility=this.currentVisibility,this.model.getChildMeshes().forEach(e=>e.visibility=this.currentVisibility));return}this.currentVisibility=ed.Rus.Lerp(this.currentVisibility,this.targetVisibility,1-Math.exp(-this.fadeSpeed*e)),this.model.visibility=this.currentVisibility,this.model.getChildMeshes().forEach(e=>e.visibility=this.currentVisibility)}constructor(e,t,i,s,o,n){super(t,o,i,s,n),(0,k._)(this,"inputMap",void 0),(0,k._)(this,"keyForward",ey.KeyW),(0,k._)(this,"keyBackward",ey.KeyS),(0,k._)(this,"keyLeft",ey.KeyA),(0,k._)(this,"keyRight",ey.KeyD),(0,k._)(this,"keyDance",ey.KeyB),(0,k._)(this,"keyJump",ey.Space),(0,k._)(this,"keyInteract",ey.KeyE),(0,k._)(this,"isJumping",!1),(0,k._)(this,"previousJumpKeyState",!1),(0,k._)(this,"previousInteractKeyState",!1),(0,k._)(this,"cameraAttachPoint",void 0),(0,k._)(this,"gameEngine",void 0),(0,k._)(this,"thirdPersonCamera",void 0),(0,k._)(this,"isGrounded",!1),(0,k._)(this,"groundCheckDistance",.1),(0,k._)(this,"_startCollector",void 0),(0,k._)(this,"_castCollector",void 0),(0,k._)(this,"keepDistance",.05),(0,k._)(this,"keepContactTolerance",.1),(0,k._)(this,"manifold",[]),(0,k._)(this,"maxSlopeCosine",Math.cos(60/180*Math.PI)),(0,k._)(this,"isPlayingFootsteps",!1),(0,k._)(this,"timeSinceLastStep",0),(0,k._)(this,"stepInterval",.45),(0,k._)(this,"footstepSoundNames",["footstep_wood_01","footstep_wood_02","footstep_wood_03","footstep_wood_04"]),(0,k._)(this,"lastFootstepIndex",-1),(0,k._)(this,"visibilityThresholdPadding",1.5),(0,k._)(this,"currentVisibility",1),(0,k._)(this,"targetVisibility",1),(0,k._)(this,"fadeSpeed",20),(0,k._)(this,"invisibleVisibilityValue",0),(0,k._)(this,"isLandingAnimationActive",!1),(0,k._)(this,"_startPosTemp",new B.P),(0,k._)(this,"_endPosTemp",new B.P),(0,k._)(this,"_velocityTemp",new B.P),(0,k._)(this,"_cameraForwardTemp",new B.P),(0,k._)(this,"_forwardTemp",new B.P),(0,k._)(this,"_rightTemp",new B.P),(0,k._)(this,"_moveDirectionTemp",new B.P),(0,k._)(this,"_desiredVelocityTemp",new B.P),(0,k._)(this,"_adjustedVelocityTemp",new B.P),(0,k._)(this,"_currentVelocityTemp",new B.P),(0,k._)(this,"_newVelocityTemp",new B.P),(0,k._)(this,"_projectionTemp",new B.P),(0,k._)(this,"_desiredRotationTemp",new B._f),(0,k._)(this,"_rotationDeltaTemp",new B._f),(0,k._)(this,"_rotationDeltaEulerTemp",new B.P),(0,k._)(this,"_angularVelocityTemp",new B.P),(0,k._)(this,"_groundCheckStartPos",new B.P),(0,k._)(this,"_groundCheckEndPos",new B.P),(0,k._)(this,"_groundNormalTemp",new B.P),(0,k._)(this,"_cameraTargetTemp",new B.P),(0,k._)(this,"_cameraDirectionTemp",new B.P),(0,k._)(this,"_cameraRay",new eg.zH(B.P.Zero(),B.P.Zero())),this.gameEngine=e,this.inputMap=new Map,o.actionManager=new ep.k(o),o.actionManager.registerAction(new eu.fQ(ep.k.OnKeyDownTrigger,e=>{let t=e.sourceEvent.code;this.inputMap.set(t,!0)})),o.actionManager.registerAction(new eu.fQ(ep.k.OnKeyUpTrigger,e=>{let t=e.sourceEvent.code;this.inputMap.set(t,!1)})),this.cameraAttachPoint=new er.Y("cameraAttachPoint",o),this.cameraAttachPoint.parent=this.getTransform(),this.cameraAttachPoint.position=new B.P(0,.4,0);let a=new em.Yf("thirdPersonCamera",-Math.PI/2,Math.PI/3,5,this.cameraAttachPoint.getAbsolutePosition(),o);a.attachControl(o.getEngine().getRenderingCanvas(),!0),a.lowerRadiusLimit=.1,a.upperRadiusLimit=10,a.lowerBetaLimit=.1,a.upperBetaLimit=Math.PI/2+.2,a.wheelPrecision=30,a.minZ=.02,a.maxZ=1e3,a.setTarget(this.cameraAttachPoint),this.thirdPersonCamera=a;let r=o.getPhysicsEngine().getPhysicsPlugin()._hknp;this._startCollector=r.HP_QueryCollector_Create(16)[1],this._castCollector=r.HP_QueryCollector_Create(16)[1]}}class eS{loadAndPlaceModels(e,t,i,s,o){if(ec.reset(),this.interactables=[],o){let e=ee(t);e!==o?(console.error(`Map hash mismatch! Client: ${e}, Server: ${o}`),alert("Warning: Your game map version differs from the server. This may cause gameplay issues.")):console.log(`Map hash verified: ${e}`)}else console.warn("No map hash provided for verification, the client hash is:",ee(t),"this may cause gameplay issues.");t.forEach(t=>{let{fileName:i}=t;if(!this.loadedContainers[i]){let s=e+t.map+"/",o=this.assetsManager.addContainerTask(i,"",s,i);o.onSuccess=e=>{this.loadedContainers[i]=e.loadedContainer},o.onError=(e,t,s)=>{console.error(`Error loading ${i}:`,t,s)}}}),s&&"function"==typeof s&&(this.assetsManager.onProgress=(e,t)=>{s((t-e)/t*100)}),this.assetsManager.onFinish=()=>{t.forEach(e=>{let t=this.loadedContainers[e.fileName];if(!t)return void console.warn(`Could not find loaded container for "${e.fileName}". Skipping.`);let i=e.defaultPhysics;e.instances.forEach(s=>{let o=t.instantiateModelsToScene(e=>e).rootNodes[0];if(!o||!(o instanceof L.Kj))return void console.error(`Invalid root node for model "${e.fileName}"`);if(o.name=e.fileName.replace(".glb",""),e.defaultScaling&&o.scaling.set(e.defaultScaling.x??1,e.defaultScaling.y??1,e.defaultScaling.z??1),s.rotation&&o.rotation.set(s.rotation.x??0,s.rotation.y??0,s.rotation.z??0),s.position&&o.position.set(s.position.x,s.position.y,s.position.z),s.scaling&&o.scaling.set(s.scaling.x??1,s.scaling.y??1,s.scaling.z??1),o.getChildMeshes().forEach(t=>{s.rotation&&(t.rotation.set(s.rotation.x??0,s.rotation.y??0,s.rotation.z??0),t.rotationQuaternion=null);let o=s.physics??i;if(o){if(!o.shapeType)return void console.warn(`Missing shape type for physics in model "${e.fileName}"`);new ef.p(t,o.shapeType,{mass:o.mass??0,restitution:o.restitution??.2,friction:o.friction??.5},this.scene),t.receiveShadows=!0,"cloud1.glb"==e.fileName&&(t.material=this.cloudMaterial),this.cascadedShadowGenerator.addShadowCaster(t)}}),s.interaction){let t=s.interaction;if(!t||!t.id)return void console.warn(`Missing interaction for model "${e.fileName}"`);let i=e.billboardOffset?new B.P(e.billboardOffset.x,e.billboardOffset.y,e.billboardOffset.z):void 0,n=new ec(o,this.scene,t.interactType,t.id,i,"E",this.ingredientLoader);n.interactionDistance=2,this.interactables.push(n)}})}),i()},this.assetsManager.load()}constructor(e,t,i){(0,k._)(this,"scene",void 0),(0,k._)(this,"cascadedShadowGenerator",void 0),(0,k._)(this,"assetsManager",void 0),(0,k._)(this,"loadedContainers",{}),(0,k._)(this,"cloudMaterial",void 0),(0,k._)(this,"interactables",[]),(0,k._)(this,"ingredientLoader",void 0),this.scene=e,this.assetsManager=new j.Sp(this.scene),this.assetsManager.autoHideLoadingUI=!1,this.assetsManager.useDefaultLoadingScreen=!1,this.cascadedShadowGenerator=t,this.ingredientLoader=i;let s=new D.K("cloud",this.scene);s.disableLighting=!1,s.emissiveColor=new R.Wo(.5,.5,.5),s.alpha=.85,s.backFaceCulling=!0,this.cloudMaterial=s}}class eM extends eb{receiveFirstState(e){this.targetPosition=new B.P(e.x,e.y,e.z),this.targetYRotation=e.rot,this.previousPosition.copyFrom(this.targetPosition),this.impostorMesh.setEnabled(!0),e.holdingPlate!==this.isHoldingPlate&&(e.holdingPlate?this.forcePickupPlate():this.dropPlate()),void 0!==e.holdedIngredient&&this.forceSetIngredient(e.holdedIngredient),this.updateAnimationState(e.animationState)}receiveState(e){if(!e.connected)return void this.impostorMesh.setEnabled(!1);this.impostorMesh.setEnabled(!0),this.previousPosition.copyFrom(this.targetPosition),this.targetPosition=new B.P(e.x,e.y,e.z),this.targetYRotation=e.rot;let t=performance.now(),i=(t-this.lastUpdateTime)/1e3;i>0&&(this.currentVelocity=this.targetPosition.subtract(this.previousPosition).scale(1/i)),this.lastUpdateTime=t,this.updateAnimationState(e.animationState),e.holdingPlate&&!this.isHoldingPlate?this.forcePickupPlate():!e.holdingPlate&&this.isHoldingPlate&&this.dropPlate(),this.forceSetIngredient(e.holdedIngredient)}update(e){this.updateMovement(e),this.updateAnimations(e),this.updateFootstepSounds(e)}dispose(){super.dispose()}lerpRotationY(e,t){Math.abs(this.impostorMesh.rotationQuaternion.toEulerAngles().y-e)>Math.PI?this.impostorMesh.rotationQuaternion=B._f.RotationAxis(B.P.Up(),e):this.impostorMesh.rotationQuaternion=B._f.Slerp(this.impostorMesh.rotationQuaternion,B._f.RotationAxis(B.P.Up(),e),t)}lerpPosition(e,t){this.impostorMesh.position=B.P.Lerp(this.impostorMesh.position,e,t)}updateMovement(e){this._predictedPositionTemp.copyFrom(this.targetPosition),this.currentVelocity.lengthSquared()>.01&&(this.currentVelocity.scaleToRef(e,this._predictedPositionTemp),this.targetPosition.addToRef(this._predictedPositionTemp,this._predictedPositionTemp)),this.lerpPosition(this._predictedPositionTemp,this.positionInterpolationFactor),this.lerpRotationY(this.targetYRotation,this.rotationInterpolationFactor)}updateAnimationState(e){let t=this.currentState;switch(e){case"Walking":this.currentState=eP.WALKING;break;case"SambaDancing":this.currentState=eP.DANCING;break;case"Jump":this.currentState=eP.JUMPING;break;case"Fall":this.currentState=eP.FALLING;break;case"Land":this.currentState=eP.LANDING;break;default:this.currentState=eP.IDLE}this.currentState===eP.WALKING&&t!==eP.WALKING?this.startFootstepSounds():this.currentState!==eP.WALKING&&t===eP.WALKING&&this.stopFootstepSounds(),this.currentState===eP.LANDING&&(t===eP.FALLING||t===eP.JUMPING)&&this.audioManager.playSound("jumpLand",.65,!1,this.getTransform())}updateFootstepSounds(e){if(this.isPlayingFootsteps)if(this.currentState===eP.WALKING&&this.impostorMesh.isEnabled()){if(this.timeSinceLastStep+=e,this.timeSinceLastStep>=this.stepInterval){let e;do e=Math.floor(Math.random()*this.footstepSoundNames.length);while(this.footstepSoundNames.length>1&&e===this.lastFootstepIndex);let t=this.footstepSoundNames[e];this.lastFootstepIndex=e,this.audioManager.playSound(t,.55,!1,this.getTransform()),this.timeSinceLastStep-=this.stepInterval}}else this.stopFootstepSounds()}startFootstepSounds(){this.isPlayingFootsteps||(this.isPlayingFootsteps=!0,this.timeSinceLastStep=this.stepInterval,this.lastFootstepIndex=-1)}stopFootstepSounds(){this.isPlayingFootsteps&&(this.isPlayingFootsteps=!1,this.timeSinceLastStep=0,this.lastFootstepIndex=-1)}constructor(e,t,i,s,o){super(e,t,i,s,o),(0,k._)(this,"scene",void 0),(0,k._)(this,"targetPosition",B.P.Zero()),(0,k._)(this,"targetYRotation",0),(0,k._)(this,"previousPosition",new B.P),(0,k._)(this,"currentVelocity",new B.P),(0,k._)(this,"lastUpdateTime",0),(0,k._)(this,"positionInterpolationFactor",.2),(0,k._)(this,"rotationInterpolationFactor",.2),(0,k._)(this,"isPlayingFootsteps",!1),(0,k._)(this,"timeSinceLastStep",0),(0,k._)(this,"stepInterval",.45),(0,k._)(this,"footstepSoundNames",["footstep_wood_01","footstep_wood_02","footstep_wood_03","footstep_wood_04"]),(0,k._)(this,"lastFootstepIndex",-1),(0,k._)(this,"_predictedPositionTemp",new B.P),this.scene=t,this.previousPosition.copyFrom(e.position),this.lastUpdateTime=performance.now(),this.physicsAggregate&&this.physicsAggregate.dispose()}}i(87600),i(68313);class e_{async loadIngredientModels(){let e=0;for(let t in eh){let i=Number(t);if(isNaN(i)||i===Z.None)continue;let s=eh[i];if(s&&s.model){let t=this.assetsManager.addMeshTask(`load-${s.name}-model`,"","assets/map/japan/",s.model);e++,t.onSuccess=e=>{let t=e.loadedMeshes[0];t.name=`template_${s.name}`,t.isVisible=!1,t.setEnabled(!1),t.isPickable=!1,t.getChildMeshes().forEach(e=>{e instanceof L.Kj&&(e.isPickable=!1,e.isVisible=!1,e.setEnabled(!1))}),this.ingredientMeshes.set(s.id,t)},t.onError=(e,t,i)=>{console.error(`Error loading model ${s.model} for ${s.name}:`,t,i)}}}return e>0?new Promise((e,t)=>{this.assetsManager.onFinish=()=>{e()},this.assetsManager.onTaskError=e=>{console.error(`Task failed: ${e.name}`),t(Error("Failed to load some ingredient assets."))},this.assetsManager.load()}):(console.warn("No ingredient models to load based on registry."),Promise.resolve())}getIngredientMesh(e){let t=this.ingredientMeshes.get(e);if(!t)return console.warn(`Template mesh for ingredient ${Z[e]} not loaded or found.`),null;let i=t.clone(`ingredient_${Z[e]}_${Date.now()}`);return i?(i.isVisible=!0,i.setEnabled(!0),i.isPickable=!0,i.getChildMeshes().forEach(e=>{e.isVisible=!0,e.setEnabled(!0),e.isPickable=!0}),i):(console.error(`Failed to clone mesh for ${Z[e]}`),null)}dispose(){this.ingredientMeshes.forEach(e=>e.dispose(!1,!0)),this.ingredientMeshes.clear(),this.assetsManager.reset(),console.log("IngredientLoader disposed.")}constructor(e){(0,k._)(this,"assetsManager",void 0),(0,k._)(this,"ingredientMeshes",new Map),this.assetsManager=new j.Sp(e),this.assetsManager.useDefaultLoadingScreen=!1,this.assetsManager.autoHideLoadingUI=!1}}class ew{getCellKey(e){let t=Math.floor(e.x/this.cellSize),i=Math.floor(e.z/this.cellSize);return`${t},${i}`}addObject(e){let t=this.getCellKey(e.mesh.position);this.cells.has(t)||this.cells.set(t,[]),this.cells.get(t).push(e)}clear(){this.cells.clear()}rebuild(e){for(let t of(this.clear(),e))this.addObject(t)}getNearbyObjects(e,t){let i=[],s=Math.ceil(t/this.cellSize),[o,n]=this.getCellKey(e).split(",").map(Number);for(let a=o-s;a<=o+s;a++)for(let o=n-s;o<=n+s;o++){let s=`${a},${o}`,n=this.cells.get(s);if(n)for(let s of n)s.isDisabled()||s.isActive||B.P.Distance(s.mesh.position,e)<=t&&i.push(s)}return i}constructor(e=5){(0,k._)(this,"cells",new Map),(0,k._)(this,"cellSize",void 0),this.cellSize=e}}class eT{handleVisibilityChange(){"visible"===document.visibilityState&&(this.requestFocusAndPointerLock(),this.audioManager.unlock().catch(e=>{console.warn("Failed to unlock audio:",e)}))}handleWindowFocus(){this.requestFocusAndPointerLock(),this.audioManager.unlock().catch(e=>{console.warn("Failed to unlock audio:",e)})}handleCanvasClick(){this.requestFocusAndPointerLock(),this.audioManager.unlock().catch(e=>{console.warn("Failed to unlock audio:",e)})}setupEventListeners(){let e=this.scene.getEngine().getRenderingCanvas();e&&(document.addEventListener("visibilitychange",this.visibilityChangeHandler),window.addEventListener("focus",this.windowFocusHandler),e.addEventListener("click",this.canvasClickHandler))}requestFocusAndPointerLock(){let e=this.scene.getEngine().getRenderingCanvas();e&&(e.focus(),setTimeout(()=>{"visible"===document.visibilityState&&document.hasFocus()&&(e.requestPointerLock().catch(e=>{console.warn("Failed to acquire pointer lock:",e)}),this.audioManager.unlock().catch(e=>{console.warn("Failed to unlock audio:",e)}))},100))}dispose(){let e=this.scene.getEngine().getRenderingCanvas();e&&(document.removeEventListener("visibilitychange",this.visibilityChangeHandler),window.removeEventListener("focus",this.windowFocusHandler),e.removeEventListener("click",this.canvasClickHandler))}constructor(e,t){(0,k._)(this,"scene",void 0),(0,k._)(this,"audioManager",void 0),(0,k._)(this,"visibilityChangeHandler",void 0),(0,k._)(this,"windowFocusHandler",void 0),(0,k._)(this,"canvasClickHandler",void 0),this.scene=e,this.audioManager=t,this.visibilityChangeHandler=this.handleVisibilityChange.bind(this),this.windowFocusHandler=this.handleWindowFocus.bind(this),this.canvasClickHandler=this.handleCanvasClick.bind(this),this.setupEventListeners()}}var ez=i(94396),ek=i(26807),eC=i(87462);class eE{initializeFpsCounter(){let e=ek.i.CreateFullscreenUI("PerformanceUI");this.fpsText=new ez.a,this.fpsText.text="FPS: 0",this.fpsText.color="white",this.fpsText.fontSize=16,this.fpsText.textHorizontalAlignment=eC.o.HORIZONTAL_ALIGNMENT_RIGHT,this.fpsText.textVerticalAlignment=eC.o.VERTICAL_ALIGNMENT_BOTTOM,this.fpsText.paddingRight="10px",this.fpsText.paddingTop="10px",e.addControl(this.fpsText)}update(){let e=Date.now();if(e-this.lastPerformanceUpdate>this.PERFORMANCE_UPDATE_INTERVAL){let t=this.scene.getEngine().getFps().toFixed();this.fpsText&&(this.fpsText.text=`FPS: ${t}`),this.lastPerformanceUpdate=e}}adjustShadowQuality(){this.shadowGenerator&&(this.shadowGenerator.blurKernel=16,this.shadowGenerator.useKernelBlur=!0,this.shadowGenerator.usePercentageCloserFiltering=!0,this.shadowGenerator.shadowMaxZ=30,this.shadowGenerator.stabilizeCascades=!0,this.shadowGenerator.lambda=.8,this.shadowGenerator.cascadeBlendPercentage=.1,this.shadowGenerator.depthClamp=!0,this.shadowGenerator.autoCalcDepthBounds=!0,this.shadowGenerator.bias=.001,this.shadowGenerator.normalBias=.3,this.shadowGenerator.depthScale=50)}dispose(){}constructor(e,t){(0,k._)(this,"scene",void 0),(0,k._)(this,"shadowGenerator",void 0),(0,k._)(this,"fpsText",void 0),(0,k._)(this,"lastPerformanceUpdate",0),(0,k._)(this,"PERFORMANCE_UPDATE_INTERVAL",1e3),this.scene=e,this.shadowGenerator=t,this.initializeFpsCounter(),this.adjustShadowQuality()}}var eA=i(55415),eN=i(74038);class eO{async initialize(){try{this.audioEngine=await (0,eA.I)()}catch(e){console.error("AudioManager: Failed to create Audio Engine.",e),this.audioEngine=null}}async unlock(){if(!this.audioEngine)return void console.warn("AudioManager: Cannot unlock, Audio Engine not initialized.");if(!this.isUnlocked)try{await this.audioEngine.unlockAsync(),this.isUnlocked=!0}catch(e){console.error("AudioManager: Failed to unlock Audio Engine.",e),this.isUnlocked=!1}}loadSounds(e,t,i){if(!this.audioEngine){console.error("AudioManager: Cannot load sounds, Audio Engine not initialized. Call initialize() first."),null==i||i();return}this.isReady=!1;let s=e.length,o=0;if(0===s){this.isReady=!0,null==i||i();return}e.forEach(e=>{let n=this.assetsManager.addBinaryFileTask(`load_sound_${e.name}`,e.path);n.onSuccess=async n=>{var a,r,l,h,d,c,p;let u=await (0,eN.HB)(e.name,n.data,{loop:(null==(a=e.options)?void 0:a.loop)??!1,autoplay:(null==(r=e.options)?void 0:r.autoplay)??!1,volume:(null==(l=e.options)?void 0:l.volume)??1,spatialEnabled:(null==(h=e.options)?void 0:h.spatialSound)??!1,spatialMaxDistance:(null==(d=e.options)?void 0:d.maxDistance)??100,spatialRolloffFactor:(null==(c=e.options)?void 0:c.rolloffFactor)??1,spatialDistanceModel:(null==(p=e.options)?void 0:p.distanceModel)??"linear"});this.staticSounds.set(e.name,u),this.soundsConfig.set(e.name,e),o++,null==t||t(s-o,s),o===s&&(this.isReady=!0,console.log("AudioManager: All sound files loaded."),null==i||i())},n.onError=(n,a,r)=>{console.error(`Error loading sound file ${e.path} for ${e.name}:`,a,r),o++,null==t||t(s-o,s),o===s&&(this.isReady=!0,console.warn("AudioManager: Finished loading sounds, but some failed."),null==i||i())}}),this.assetsManager.load()}playSound(e){var t,i;let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,o=arguments.length>2?arguments[2]:void 0,n=arguments.length>3?arguments[3]:void 0;if(!this.isReady)return;if(!this.isUnlocked)return void console.warn(`AudioManager: Audio Engine not unlocked, cannot play sound: ${e}. Unlock requires user interaction.`);let a=this.staticSounds.get(e),r=this.soundsConfig.get(e);if(!a||!r)return void console.warn(`Sound not found: ${e}`);a.volume=s*this.sfxVolume*this.globalVolume*((null==(t=r.options)?void 0:t.volume)??1),void 0!==o&&(a.loop=o),(null==(i=r.options)?void 0:i.spatialSound)&&n&&a.spatial.attach(n),a.play()}stopSound(e){if(!this.isReady)return;let t=this.staticSounds.get(e);null==t||t.stop()}dispose(){var e;this.staticSounds.forEach(e=>{e.stop(),e.dispose()}),this.staticSounds.clear(),this.assetsManager.reset(),null==(e=this.audioEngine)||e.dispose(),this.audioEngine=null,this.isReady=!1,this.isUnlocked=!1,console.log("AudioManager disposed.")}constructor(e){(0,k._)(this,"assetsManager",void 0),(0,k._)(this,"staticSounds",new Map),(0,k._)(this,"soundsConfig",new Map),(0,k._)(this,"globalVolume",.7),(0,k._)(this,"sfxVolume",1),(0,k._)(this,"isReady",!1),(0,k._)(this,"isUnlocked",!1),(0,k._)(this,"audioEngine",null),this.assetsManager=new j.Sp(e),this.assetsManager.useDefaultLoadingScreen=!1}}var eD=i(51425);let eR={onigiri_recipe:{id:"onigiri_recipe",name:"Onigiri",result:{ingredient:Z.Onigiri,quantity:1},requiredIngredients:[{ingredient:Z.CookedRice,quantity:1},{ingredient:Z.Nori,quantity:1}],stationType:Q.ChoppingBoard,scoreValue:100,forServing:!0},cooked_rice_recipe:{id:"cooked_rice_recipe",name:"Cooked Rice",result:{ingredient:Z.CookedRice,quantity:1},requiredIngredients:[{ingredient:Z.Rice,quantity:1}],stationType:Q.Oven,processingTime:5e3},ebi_nigiri_recipe:{id:"ebi_nigiri_recipe",name:"Ebi Nigiri",result:{ingredient:Z.EbiNigiri,quantity:1},requiredIngredients:[{ingredient:Z.CookedRice,quantity:1},{ingredient:Z.Ebi,quantity:1}],stationType:Q.ChoppingBoard,scoreValue:150,forServing:!0},salmon_nigiri_recipe:{id:"salmon_nigiri_recipe",name:"Salmon Nigiri",result:{ingredient:Z.SalmonNigiri,quantity:2},requiredIngredients:[{ingredient:Z.CookedRice,quantity:1},{ingredient:Z.Salmon,quantity:1},{ingredient:Z.Nori,quantity:1}],stationType:Q.ChoppingBoard,scoreValue:150,forServing:!0},sea_urchin_recipe:{id:"sea_urchin_recipe",name:"Sea Urchin",result:{ingredient:Z.SeaUrchinOpen,quantity:1},requiredIngredients:[{ingredient:Z.SeaUrchin,quantity:1}],stationType:Q.ChoppingBoard,scoreValue:100},sea_urchin_roll_recipe:{id:"sea_urchin_roll_recipe",name:"Sea Urchin Roll",result:{ingredient:Z.SeaUrchinRoll,quantity:1},requiredIngredients:[{ingredient:Z.CookedRice,quantity:1},{ingredient:Z.SeaUrchinOpen,quantity:1},{ingredient:Z.Nori,quantity:1}],stationType:Q.ChoppingBoard,scoreValue:200,forServing:!0}};var eB=i(58805),eL=i(84396);class eF{dispose(){var e,t,i,s,o;null==(e=this.chickAssetContainer)||e.dispose(),this.chickAssetContainer=null,null==(t=this.chickenAssetContainer)||t.dispose(),this.chickenAssetContainer=null,this.chickTemplateMesh=null,this.poufParticleTexture&&(this.poufParticleTexture.dispose(),this.poufParticleTexture=null),this.spawnedCustomers.forEach(e=>{e.dispose()}),this.spawnedCustomers.clear(),null==(i=this.localController)||i.dispose(),this.remoteControllers.forEach(e=>e.dispose()),this.remoteControllers.clear(),this.audioManager.dispose(),this.inputManager.dispose(),null==(s=this.performanceManager)||s.dispose(),ec.reset(),null==(o=this.ingredientLoader)||o.dispose(),this.scene.dispose(),this.uiRenderObserver&&(this.scene.onBeforeRenderObservable.remove(this.uiRenderObserver),this.uiRenderObserver=null),this.customerOrderMeshes.forEach(e=>e.dispose()),this.customerOrderMeshes.clear(),this.orderUITextures.forEach(e=>e.dispose()),this.orderUITextures.clear(),this.orderUIMaterials.forEach(e=>e.dispose()),this.orderUIMaterials.clear(),this.customerOrderData.clear(),this.customerOrderIcons.clear(),this.lastOrderUIUpdateTimes.clear(),this.boundaryWalls.forEach(e=>{var t;null==(t=e.getPhysicsBody())||t.dispose(),e.dispose()}),this.boundaryWalls=[],console.log("GameEngine disposed")}playSfx(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2?arguments[2]:void 0,s=arguments.length>3?arguments[3]:void 0;this.audioManager.playSound(e,t,i,s)}stopSfx(e){this.audioManager.stopSound(e)}async init(){var e;let t=this.scene.getEngine();t.displayLoadingUI(),await this.audioManager.initialize(),this.assetsManager=new j.Sp(this.scene),this.assetsManager.useDefaultLoadingScreen=!1,this.assetsManager.autoHideLoadingUI=!1,this.ingredientLoader=new e_(this.scene);let i=this.assetsManager.addContainerTask("characterTask","","assets/characters/","character.glb"),s=new U.a(!0,await (0,V.Z)());this.scene.enablePhysics(new B.P(0,-20,0),s),new A.e("hemilight",new B.P(0,1,0),this.scene).intensity=.3;let o=new E.O("sun",new B.P(-5,-10,5).normalize(),this.scene);o.position=o.direction.negate().scaleInPlace(40),this.shadowGenerator=new C.R(256,o),this.shadowGenerator.useKernelBlur=!0,this.shadowGenerator.depthClamp=!0,this.shadowGenerator.autoCalcDepthBounds=!0,this.performanceManager=new eE(this.scene,this.shadowGenerator),new A.e("extraHemi",B.P.Up(),this.scene).intensity=.4;let n=F.V.CreateBox("skyBox",{size:150},this.scene),a=new D.K("skyBox",this.scene);a.backFaceCulling=!1,a.reflectionTexture=new N.B("assets/skybox/skybox",this.scene),a.reflectionTexture.coordinatesMode=O.x.SKYBOX_MODE,a.diffuseColor=new R.Wo(0,0,0),a.specularColor=new R.Wo(0,0,0),n.material=a;let r=new G.x("ref",512,this.scene);null==(e=r.renderList)||e.push(n),this.scene.environmentTexture=r.cubeTexture,i.onSuccess=e=>{this.loadedCharacterContainer=e.loadedContainer},this.assetsManager.onProgress=(e,t,i)=>{let s=this.scene.getEngine();s.loadingScreen instanceof W&&s.loadingScreen.updateProgress((t-e)/t*100)};let l=this.assetsManager.addContainerTask("chickTask","","assets/map/japan/","Chick.glb");l.onSuccess=e=>{this.chickAssetContainer=e.loadedContainer;let t=e.loadedContainer.rootNodes[0];t instanceof eD.x?(this.chickTemplateMesh=t,this.chickTemplateMesh.setEnabled(!1),this.chickTemplateMesh.isVisible=!1,this.chickTemplateMesh.isPickable=!1,this.chickTemplateMesh.getChildMeshes().forEach(e=>{e.setEnabled(!1),e.isVisible=!1,e.isPickable=!1})):console.error("Chick GLB loaded, but root node is not a mesh.")},l.onError=(e,t,i)=>{console.error("Error loading Chick.glb:",t,i)};let h=this.assetsManager.addContainerTask("chickenTask","","assets/map/japan/","Chicken.glb");h.onSuccess=e=>{this.chickenAssetContainer=e.loadedContainer;let t=e.loadedContainer.rootNodes[0];t instanceof eD.x?(this.chickenTemplateMesh=t,this.chickenTemplateMesh.setEnabled(!1),this.chickenTemplateMesh.isVisible=!1,this.chickenTemplateMesh.isPickable=!1,this.chickenTemplateMesh.getChildMeshes().forEach(e=>{e.setEnabled(!1),e.isVisible=!1,e.isPickable=!1})):console.error("Chick GLB loaded, but root node is not a mesh.")},h.onError=(e,t,i)=>{console.error("Error loading Chick.glb:",t,i)};try{this.poufParticleTexture=new O.x("assets/particles/Star-Texture.png",this.scene),this.poufParticleTexture.hasAlpha=!0}catch(e){console.error("Failed to load pouf particle texture:",e)}try{this.portalParticleTexture=new O.x("assets/particles/Runes1.png",this.scene),this.portalParticleTexture.hasAlpha=!0,console.log("Portal particle texture loaded successfully.")}catch(e){console.error("Failed to load portal particle texture, falling back to pouf:",e);try{this.poufParticleTexture=new O.x("assets/particles/Star-Texture.png",this.scene),this.poufParticleTexture.hasAlpha=!0}catch(e){console.error("Failed to load fallback pouf texture:",e)}}this.assetsManager.onFinish=()=>{this.loadingState.assets.progress=100,this.loadingState.currentTask="Assets loaded, preparing map and sounds...";let e=this.scene.getEngine();e.loadingScreen instanceof W&&(e.loadingScreen.loadingUIText=this.loadingState.currentTask),c=!0,y()};let d=new eS(this.scene,this.shadowGenerator,this.ingredientLoader),c=!1,p=!1,m=!1,g=!1,y=()=>{if(c&&p&&m&&g){let e=this.scene.getEngine();e.loadingScreen instanceof W&&(this.loadingState.currentTask="Initializing game...",e.loadingScreen.loadingUIText=this.loadingState.currentTask,e.loadingScreen.updateProgress(100),this.createBoundaryWalls(),this.initializePlayers(),setTimeout(()=>{this.loadingState.currentTask="Ready!",e.loadingScreen instanceof W&&(e.loadingScreen.loadingUIText=this.loadingState.currentTask,e.loadingScreen.updateProgress(100)),setTimeout(()=>e.hideLoadingUI(),500)},500))}};this.audioManager.loadSounds(this.soundList,void 0,()=>{m=!0,y()}),this.ingredientLoader.loadIngredientModels().then(()=>{g=!0,y()}).catch(e=>{console.error("Error loading ingredient models:",e)}),this.assetsManager.load(),d.loadAndPlaceModels("assets/map/",es,()=>{if(this.interactables=d.interactables,p=!0,this.loadingState.map.loaded=!0,this.loadingState.map.progress=100,this.loadingState.currentTask="Map loading complete",t.loadingScreen instanceof W){let e=(this.loadingState.assets.progress+this.loadingState.map.progress)/2;t.loadingScreen.updateProgress(e),t.loadingScreen.loadingUIText=this.loadingState.currentTask}let e=(0,u.getStateCallbacks)(this.room);e(this.room.state).interactableObjects.onAdd((t,i)=>{let s=this.interactables.find(e=>e.id===Number(i));if(!s)return void console.warn(`Interactable ${i} added to state but not found in client list.`);let o=e=>{s.setDisabled(e.disabled),e.isActive?s.activate(e.activeSince,e.processingEndTime):s.deactivate();let t=e.ingredientsOnBoard.map(e=>e);if(s.updateIngredientsOnBoard(t),s.interactType===Q.Oven){let t=e.isActive&&e.processingRecipeId&&e.processingEndTime>0,i=t?eR[e.processingRecipeId]:null;t&&i&&i.requiredIngredients.length>0?s.showCookingVisual(i.requiredIngredients[0].ingredient):s.hideCookingVisual()}};if(o(t),e(t).onChange(()=>{this.interactables.find(e=>e.id===Number(i))&&o(t)}),s.interactType===Q.Oven&&(e(t).listen("isActive",(e,t)=>{e&&!t?this.audioManager.playSound("ovenLoop",.6,!0,s.mesh):!e&&t&&this.audioManager.stopSound("ovenLoop")}),t.isActive&&this.audioManager.playSound("ovenLoop",.6,!0,s.mesh)),s.interactType===Q.ChoppingBoard){let i=t.ingredientsOnBoard.length;e(t).listen("ingredientsOnBoard",e=>{e.length!==i&&(this.playSfx("pickupPlace"),i=e.length)})}}),this.setupGameEventListeners(),y()},e=>{this.loadingState.map.progress=e,this.loadingState.currentTask=`Loading map: ${e.toFixed(0)}%`;let t=this.scene.getEngine();if(t.loadingScreen instanceof W){let e=(this.loadingState.assets.progress+this.loadingState.map.progress)/2;t.loadingScreen.updateProgress(e),t.loadingScreen.loadingUIText=this.loadingState.currentTask}},this.room.state.mapHash),this.inputManager.requestFocusAndPointerLock()}_setupUIRenderObserver(){this.uiRenderObserver&&this.scene.onBeforeRenderObservable.remove(this.uiRenderObserver),this.uiRenderObserver=this.scene.onBeforeRenderObservable.add(()=>{let e=Date.now();this.customerOrderMeshes.forEach((t,i)=>{let s=this.spawnedCustomers.get(i);if(s&&s.isEnabled()){if(s.getAbsolutePosition().addToRef(this.customerUIOffset,this._uiUpdatePosVector),t.setAbsolutePosition(this._uiUpdatePosVector),t.isEnabled()||t.setEnabled(!0),e-(this.lastOrderUIUpdateTimes.get(i)??0)>this.orderUIUpdateInterval){let t=this.orderUITextures.get(i),s=this.customerOrderData.get(i),o=this.customerOrderIcons.get(i);t&&s&&o&&o.complete&&(this.drawOrderUIWithTimer(t,s,o),this.lastOrderUIUpdateTimes.set(i,e))}}else t.isEnabled()&&t.setEnabled(!1),this.lastOrderUIUpdateTimes.has(i)&&this.lastOrderUIUpdateTimes.delete(i)})})}createBoundaryWalls(){let e=(e,t,i)=>{let s=F.V.CreateBox(e,{width:i.x,height:i.y,depth:i.z},this.scene);s.position=t,s.visibility=0,s.isPickable=!1,new ef.p(s,J.Bq.BOX,{mass:0,friction:.5,restitution:.1},this.scene),this.boundaryWalls.push(s)};e("BoundaryWall_Back",new B.P(0,10,-9.25),new B.P(18.5,20,.5)),e("BoundaryWall_Front",new B.P(0,10,9.25),new B.P(18.5,20,.5)),e("BoundaryWall_Left",new B.P(-9.25,10,0),new B.P(.5,20,18.5)),e("BoundaryWall_Right",new B.P(9.25,10,0),new B.P(.5,20,18.5)),console.log(`Created ${this.boundaryWalls.length} invisible boundary walls.`)}setupGameEventListeners(){let e=(0,u.getStateCallbacks)(this.room);e(this.room.state).interactableObjects.onAdd((t,i)=>{let s=this.interactables.find(e=>e.id===Number(i));if(!s)return;if(s.interactType===Q.Oven&&(t.isActive&&"cooked_rice_recipe"===t.processingRecipeId?s.showCookingVisual(Z.Rice):s.hideCookingVisual(),e(t).onChange(()=>{if(t.isActive&&"cooked_rice_recipe"===t.processingRecipeId?s.showCookingVisual(Z.Rice):s.hideCookingVisual(),!t.isActive&&t.ingredientsOnBoard.length>0){let e=t.ingredientsOnBoard.map(e=>e);s.updateIngredientsOnBoard(e)}else t.isActive||s.clearIngredientsOnBoard()}),e(t).listen("isActive",(e,t)=>{e&&!t?this.audioManager.playSound("ovenLoop",.6,!0,s.mesh):!e&&t&&this.audioManager.stopSound("ovenLoop")}),t.isActive&&this.audioManager.playSound("ovenLoop",.6,!0,s.mesh)),s.interactType===Q.ChoppingBoard){let i=[...t.ingredientsOnBoard.values()];e(t).onChange(()=>{let e=[...t.ingredientsOnBoard.values()];e.length!==i.length&&this.playSfx("pickupPlace"),i=e})}e(t).onChange(()=>{let e=this.interactables.find(e=>e.id===Number(t.id));if(!e)return;e.setDisabled(t.disabled),t.isActive&&e.interactType!==Q.Oven?e.activate():t.isActive||e.interactType===Q.Oven||e.deactivate();let i=t.ingredientsOnBoard.map(e=>e);e.updateIngredientsOnBoard(i)});let o=this.interactables.find(e=>e.id===Number(t.id));if(o){o.setDisabled(t.disabled);let e=t.ingredientsOnBoard.map(e=>e);o.updateIngredientsOnBoard(e),t.isActive&&o.interactType!==Q.Oven&&o.activate()}}),e(this.room.state).orders.onAdd(t=>{-1!==t.chairId&&(this.handleSpawnChick(t.chairId,t.customerType),this.customerOrderData.set(t.chairId,{createdAt:t.createdAt,deadline:t.deadline}),this.createCustomerOrderUI_3D(t.chairId,t.recipeId)),e(t).listen("deadline",e=>{-1!==t.chairId&&this.customerOrderData.has(t.chairId)&&(this.customerOrderData.set(t.chairId,{createdAt:t.createdAt,deadline:e}),this.lastOrderUIUpdateTimes.set(t.chairId,0))})}),e(this.room.state).orders.onRemove(e=>{-1!==e.chairId&&(this.handleRemoveChick(e.chairId),this.removeCustomerOrderUI_3D(e.chairId),this.customerOrderData.delete(e.chairId),this.lastOrderUIUpdateTimes.delete(e.chairId))}),e(this.room.state).listen("timeLeft",e=>{let t=e<=1e4&&e>0;t&&!this.isTimerTickingSoundPlaying?(this.isTimerTickingSoundPlaying=!0,null!==this.timerTickIntervalId&&clearInterval(this.timerTickIntervalId),this.playSfx("timerTick"),this.timerTickIntervalId=window.setInterval(()=>{this.room.state.timeLeft<=1e4&&this.room.state.timeLeft>0?this.playSfx("timerTick"):this.stopTimerTickingSound()},1e3)):!t&&this.isTimerTickingSoundPlaying&&this.stopTimerTickingSound()}),this.room.onMessage("alreadyCarrying",()=>this.playSfx("error")),this.room.onMessage("noIngredient",()=>this.playSfx("error")),this.room.onMessage("invalidIngredient",()=>this.playSfx("error")),this.room.onMessage("noMatchingOrder",()=>this.playSfx("error")),this.room.onMessage("needPlate",()=>this.playSfx("error")),this.room.onMessage("wrongIngredient",()=>this.playSfx("error")),this.room.onMessage("wrongOrder",()=>this.playSfx("error")),this.room.onMessage("orderCompleted",()=>this.playSfx("orderComplete")),this.room.onMessage("invalidServe",()=>this.playSfx("error")),this.room.onMessage("stationBusy",()=>this.playSfx("error")),this.room.onMessage("cannotPickup",()=>this.playSfx("error")),this.room.onMessage("invalidPickup",()=>this.playSfx("error")),this.room.onMessage("boardFull",()=>this.playSfx("error")),this.room.onMessage("invalidCombination",()=>this.playSfx("error")),this.room.onMessage("boardNotEmpty",()=>this.playSfx("error")),this.room.onMessage("boardEmpty",()=>this.playSfx("error")),this.room.onMessage("cannotPlaceRaw",()=>this.playSfx("error")),this.room.onMessage("error",e=>{console.warn("Received error from server:",(null==e?void 0:e.message)||"Unknown error"),this.playSfx("error")}),this.room.onMessage("orderCompleted",()=>this.playSfx("orderComplete")),this.room.onMessage("gameOver",e=>{var t;console.log("Game Over! Final Score:",e.finalScore),this.onGameOverCallback(e.finalScore),null==(t=this.localController)||t.inputMap.clear(),this.audioManager.stopSound("ovenLoop"),this.stopTimerTickingSound(),this.scene.getEngine().isPointerLock&&document.exitPointerLock(),this.dispose()})}createCustomerOrderUI_3D(e,t){this.customerOrderMeshes.has(e)&&this.removeCustomerOrderUI_3D(e);let i=this.spawnedCustomers.get(e);if(!i)return;let s=eR[t];if(!s)return;let o=eh[s.result.ingredient];if(!o||!o.icon)return;let n=`/ingredients/${o.icon}.png`,a=F.V.CreatePlane(`orderPlane_${e}`,{size:.6},this.scene);a.billboardMode=L.Kj.BILLBOARDMODE_ALL,a.isPickable=!1,a.renderingGroupId=1,a.position=i.getAbsolutePosition().add(this.customerUIOffset),a.setEnabled(!0);let r=new ea.c(`orderTex_${e}`,{width:128,height:128},this.scene,!1,O.x.TRILINEAR_SAMPLINGMODE);r.hasAlpha=!0;let l=new Image;l.src=n,l.onload=()=>{this.customerOrderIcons.set(e,l);let t=this.customerOrderData.get(e);t?this.drawOrderUIWithTimer(r,t,l):this.drawOrderUIWithTimer(r,{createdAt:Date.now(),deadline:Date.now()+6e4},l)},l.onerror=()=>{console.error(`[UI 3D] Failed to load icon: ${n}`);let t=new Image;t.width=1,t.height=1,this.customerOrderIcons.set(e,t);let i=this.customerOrderData.get(e);i&&this.drawOrderUIWithTimer(r,i,t,!0)};let h=new D.K(`orderMat_${e}`,this.scene);h.diffuseTexture=r,h.opacityTexture=r,h.useAlphaFromDiffuseTexture=!1,h.specularColor=new R.Wo(0,0,0),h.emissiveColor=R.Wo.White(),h.disableLighting=!0,h.backFaceCulling=!1,a.material=h,this.customerOrderMeshes.set(e,a),this.orderUITextures.set(e,r),this.orderUIMaterials.set(e,h),this.lastOrderUIUpdateTimes.set(e,0)}drawOrderUIWithTimer(e,t,i){let s=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=e.getSize().width,n=e.getSize().height,a=e.getContext();if(!a)return;let r=1;if(t.deadline>0&&t.createdAt>0){let e=t.deadline-t.createdAt,i=Date.now()-t.createdAt;r=eB.R.Clamp(1-i/e,0,1)}t.deadline>0&&Date.now()>t.deadline&&(r=0);let l=n-18-48,h=16+l+16;if(a.clearRect(0,0,o,n),a.fillStyle="rgba(0, 0, 0, 0.5)",a.beginPath(),a.roundRect(8,8,o-16,n-16,15),a.fill(),!s&&i.complete&&i.naturalWidth>0){let e=.9*Math.min(o-32,l),t=(o-e)/2,s=16+(l-e)/2;a.drawImage(i,t,s,e,e)}else s&&(a.fillStyle="white",a.font="bold 30px Arial",a.textAlign="center",a.textBaseline="middle",a.fillText("?",o/2,16+l/2));if(t.deadline>0){let e=o-32,t=e*r;a.fillStyle="rgba(50, 50, 50, 0.8)",a.fillRect(16,h,e,18);let i="#4ade80";r<.25?i="#f87171":r<.6&&(i="#facc15"),a.fillStyle=i,a.fillRect(16,h,t,18),a.strokeStyle="rgba(200, 200, 200, 0.7)",a.lineWidth=1,a.strokeRect(16,h,e,18)}e.update(!0)}removeCustomerOrderUI_3D(e){let t=this.customerOrderMeshes.get(e);t&&(t.dispose(),this.customerOrderMeshes.delete(e));let i=this.orderUITextures.get(e);i&&(i.dispose(),this.orderUITextures.delete(e));let s=this.orderUIMaterials.get(e);s&&(s.dispose(),this.orderUIMaterials.delete(e)),this.customerOrderData.delete(e),this.customerOrderIcons.delete(e),this.lastOrderUIUpdateTimes.delete(e)}handleSpawnChick(e,t){if(this.spawnedCustomers.has(e))return;let i="chick"===t?this.chickTemplateMesh:this.chickenTemplateMesh,s="chick"===t?this.chickAssetContainer:this.chickenAssetContainer;if(!i||!s)return void console.error(`${"chick"===t?"Chick":"Chicken"} template mesh or container is not loaded or available. Cannot spawn.`);let o=this.interactables.find(t=>t.id===e&&t.interactType===Q.ServingOrder);if(!o)return void console.error(`Could not find chair object with ID ${e} to spawn customer.`);let n=s.instantiateModelsToScene(t=>`${t}_${e}`,!1,{doNotInstantiate:!0}).rootNodes[0];if(!n)return void console.error(`Failed to clone customer template mesh for chair ${e}.`);n.setEnabled(!0),n.isVisible=!0,n.isPickable=!1,n.getChildMeshes().forEach(t=>{t.setEnabled(!0),t.isVisible=!0,t.isPickable=!1,t.material&&(t.material=t.material.clone(`${t.material.name}_${e}`))});let a=new B.P(.075,.075,.075);n.scaling=B.P.Zero();let r=o.mesh,l=r.getAbsolutePosition().add(new B.P(0,.05,0));n.position=l,n.rotation=r.rotation?r.rotation.clone():B.P.Zero(),this.spawnedCustomers.set(e,n);let h=new eL.fw(`customerSpawnScale_${e}`,"scaling",60,eL.fw.ANIMATIONTYPE_VECTOR3,eL.fw.ANIMATIONLOOPMODE_CONSTANT),d=[];d.push({frame:0,value:B.P.Zero()}),d.push({frame:24,value:a}),h.setKeys(d);let c=new eL.ud(.6);c.setEasingMode(eL.Kp.EASINGMODE_EASEOUT),h.setEasingFunction(c),n.animations=n.animations||[],n.animations.push(h),this.scene.beginAnimation(n,0,24,!1,1,()=>{n.scaling.copyFrom(a)}),this.createPortalSpawnEffect(l)}handleRemoveChick(e){let t=this.spawnedCustomers.get(e);if(t){let i=new eL.fw(`customerDespawnScale_${e}`,"scaling",60,eL.fw.ANIMATIONTYPE_VECTOR3,eL.fw.ANIMATIONLOOPMODE_CONSTANT),s=[];s.push({frame:0,value:t.scaling.clone()}),s.push({frame:18,value:B.P.Zero()}),i.setKeys(s);let o=new eL.v;o.setEasingMode(eL.Kp.EASINGMODE_EASEIN),i.setEasingFunction(o),this.scene.stopAnimation(t,`customerSpawnScale_${e}`),t.animations=t.animations||[],t.animations.push(i),this.scene.beginAnimation(t,0,18,!1,1,()=>{t&&!t.isDisposed()&&t.dispose(),this.spawnedCustomers.delete(e)})}else this.spawnedCustomers.delete(e);this.removeCustomerOrderUI_3D(e),this.customerOrderData.delete(e)}createPortalSpawnEffect(e){let t=new en.p(`portalSpawn_${e.x}_${e.z}`,150,this.scene);if(this.portalParticleTexture)t.particleTexture=this.portalParticleTexture;else{if(!this.poufParticleTexture)return void console.error("No particle texture available for portal effect.");console.warn("Using fallback pouf texture for portal effect."),t.particleTexture=this.poufParticleTexture}t.emitter=e.clone().addInPlace(new B.P(0,.1,0)),t.particleEmitterType=t.createSphereEmitter(.15),t.color1=new R.HE(.5,.8,1,1),t.color2=new R.HE(.7,.5,1,1),t.colorDead=new R.HE(.1,.1,.2,0),t.addColorGradient(0,new R.HE(.8,.9,1,1)),t.addColorGradient(.6,new R.HE(.6,.5,1,.7)),t.addColorGradient(1,t.colorDead.clone()),t.minSize=.03,t.maxSize=.15,t.addSizeGradient(0,.02),t.addSizeGradient(.4,.15),t.addSizeGradient(1,.01),t.minLifeTime=.4,t.maxLifeTime=.8,t.emitRate=150/t.minLifeTime,t.manualEmitCount=150,t.minEmitPower=1.5,t.maxEmitPower=3,t.updateSpeed=.008,t.gravity=new B.P(0,-1.5,0),t.direction1=new B.P(-.8,.5,-.8),t.direction2=new B.P(.8,1,.8),t.minAngularSpeed=-(3*Math.PI),t.maxAngularSpeed=3*Math.PI,t.blendMode=en.p.BLENDMODE_ADD,t.disposeOnStop=!0,t.start(),setTimeout(()=>{t.stop()},1e3*t.maxLifeTime+100)}stopTimerTickingSound(){null!==this.timerTickIntervalId&&(clearInterval(this.timerTickIntervalId),this.timerTickIntervalId=null),this.isTimerTickingSoundPlaying=!1}update(e){var t,i,s;let o=e/1e3;if(null==(t=this.localController)||t.update(o),this.localController){this._playerPosTemp.copyFrom(this.localController.position),this.scene.getFrameId()%60==0&&this.spatialGrid.rebuild(this.interactables);let e=this.MAX_INTERACTION_DISTANCE/2,t=this.spatialGrid.getNearbyObjects(this._playerPosTemp,e),i=null,s=1/0;for(let e of t){let t=B.P.Distance(e.mesh.position,this._playerPosTemp);t<e.interactionDistance&&t<s&&(s=t,i=e)}i!==this._nearestInteractable&&(this._nearestInteractable&&this._nearestInteractable.showPrompt(!1),i&&i.showPrompt(!0),this._nearestInteractable=i)}if(this.room&&this.localController){let e=Date.now(),t=this.localController.getTransform(),i=t.position,o=(null==(s=t.rotationQuaternion)?void 0:s.toEulerAngles().y)||0,n=this.localController.getTargetAnim.name,a=e-this.lastNetworkUpdateTime,r=B.P.Distance(i,this.lastSentPosition)>this.POSITION_THRESHOLD,l=Math.abs(o-this.lastSentRotation)>this.ROTATION_THRESHOLD,h=this.lastSentAnimationState!==n;(a>=this.MAX_NETWORK_UPDATE_INTERVAL||a>=this.NETWORK_UPDATE_INTERVAL&&(r||l||h))&&(this.room.send("move",{position:{x:i.x,y:i.y,z:i.z},rotation:{y:o},animationState:n,timestamp:e}),this.lastSentPosition.copyFrom(i),this.lastSentRotation=o,this.lastSentAnimationState=n,this.lastNetworkUpdateTime=e)}this.remoteControllers.forEach(e=>{e.update(o)}),null==(i=this.performanceManager)||i.update()}tryInteract(e){if(this._nearestInteractable&&B.P.Distance(this._nearestInteractable.mesh.position,e.position)<=this._nearestInteractable.interactionDistance){this._nearestInteractable.interact(),this.room.send("interact",{objectId:this._nearestInteractable.id,timestamp:Date.now()});return}this._playerPosTemp.copyFrom(e.position);let t=this.spatialGrid.getNearbyObjects(this._playerPosTemp,this.MAX_INTERACTION_DISTANCE),i=null,s=1/0;for(let e of t){let t=B.P.Distance(e.mesh.position,this._playerPosTemp);t<e.interactionDistance&&t<s&&(s=t,i=e)}i&&(this._nearestInteractable=i,i.interact(),this.room.send("interact",{objectId:i.id,timestamp:Date.now()}))}initializePlayers(){if(!this.loadedCharacterContainer)return void console.error("Character container not loaded!");let e=this.loadedCharacterContainer.instantiateModelsToScene(e=>e),t=e.rootNodes[0];t.scaling=new B.P(.9,.9,.9),t.rotation=new B.P(0,0,0),this.localController=new eI(this,t,this.ingredientLoader,e.animationGroups,this.scene,this.audioManager),this.localController.model.receiveShadows=!0,this.shadowGenerator.addShadowCaster(this.localController.model);let i=(0,u.getStateCallbacks)(this.room);i(this.room.state).players.onAdd(async(e,t)=>{if(t===this.room.sessionId){var s,o;null==(s=this.localController)||s.setPosition(new B.P(e.x,e.y,e.z)),null==(o=this.localController)||o.setRotationY(e.rot),i(e).listen("holdingPlate",e=>{this.localController&&(e&&!this.localController.isHoldingPlate?this.localController.forcePickupPlate():!e&&this.localController.isHoldingPlate&&this.localController.dropPlate())}),i(e).listen("holdedIngredient",e=>{this.localController&&this.localController.forceSetIngredient(e)});return}let n=this.loadedCharacterContainer.instantiateModelsToScene(e=>e),a=n.rootNodes[0];a.scaling=new B.P(.9,.9,.9),a.rotation=new B.P(0,0,0);let r=new eM(a,this.scene,this.ingredientLoader,n.animationGroups,this.audioManager);r.setPosition(new B.P(e.x,e.y,e.z)),r.setRotationY(e.rot),a.receiveShadows=!0,this.shadowGenerator.addShadowCaster(a),this.remoteControllers.set(t,r),r.receiveFirstState(e);let l=0;i(e).onChange(()=>{let t=Date.now();t-l>50&&(r.receiveState(e),l=t)})}),i(this.room.state).players.onRemove((e,t)=>{let i=this.remoteControllers.get(t);i&&(i.dispose(),this.remoteControllers.delete(t))})}constructor(e,t,i){var s;(0,k._)(this,"interactables",[]),(0,k._)(this,"spatialGrid",new ew(2.5)),(0,k._)(this,"scene",void 0),(0,k._)(this,"room",void 0),(0,k._)(this,"localController",void 0),(0,k._)(this,"remoteControllers",new Map),(0,k._)(this,"shadowGenerator",void 0),(0,k._)(this,"assetsManager",void 0),(0,k._)(this,"ingredientLoader",void 0),(0,k._)(this,"inputManager",void 0),(0,k._)(this,"performanceManager",void 0),(0,k._)(this,"loadedCharacterContainer",void 0),(0,k._)(this,"poufParticleTexture",null),(0,k._)(this,"portalParticleTexture",null),(0,k._)(this,"onGameOverCallback",()=>{}),(0,k._)(this,"chickTemplateMesh",null),(0,k._)(this,"chickAssetContainer",null),(0,k._)(this,"chickenTemplateMesh",null),(0,k._)(this,"chickenAssetContainer",null),(0,k._)(this,"spawnedCustomers",new Map),(0,k._)(this,"customerOrderMeshes",new Map),(0,k._)(this,"orderUITextures",new Map),(0,k._)(this,"orderUIMaterials",new Map),(0,k._)(this,"uiRenderObserver",null),(0,k._)(this,"customerUIOffset",new B.P(0,2,0)),(0,k._)(this,"_uiUpdatePosVector",new B.P),(0,k._)(this,"customerOrderData",new Map),(0,k._)(this,"customerOrderIcons",new Map),(0,k._)(this,"lastOrderUIUpdateTimes",new Map),(0,k._)(this,"orderUIUpdateInterval",250),(0,k._)(this,"_playerPosTemp",new B.P),(0,k._)(this,"loadingState",{assets:{progress:0,total:0,current:0},map:{progress:0,loaded:!1},currentTask:""}),(0,k._)(this,"lastNetworkUpdateTime",0),(0,k._)(this,"NETWORK_UPDATE_INTERVAL",10),(0,k._)(this,"MAX_NETWORK_UPDATE_INTERVAL",100),(0,k._)(this,"POSITION_THRESHOLD",.01),(0,k._)(this,"ROTATION_THRESHOLD",.05),(0,k._)(this,"lastSentPosition",new B.P),(0,k._)(this,"lastSentRotation",0),(0,k._)(this,"lastSentAnimationState",""),(0,k._)(this,"audioManager",void 0),(0,k._)(this,"boundaryWalls",[]),(0,k._)(this,"soundList",[{name:"pickupPlace",path:"assets/audio/pickup_place.ogg",options:{volume:.3}},{name:"trash",path:"assets/audio/trash.ogg",options:{volume:.2}},{name:"orderComplete",path:"assets/audio/order_complete.ogg",options:{volume:.4}},{name:"error",path:"assets/audio/error.ogg",options:{volume:.2}},{name:"ovenLoop",path:"assets/audio/oven_loop.ogg",options:{volume:.025,spatialSound:!0,loop:!0}},{name:"footstep_wood_01",path:"assets/audio/footstep_wood_001.ogg",options:{volume:.7,spatialSound:!0,distanceModel:"linear"}},{name:"footstep_wood_02",path:"assets/audio/footstep_wood_002.ogg",options:{volume:.7,spatialSound:!0,distanceModel:"linear"}},{name:"footstep_wood_03",path:"assets/audio/footstep_wood_003.ogg",options:{volume:.7,spatialSound:!0,distanceModel:"linear"}},{name:"footstep_wood_04",path:"assets/audio/footstep_wood_004.ogg",options:{volume:.7,spatialSound:!0,distanceModel:"linear"}},{name:"jumpLand",path:"assets/audio/jump_land.ogg",options:{volume:.5,spatialSound:!0,distanceModel:"linear"}},{name:"timerTick",path:"assets/audio/timer_tick.ogg",options:{volume:.4}}]),(0,k._)(this,"isTimerTickingSoundPlaying",!1),(0,k._)(this,"timerTickIntervalId",null),(0,k._)(this,"MAX_INTERACTION_DISTANCE",5),(0,k._)(this,"_nearestInteractable",null),this.scene=e,this.room=t,this.onGameOverCallback=i,this.audioManager=new eO(this.scene),this.inputManager=new eT(this.scene,this.audioManager),e.getEngine().setHardwareScalingLevel(1),e.skipFrustumClipping=!1,e.skipPointerMovePicking=!0,e.shadowsEnabled=!0,e.lightsEnabled=!0,e.particlesEnabled=!0,e.collisionsEnabled=!0,e.fogEnabled=!0,null==(s=e.getPhysicsEngine())||s.setTimeStep(1/60),this._setupUIRenderObserver()}}var ej=i(40792),eU=i(50371),eG=i(56841),eV=i(83509),eH=i(73357),eK=i(76561);let e$=e=>{let t=Date.now(),i=Math.max(0,e.deadline-t),s=e.deadline-e.createdAt,o=s>0?Math.min(100,Math.max(0,i/s*100)):0,n=Math.floor(i/6e4),a=Math.floor(i%6e4/1e3);return{timeLeft:i,timePercentage:o,formattedTimeLeft:`${String(n).padStart(2,"0")}:${String(a).padStart(2,"0")}`,isUrgent:i<1e4&&i>0,isExpired:i<=0&&s>0,totalTime:s}},eW=e=>{let t={ingredientsToProcess:[],finalAssemblyIngredients:[],finalAssemblyStation:null,allBaseIngredients:[]};if(!e)return t;let i=function(e){let t=eR[e];if(!t)return[];let i=[],s=new Set;return!function e(t,i,s){let o=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(s.has(t)||t===Z.None)return;let n=function(e){if(e!==Z.None)for(let t in eR){let i=eR[t];if(i.result.ingredient===e)return i}}(t);if(n)n.requiredIngredients.forEach(t=>{e(t.ingredient,i,s)}),i.push({type:"PROCESS",ingredient:t,stationType:n.stationType,requiredIngredients:n.requiredIngredients.map(e=>e.ingredient),isFinalStep:o}),s.add(t);else{if(!eh[t])return;let e=Q.Fridge;i.push({type:"GET",ingredient:t,stationType:e,requiredIngredients:[]}),s.add(t)}}(t.result.ingredient,i,s,!0),i}(e);if(0===i.length)return t;let s=new Set,o=new Set;i.forEach(e=>{if("GET"===e.type)o.add(e.ingredient);else if("PROCESS"===e.type){var i;s.add(e.ingredient),null==(i=e.requiredIngredients)||i.forEach(i=>{!s.has(i)&&(e.stationType===Q.ChoppingBoard||e.stationType===Q.Oven)&&(t.ingredientsToProcess.some(t=>t.ingredient===i&&t.station===e.stationType)||t.ingredientsToProcess.push({ingredient:i,station:e.stationType}))})}}),t.allBaseIngredients=Array.from(o);let n=i[i.length-1];return(null==n?void 0:n.type)==="PROCESS"?(t.finalAssemblyIngredients=n.requiredIngredients??[],t.finalAssemblyStation=n.stationType):(null==n?void 0:n.type)==="GET"&&(t.finalAssemblyIngredients=[n.ingredient],t.finalAssemblyStation=n.stationType),t},eq=e=>{let t,i=(0,p.c)(10),{type:s,size:o}=e,n=void 0===o?14:o;i[0]!==n?(t={size:n,strokeWidth:2,className:"flex-shrink-0"},i[0]=n,i[1]=t):t=i[1];let a=t;switch(s){case Q.Oven:{let e;return i[2]!==a?(e=(0,h.jsx)(ej.Z,{...a,className:"text-orange-500"}),i[2]=a,i[3]=e):e=i[3],e}case Q.ChoppingBoard:{let e;return i[4]!==a?(e=(0,h.jsx)(eU.Z,{...a,className:"text-green-500"}),i[4]=a,i[5]=e):e=i[5],e}case Q.Fridge:case Q.Stock:{let e;return i[6]!==a?(e=(0,h.jsx)(eG.Z,{...a,className:"text-blue-500"}),i[6]=a,i[7]=e):e=i[7],e}default:{let e;return i[8]!==a?(e=(0,h.jsx)(eV.Z,{...a,className:"text-gray-600"}),i[8]=a,i[9]=e):e=i[9],e}}},eJ=(0,d.memo)(e=>{let t,i,s,o,n=(0,p.c)(13),{ingredient:a,sizeClass:r,station:l}=e;n[0]!==a?(t=eh[a],n[0]=a,n[1]=t):t=n[1];let d=t,c=(null==d?void 0:d.icon)?`/ingredients/${d.icon}.png`:"/icons/placeholder.png",u=l===Q.Oven?"bg-orange-100/50":l===Q.ChoppingBoard?"bg-green-100/50":l===Q.Fridge||l===Q.Stock?"bg-blue-100/50":"bg-gray-100/50",m=`flex items-center gap-1 ${l?u:"bg-white/50"} rounded-lg px-1.5 py-1`,g=(null==d?void 0:d.name)||"Unknown",y=null==d?void 0:d.name,f=`${void 0===r?"w-6 h-6":r} object-contain rounded-full bg-white/90 border border-gray-200 shadow-sm`;return n[2]!==c||n[3]!==g||n[4]!==y||n[5]!==f?(i=(0,h.jsx)("img",{src:c,alt:g,title:y,className:f,onError:eX}),n[2]=c,n[3]=g,n[4]=y,n[5]=f,n[6]=i):i=n[6],n[7]!==l?(s=l&&(0,h.jsx)(eq,{type:l,size:14}),n[7]=l,n[8]=s):s=n[8],n[9]!==m||n[10]!==i||n[11]!==s?(o=(0,h.jsxs)("div",{className:m,children:[i,s]}),n[9]=m,n[10]=i,n[11]=s,n[12]=o):o=n[12],o}),eQ=e=>{let{order:t}=e,i=(0,d.useMemo)(()=>eR[t.recipeId],[t.recipeId]),[s,o]=(0,d.useState)(()=>e$(t)),n=(0,d.useMemo)(()=>eW(t.recipeId),[t.recipeId]);if((0,d.useEffect)(()=>{if(o(e$(t)),t.deadline>0&&t.deadline>Date.now()){let e=setInterval(()=>{let i=e$(t);o(i),i.timeLeft<=0&&clearInterval(e)},1e3);return()=>clearInterval(e)}},[t.id,t.deadline,t.createdAt]),!i)return(0,h.jsx)("div",{className:"bg-red-100 border border-red-400 text-red-700 px-2 py-1 rounded text-xs",children:"Error: Recipe not found!"});let a=eh[i.result.ingredient],r=(null==a?void 0:a.icon)?`/ingredients/${a.icon}.png`:"/icons/placeholder.png";return(0,h.jsxs)("div",{className:`bg-gradient-to-br from-purple-300 via-pink-200 to-yellow-100 rounded-lg shadow-md p-2 flex flex-col gap-1 w-full ${s.isUrgent?"border-2 border-red-500":""} ${s.isExpired?"opacity-60":""}`,children:[(0,h.jsx)("div",{className:"flex justify-center",children:(0,h.jsx)("img",{src:r,alt:i.name,className:"w-8 h-8 object-contain rounded-full bg-white/90 border border-gray-200 shadow-sm",onError:e=>e.currentTarget.src="/icons/placeholder.png"})}),(0,h.jsxs)("div",{className:"flex flex-wrap gap-1 justify-center",children:[n.ingredientsToProcess.slice(0,4).map((e,i)=>(0,h.jsx)(eJ,{ingredient:e.ingredient,sizeClass:"w-6 h-6",station:e.station},`${t.id}-proc-${i}`)),n.ingredientsToProcess.length>4&&(0,h.jsxs)("span",{className:"flex items-center justify-center w-6 h-6 rounded-full bg-white/90 border border-gray-200 text-xs text-gray-600",children:["+",n.ingredientsToProcess.length-4]}),0===n.ingredientsToProcess.length&&n.allBaseIngredients.slice(0,4).map((e,i)=>(0,h.jsx)(eJ,{ingredient:e,sizeClass:"w-6 h-6"},`${t.id}-base-${i}`))]}),n.finalAssemblyStation&&n.finalAssemblyIngredients.length>0&&(0,h.jsxs)("div",{className:"flex items-center gap-1 justify-center bg-gray-100/50 rounded-md px-2 py-1",children:[(0,h.jsx)(eq,{type:n.finalAssemblyStation,size:16}),n.finalAssemblyIngredients.slice(0,3).map((e,i)=>(0,h.jsx)(eJ,{ingredient:e,sizeClass:"w-5 h-5"},`${t.id}-final-${i}`))]}),s.totalTime>0&&(0,h.jsx)("div",{className:"w-full h-2 bg-gray-200 rounded-full overflow-hidden",children:(0,h.jsx)("div",{className:`h-full ${s.isUrgent?"bg-red-500":"bg-green-500"} transition-all duration-1000`,style:{width:`${s.timePercentage}%`}})})]})};function eZ(){let e=v(e=>e.orders),t=(0,d.useMemo)(()=>e&&0!==e.length?[...e].sort((e,t)=>{let i=e.deadline>0&&e.deadline<=Date.now(),s=t.deadline>0&&t.deadline<=Date.now();return i&&!s?1:!i&&s?-1:(e.deadline||1/0)-(t.deadline||1/0)||e.createdAt-t.createdAt}):[],[e]);return(0,h.jsxs)("div",{className:"fixed top-4 right-2 z-10 w-52 max-h-[calc(100vh-8rem)] overflow-y-auto p-2.5 bg-black/40 backdrop-blur-sm rounded-lg shadow-lg",children:[(0,h.jsx)("h3",{className:"text-center font-semibold text-white/90 text-sm mb-2",children:"Orders"}),(0,h.jsx)("div",{className:"flex flex-col gap-1.5",children:(0,h.jsx)(eH.M,{children:t.length>0?t.map(e=>(0,h.jsx)(eK.E.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,x:20},transition:{duration:.2},children:(0,h.jsx)(eQ,{order:e})},e.id)):(0,h.jsx)(eK.E.p,{initial:{opacity:0},animate:{opacity:1},className:"text-center text-gray-300/70 text-xs py-2",children:"No orders"})})})]})}function eX(e){return e.currentTarget.src="/icons/placeholder.png"}var eY=i(74927);function e0(){let e,t,i=(0,p.c)(3),s=v(e1)??0;return i[0]===Symbol.for("react.memo_cache_sentinel")?(e=(0,h.jsx)(eY.Z,{strokeWidth:3,className:"inline-block h-5 w-5 mr-2 transition-colors duration-300 ease-in-out text-gradient-to-br from-purple-300 via-pink-200 to-yellow-100"}),i[0]=e):e=i[0],i[1]!==s?(t=(0,h.jsx)("div",{className:"border border-gradient-to-br from-purple-300 via-pink-200 to-yellow-100 rounded-full shadow-lg px-3 py-1 w-fit absolute bottom-3 left-4 z-10 pointer-events-none transition-colors duration-300 ease-in-out bg-gray-800",children:(0,h.jsxs)("div",{className:"flex items-center",children:[e,(0,h.jsx)("span",{className:"text-2xl font-bold transition-colors duration-300 ease-in-out text-gradient-to-br from-purple-300 via-pink-200 to-yellow-100",children:s})]})}),i[1]=s,i[2]=t):t=i[2],t}function e1(e){return e.score}var e2=i(45077);function e5(){let e,t,i,s,o=(0,p.c)(11),n=v(e3)??0,a=n<=1e4,r=Math.max(0,Math.floor(n/6e4)),l=Math.max(0,Math.floor(n%6e4/1e3)),d=`${String(r).padStart(2,"0")}:${String(l).padStart(2,"0")}`,c=`rounded-full shadow-lg px-4 py-1 w-fit absolute top-4 left-1/2 transform -translate-x-1/2 z-10 pointer-events-none transition-colors duration-300 ease-in-out ${a?"bg-gradient-to-br from-red-400 via-orange-300 to-yellow-200":"bg-gradient-to-br from-purple-300 via-pink-200 to-yellow-100"} ${a?"animate-pulse":""}`,u=`inline-block h-5 w-5 mr-2 transition-colors duration-300 ease-in-out ${a?"text-red-700":"text-gray-800"}`;o[0]!==u?(e=(0,h.jsx)(e2.Z,{strokeWidth:4,className:u}),o[0]=u,o[1]=e):e=o[1];let m=`text-2xl font-md transition-colors duration-300 ease-in-out ${a?"text-red-700 font-extrabold":"text-gray-800"}`;return o[2]!==d||o[3]!==m?(t=(0,h.jsx)("span",{className:m,children:d}),o[2]=d,o[3]=m,o[4]=t):t=o[4],o[5]!==e||o[6]!==t?(i=(0,h.jsxs)("div",{className:"flex items-center justify-center",children:[e,t]}),o[5]=e,o[6]=t,o[7]=i):i=o[7],o[8]!==c||o[9]!==i?(s=(0,h.jsx)("div",{className:c,children:i}),o[8]=c,o[9]=i,o[10]=s):s=o[10],s}function e3(e){return e.timeLeft}var e8=i(53219);function e7(e){let t,i,s,o,n,a,r=(0,p.c)(8),{onBackToMenu:l}=e;return r[0]===Symbol.for("react.memo_cache_sentinel")?(t=(0,h.jsx)(e8.Z,{className:"h-6 w-5",strokeWidth:4}),r[0]=t):t=r[0],r[1]!==l?(i=(0,h.jsxs)("button",{onClick:l,className:"absolute top-3 left-3 btn-dream-small pointer-events-auto flex items-center gap-2",children:[t,"Main menu"]}),r[1]=l,r[2]=i):i=r[2],r[3]===Symbol.for("react.memo_cache_sentinel")?(s=(0,h.jsx)(e5,{}),o=(0,h.jsx)(eZ,{}),n=(0,h.jsx)(e0,{}),r[3]=s,r[4]=o,r[5]=n):(s=r[3],o=r[4],n=r[5]),r[6]!==i?(a=(0,h.jsxs)("div",{className:"absolute top-0 left-0 w-full h-full pointer-events-none",children:[i,s,o,n]}),r[6]=i,r[7]=a):a=r[7],a}var e4=i(91652);let e6=["#A78BFA","#FBCFE8","#FDE68A","#FFFFFF"],e9=e=>{let t,i,s,o,n,a,r=(0,p.c)(10),{finalScore:l,onBackToMenu:d}=e;return r[0]===Symbol.for("react.memo_cache_sentinel")?(t=(0,h.jsx)(e4.Z,{recycle:!0,numberOfPieces:200,gravity:.01,initialVelocityX:{min:-7,max:7},initialVelocityY:{min:4,max:8},colors:e6,tweenDuration:7e3,opacity:.9}),r[0]=t):t=r[0],r[1]===Symbol.for("react.memo_cache_sentinel")?(i=(0,h.jsx)("h2",{className:"text-4xl font-bold mb-3 bg-gradient-to-br from-purple-300 via-pink-200 to-yellow-100 bg-clip-text text-transparent",children:"Game Over!"}),s=(0,h.jsx)("p",{className:"text-xl text-base-content opacity-90 mb-6",children:"Your final score is:"}),r[1]=i,r[2]=s):(i=r[1],s=r[2]),r[3]!==l?(o=(0,h.jsx)("p",{className:"text-6xl font-extrabold mb-6",children:l}),r[3]=l,r[4]=o):o=r[4],r[5]!==d?(n=(0,h.jsx)("button",{onClick:d,className:"btn-dream w-full",children:"Back to Main Menu"}),r[5]=d,r[6]=n):n=r[6],r[7]!==o||r[8]!==n?(a=(0,h.jsxs)("div",{className:"absolute inset-0 bg-base-200 bg-opacity-90 flex flex-col items-center justify-center z-20 pointer-events-auto overflow-hidden",children:[t,(0,h.jsxs)("div",{className:"relative z-10 bg-base-100 p-8 rounded-lg shadow-xl text-center max-w-md w-full transform transition-all scale-100 opacity-100",children:[i,s,o,n]})]}),r[7]=o,r[8]=n,r[9]=a):a=r[9],a},te=e=>{let t,i,s=(0,p.c)(9),{onBackToMenu:o,gameEngineRef:n}=e,a=I(),r=S();if(s[0]!==(null==r?void 0:r.message)||s[1]!==a||s[2]!==n||s[3]!==o?(t=()=>{if(a===g.ERROR){var e;console.error("Connection error:",null==r?void 0:r.message),null==(e=n.current)||e.dispose(),o()}else a===g.RECONNECTING&&console.log("Attempting to reconnect to game server...")},s[0]=null==r?void 0:r.message,s[1]=a,s[2]=n,s[3]=o,s[4]=t):t=s[4],s[5]!==r||s[6]!==a?(i=[a,r],s[5]=r,s[6]=a,s[7]=i):i=s[7],(0,d.useEffect)(t,i),a===g.RECONNECTING){let e;return s[8]===Symbol.for("react.memo_cache_sentinel")?(e=(0,h.jsx)("div",{className:"absolute top-4 right-4 bg-warning text-white px-4 py-2 rounded-md shadow-lg",children:"Reconnecting to server..."}),s[8]=e):e=s[8],e}return null},tt=e=>{let t,i,s,o,n,a,r,l,c=(0,p.c)(21),{onBackToMenu:u}=e,m=b(),g=(0,d.useRef)(void 0),[y,f]=(0,d.useState)(!1),[x,P]=(0,d.useState)(!1),[v,I]=(0,d.useState)(null);c[0]===Symbol.for("react.memo_cache_sentinel")?(t=e=>{I(e),P(!0)},c[0]=t):t=c[0];let S=t;c[1]!==m?(i=async e=>{m&&(g.current=new eF(e,m,S),e.getEngine().onEndFrameObservable.add(()=>{f(!0)}),await g.current.init())},c[1]=m,c[2]=i):i=c[2];let M=i;c[3]!==x?(s=e=>{if(!x){var t;let i=e.getEngine().getDeltaTime();null==(t=g.current)||t.update(i)}},c[3]=x,c[4]=s):s=c[4];let _=s;c[5]===Symbol.for("react.memo_cache_sentinel")?(o=()=>{var e;null==(e=g.current)||e.dispose(),g.current=void 0},c[5]=o):o=c[5];let w=o;return c[6]!==x||c[7]!==_||c[8]!==M?(n=!x&&(0,h.jsx)(q,{antialias:!0,onDispose:w,onSceneReady:M,onRender:_,id:"my-canvas",className:"w-full h-full"}),c[6]=x,c[7]=_,c[8]=M,c[9]=n):n=c[9],c[10]!==u?(a=(0,h.jsx)(te,{onBackToMenu:u,gameEngineRef:g}),c[10]=u,c[11]=a):a=c[11],c[12]!==v||c[13]!==x||c[14]!==y||c[15]!==u?(r=y&&(x?(0,h.jsx)(e9,{finalScore:v??0,onBackToMenu:u}):(0,h.jsx)(e7,{onBackToMenu:u})),c[12]=v,c[13]=x,c[14]=y,c[15]=u,c[16]=r):r=c[16],c[17]!==n||c[18]!==a||c[19]!==r?(l=(0,h.jsxs)("div",{className:"relative w-full h-full",children:[n,a,r]}),c[17]=n,c[18]=a,c[19]=r,c[20]=l):l=c[20],l},ti=(0,i(777).U)(e=>({mode:"menu",roomToJoin:void 0,setMode:t=>e({mode:t}),setRoomToJoin:t=>e({roomToJoin:t})}));i(99518);let ts=()=>{let e,t,i,s,o,n,a=(0,p.c)(16),r=w(),l=ti(to),d=ti(tn);return a[0]!==l?(e=(0,h.jsx)("button",{className:"btn-dream-small",onClick:()=>{l("menu")},children:"Back to menu"}),a[0]=l,a[1]=e):e=a[1],a[2]!==l||a[3]!==d?(t=(0,h.jsx)("button",{className:"btn-dream-small",onClick:()=>{d({roomName:"game",forceCreate:!0}),l("game")},children:"Create Room"}),a[2]=l,a[3]=d,a[4]=t):t=a[4],a[5]!==e||a[6]!==t?(i=(0,h.jsxs)("div",{className:"flex items-center justify-between w-full max-w-md mb-4",children:[e,t]}),a[5]=e,a[6]=t,a[7]=i):i=a[7],a[8]===Symbol.for("react.memo_cache_sentinel")?(s=(0,h.jsx)("h1",{className:"text-3xl font-bold mb-2 bg-gradient-to-br from-purple-300 via-pink-200 to-yellow-100 bg-clip-text text-transparent",children:"Available Rooms"}),a[8]=s):s=a[8],a[9]!==r||a[10]!==l||a[11]!==d?(o=(0,h.jsxs)("div",{className:"w-full max-w-md",children:[s,r.length>0?(0,h.jsx)("ul",{className:"space-y-2",children:r.map(e=>(0,h.jsxs)("li",{className:"flex justify-between items-center p-4 bg-base-100 rounded-lg shadow",children:[(0,h.jsxs)("span",{className:"text-lg",children:[e.name," ",e.roomId]}),(0,h.jsxs)("span",{className:"text-sm text-gray-500",children:[e.clients," / ",e.maxClients]}),(0,h.jsx)("button",{className:"btn-dream-small","aria-label":`Join room ${e.name}`,onClick:()=>{d({roomId:e.roomId}),l("game")},disabled:e.clients>=e.maxClients,children:"Join"})]},e.roomId))}):(0,h.jsx)("p",{children:"No rooms available. Create a new room to start."})]}),a[9]=r,a[10]=l,a[11]=d,a[12]=o):o=a[12],a[13]!==i||a[14]!==o?(n=(0,h.jsxs)("div",{className:"flex flex-col items-center justify-center flex-1 bg-base-200 bg-opacity-90 p-4",children:[i,o]}),a[13]=i,a[14]=o,a[15]=n):n=a[15],n};function to(e){return e.setMode}function tn(e){return e.setRoomToJoin}var ta=i(37857);function tr(e){return e.mode}function tl(e){return e.setMode}function th(e){return e.roomToJoin}function td(e){return e.setRoomToJoin}function tc(){P().catch(console.error)}async function tp(){await M({roomName:"lobby",isLobby:!0})}function tu(){_().catch(console.error)}function tm(){window.open("https://github.com/TriForMine/delixia","_blank")}(0,c.createRoot)(document.getElementById("root")).render((0,h.jsx)(d.StrictMode,{children:(0,h.jsx)(()=>{let e,t,i,s,o,n,a,r,l,c,u=(0,p.c)(29),m=ti(tr),g=ti(tl),y=ti(th),f=ti(td);u[0]===Symbol.for("react.memo_cache_sentinel")?(e={format:"mp3",autoplay:!0,loop:!0,initialVolume:.05},u[0]=e):e=u[0],(0,ta.xm)("/assets/music/theme.mp3",e),u[1]!==m||u[2]!==(null==y?void 0:y.forceCreate)||u[3]!==(null==y?void 0:y.roomId)||u[4]!==(null==y?void 0:y.roomName)?(t=()=>"game"===m?((async()=>{await x({roomName:null==y?void 0:y.roomName,roomId:null==y?void 0:y.roomId,forceCreate:null==y?void 0:y.forceCreate})})(),tc):"roomList"===m?(tp(),tu):void 0,u[1]=m,u[2]=null==y?void 0:y.forceCreate,u[3]=null==y?void 0:y.roomId,u[4]=null==y?void 0:y.roomName,u[5]=t):t=u[5],u[6]!==m||u[7]!==y?(i=[m,y],u[6]=m,u[7]=y,u[8]=i):i=u[8],(0,d.useEffect)(t,i),u[9]!==g||u[10]!==f?(s=()=>{f({roomName:"game"}),g("game")},u[9]=g,u[10]=f,u[11]=s):s=u[11];let P=s;u[12]!==g?(o=()=>{g("menu")},u[12]=g,u[13]=o):o=u[13];let b=o;u[14]!==g?(n=()=>{g("roomList")},u[14]=g,u[15]=n):n=u[15];let v=n;return u[16]!==P||u[17]!==v||u[18]!==m?(a="menu"===m&&(0,h.jsxs)("div",{className:"flex flex-col items-center justify-center flex-1",children:[(0,h.jsx)("h1",{className:"text-6xl font-bold mb-2 bg-gradient-to-br from-purple-300 via-pink-200 to-yellow-100 bg-clip-text text-transparent",children:"Delixia"}),(0,h.jsx)("p",{className:"text-xl mb-8 text-base-content opacity-80",children:"A cooking game with a twist!"}),(0,h.jsxs)("div",{className:"flex flex-col gap-4 w-64",children:[(0,h.jsx)("button",{onClick:P,className:"btn-dream",children:"Quick Play"}),(0,h.jsx)("button",{onClick:v,className:"btn-dream",children:"Join Room"}),(0,h.jsx)("button",{onClick:tm,className:"btn-dream",children:"GitHub"})]}),(0,h.jsxs)("div",{className:"fixed bottom-4 text-sm opacity-70 text-white",children:["Version ","0.0.0"]})]}),u[16]=P,u[17]=v,u[18]=m,u[19]=a):a=u[19],u[20]!==b||u[21]!==m?(r="game"===m&&(0,h.jsx)("div",{className:"flex flex-1 h-full",children:(0,h.jsx)("div",{className:"flex-1 bg-base-100",children:(0,h.jsx)(tt,{onBackToMenu:b})})}),u[20]=b,u[21]=m,u[22]=r):r=u[22],u[23]!==m?(l="roomList"===m&&(0,h.jsx)(ts,{}),u[23]=m,u[24]=l):l=u[24],u[25]!==a||u[26]!==r||u[27]!==l?(c=(0,h.jsxs)("div",{className:"min-h-screen h-screen flex flex-col bg-base-200 overflow-hidden",children:[a,r,l]}),u[25]=a,u[26]=r,u[27]=l,u[28]=c):c=u[28],c},{})}))},19505:function(){},1078:function(){}},t={};function i(s){var o=t[s];if(void 0!==o)return o.exports;var n=t[s]={exports:{}};return e[s].call(n.exports,n,n.exports,i),n.exports}i.m=e,i.d=(e,t)=>{for(var s in t)i.o(t,s)&&!i.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},i.g=(()=>{if("object"==typeof globalThis)return globalThis;try{return this||Function("return this")()}catch(e){if("object"==typeof window)return window}})(),i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),i.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e=[];i.O=(t,s,o,n)=>{if(s){n=n||0;for(var a=e.length;a>0&&e[a-1][2]>n;a--)e[a]=e[a-1];e[a]=[s,o,n];return}for(var r=1/0,a=0;a<e.length;a++){for(var[s,o,n]=e[a],l=!0,h=0;h<s.length;h++)(!1&n||r>=n)&&Object.keys(i.O).every(e=>i.O[e](s[h]))?s.splice(h--,1):(l=!1,n<r&&(r=n));if(l){e.splice(a--,1);var d=o();void 0!==d&&(t=d)}}return t}})(),i.p="/Delixia/",i.rv=()=>"1.3.5",(()=>{i.b=document.baseURI||self.location.href;var e={980:0};i.O.j=t=>0===e[t];var t=(t,s)=>{var o,n,[a,r,l]=s,h=0;if(a.some(t=>0!==e[t])){for(o in r)i.o(r,o)&&(i.m[o]=r[o]);if(l)var d=l(i)}for(t&&t(s);h<a.length;h++)n=a[h],i.o(e,n)&&e[n]&&e[n][0](),e[n]=0;return i.O(d)},s=self.webpackChunkdelixia=self.webpackChunkdelixia||[];s.forEach(t.bind(null,0)),s.push=t.bind(null,s.push.bind(s))})(),i.ruid="bundler=rspack@1.3.5";var s=i.O(void 0,["361","732"],function(){return i(49454)});s=i.O(s)})();