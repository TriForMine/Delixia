(()=>{"use strict";var e={1934:function(e,t,i){var s,a,n,o,r,l,c,d=i(85893),h=i(67294),m=i(20745),p=i(68827),u=i(61588);let g=[1e3,1001,1005,1006];var y=((s={}).DISCONNECTED="disconnected",s.CONNECTING="connecting",s.CONNECTED="connected",s.RECONNECTING="reconnecting",s.ERROR="error",s);function f(e){let t=e,i=new Set;return{get:()=>t,set:e=>{t=e,i.forEach(t=>t(e))},subscribe:e=>(i.add(e),()=>i.delete(e))}}let x=(e,t)=>{let i,s=new u.Client(e),a=f(void 0),n=f(void 0),o=f([]),r=f("disconnected"),l=f(null),c=!1,d=0,m=null,p=(e,t)=>{if(a.set(void 0),a.set(e),i=e.reconnectionToken,r.set("connected"),d=0,e.onError((e,t)=>{console.error(`Room error: ${e} - ${t}`),l.set({code:e,message:t}),g.includes(e)&&d<5?x():r.set("error")}),e.onLeave(e=>{a.set(void 0),g.includes(e)&&d<5?x():(n.set(void 0),o.set([]),r.set("disconnected"),i=void 0,m=null)}),t)e.onMessage("rooms",e=>{o.set(e)}),e.onMessage("+",e=>{let[t,i]=e,s=o.get(),a=s.findIndex(e=>e.roomId===t);if(-1!==a){let e=[...s];e[a]={...e[a],...i},o.set(e)}else o.set([...s,i])}),e.onMessage("-",e=>{o.set(o.get().filter(t=>t.roomId!==e))});else{n.set(e.state);let t={};e.onStateChange.once(i=>{let s=(0,u.getStateCallbacks)(e);for(let e of Object.keys(i)){let a=s(i)[e];"object"==typeof i[e]&&(t[e]=!1,a.onAdd(i=>{t[e]=!0,s(i).onChange(()=>{t[e]=!0})}),a.onRemove(()=>{t[e]=!0}))}n.set(i)}),e.onStateChange(e=>{if(!e)return;let i={...e};for(let[s,a]of Object.entries(t)){if(!a)continue;t[s]=!1;let n=e[s];n.clone&&(i[s]=n.clone())}n.set(i)})}},y=async e=>{let{roomName:i,roomId:n,forceCreate:o=!1,isLobby:d=!1,options:h={}}=e;if(c||a.get())return;let u=h||{};m={roomName:i,roomId:n,forceCreate:o,isLobby:d,options:u},r.set("connecting"),l.set(null),c=!0;try{let e;if(i)e=o?await s.create(i,u):await s.joinOrCreate(i,u);else if(n)e=await s.joinById(n,u,t);else throw Error("Must provide either roomName or roomId");p(e,d)}catch(e){console.error("Failed to connect to Colyseus!",e),l.set({message:e instanceof Error?e.message:"Unknown connection error"}),r.set("error")}finally{c=!1}},x=async()=>{if(d>=5){console.error("Max reconnection attempts reached"),r.set("error");return}if(d++,r.set("reconnecting"),i&&1)try{let e=await s.reconnect(i);p(e,(null==m?void 0:m.isLobby)||!1)}catch(e){setTimeout(x,1e3*Math.pow(1.5,d))}else m?(c=!1,y(m)):r.set("error")};return{client:s,connect:y,disconnectFromColyseus:async()=>{d=0,m=null,i=void 0;let e=a.get();if(e){a.set(void 0),n.set(void 0),o.set([]),r.set("disconnected");try{await e.leave(!0)}catch(e){console.error("Error during disconnection:",e)}}},useColyseusRoom:()=>(0,h.useSyncExternalStore)(e=>a.subscribe(e),()=>a.get()),useColyseusState:function(e){return(0,h.useSyncExternalStore)(e=>n.subscribe(e),()=>{let t=n.get();return t&&e?e(t):t})},useLobbyRooms:()=>(0,h.useSyncExternalStore)(e=>o.subscribe(e),()=>o.get()),useConnectionStatus:()=>(0,h.useSyncExternalStore)(e=>r.subscribe(e),()=>r.get()),useConnectionError:()=>(0,h.useSyncExternalStore)(e=>l.subscribe(e),()=>l.get())}},{connect:b,disconnectFromColyseus:P,useColyseusRoom:v,useColyseusState:S,useConnectionStatus:_,useConnectionError:w}=x((void 0)??"ws://localhost:2567"),{connect:M,disconnectFromColyseus:I,useLobbyRooms:N,useConnectionStatus:T,useConnectionError:k}=x((void 0)??"ws://localhost:2567");var E=i(27412),C=i(39621),z=i(87165),j=i(9263),A=i(83927),D=i(86564),O=i(36631),L=i(92962),F=i(58098),R=i(81823),B=i(78302),U=i(88251),V=i(36310),G=i(47117),$=i(3248),H=i(82915);i(7549);var K=i(99044),W=i(47059);class q{createLoadingUI(){var e;this.loadingDiv=document.createElement("div"),this.loadingDiv.className=`
      fixed inset-0
      flex flex-col
      bg-base-200 bg-opacity-90
      transition-opacity duration-500
      opacity-0
      z-50
      pointer-events-none
    `,this.loadingDiv.innerHTML=`
  <!-- Center container -->
  <div class="flex flex-col items-center justify-center h-full max-w-2xl mx-auto px-6">
    <!-- Game Title with gradient applied to text -->
    <div class="text-center mb-12">
      <h1 class="text-5xl md:text-6xl font-bold mb-2 tracking-wider animate-pulse bg-gradient-to-br from-purple-300 via-pink-200 to-yellow-100 bg-clip-text text-transparent">
        Delixia
      </h1>
      <div class="h-1 w-24 mx-auto bg-gradient-to-r from-purple-300 via-pink-200 to-yellow-100 rounded-full"></div>
    </div>

    <!-- Loading text (you can also apply a gradient here if needed) -->
    <div class="w-full text-center mb-8">
      <p id="loading-text" class="text-xl md:text-2xl font-medium text-base-content opacity-80 tracking-wide">
        Loading...
      </p>
    </div>

    <!-- Progress bar and indicator -->
    <div class="w-full">
      <div class="relative">
        <div class="absolute inset-0 bg-primary/20 rounded-full blur-md transform scale-105"></div>
        <div class="relative bg-base-100/80 rounded-full h-3 backdrop-blur-sm">
          <div
  id="progress-bar-fill"
  class="h-full bg-gradient-to-r from-purple-300 via-pink-200 to-yellow-100 rounded-full transition-all duration-300 shadow-lg shadow-yellow-200/50"
  style="width: 0%;"
></div>

        </div>
      </div>
      <div class="flex justify-center gap-2 mt-4">
  <div class="w-2 h-2 bg-gradient-to-r from-purple-300 via-pink-200 to-yellow-100 rounded-full animate-bounce" style="animation-delay: 0s"></div>
  <div class="w-2 h-2 bg-gradient-to-r from-purple-300 via-pink-200 to-yellow-100 rounded-full animate-bounce" style="animation-delay: 0.2s"></div>
  <div class="w-2 h-2 bg-gradient-to-r from-purple-300 via-pink-200 to-yellow-100 rounded-full animate-bounce" style="animation-delay: 0.4s"></div>
</div>

    </div>
  </div>
`,null==(e=this.canvas.parentElement)||e.appendChild(this.loadingDiv),this.progressBar=this.loadingDiv.querySelector("#progress-bar-fill")??void 0,this.loadingTextElement=this.loadingDiv.querySelector("#loading-text")??void 0}displayLoadingUI(){this.loadingDiv&&(this.loadingTextElement&&(this.loadingTextElement.innerText=this.loadingUIText||"Loading..."),this.loadingDiv.style.opacity="1")}hideLoadingUI(){this.loadingDiv&&(this.loadingDiv.style.opacity="0")}updateProgress(e){this.progressBar&&(this.progressBar.style.width=`${e.toFixed(0)}%`),this.loadingTextElement&&(this.loadingTextElement.innerText=this.loadingUIText)}constructor(e){(0,E._)(this,"loadingUIText",""),(0,E._)(this,"loadingUIBackgroundColor","rgba(0, 0, 0, 0.8)"),(0,E._)(this,"loadingDiv",void 0),(0,E._)(this,"progressBar",void 0),(0,E._)(this,"loadingTextElement",void 0),this.canvas=e,this.createLoadingUI()}}let Z=e=>{let t,i,s,a,n,o,r,l,c,m,u,g,y,f=(0,p.c)(27);f[0]!==e?({antialias:i,engineOptions:s,adaptToDeviceRatio:t,sceneOptions:l,onRender:n,onSceneReady:o,onDispose:a,...r}=e,f[0]=e,f[1]=t,f[2]=i,f[3]=s,f[4]=a,f[5]=n,f[6]=o,f[7]=r,f[8]=l):(t=f[1],i=f[2],s=f[3],a=f[4],n=f[5],o=f[6],r=f[7],l=f[8]);let x=(0,h.useRef)(null),b=(0,h.useRef)(null),P=(0,h.useRef)(!1),[v,S]=h.useState(!1);return f[9]!==t||f[10]!==i||f[11]!==s||f[12]!==v||f[13]!==a?(c=()=>{let{current:e}=x;if(e&&!v)return(async()=>{let a;if(!b.current&&!P.current){if(P.current=!0,await W.f.IsSupportedAsync){let t=new W.f(e,s);await t.initAsync(),(a=t).compatibilityMode=!1}else a=new K.D(e,i,s,t);a.loadingScreen=new q(e),b.current=a,P.current=!1,S(!0),a.displayLoadingUI()}})().catch(console.error),()=>{S(!1),null==a||a(),b.current&&(b.current.dispose(),b.current=null)}},f[9]=t,f[10]=i,f[11]=s,f[12]=v,f[13]=a,f[14]=c):c=f[14],f[15]!==t||f[16]!==i||f[17]!==s?(m=[i,s,t],f[15]=t,f[16]=i,f[17]=s,f[18]=m):m=f[18],(0,h.useEffect)(c,m),f[19]!==v||f[20]!==n||f[21]!==o||f[22]!==l?(u=()=>{let e;if(v)return(async()=>{let t=b.current;e=new $.x(t,l);let i=async()=>{null==e||e.onBeforeRenderObservable.add(()=>{e&&(null==n||n(e))}),t.runRenderLoop(()=>{e&&e.activeCamera&&e.render()})};e.isReady()?(await o(e),await i()):e.onReadyObservable.addOnce(async e=>{await o(e),await i()});let s=()=>{t.resize(!0)};return window&&window.addEventListener("resize",s),()=>{null==e||e.getEngine().dispose(),window&&window.removeEventListener("resize",s)}})().catch(console.error),()=>{e&&e.dispose()}},g=[v,n,o,l],f[19]=v,f[20]=n,f[21]=o,f[22]=l,f[23]=u,f[24]=g):(u=f[23],g=f[24]),(0,h.useEffect)(u,g),f[25]!==r?(y=(0,d.jsx)("canvas",{ref:x,...r,tabIndex:0}),f[25]=r,f[26]=y):y=f[26],y};var Y=i(92538),Q=i(32963),J=i(91783),X=i(9197),ee=((a={})[a.Fridge=0]="Fridge",a[a.Oven=1]="Oven",a[a.Counter=2]="Counter",a[a.ChoppingBoard=3]="ChoppingBoard",a[a.Sink=4]="Sink",a[a.Stock=5]="Stock",a[a.Ingredient=6]="Ingredient",a[a.Trash=7]="Trash",a[a.ServingOrder=8]="ServingOrder",a[a.ServingBoard=9]="ServingBoard",a),et=((n={})[n.None=0]="None",n[n.Nori=1]="Nori",n[n.Rice=2]="Rice",n[n.Onigiri=3]="Onigiri",n[n.Plate=4]="Plate",n[n.CookedRice=5]="CookedRice",n[n.Ebi=6]="Ebi",n[n.Salmon=7]="Salmon",n[n.SalmonNigiri=8]="SalmonNigiri",n[n.EbiNigiri=9]="EbiNigiri",n[n.SeaUrchin=10]="SeaUrchin",n[n.SeaUrchinOpen=11]="SeaUrchinOpen",n[n.SeaUrchinRoll=12]="SeaUrchinRoll",n),ei=((o={})[o.WAITING=0]="WAITING",o[o.PLAYING=1]="PLAYING",o[o.FINISHED=2]="FINISHED",o);let es={[et.Plate]:{scale:{x:.6,y:.6,z:.6}},[et.Rice]:{scale:{x:.4,y:.4,z:.4},onBoard:{positionOffset:{x:0,y:-.1,z:0}}},[et.CookedRice]:{scale:{x:.4,y:.4,z:.4},onBoard:{positionOffset:{x:0,y:-.1,z:0}}},[et.Nori]:{scale:{x:.4,y:.4,z:.4},onBoard:{positionOffset:{x:0,y:-.05,z:0}}},[et.Ebi]:{onBoard:{positionOffset:{x:0,y:-.05,z:0}}},[et.EbiNigiri]:{scale:{x:.6,y:.6,z:.6}},[et.Salmon]:{onBoard:{positionOffset:{x:.23,y:-.1,z:0}}},[et.SalmonNigiri]:{scale:{x:.6,y:.6,z:.6}},[et.SeaUrchinRoll]:{scale:{x:.4,y:.4,z:.4},onBoard:{positionOffset:{x:0,y:-.1,z:0}}},[et.Onigiri]:{scale:{x:.5,y:.5,z:.5},onBoard:{positionOffset:{x:0,y:-.1,z:0}}}},ea={[et.None]:{id:et.None,name:"None",icon:"",model:""},[et.Nori]:{id:et.Nori,name:"Nori",icon:"nori",model:"Nori.glb"},[et.Rice]:{id:et.Rice,name:"Rice",icon:"rice",model:"Rice Ball.glb"},[et.CookedRice]:{id:et.CookedRice,name:"Cooked Rice",icon:"rice",model:"Rice Ball.glb",isResult:!0},[et.Onigiri]:{id:et.Onigiri,name:"Onigiri",icon:"onigiri",model:"Onigiri.glb",isResult:!0,isFinal:!0},[et.Plate]:{id:et.Plate,name:"Plate",icon:"plate",model:"Plate.glb",isPlate:!0},[et.Ebi]:{id:et.Ebi,name:"Ebi",icon:"ebi",model:"Ebi.glb"},[et.Salmon]:{id:et.Salmon,name:"Salmon",icon:"salmon",model:"Salmon.glb"},[et.SalmonNigiri]:{id:et.SalmonNigiri,name:"Salmon Nigiri",icon:"salmon_nigiri",model:"Salmon Nigiri.glb",isResult:!0,isFinal:!0},[et.EbiNigiri]:{id:et.EbiNigiri,name:"Ebi Nigiri",icon:"ebi_nigiri",model:"Ebi Nigiri.glb",isResult:!0,isFinal:!0},[et.SeaUrchin]:{id:et.SeaUrchin,name:"Sea Urchin",icon:"sea_urchin",model:"Sea Urchin.glb"},[et.SeaUrchinOpen]:{id:et.SeaUrchinOpen,name:"Sea Urchin Open",icon:"sea_urchin_open",model:"Sea Urchin Open.glb",isResult:!0},[et.SeaUrchinRoll]:{id:et.SeaUrchinRoll,name:"Sea Urchin Roll",icon:"sea_urchin_roll",model:"Sea Urchin Roll.glb",isResult:!0,isFinal:!0}};var en=i(38691),eo=((r={}).Escape="Escape",r.Digit1="Digit1",r.Digit2="Digit2",r.Digit3="Digit3",r.Digit4="Digit4",r.Digit5="Digit5",r.Digit6="Digit6",r.Digit7="Digit7",r.Digit8="Digit8",r.Digit9="Digit9",r.Digit0="Digit0",r.Minus="Minus",r.Equal="Equal",r.Backspace="Backspace",r.Tab="Tab",r.KeyQ="KeyQ",r.KeyW="KeyW",r.KeyE="KeyE",r.KeyR="KeyR",r.KeyT="KeyT",r.KeyY="KeyY",r.KeyU="KeyU",r.KeyI="KeyI",r.KeyO="KeyO",r.KeyP="KeyP",r.BracketLeft="BracketLeft",r.BracketRight="BracketRight",r.Enter="Enter",r.ControlLeft="ControlLeft",r.KeyA="KeyA",r.KeyS="KeyS",r.KeyD="KeyD",r.KeyF="KeyF",r.KeyG="KeyG",r.KeyH="KeyH",r.KeyJ="KeyJ",r.KeyK="KeyK",r.KeyL="KeyL",r.Semicolon="Semicolon",r.Quote="Quote",r.Backquote="Backquote",r.ShiftLeft="ShiftLeft",r.Backslash="Backslash",r.KeyZ="KeyZ",r.KeyX="KeyX",r.KeyC="KeyC",r.KeyV="KeyV",r.KeyB="KeyB",r.KeyN="KeyN",r.KeyM="KeyM",r.Comma="Comma",r.Period="Period",r.Slash="Slash",r.ShiftRight="ShiftRight",r.NumpadMultiply="NumpadMultiply",r.AltLeft="AltLeft",r.Space="Space",r.CapsLock="CapsLock",r.F1="F1",r.F2="F2",r.F3="F3",r.F4="F4",r.F5="F5",r.F6="F6",r.F7="F7",r.F8="F8",r.F9="F9",r.F10="F10",r.Numpad7="Numpad7",r.Numpad8="Numpad8",r.Numpad9="Numpad9",r.NumpadSubtract="NumpadSubtract",r.Numpad4="Numpad4",r.Numpad5="Numpad5",r.Numpad6="Numpad6",r.NumpadAdd="NumpadAdd",r.Numpad1="Numpad1",r.Numpad2="Numpad2",r.Numpad3="Numpad3",r.Numpad0="Numpad0",r.NumpadDecimal="NumpadDecimal",r.IntlBackslash="IntlBackslash",r.F11="F11",r.F12="F12",r.NumpadEqual="NumpadEqual",r.F13="F13",r.F14="F14",r.F15="F15",r.F16="F16",r.F17="F17",r.F18="F18",r.F19="F19",r.F20="F20",r.Lang2="Lang2",r.Lang1="Lang1",r.IntlRo="IntlRo",r.IntlYen="IntlYen",r.NumpadComma="NumpadComma",r.NumpadEnter="NumpadEnter",r.ControlRight="ControlRight",r.NumpadDivide="NumpadDivide",r.AltRight="AltRight",r.NumLock="NumLock",r.Home="Home",r.ArrowUp="ArrowUp",r.PageUp="PageUp",r.ArrowLeft="ArrowLeft",r.ArrowRight="ArrowRight",r.End="End",r.ArrowDown="ArrowDown",r.PageDown="PageDown",r.Delete="Delete",r.MetaLeft="MetaLeft",r.MetaRight="MetaRight",r.ContextMenu="ContextMenu",r);class er{updateKeyPromptVisuals(e){let t=function(e){if(!e)return"?";if(e.startsWith("Key"))return e.substring(3);if(e.startsWith("Digit"))return e.substring(5);if(e.startsWith("Numpad")){let t=e.substring(6);switch(t){case"Decimal":return"NUM .";case"Divide":return"NUM /";case"Multiply":return"NUM *";case"Subtract":return"NUM -";case"Add":return"NUM +";case"Enter":return"NUM ↵";default:return`NUM ${t}`}}switch(e){case"Space":return"SPACE";case"ArrowUp":return"↑";case"ArrowDown":return"↓";case"ArrowLeft":return"←";case"ArrowRight":return"→";case"Backquote":return"`";case"Minus":return"-";case"Equal":return"=";case"BracketLeft":return"[";case"BracketRight":return"]";case"Backslash":return"\\";case"Semicolon":return";";case"Quote":return"'";case"Comma":return",";case"Period":return".";case"Slash":return"/";case"Enter":return"↵";case"Escape":return"ESC";case"Tab":return"TAB";case"CapsLock":return"CAPS";case"ShiftLeft":case"ShiftRight":return"SHIFT";case"ControlLeft":case"ControlRight":return"CTRL";case"AltLeft":case"AltRight":return"ALT";case"MetaLeft":case"MetaRight":return"WIN";case"ContextMenu":return"MENU";case"Delete":return"DEL";case"Home":return"HOME";case"End":return"END";case"PageUp":return"PG UP";case"PageDown":return"PG DN";default:return e.length>7?e.substring(0,5)+"…":e}}(e);t===this.currentDisplayKey&&this.promptDisc.material||(this._setupPromptMaterial(t),this.currentDisplayKey=t)}showDirtyPlateVisual(e){if(e&&!this.dirtyPlateMesh){if(this.ingredientLoader&&(this.dirtyPlateMesh=this.ingredientLoader.getIngredientMesh(et.Plate),this.dirtyPlateMesh)){this.dirtyPlateMesh.setParent(this.mesh);let e=this.mesh.rotation.y,t=new F.P(0,.15,-.1);.01>Math.abs(e)?t=new F.P(0,2,-4):.01>Math.abs(e-Math.PI/2)?t=new F.P(-4,2,0):.01>Math.abs(e-Math.PI)?t=new F.P(0,2,4):(.01>Math.abs(e- -Math.PI/2)||.01>Math.abs(e-3*Math.PI/2))&&(t=new F.P(4,2,0)),this.dirtyPlateMesh.position=t,this.dirtyPlateMesh.scaling=new F.P(.5/this.mesh.scaling.x,-.5/this.mesh.scaling.y,.5/this.mesh.scaling.z),this.dirtyPlateMesh.isPickable=!1,this.dirtyPlateMesh.isVisible=!0,this.dirtyPlateMesh.getChildMeshes().forEach(e=>{e.isPickable=!1,e.isVisible=!0}),this._createSmokeEffect(this.dirtyPlateMesh)}}else!e&&this.dirtyPlateMesh&&(this.dirtyPlateSmokeSystem&&(this.dirtyPlateSmokeSystem.stop(),this.dirtyPlateSmokeSystem=null),this.dirtyPlateMesh&&(this.dirtyPlateMesh.dispose(),this.dirtyPlateMesh=null))}_createSmokeEffect(e){if(this.dirtyPlateSmokeSystem)return;let t=new Q.p(`dirtySmoke_${this.id}`,50,this.scene);if(!er.smokeParticleTexture)return void console.warn("Smoke texture not loaded, smoke effect will not display correctly.");t.particleTexture=er.smokeParticleTexture,t.emitter=e,t.minEmitBox=new F.P(-.1,.05,-.1),t.maxEmitBox=new F.P(.1,.1,.1),t.color1=new L.HE(.4,.6,.4,.15),t.color2=new L.HE(.5,.65,.3,.1),t.colorDead=new L.HE(.1,.2,.1,0),t.minSize=.1,t.maxSize=.4,t.minLifeTime=1.5,t.maxLifeTime=3,t.emitRate=10,t.gravity=new F.P(0,.15,0),t.direction1=new F.P(-.05,.3,-.05),t.direction2=new F.P(.05,.6,.05),t.minEmitPower=.01,t.maxEmitPower=.05,t.updateSpeed=.015,t.blendMode=Q.p.BLENDMODE_STANDARD,t.disposeOnStop=!0,t.start(),this.dirtyPlateSmokeSystem=t}_setupHorizontalProgressBar(){this.progressBarPlane=Y.VO7.CreatePlane(`${this.mesh.name}_progressBarPlane`,{width:this.progressBarPlaneWidth,height:this.progressBarPlaneHeight},this.scene),this.progressBarPlane.setAbsolutePosition(this.mesh.getAbsolutePosition().add(this.billboardOffset)),this.progressBarPlane.billboardMode=Y.Kj0.BILLBOARDMODE_ALL,this.progressBarPlane.renderingGroupId=1,this.progressBarPlane.isPickable=!1,this.progressBarPlane.setEnabled(!1),this.progressBarTexture=new J.c(`${this.mesh.name}_progressBarTexture`,{width:this.progressBarTextureWidth,height:this.progressBarTextureHeight},this.scene,!1,D.x.BILINEAR_SAMPLINGMODE),this.progressBarTexture.hasAlpha=!0,this.progressBarMaterial=new O.K(`${this.mesh.name}_progressBarMat`,this.scene),this.progressBarMaterial.diffuseTexture=this.progressBarTexture,this.progressBarMaterial.opacityTexture=this.progressBarTexture,this.progressBarMaterial.useAlphaFromDiffuseTexture=!1,this.progressBarMaterial.emissiveColor=L.Wo.White(),this.progressBarMaterial.disableLighting=!0,this.progressBarMaterial.backFaceCulling=!1,this.progressBarPlane.material=this.progressBarMaterial}_updateHorizontalProgressBar(){if(!this.isProcessing||!this.progressBarTexture||!this.progressBarPlane||!this.progressBarPlane.isEnabled)return;let e=this.totalProcessingDuration>0?en.Rus.Clamp(1-this.processingTimeLeft/this.totalProcessingDuration,0,1):0,t=this.progressBarTexture.getContext();if(!t)return void console.error(`[${this.id}] ERROR: Failed to get context from progressBarTexture!`);let i=this.progressBarTextureWidth,s=this.progressBarTextureHeight,a=i-8,n=s-8,o=a*e;if(t.clearRect(0,0,i,s),t.fillStyle="rgba(30, 30, 30, 0.8)",t.fillRect(4,4,a,n),o>0){let i="#86EFAC";e>=.8?i="#F87171":e>=1&&(i="#808080"),t.fillStyle=i,t.fillRect(4,4,o,n)}t.strokeStyle="rgba(200, 200, 200, 0.9)",t.lineWidth=2,t.strokeRect(4,4,a,n),this.progressBarTexture.update()}_setupPromptMaterial(e){let t,i=`prompt_${e}`;if(er.promptTextures.has(i))t=er.promptTextures.get(i);else{let s=(t=new J.c(i,{width:64,height:64},this.scene,!1)).getContext();s.fillStyle=L.HE.FromHexString("#00000099").toHexString(),s.beginPath(),s.arc(32,32,30,0,2*Math.PI),s.fill(),s.fillStyle="#FF9999";let a=e.length>3?20:e.length>1?24:30;s.font=`bold ${a}px "Patrick Hand"`,s.textAlign="center",s.textBaseline="middle",s.fillText(e.toUpperCase(),32,34),t.update(!0),er.promptTextures.set(i,t)}let s=new O.K(`promptMat_${e}_${this.id}`,this.scene);s.diffuseTexture=t,s.opacityTexture=t,s.useAlphaFromDiffuseTexture=!1,s.emissiveColor=L.Wo.White(),s.disableLighting=!0,s.backFaceCulling=!1,s.alpha=.85,this.promptDisc.material=s}_setupRenderObserver(){this._renderObserver&&this.scene.onBeforeRenderObservable.remove(this._renderObserver),this._renderObserver=this.scene.onBeforeRenderObservable.add(()=>{if(this.promptDisc.isEnabled()&&(this.mesh.getAbsolutePosition().addToRef(this.billboardOffset,this._positionUpdateTemp),this._positionUpdateTemp.y+=.15*Math.sin(.0015*Date.now()),this.promptDisc.setAbsolutePosition(this._positionUpdateTemp)),this.displayedIngredientInfos.length>0||this.cookingVisualInfo){let e=this.ingredientAnchor.getWorldMatrix();for(let t of this.displayedIngredientInfos)F.P.TransformCoordinatesToRef(t.localOffset,e,this._positionUpdateTemp),t.mesh.setAbsolutePosition(this._positionUpdateTemp),this.ingredientAnchor.absoluteRotationQuaternion.multiplyToRef(t.localRotation,t.mesh.rotationQuaternion),t.mesh.scaling.copyFrom(t.localScale);this.cookingVisualInfo&&(F.P.TransformCoordinatesToRef(this.cookingVisualInfo.localOffset,e,this._positionUpdateTemp),this.cookingVisualInfo.mesh.setAbsolutePosition(this._positionUpdateTemp),this.ingredientAnchor.absoluteRotationQuaternion.multiplyToRef(this.cookingVisualInfo.localRotation,this.cookingVisualInfo.mesh.rotationQuaternion),this.cookingVisualInfo.mesh.scaling.copyFrom(this.cookingVisualInfo.localScale))}this.isProcessing&&this.progressBarPlane&&(this.mesh.getAbsolutePosition().addToRef(this.billboardOffset,this._positionUpdateTemp),this.progressBarPlane.setAbsolutePosition(this._positionUpdateTemp))})}static reset(){this.promptTextures.forEach(e=>e.dispose()),this.promptTextures.clear(),this.particleTextures.forEach(e=>e.dispose()),this.particleTextures.clear()}createSparkleEffect(){this.sparkleSystem=new Q.p(`${this.mesh.name}_sparkles`,15,this.scene),this.sparkleSystem.disposeOnStop=!0,this.sparkleSystem.emitter=this.promptDisc;let e=new F.P(-.1,-.1,-.1),t=new F.P(.1,.1,.1);this.sparkleSystem.minEmitBox=e,this.sparkleSystem.maxEmitBox=t,this.sparkleSystem.color1=new L.HE(1,.85,.9,.6),this.sparkleSystem.color2=new L.HE(.85,.9,1,.6),this.sparkleSystem.colorDead=new L.HE(0,0,0,0),this.sparkleSystem.minSize=.02,this.sparkleSystem.maxSize=.06,this.sparkleSystem.minLifeTime=1,this.sparkleSystem.maxLifeTime=2,this.sparkleSystem.emitRate=5,this.sparkleSystem.blendMode=Q.p.BLENDMODE_ADD,this.sparkleSystem.gravity=new F.P(0,-.02,0);let i=new F.P(-.15,.3,-.15),s=new F.P(.15,.6,.15);this.sparkleSystem.direction1=i,this.sparkleSystem.direction2=s,this.sparkleSystem.minEmitPower=.03,this.sparkleSystem.maxEmitPower=.08,this.sparkleSystem.updateSpeed=.02,this.sparkleSystem.preWarmCycles=0,this.sparkleSystem.disposeOnStop=!1,this.sparkleSystem.stop()}setDisabled(e){this.disabled=e,e&&this.showPrompt(!1)}isDisabled(){return this.disabled}showPrompt(e){let t=this.interactType===ee.ServingOrder&&!!this.dirtyPlateMesh;(this.disabled||this.isActive)&&!t&&(e=!1),this.promptDisc.isEnabled()!==e&&(this.promptDisc.setEnabled(e),this.sparkleSystem&&(e?this.sparkleSystem.start():this.sparkleSystem.stop()))}activate(e){e||(this.isActive=!0,this.showPrompt(!1),this.isProcessing||(this.showPrompt(!1),this.interactType===ee.Oven&&this._startOvenEffects()),this.showDirtyPlateVisual(!1))}deactivate(){this.activeParticleSystems.forEach(e=>{e.stop()}),this.activeParticleSystems=[],this.isProcessing&&(this.isProcessing=!1,this.progressBarPlane&&this.progressBarPlane.setEnabled(!1))}updateProcessingProgress(e,t){let i=this.isProcessing;this.isProcessing=e>0&&t>0,this.processingTimeLeft=e,this.totalProcessingDuration=t,this.progressBarPlane&&this.progressBarPlane.setEnabled(this.isProcessing),this.isProcessing?(this._updateHorizontalProgressBar(),i||this.interactType!==ee.Oven||this._startOvenEffects()):i&&!this.isProcessing&&(this.interactType===ee.Oven&&(this.activeParticleSystems.forEach(e=>e.stop()),this.activeParticleSystems=[]),this.progressBarPlane&&this.progressBarPlane.setEnabled(!1))}_startOvenEffects(){let e,t,i="assets/particles/Star-Texture.png";er.particleTextures.has(i)?e=er.particleTextures.get(i):((e=new D.x(i,this.scene)).hasAlpha=!0,er.particleTextures.set(i,e));let s=new Q.p("fire",600,this.scene);s.particleTexture=e.clone();let a=new F.P;a.copyFrom(this.mesh.getAbsolutePosition()),a.y+=.4,a.z-=.2;let n=new F.P;n.copyFrom(a),n.y+=.4,s.emitter=a;let o=new F.P(-.3,0,-.3),r=new F.P(.3,.1,.3);s.minEmitBox=o,s.maxEmitBox=r,s.color1=new L.HE(1,.7,0,1),s.color2=new L.HE(1,.3,0,1),s.colorDead=new L.HE(.2,0,0,0),s.addColorGradient(0,new L.HE(1,.8,.1,1)),s.addColorGradient(.4,new L.HE(1,.5,0,.9)),s.addColorGradient(.8,new L.HE(.9,.1,0,.5)),s.addColorGradient(1,s.colorDead.clone()),s.minSize=.03,s.maxSize=.15,s.minLifeTime=.15,s.maxLifeTime=.25,s.addSizeGradient(0,.03),s.addSizeGradient(.5,.15),s.addSizeGradient(1,.01),s.emitRate=400,s.blendMode=Q.p.BLENDMODE_ADD,s.minInitialRotation=0,s.maxInitialRotation=2*Math.PI,s.minAngularSpeed=-(2*Math.PI),s.maxAngularSpeed=2*Math.PI,s.gravity=new F.P(0,0,0);let l=new F.P(-.2,1.5,-.2),c=new F.P(.2,3,.2);s.direction1=l,s.direction2=c,s.minEmitPower=.5,s.maxEmitPower=1,s.updateSpeed=.008,s.disposeOnStop=!0;let d="assets/particles/ExplosionTexture-Smoke-1.png";er.particleTextures.has(d)?t=er.particleTextures.get(d):((t=new D.x(d,this.scene)).hasAlpha=!0,er.particleTextures.set(d,t));let h=new Q.p("smoke",150,this.scene);h.particleTexture=t.clone(),h.emitter=n,h.minEmitBox=new F.P(-.3,.1,-.3),h.maxEmitBox=new F.P(.3,.2,.3),h.color1=new L.HE(1,1,1,.05),h.color2=new L.HE(.9,.9,.9,.03),h.colorDead=new L.HE(1,1,1,0),h.addColorGradient(0,new L.HE(1,1,1,0)),h.addColorGradient(.3,new L.HE(1,1,1,.05)),h.addColorGradient(.7,new L.HE(.9,.9,.9,.02)),h.addColorGradient(1,new L.HE(1,1,1,0)),h.minSize=.5,h.maxSize=1.5,h.addSizeGradient(0,.4),h.addSizeGradient(.5,1.2),h.addSizeGradient(1,1.8),h.minLifeTime=1.2,h.maxLifeTime=2.5,h.emitRate=6,h.blendMode=Q.p.BLENDMODE_STANDARD,h.minInitialRotation=0,h.maxInitialRotation=2*Math.PI,h.minAngularSpeed=-.2,h.maxAngularSpeed=.2,h.gravity=new F.P(0,.2,0),h.direction1=new F.P(-.05,.8,-.05),h.direction2=new F.P(.05,1.2,.05),h.minEmitPower=.02,h.maxEmitPower=.08,h.updateSpeed=.02,h.disposeOnStop=!0,s.start(),h.start(),this.activeParticleSystems.push(s,h)}interact(){if(this.disabled&&!this.isActive)return}_prepareIngredientVisual(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:F._f.Identity();if(!this.ingredientLoader)return null;let s=this.ingredientLoader.getIngredientMesh(e);if(!s)return null;s.isPickable=!1,s.getChildMeshes(!1,e=>e instanceof Y.Kj0).forEach(e=>e.isPickable=!1),s.setEnabled(!0);let a=es[e],n=(null==a?void 0:a.onBoard)??(null==a?void 0:a.hand),o=new F.P(.5,.5,.5),r=(null==a?void 0:a.scale)?new F.P(a.scale.x,a.scale.y,a.scale.z):o,l=(null==n?void 0:n.rotationOffset)?new F._f(n.rotationOffset.x,n.rotationOffset.y,n.rotationOffset.z,n.rotationOffset.w):F._f.Identity(),c=i.multiply(l),d=(null==n?void 0:n.positionOffset)?new F.P(n.positionOffset.x,n.positionOffset.y,n.positionOffset.z):F.P.Zero();return{mesh:s,localOffset:t.add(d).clone(),localRotation:c.clone(),localScale:r.clone()}}updateIngredientsOnBoard(e){if(!(e.length!==this.lastIngredientsOnBoard.length||!e.every((e,t)=>e===this.lastIngredientsOnBoard[t]))&&this.displayedIngredientInfos.length>0)return;let t=e.find(e=>{var t;return null==(t=ea[e])?void 0:t.isFinal}),i=this.lastIngredientsOnBoard.find(e=>{var t;return null==(t=ea[e])?void 0:t.isFinal});if(this.clearIngredientsOnBoard(),!this.ingredientLoader){console.warn("IngredientLoader not available for updating board visuals."),this.lastIngredientsOnBoard=[...e];return}let s=null,a=null,n=[];if(this.interactType===ee.ServingBoard){let t=e.includes(et.Plate),i=e.find(e=>{var t;return e!==et.Plate&&(null==(t=ea[e])?void 0:t.isFinal)});if(t&&(s=this._prepareIngredientVisual(et.Plate,F.P.Zero()))&&this.displayedIngredientInfos.push(s),i){let e=new F.P(0,t?.12:.05,0);(a=this._prepareIngredientVisual(i,e))&&this.displayedIngredientInfos.push(a)}}else if(this.interactType===ee.ChoppingBoard||this.interactType===ee.Oven){let t=this.interactType===ee.Oven,i=3*!!t,s=.37*!!t,a=e.filter(e=>e!==et.Plate),o=a.length;a.forEach((e,t)=>{let a=new F.P(o>1?(t-(o-1)/2)*.15:0,i+.05*t,s),r=this._prepareIngredientVisual(e,a);r&&n.push(r)}),this.displayedIngredientInfos.push(...n)}t&&!i&&this.playCraftCompleteEffect(),this.lastIngredientsOnBoard=[...e]}showCookingVisual(e){if(!this.cookingVisualInfo&&this.ingredientLoader&&e===et.Rice&&this.interactType===ee.Oven){let t=new F.P(0,3,.37),i=this._prepareIngredientVisual(e,t);i&&(this.cookingVisualInfo=i)}}hideCookingVisual(){this.cookingVisualInfo&&(this.cookingVisualInfo.mesh.dispose(),this.cookingVisualInfo=null)}playCraftCompleteEffect(){let e,t=new Q.p(`${this.mesh.name}_craft_complete`,50,this.scene);t.emitter=this.mesh.getAbsolutePosition().add(new F.P(0,.3,0)),t.particleEmitterType=t.createSphereEmitter(1.2);let i="assets/particles/Star-Texture.png";er.particleTextures.has(i)?e=er.particleTextures.get(i):((e=new D.x(i,this.scene)).hasAlpha=!0,er.particleTextures.set(i,e)),t.particleTexture=e,t.color1=new L.HE(1,1,.5,1),t.color2=new L.HE(1,.8,.2,1),t.colorDead=new L.HE(0,0,0,0),t.minSize=.05,t.maxSize=.15,t.minLifeTime=.3,t.maxLifeTime=.8,t.emitRate=50/t.maxLifeTime,t.manualEmitCount=50,t.maxEmitPower=2,t.minEmitPower=1,t.updateSpeed=.01,t.gravity=new F.P(0,-3,0),t.direction1=new F.P(-1,2,-1),t.direction2=new F.P(1,4,1),t.blendMode=Q.p.BLENDMODE_ADD,t.start(),setTimeout(()=>{t&&t.stop()},(t.maxLifeTime+.2)*1e3)}clearIngredientsOnBoard(){this.displayedIngredientInfos.forEach(e=>{e.mesh.dispose()}),this.displayedIngredientInfos=[]}dispose(){console.log(`Disposing InteractableObject ${this.id} (${this.mesh.name})`),this.deactivate(),this.clearIngredientsOnBoard(),this.hideCookingVisual(),this.sparkleSystem&&(this.sparkleSystem.stop(),this.sparkleSystem.dispose()),this.progressBarPlane&&(this.progressBarPlane.dispose(),this.progressBarPlane=null),this.progressBarTexture&&(this.progressBarTexture.dispose(),this.progressBarTexture=null),this.progressBarMaterial&&(this.progressBarMaterial.dispose(),this.progressBarMaterial=null),this.promptDisc.dispose(),this.ingredientAnchor.dispose(),this._renderObserver&&(this.scene.onBeforeRenderObservable.remove(this._renderObserver),this._renderObserver=null),this.showDirtyPlateVisual(!1)}constructor(e,t,i,s,a,n){if((0,E._)(this,"isActive",!1),(0,E._)(this,"mesh",void 0),(0,E._)(this,"interactionDistance",2.5),(0,E._)(this,"promptDisc",void 0),(0,E._)(this,"scene",void 0),(0,E._)(this,"billboardOffset",void 0),(0,E._)(this,"interactType",void 0),(0,E._)(this,"id",void 0),(0,E._)(this,"sparkleSystem",void 0),(0,E._)(this,"ingredientLoader",void 0),(0,E._)(this,"ingredientAnchor",void 0),(0,E._)(this,"displayedIngredientInfos",[]),(0,E._)(this,"cookingVisualInfo",null),(0,E._)(this,"lastIngredientsOnBoard",[]),(0,E._)(this,"_positionUpdateTemp",new F.P),(0,E._)(this,"_renderObserver",null),(0,E._)(this,"activeParticleSystems",[]),(0,E._)(this,"disabled",!1),(0,E._)(this,"progressBarPlane",null),(0,E._)(this,"progressBarTexture",null),(0,E._)(this,"progressBarMaterial",null),(0,E._)(this,"progressBarTextureWidth",512),(0,E._)(this,"progressBarTextureHeight",64),(0,E._)(this,"progressBarPlaneWidth",.8),(0,E._)(this,"progressBarPlaneHeight",.15),(0,E._)(this,"isProcessing",!1),(0,E._)(this,"processingTimeLeft",0),(0,E._)(this,"totalProcessingDuration",0),(0,E._)(this,"dirtyPlateMesh",null),(0,E._)(this,"dirtyPlateSmokeSystem",null),(0,E._)(this,"currentDisplayKey","?"),this.mesh=e,this.scene=t,this.billboardOffset=(null==a?void 0:a.clone())??new F.P(0,2,0),this.ingredientLoader=n,this.interactType=i,this.id=s,this.ingredientAnchor=new X.Y(`${e.name}_ingredientAnchor`,t),this.ingredientAnchor.setParent(this.mesh),this.ingredientAnchor.position=new F.P(0,.1,0),this.ingredientAnchor.rotationQuaternion=F._f.Identity(),this.ingredientAnchor.scaling=F.P.One(),this.promptDisc=Y.VO7.CreateDisc(`${e.name}_prompt_disc`,{radius:.25,tessellation:16},t),this.promptDisc.billboardMode=Y.Kj0.BILLBOARDMODE_ALL,this.promptDisc.isPickable=!1,this.promptDisc.renderingGroupId=1,this.promptDisc.setEnabled(!1),this.promptDisc.rotation.x=Math.PI,this.createSparkleEffect(),this.interactType===ee.Oven&&this._setupHorizontalProgressBar(),!er.smokeParticleTexture&&t)try{er.smokeParticleTexture=new D.x("assets/particles/ExplosionTexture-Smoke-1.png",t),er.smokeParticleTexture.hasAlpha=!0}catch(e){console.error("Failed to load smoke particle texture:",e)}this._setupRenderObserver()}}(0,E._)(er,"promptTextures",new Map),(0,E._)(er,"particleTextures",new Map),(0,E._)(er,"smokeParticleTexture",null);var el=i(68989),ec=i(25677),ed=i(78583),eh=i(42881),em=i(38526);function ep(e,t,i){return Math.abs(t-e)<=i?t:e+Math.sign(t-e)*i}var eu=i(40023),eg=((l={}).IDLE="IDLE",l.WALKING="WALKING",l.JUMPING="JUMPING",l.LANDING="LANDING",l.FALLING="FALLING",l.DANCING="DANCING",l);class ey{clearHeldItemVisuals(){this.currentIngredientMesh&&(this.currentIngredientMesh.dispose(),this.currentIngredientMesh=void 0),this.plateMesh&&(this.plateMesh.dispose(),this.plateMesh=void 0)}updateHeldItemVisuals(){this.clearHeldItemVisuals();let e=es[et.Plate],t=es[this.ingredient],i=ea[this.ingredient],s=new F.P(.5,.5,.5);if(this.holdingPlate&&(this.plateMesh=this.ingredientLoader.getIngredientMesh(et.Plate),this.plateMesh)){this.plateMesh.parent=this.holdAttachmentPoint;let t=(null==e?void 0:e.scale)?new F.P(e.scale.x,e.scale.y,e.scale.z):s;this.plateMesh.scaling=t;let i=null==e?void 0:e.hand,a=F.P.Zero();this.plateMesh.position=(null==i?void 0:i.positionOffset)?new F.P(i.positionOffset.x,i.positionOffset.y,i.positionOffset.z):a,this.plateMesh.rotationQuaternion=(null==i?void 0:i.rotationOffset)?new F._f(i.rotationOffset.x,i.rotationOffset.y,i.rotationOffset.z,i.rotationOffset.w):F._f.Identity(),this.plateMesh.isPickable=!1,this.plateMesh.getChildMeshes().forEach(e=>e.isPickable=!1)}if(this.ingredient!==et.None&&i&&(this.currentIngredientMesh=this.ingredientLoader.getIngredientMesh(this.ingredient),this.currentIngredientMesh)){let e,i,a=this.holdAttachmentPoint;this.holdingPlate&&this.plateMesh?(a=this.plateMesh,e=null==t?void 0:t.onPlate,i=new F.P(0,.1,0)):(a=this.holdAttachmentPoint,e=null==t?void 0:t.hand,i=new F.P(0,-.1,.1)),this.currentIngredientMesh.parent=a;let n=(null==t?void 0:t.scale)?new F.P(t.scale.x,t.scale.y,t.scale.z):s;this.holdingPlate&&this.plateMesh&&(n=new F.P(n.x/.5,n.y/.5,n.z/.5)),this.currentIngredientMesh.scaling=n;let o=(null==e?void 0:e.positionOffset)?new F.P(e.positionOffset.x,e.positionOffset.y,e.positionOffset.z):F.P.Zero();this.currentIngredientMesh.position=i.add(o),this.currentIngredientMesh.rotationQuaternion=(null==e?void 0:e.rotationOffset)?new F._f(e.rotationOffset.x,e.rotationOffset.y,e.rotationOffset.z,e.rotationOffset.w):F._f.Identity(),this.currentIngredientMesh.isPickable=!1,this.currentIngredientMesh.getChildMeshes().forEach(e=>e.isPickable=!1)}}dropIngredient(){this.ingredient=et.None,this.updateHeldItemVisuals()}dropPlate(){if(this.holdingPlate){if(this.holdingPlate=!1,this.ingredient!==et.None){let e=ea[this.ingredient];(null==e?void 0:e.isFinal)&&(this.ingredient=et.None)}this.updateHeldItemVisuals()}}pickupIngredient(e){if(this.ingredient)return;let t=ea[e];(!this.holdingPlate||(null==t?void 0:t.isFinal))&&this.forceSetIngredient(e)}forceSetIngredient(e){this.ingredient!==e&&(this.ingredient=e,this.updateHeldItemVisuals())}pickupPlate(){var e;let t=this.ingredient,i=t!==et.None&&!!(null==(e=ea[t])?void 0:e.isFinal);if(t!==et.None&&!i)return void console.warn("Client: Cannot pick up plate while holding non-final.");this.forcePickupPlate()}forcePickupPlate(){this.holdingPlate||(this.holdingPlate=!0,this.updateHeldItemVisuals())}get holdedIngredient(){return this.ingredient}get isHoldingPlate(){return this.holdingPlate}set isHoldingPlate(e){e&&!this.holdingPlate?this.pickupPlate():!e&&this.holdingPlate&&this.dropPlate()}get position(){return this.impostorMesh.position}get rotation(){return this.impostorMesh.rotationQuaternion}get getTargetAnim(){return this.targetAnim}getTransform(){return this.impostorMesh}setPosition(e){this.impostorMesh.position=e}setRotation(e){this.impostorMesh.rotationQuaternion=e}setRotationY(e){this.impostorMesh.rotationQuaternion=F._f.RotationAxis(F.P.Up(),e)}update(e){}_createOrUpdateUsernameDisplay(e){this._removeUsernameDisplay(),this.usernameTexture=new J.c(`usernameTexture_${this.impostorMesh.name}`,{width:512,height:128},this.scene,!1,D.x.BILINEAR_SAMPLINGMODE),this.usernameTexture.hasAlpha=!0;let t=this.usernameTexture.getContext();t.clearRect(0,0,512,128),t.fillStyle="rgba(0, 0, 0, 0.5)",t.beginPath(),t.roundRect(0,0,512,128,25.6),t.fill(),t.font="bold 76.8px Arial",t.fillStyle="#ffe4e6",t.textAlign="center",t.textBaseline="middle",t.fillText(e,256,64),this.usernameTexture.update(),this.usernameMaterial=new O.K(`usernameMat_${this.impostorMesh.name}`,this.scene),this.usernameMaterial.diffuseTexture=this.usernameTexture,this.usernameMaterial.opacityTexture=this.usernameTexture,this.usernameMaterial.useAlphaFromDiffuseTexture=!0,this.usernameMaterial.emissiveColor=L.Wo.White(),this.usernameMaterial.disableLighting=!0,this.usernameMaterial.backFaceCulling=!1,this.usernamePlane=B.V.CreatePlane(`usernamePlane_${this.impostorMesh.name}`,{width:1,height:.25},this.scene),this.usernamePlane.material=this.usernameMaterial,this.usernamePlane.billboardMode=Y.Kj0.BILLBOARDMODE_ALL,this.usernamePlane.parent=this.nameTagAttachmentPoint,this.usernamePlane.position=F.P.Zero(),this.usernamePlane.isPickable=!1,this.usernamePlane.renderingGroupId=1,this.usernamePlane.setEnabled(!0),this.currentDisplayedUsername=e}_removeUsernameDisplay(){this.usernamePlane&&(this.usernamePlane.dispose(),this.usernamePlane=null),this.usernameMaterial&&(this.usernameMaterial.dispose(),this.usernameMaterial=null),this.usernameTexture&&(this.usernameTexture.dispose(),this.usernameTexture=null),this.currentDisplayedUsername=""}setUsernameDisplay(e){let t=(null==e?void 0:e.trim())??"Player";t&&t!==this.currentDisplayedUsername?this._createOrUpdateUsernameDisplay(t):!t&&this.usernamePlane&&this._removeUsernameDisplay()}dispose(){var e,t;console.log(`Disposing CharacterController ${(null==(e=this.impostorMesh)?void 0:e.name)??"Unknown"}`),this._removeUsernameDisplay(),this.clearHeldItemVisuals(),this.holdAttachmentPoint.dispose(),this.nameTagAttachmentPoint.dispose(),this.impostorMesh.dispose(),this.model.dispose(),this.physicsAggregate&&this.physicsAggregate.dispose(),this.nonIdleAnimations.forEach(e=>e.stop()),this.idleAnim.stop(),console.log(`CharacterController ${(null==(t=this.impostorMesh)?void 0:t.name)??"Unknown"} disposed.`)}updateAnimations(e){let t=this.idleAnim;switch(this.currentState){case eg.IDLE:t=this.idleAnim;break;case eg.WALKING:t=this.walkAnim;break;case eg.JUMPING:t=this.jumpAnim;break;case eg.FALLING:t=this.fallingAnim;break;case eg.LANDING:t=this.landingAnim;break;case eg.DANCING:t=this.sambaDanceAnim}this.targetAnim=t;let i=0;for(let s of this.nonIdleAnimations){let a=+(s===t);if(s.weight=ep(s.weight,a,this.animationBlendSpeed*e),s===t&&s.weight>.01&&!s.isPlaying){let e=s===this.fallingAnim||s===this.walkAnim||s===this.sambaDanceAnim;e||s.goToFrame(0),s.play(e)}else s!==t&&s.weight<.01&&s.isPlaying&&(s.pause(),s.loopAnimation||s.goToFrame(0));i+=s.weight}this.idleAnim.weight=ep(this.idleAnim.weight,Math.max(0,1-i),this.animationBlendSpeed*e),this.idleAnim.weight>.01&&!this.idleAnim.isPlaying?this.idleAnim.play(!0):this.idleAnim.weight<.01&&this.idleAnim.isPlaying&&this.idleAnim.pause()}isAnimationFinished(e){return e.loopAnimation?e.weight<.1:!e.isPlaying&&e.weight<.1}constructor(e,t,i,s,a){(0,E._)(this,"audioManager",void 0),(0,E._)(this,"ingredientLoader",void 0),(0,E._)(this,"currentIngredientMesh",void 0),(0,E._)(this,"plateMesh",void 0),(0,E._)(this,"scene",void 0),(0,E._)(this,"model",void 0),(0,E._)(this,"physicsAggregate",void 0),(0,E._)(this,"moveSpeed",1.8),(0,E._)(this,"rotationSpeed",6),(0,E._)(this,"animationBlendSpeed",4),(0,E._)(this,"jumpForce",5),(0,E._)(this,"walkAnim",void 0),(0,E._)(this,"idleAnim",void 0),(0,E._)(this,"jumpAnim",void 0),(0,E._)(this,"landingAnim",void 0),(0,E._)(this,"fallingAnim",void 0),(0,E._)(this,"sambaDanceAnim",void 0),(0,E._)(this,"nonIdleAnimations",void 0),(0,E._)(this,"thirdPersonCamera",void 0),(0,E._)(this,"targetAnim",void 0),(0,E._)(this,"impostorMesh",void 0),(0,E._)(this,"currentState",eg.IDLE),(0,E._)(this,"ingredient",et.None),(0,E._)(this,"holdingPlate",!1),(0,E._)(this,"holdAttachmentPoint",void 0),(0,E._)(this,"nameTagAttachmentPoint",void 0),(0,E._)(this,"usernamePlane",null),(0,E._)(this,"usernameTexture",null),(0,E._)(this,"usernameMaterial",null),(0,E._)(this,"currentDisplayedUsername",""),this.scene=t,this.ingredientLoader=i,this.audioManager=a,this.impostorMesh=B.V.CreateCapsule("CharacterTransform",{height:1.5,radius:.3},t),this.impostorMesh.visibility=0,this.impostorMesh.rotationQuaternion=F._f.Identity(),this.impostorMesh.position.y=1,this.impostorMesh.position.x=0,this.impostorMesh.position.z=3.5,this.impostorMesh.isPickable=!1,this.holdAttachmentPoint=new X.Y("holdAttachmentPoint",t),this.holdAttachmentPoint.parent=this.impostorMesh,this.holdAttachmentPoint.position=new F.P(0,-.2,-.4),this.holdAttachmentPoint.rotationQuaternion=F._f.Identity(),this.holdAttachmentPoint.scaling=F.P.One(),this.nameTagAttachmentPoint=new X.Y("nameTagAttachmentPoint",t),this.nameTagAttachmentPoint.parent=this.impostorMesh,this.nameTagAttachmentPoint.position=new F.P(0,1,0),this.model=e,this.model.parent=this.impostorMesh,this.model.rotate(F.P.Up(),Math.PI),this.model.position.y=-.75,e.isPickable=!1,this.model.getChildMeshes().forEach(e=>{e.isPickable=!1,e.receiveShadows=!0});let n=s.find(e=>"Walking"===e.name);if(void 0===n)throw Error("'Walking' animation not found");this.walkAnim=n,this.walkAnim.weight=0;let o=s.find(e=>"SambaDancing"===e.name);if(void 0===o)throw Error("'SambaDancing' animation not found");this.sambaDanceAnim=o,this.sambaDanceAnim.weight=0;let r=s.find(e=>"Jump"===e.name);if(void 0===r)throw Error("'Jumping' animation not found");this.jumpAnim=r,this.jumpAnim.weight=0;let l=s.find(e=>"Fall"===e.name);if(void 0===l)throw Error("'Falling' animation not found");this.fallingAnim=l,this.fallingAnim.weight=0;let c=s.find(e=>"Land"===e.name);if(void 0===c)throw Error("'Landing' animation not found");this.landingAnim=c,this.landingAnim.weight=0,this.landingAnim.loopAnimation=!1;let d=s.find(e=>"Idle"===e.name);if(void 0===d)throw Error("'Idle' animation not found");this.idleAnim=d,this.idleAnim.weight=1,this.idleAnim.play(!0),this.targetAnim=this.idleAnim,this.nonIdleAnimations=[this.walkAnim,this.sambaDanceAnim,this.jumpAnim,this.fallingAnim,this.landingAnim],this.physicsAggregate=new em.p(this.getTransform(),eu.Bq.CAPSULE,{mass:1,friction:.5}),this.physicsAggregate.body.setMassProperties({inertia:F.P.ZeroReadOnly}),this.physicsAggregate.body.setAngularDamping(100),this.physicsAggregate.body.setLinearDamping(10)}}var ef=((c={})[c.UNSUPPORTED=0]="UNSUPPORTED",c[c.SLIDING=1]="SLIDING",c[c.SUPPORTED=2]="SUPPORTED",c);let ex={forward:eo.KeyW,backward:eo.KeyS,left:eo.KeyA,right:eo.KeyD,jump:eo.Space,interact:eo.KeyE,dance:eo.KeyB};function eb(e,t){let i=localStorage.getItem(e);if(null===i)return t;try{if("boolean"==typeof t)return"true"===i;if("number"==typeof t){let e=parseFloat(i);return isNaN(e)?t:e}if("object"==typeof t&&null!==t){let s=JSON.parse(i);if(typeof s==typeof t)return s;return console.warn(`Type mismatch for setting ${e}. Using default.`),t}return i}catch(i){return console.error(`Error reading setting ${e}:`,i),t}}function eP(e,t){try{let i="object"==typeof t?JSON.stringify(t):String(t);localStorage.setItem(e,i)}catch(t){console.error(`Error saving setting ${e}:`,t)}}let ev={PLAYER_USERNAME:"delixia_playerUsername",SENSITIVITY_X:"delixia_sensitivityX",SENSITIVITY_Y:"delixia_sensitivityY",WHEEL_PRECISION:"delixia_wheelPrecision",INVERT_Y:"delixia_invertY",FOV:"delixia_fov",SHOW_FPS:"delixia_showFps",MASTER_VOLUME:"delixia_masterVolume",MUSIC_ENABLED:"delixia_musicEnabled",MUSIC_VOLUME:"delixia_musicVolume",SFX_VOLUME:"delixia_sfxVolume",GRAPHICS_QUALITY:"delixia_graphicsQuality",KEY_BINDINGS:"delixia_keyBindings"},eS={getUsername:()=>eb(ev.PLAYER_USERNAME,""),setUsername:e=>eP(ev.PLAYER_USERNAME,e.trim()),getSensitivityX:()=>eb(ev.SENSITIVITY_X,1),setSensitivityX:e=>eP(ev.SENSITIVITY_X,Math.max(.1,Math.min(e,5))),getSensitivityY:()=>eb(ev.SENSITIVITY_Y,1),setSensitivityY:e=>eP(ev.SENSITIVITY_Y,Math.max(.1,Math.min(e,5))),getWheelPrecision:()=>eb(ev.WHEEL_PRECISION,12),setWheelPrecision:e=>eP(ev.WHEEL_PRECISION,Math.max(1,Math.min(e,100))),getInvertY:()=>eb(ev.INVERT_Y,!1),setInvertY:e=>eP(ev.INVERT_Y,e),getFov:()=>eb(ev.FOV,.8),setFov:e=>eP(ev.FOV,Math.max(.5,Math.min(e,1.4))),getShowFps:()=>eb(ev.SHOW_FPS,!1),setShowFps:e=>eP(ev.SHOW_FPS,e),getGraphicsQuality:()=>eb(ev.GRAPHICS_QUALITY,"high"),setGraphicsQuality:e=>eP(ev.GRAPHICS_QUALITY,e),getMasterVolume:()=>eb(ev.MASTER_VOLUME,1),setMasterVolume:e=>eP(ev.MASTER_VOLUME,Math.max(0,Math.min(e,1))),getMusicEnabled:()=>eb(ev.MUSIC_ENABLED,!0),setMusicEnabled:e=>eP(ev.MUSIC_ENABLED,e),getMusicVolume:()=>eb(ev.MUSIC_VOLUME,.3),setMusicVolume:e=>eP(ev.MUSIC_VOLUME,Math.max(0,Math.min(e,1))),getSfxVolume:()=>eb(ev.SFX_VOLUME,.7),setSfxVolume:e=>eP(ev.SFX_VOLUME,Math.max(0,Math.min(e,1))),getKeyBindings:()=>{let e=localStorage.getItem(ev.KEY_BINDINGS),t={...ex};if(e)try{let i=JSON.parse(e);t=function(e){let t={...ex};if(e&&"object"==typeof e)for(let i in ex)e[i]&&"string"==typeof e[i]&&(t[i]=e[i]);return t}(i)}catch(e){console.error("Error parsing key bindings, using defaults:",e)}return t},setKeyBindings:e=>{eP(ev.KEY_BINDINGS,e)},resetAllSettings:()=>{Object.values(ev).forEach(e=>{localStorage.removeItem(e)}),console.log("All settings reset to default."),window.location.reload()}};class e_ extends ey{applyKeybindings(){this.keyBindings=eS.getKeyBindings()}applyCameraSettings(){let e=eS.getSensitivityX(),t=eS.getSensitivityY(),i=eS.getWheelPrecision(),s=eS.getInvertY(),a=eS.getFov();this.thirdPersonCamera&&(this.thirdPersonCamera.angularSensibilityX=2500/e,this.thirdPersonCamera.angularSensibilityY=2500/t*(s?-1:1),this.thirdPersonCamera.wheelPrecision=i,this.thirdPersonCamera.fov=a)}setUsernameDisplay(e){this._removeUsernameDisplay()}update(e){this._startPosTemp.copyFrom(this.getTransform().position),this._velocityTemp.copyFrom(this.physicsAggregate.body.getLinearVelocity()),this._velocityTemp.scaleInPlace(e),this._startPosTemp.addToRef(this._velocityTemp,this._endPosTemp),this._castWithCollectors(this._startPosTemp,this._endPosTemp),this._updateManifold(),this.isGrounded=this.checkGrounded(),this.handleInput(),this.updateState(),this.updateMovement(),this.updateAnimations(e),this.updateCameraCollision(),this.updateFootstepSounds(e),this.updateCharacterVisibilityFade(e)}updateFootstepSounds(e){if(this.currentState===eg.WALKING&&this.isGrounded){if(this.timeSinceLastStep+=e,this.timeSinceLastStep>=this.stepInterval){let e;do e=Math.floor(Math.random()*this.footstepSoundNames.length);while(this.footstepSoundNames.length>1&&e===this.lastFootstepIndex);let t=this.footstepSoundNames[e];this.lastFootstepIndex=e,this.audioManager.playSound(t,.55,!1,this.getTransform()),this.timeSinceLastStep-=this.stepInterval}this.isPlayingFootsteps=!0}else this.isPlayingFootsteps&&(this.isPlayingFootsteps=!1,this.timeSinceLastStep=0,this.lastFootstepIndex=-1)}handleInput(){let e=this.keyBindings.jump??eo.Space,t=this.keyBindings.interact??eo.KeyE,i=this.inputMap.get(e)||!1;i&&!this.previousJumpKeyState&&this.isGrounded&&!this.isJumping&&(this.isJumping=!0,this.jumpAnim.reset(),this.jumpAnim.play(!1),this.physicsAggregate.body.applyImpulse(new F.P(0,7e3,0),new F.P(0,0,0))),this.previousJumpKeyState=i;let s=this.inputMap.get(t)||!1;s&&!this.previousInteractKeyState&&this.gameEngine.tryInteract(this),this.previousInteractKeyState=s}updateState(){let e,t=this.checkSupport(),i=this.physicsAggregate.body.getLinearVelocity().y,s=this.isAnyMovementKeyDown(),a=this.keyBindings.dance??eo.KeyB;this.isLandingAnimationActive&&this.landingAnim.weight<.1&&(this.isLandingAnimationActive=!1,this.landingAnim.isPlaying||this.landingAnim.goToFrame(0)),this.inputMap.get(a)?(e=eg.DANCING,this.isJumping=!1,this.isLandingAnimationActive=!1):t===ef.SUPPORTED?this.currentState===eg.FALLING||this.currentState===eg.JUMPING?(e=eg.LANDING,this.isJumping=!1,this.isLandingAnimationActive=!0,this.gameEngine.playSfx("jumpLand",.65,!1,this.getTransform())):this.isLandingAnimationActive?s?(e=eg.WALKING,this.isLandingAnimationActive=!1):e=eg.LANDING:(e=s?eg.WALKING:eg.IDLE,this.isJumping=!1):(t===ef.SLIDING?(e=eg.FALLING,this.isJumping=!1):this.isJumping&&i>.05?e=eg.JUMPING:(e=eg.FALLING,this.isJumping&&(this.isJumping=!1)),this.isLandingAnimationActive=!1),this.currentState=e}updateMovement(){this._cameraForwardTemp.copyFrom(this.thirdPersonCamera.getForwardRay().direction),this._forwardTemp.set(this._cameraForwardTemp.x,0,this._cameraForwardTemp.z),this._forwardTemp.normalize(),this._rightTemp.set(this._forwardTemp.z,0,-this._forwardTemp.x),this._rightTemp.normalize(),this._moveDirectionTemp.setAll(0),this.inputMap.get(this.keyBindings.forward)&&this._moveDirectionTemp.addInPlace(this._forwardTemp),this.inputMap.get(this.keyBindings.backward)&&this._moveDirectionTemp.subtractInPlace(this._forwardTemp),this.inputMap.get(this.keyBindings.left)&&this._moveDirectionTemp.subtractInPlace(this._rightTemp),this.inputMap.get(this.keyBindings.right)&&this._moveDirectionTemp.addInPlace(this._rightTemp),this._moveDirectionTemp.normalize();let e=this.getTransform().rotationQuaternion;if(!e)throw Error("Character rotation quaternion is null");for(let t of(this._moveDirectionTemp.lengthSquared()>.01?F._f.FromLookDirectionLHToRef(this._moveDirectionTemp,F.P.UpReadOnly,this._desiredRotationTemp):this._desiredRotationTemp.copyFrom(e),this.applySmoothRotation(e,this._desiredRotationTemp),this._moveDirectionTemp.scaleToRef(this.moveSpeed,this._desiredVelocityTemp),this._adjustedVelocityTemp.copyFrom(this._desiredVelocityTemp),this.manifold)){let e=t.normal,i=this._adjustedVelocityTemp.dot(e);i<0&&(e.scaleToRef(i,this._projectionTemp),this._adjustedVelocityTemp.subtractInPlace(this._projectionTemp))}this._currentVelocityTemp.copyFrom(this.physicsAggregate.body.getLinearVelocity()),this._newVelocityTemp.set(this._adjustedVelocityTemp.x,this._currentVelocityTemp.y,this._adjustedVelocityTemp.z),this.physicsAggregate.body.setLinearVelocity(this._newVelocityTemp)}applySmoothRotation(e,t){if(t.equals(e))this._angularVelocityTemp.setAll(0),this.physicsAggregate.body.setAngularVelocity(this._angularVelocityTemp);else{F._f.InverseToRef(e,this._rotationDeltaTemp),this._rotationDeltaTemp.multiplyInPlace(t),this._rotationDeltaTemp.toEulerAnglesToRef(this._rotationDeltaEulerTemp);let i=this._rotationDeltaEulerTemp.y*this.rotationSpeed;this._angularVelocityTemp.set(0,i,0),this.physicsAggregate.body.setAngularVelocity(this._angularVelocityTemp)}}checkGroundWithShapeCast(e){let t=this.scene.getPhysicsEngine().getPhysicsPlugin(),i=t._hknp;this._groundCheckStartPos.copyFrom(this.getTransform().position),this._groundCheckEndPos.copyFrom(this._groundCheckStartPos),this._groundCheckEndPos.y-=e;let s=[this.physicsAggregate.shape._pluginData,[0,0,0,1],[this._groundCheckStartPos.x,this._groundCheckStartPos.y,this._groundCheckStartPos.z],[this._groundCheckEndPos.x,this._groundCheckEndPos.y,this._groundCheckEndPos.z],!1,[BigInt(0)]];if(i.HP_World_ShapeCastWithCollector(t.world,this._castCollector,s),i.HP_QueryCollector_GetNumHits(this._castCollector)[1]>0){let[e,,t]=i.HP_QueryCollector_GetShapeCastResult(this._castCollector,0)[1];if(e<1)return F.P.FromArrayToRef(t[4],0,this._groundNormalTemp),{isGrounded:!0,groundNormal:this._groundNormalTemp}}return{isGrounded:!1,groundNormal:null}}checkGrounded(){return this.checkGroundWithShapeCast(this.groundCheckDistance).isGrounded}_castWithCollectors(e,t){let i=this.scene.getPhysicsEngine().getPhysicsPlugin(),s=i._hknp,a=[e.x,e.y,e.z],n=[0,0,0,1],o=[this.physicsAggregate.shape._pluginData,a,n,this.keepDistance+this.keepContactTolerance,!1,[BigInt(0)]];s.HP_World_ShapeProximityWithCollector(i.world,this._startCollector,o);let r=[this.physicsAggregate.shape._pluginData,n,a,[t.x,t.y,t.z],!1,[BigInt(0)]];s.HP_World_ShapeCastWithCollector(i.world,this._castCollector,r)}_updateManifold(){let e=this.scene.getPhysicsEngine().getPhysicsPlugin(),t=e._hknp;this.manifold=[];let i=t.HP_QueryCollector_GetNumHits(this._startCollector)[1];for(let s=0;s<i;s++){let[i,,a]=t.HP_QueryCollector_GetShapeProximityResult(this._startCollector,s)[1],n=F.P.FromArray(a[3]),o=F.P.FromArray(a[4]),r=a[0][0],l=e._bodies.get(r);if(l){let e={position:n,normal:o,distance:i,fraction:0,bodyB:l.body,allowedPenetration:Math.min(Math.max(this.keepDistance-i,0),this.keepDistance)};this.manifold.push(e)}}}checkSupport(){let e=!1,t=F.P.Zero(),i=0;for(let s of this.manifold)s.normal.dot(F.P.Up())>.1&&(e=!0,t.addInPlace(s.normal),i++);return e?(t.scaleInPlace(1/i),t.dot(F.P.Up())>this.maxSlopeCosine?ef.SUPPORTED:ef.SLIDING):ef.UNSUPPORTED}updateCameraCollision(){let e=this.thirdPersonCamera;this._cameraTargetTemp=this.cameraAttachPoint.getAbsolutePosition(),e.position.subtractToRef(this._cameraTargetTemp,this._cameraDirectionTemp);let t=this._cameraDirectionTemp.length();if(t<1e-4)return;this._cameraDirectionTemp.normalizeToRef(this._cameraDirectionTemp),this._cameraRay.origin.copyFrom(this._cameraTargetTemp),this._cameraRay.direction.copyFrom(this._cameraDirectionTemp),this._cameraRay.length=t;let i=this.scene.pickWithRay(this._cameraRay,e=>null!=e.physicsBody&&e.isEnabled()&&e!==this.getTransform()&&e.isPickable),s=Number.POSITIVE_INFINITY;i&&i.hit&&i.distance<t&&(s=Math.max(i.distance-.01,e.lowerRadiusLimit??1));let a=Math.min(e.radius,s);a=Math.max(a=Math.min(a,e.upperRadiusLimit??9999999),e.lowerRadiusLimit??1);let n=1-Math.exp(-15*this.scene.getEngine().getDeltaTime()/1e3);e.radius=en.Rus.Lerp(e.radius,a,n),.01>Math.abs(e.radius-a)&&(e.radius=a)}isAnyMovementKeyDown(){return this.inputMap.get(this.keyBindings.forward)||this.inputMap.get(this.keyBindings.backward)||this.inputMap.get(this.keyBindings.left)||this.inputMap.get(this.keyBindings.right)}dropIngredient(){super.dropIngredient(),this.gameEngine.playSfx("trash")}dropPlate(){super.dropPlate(),this.gameEngine.playSfx("trash")}updateCharacterVisibilityFade(e){let t=this.thirdPersonCamera;if("number"!=typeof t.lowerRadiusLimit)this.targetVisibility=1;else{let e=t.radius<=t.lowerRadiusLimit+this.visibilityThresholdPadding;this.targetVisibility=e?this.invisibleVisibilityValue:1}if(.01>Math.abs(this.currentVisibility-this.targetVisibility)){this.currentVisibility!==this.targetVisibility&&(this.currentVisibility=this.targetVisibility,this.model.visibility=this.currentVisibility,this.model.getChildMeshes().forEach(e=>e.visibility=this.currentVisibility));return}this.currentVisibility=en.Rus.Lerp(this.currentVisibility,this.targetVisibility,1-Math.exp(-this.fadeSpeed*e)),this.model.visibility=this.currentVisibility,this.model.getChildMeshes().forEach(e=>e.visibility=this.currentVisibility)}dispose(){super.dispose()}constructor(e,t,i,s,a,n){super(t,a,i,s,n),(0,E._)(this,"keyBindings",{}),(0,E._)(this,"inputMap",void 0),(0,E._)(this,"isJumping",!1),(0,E._)(this,"previousJumpKeyState",!1),(0,E._)(this,"previousInteractKeyState",!1),(0,E._)(this,"cameraAttachPoint",void 0),(0,E._)(this,"gameEngine",void 0),(0,E._)(this,"thirdPersonCamera",void 0),(0,E._)(this,"isGrounded",!1),(0,E._)(this,"groundCheckDistance",.1),(0,E._)(this,"_startCollector",void 0),(0,E._)(this,"_castCollector",void 0),(0,E._)(this,"keepDistance",.05),(0,E._)(this,"keepContactTolerance",.1),(0,E._)(this,"manifold",[]),(0,E._)(this,"maxSlopeCosine",Math.cos(60/180*Math.PI)),(0,E._)(this,"isPlayingFootsteps",!1),(0,E._)(this,"timeSinceLastStep",0),(0,E._)(this,"stepInterval",.45),(0,E._)(this,"footstepSoundNames",["footstep_wood_01","footstep_wood_02","footstep_wood_03","footstep_wood_04"]),(0,E._)(this,"lastFootstepIndex",-1),(0,E._)(this,"visibilityThresholdPadding",1.5),(0,E._)(this,"currentVisibility",1),(0,E._)(this,"targetVisibility",1),(0,E._)(this,"fadeSpeed",20),(0,E._)(this,"invisibleVisibilityValue",0),(0,E._)(this,"isLandingAnimationActive",!1),(0,E._)(this,"_startPosTemp",new F.P),(0,E._)(this,"_endPosTemp",new F.P),(0,E._)(this,"_velocityTemp",new F.P),(0,E._)(this,"_cameraForwardTemp",new F.P),(0,E._)(this,"_forwardTemp",new F.P),(0,E._)(this,"_rightTemp",new F.P),(0,E._)(this,"_moveDirectionTemp",new F.P),(0,E._)(this,"_desiredVelocityTemp",new F.P),(0,E._)(this,"_adjustedVelocityTemp",new F.P),(0,E._)(this,"_currentVelocityTemp",new F.P),(0,E._)(this,"_newVelocityTemp",new F.P),(0,E._)(this,"_projectionTemp",new F.P),(0,E._)(this,"_desiredRotationTemp",new F._f),(0,E._)(this,"_rotationDeltaTemp",new F._f),(0,E._)(this,"_rotationDeltaEulerTemp",new F.P),(0,E._)(this,"_angularVelocityTemp",new F.P),(0,E._)(this,"_groundCheckStartPos",new F.P),(0,E._)(this,"_groundCheckEndPos",new F.P),(0,E._)(this,"_groundNormalTemp",new F.P),(0,E._)(this,"_cameraTargetTemp",new F.P),(0,E._)(this,"_cameraDirectionTemp",new F.P),(0,E._)(this,"_cameraRay",new eh.zH(F.P.Zero(),F.P.Zero())),this.gameEngine=e,this.inputMap=new Map,a.actionManager=new el.k(a),a.actionManager.registerAction(new ec.fQ(el.k.OnKeyDownTrigger,e=>{let t=e.sourceEvent.code;this.inputMap.set(t,!0)})),a.actionManager.registerAction(new ec.fQ(el.k.OnKeyUpTrigger,e=>{let t=e.sourceEvent.code;this.inputMap.set(t,!1)})),this.cameraAttachPoint=new X.Y("cameraAttachPoint",a),this.cameraAttachPoint.parent=this.getTransform(),this.cameraAttachPoint.position=new F.P(0,.4,0);let o=new ed.Yf("thirdPersonCamera",-Math.PI/2,Math.PI/3,5,this.cameraAttachPoint.getAbsolutePosition(),a);o.inputs.clear(),o.inputs.addPointers(),o.inputs.addGamepad(),o.inputs.addMouseWheel(),o.attachControl(a.getEngine().getRenderingCanvas(),!0),o.lowerRadiusLimit=.1,o.upperRadiusLimit=10,o.lowerBetaLimit=.1,o.upperBetaLimit=Math.PI/2+.2,o.minZ=.02,o.maxZ=1e3,o.setTarget(this.cameraAttachPoint),this.thirdPersonCamera=o,this.applyCameraSettings(),this.applyKeybindings();let r=a.getPhysicsEngine().getPhysicsPlugin()._hknp;this._startCollector=r.HP_QueryCollector_Create(16)[1],this._castCollector=r.HP_QueryCollector_Create(16)[1]}}var ew=i(8932),eM=i(72023);function eI(e){let t=JSON.stringify(e,(e,t)=>{if("hash"!==e){if(Array.isArray(t))return t.slice().sort((e,t)=>{let i=JSON.stringify(e),s=JSON.stringify(t);return i<s?-1:+(i>s)});if(t&&"object"==typeof t&&!(t instanceof Date)){let e={};return Object.keys(t).sort().forEach(i=>{e[i]=t[i]}),e}return t}});return(0,eM.sha256)(t)}let eN=ew.z.object({id:ew.z.number().optional(),interactType:ew.z.nativeEnum(ee),ingredient:ew.z.nativeEnum(et).optional()}),eT=ew.z.object({map:ew.z.string(),fileName:ew.z.string(),defaultScaling:ew.z.object({x:ew.z.number().optional(),y:ew.z.number().optional(),z:ew.z.number().optional()}).optional(),billboardOffset:ew.z.object({x:ew.z.number(),y:ew.z.number(),z:ew.z.number()}).optional(),defaultPhysics:ew.z.object({shapeType:ew.z.nativeEnum(eu.Bq),mass:ew.z.number().optional(),friction:ew.z.number().optional(),restitution:ew.z.number().optional()}).optional(),interaction:eN.optional(),instances:ew.z.array(ew.z.object({position:ew.z.object({x:ew.z.number(),y:ew.z.number(),z:ew.z.number()}),rotation:ew.z.object({x:ew.z.number().optional(),y:ew.z.number().optional(),z:ew.z.number().optional()}).optional(),scaling:ew.z.object({x:ew.z.number().optional(),y:ew.z.number().optional(),z:ew.z.number().optional()}).optional(),physics:ew.z.object({shapeType:ew.z.number(),mass:ew.z.number().optional(),friction:ew.z.number().optional(),restitution:ew.z.number().optional()}).optional(),interaction:eN.optional()})),hash:ew.z.string().optional()});var ek=i(7942);class eE{loadAndPlaceModels(e,t,i,s,a){if(er.reset(),this.interactables=[],a){let e=eI(t);e!==a?(console.error(`Map hash mismatch! Client: ${e}, Server: ${a}`),ek.Am.error("Warning: Your game map version differs from the server. This may cause gameplay issues.")):console.log(`Map hash verified: ${e}`)}else console.warn("No map hash provided for verification, the client hash is:",eI(t),"this may cause gameplay issues.");t.forEach(t=>{let{fileName:i}=t;if(!this.loadedContainers[i]){let s=e+t.map+"/",a=this.assetsManager.addContainerTask(i,"",s,i);a.onSuccess=e=>{this.loadedContainers[i]=e.loadedContainer},a.onError=(e,t,s)=>{console.error(`Error loading ${i}:`,t,s)}}}),s&&"function"==typeof s&&(this.assetsManager.onProgress=(e,t)=>{s((t-e)/t*100)}),this.assetsManager.onFinish=()=>{t.forEach(e=>{let t=this.loadedContainers[e.fileName];if(!t)return void console.warn(`Could not find loaded container for "${e.fileName}". Skipping.`);let i=e.defaultPhysics;e.instances.forEach(s=>{let a=t.instantiateModelsToScene(e=>e).rootNodes[0];if(!a||!(a instanceof R.Kj))return void console.error(`Invalid root node for model "${e.fileName}"`);if(a.name=e.fileName.replace(".glb",""),e.defaultScaling&&a.scaling.set(e.defaultScaling.x??1,e.defaultScaling.y??1,e.defaultScaling.z??1),s.rotation&&a.rotation.set(s.rotation.x??0,s.rotation.y??0,s.rotation.z??0),s.position&&a.position.set(s.position.x,s.position.y,s.position.z),s.scaling&&a.scaling.set(s.scaling.x??1,s.scaling.y??1,s.scaling.z??1),a.getChildMeshes().forEach(t=>{s.rotation&&(t.rotation.set(s.rotation.x??0,s.rotation.y??0,s.rotation.z??0),t.rotationQuaternion=null);let a=s.physics??i;if(a){if(!a.shapeType)return void console.warn(`Missing shape type for physics in model "${e.fileName}"`);new em.p(t,a.shapeType,{mass:a.mass??0,restitution:a.restitution??.2,friction:a.friction??.5},this.scene),t.receiveShadows=!0,"cloud1.glb"==e.fileName&&(t.material=this.cloudMaterial),this.cascadedShadowGenerator.addShadowCaster(t)}}),s.interaction){let t=s.interaction;if(!t||!t.id)return void console.warn(`Missing interaction for model "${e.fileName}"`);let i=e.billboardOffset?new F.P(e.billboardOffset.x,e.billboardOffset.y,e.billboardOffset.z):void 0,n=new er(a,this.scene,t.interactType,t.id,i,this.ingredientLoader);n.interactionDistance=2,this.interactables.push(n)}})}),i()},this.assetsManager.load()}constructor(e,t,i){(0,E._)(this,"scene",void 0),(0,E._)(this,"cascadedShadowGenerator",void 0),(0,E._)(this,"assetsManager",void 0),(0,E._)(this,"loadedContainers",{}),(0,E._)(this,"cloudMaterial",void 0),(0,E._)(this,"interactables",[]),(0,E._)(this,"ingredientLoader",void 0),this.scene=e,this.assetsManager=new U.Sp(this.scene),this.assetsManager.autoHideLoadingUI=!1,this.assetsManager.useDefaultLoadingScreen=!1,this.cascadedShadowGenerator=t,this.ingredientLoader=i;let s=new O.K("cloud",this.scene);s.disableLighting=!1,s.emissiveColor=new L.Wo(.5,.5,.5),s.alpha=.85,s.backFaceCulling=!0,this.cloudMaterial=s}}class eC extends ey{receiveFirstState(e){this.targetPosition=new F.P(e.x,e.y,e.z),this.targetYRotation=e.rot,this.previousPosition.copyFrom(this.targetPosition),this.impostorMesh.setEnabled(!0),this.setUsernameDisplay(e.name),e.holdingPlate!==this.isHoldingPlate&&(e.holdingPlate?this.forcePickupPlate():this.dropPlate()),void 0!==e.holdedIngredient&&this.forceSetIngredient(e.holdedIngredient),this.updateAnimationState(e.animationState)}receiveState(e){if(!e.connected){this.impostorMesh.setEnabled(!1),this._removeUsernameDisplay();return}this.impostorMesh.isEnabled()||this.impostorMesh.setEnabled(!0),this.setUsernameDisplay(e.name),this.previousPosition.copyFrom(this.targetPosition),this.targetPosition=new F.P(e.x,e.y,e.z),this.targetYRotation=e.rot;let t=performance.now(),i=(t-this.lastUpdateTime)/1e3;i>0&&(this.currentVelocity=this.targetPosition.subtract(this.previousPosition).scale(1/i)),this.lastUpdateTime=t,this.updateAnimationState(e.animationState),e.holdingPlate&&!this.isHoldingPlate?this.forcePickupPlate():!e.holdingPlate&&this.isHoldingPlate&&this.dropPlate(),this.forceSetIngredient(e.holdedIngredient)}update(e){this.updateMovement(e),this.updateAnimations(e),this.updateFootstepSounds(e)}dispose(){super.dispose()}lerpRotationY(e,t){Math.abs(this.impostorMesh.rotationQuaternion.toEulerAngles().y-e)>Math.PI?this.impostorMesh.rotationQuaternion=F._f.RotationAxis(F.P.Up(),e):this.impostorMesh.rotationQuaternion=F._f.Slerp(this.impostorMesh.rotationQuaternion,F._f.RotationAxis(F.P.Up(),e),t)}lerpPosition(e,t){this.impostorMesh.position=F.P.Lerp(this.impostorMesh.position,e,t)}updateMovement(e){this._predictedPositionTemp.copyFrom(this.targetPosition),this.currentVelocity.lengthSquared()>.01&&(this.currentVelocity.scaleToRef(e,this._predictedPositionTemp),this.targetPosition.addToRef(this._predictedPositionTemp,this._predictedPositionTemp)),this.lerpPosition(this._predictedPositionTemp,this.positionInterpolationFactor),this.lerpRotationY(this.targetYRotation,this.rotationInterpolationFactor)}updateAnimationState(e){let t=this.currentState;switch(e){case"Walking":this.currentState=eg.WALKING;break;case"SambaDancing":this.currentState=eg.DANCING;break;case"Jump":this.currentState=eg.JUMPING;break;case"Fall":this.currentState=eg.FALLING;break;case"Land":this.currentState=eg.LANDING;break;default:this.currentState=eg.IDLE}this.currentState===eg.WALKING&&t!==eg.WALKING?this.startFootstepSounds():this.currentState!==eg.WALKING&&t===eg.WALKING&&this.stopFootstepSounds(),this.currentState===eg.LANDING&&(t===eg.FALLING||t===eg.JUMPING)&&this.audioManager.playSound("jumpLand",.65,!1,this.getTransform())}updateFootstepSounds(e){if(this.isPlayingFootsteps)if(this.currentState===eg.WALKING&&this.impostorMesh.isEnabled()){if(this.timeSinceLastStep+=e,this.timeSinceLastStep>=this.stepInterval){let e;do e=Math.floor(Math.random()*this.footstepSoundNames.length);while(this.footstepSoundNames.length>1&&e===this.lastFootstepIndex);let t=this.footstepSoundNames[e];this.lastFootstepIndex=e,this.audioManager.playSound(t,.55,!1,this.getTransform()),this.timeSinceLastStep-=this.stepInterval}}else this.stopFootstepSounds()}startFootstepSounds(){this.isPlayingFootsteps||(this.isPlayingFootsteps=!0,this.timeSinceLastStep=this.stepInterval,this.lastFootstepIndex=-1)}stopFootstepSounds(){this.isPlayingFootsteps&&(this.isPlayingFootsteps=!1,this.timeSinceLastStep=0,this.lastFootstepIndex=-1)}constructor(e,t,i,s,a){super(e,t,i,s,a),(0,E._)(this,"scene",void 0),(0,E._)(this,"targetPosition",F.P.Zero()),(0,E._)(this,"targetYRotation",0),(0,E._)(this,"previousPosition",new F.P),(0,E._)(this,"currentVelocity",new F.P),(0,E._)(this,"lastUpdateTime",0),(0,E._)(this,"positionInterpolationFactor",.2),(0,E._)(this,"rotationInterpolationFactor",.2),(0,E._)(this,"isPlayingFootsteps",!1),(0,E._)(this,"timeSinceLastStep",0),(0,E._)(this,"stepInterval",.45),(0,E._)(this,"footstepSoundNames",["footstep_wood_01","footstep_wood_02","footstep_wood_03","footstep_wood_04"]),(0,E._)(this,"lastFootstepIndex",-1),(0,E._)(this,"_predictedPositionTemp",new F.P),this.scene=t,this.previousPosition.copyFrom(e.position),this.lastUpdateTime=performance.now(),this.physicsAggregate&&this.physicsAggregate.dispose()}}i(87600),i(68313);class ez{async loadIngredientModels(){let e=0;for(let t in ea){let i=Number(t);if(isNaN(i)||i===et.None)continue;let s=ea[i];if(s&&s.model){let t=this.assetsManager.addMeshTask(`load-${s.name}-model`,"","assets/map/japan/",s.model);e++,t.onSuccess=e=>{let t=e.loadedMeshes[0];t.name=`template_${s.name}`,t.isVisible=!1,t.setEnabled(!1),t.isPickable=!1,t.getChildMeshes().forEach(e=>{e instanceof R.Kj&&(e.isPickable=!1,e.isVisible=!1,e.setEnabled(!1))}),this.ingredientMeshes.set(s.id,t)},t.onError=(e,t,i)=>{console.error(`Error loading model ${s.model} for ${s.name}:`,t,i)}}}return e>0?new Promise((e,t)=>{this.assetsManager.onFinish=()=>{e()},this.assetsManager.onTaskError=e=>{console.error(`Task failed: ${e.name}`),t(Error("Failed to load some ingredient assets."))},this.assetsManager.load()}):(console.warn("No ingredient models to load based on registry."),Promise.resolve())}getIngredientMesh(e){let t=this.ingredientMeshes.get(e);if(!t)return console.warn(`Template mesh for ingredient ${et[e]} not loaded or found.`),null;let i=t.clone(`ingredient_${et[e]}_${Date.now()}`);return i?(i.isVisible=!0,i.setEnabled(!0),i.isPickable=!0,i.getChildMeshes().forEach(e=>{e.isVisible=!0,e.setEnabled(!0),e.isPickable=!0}),i):(console.error(`Failed to clone mesh for ${et[e]}`),null)}dispose(){this.ingredientMeshes.forEach(e=>e.dispose(!1,!0)),this.ingredientMeshes.clear(),this.assetsManager.reset(),console.log("IngredientLoader disposed.")}constructor(e){(0,E._)(this,"assetsManager",void 0),(0,E._)(this,"ingredientMeshes",new Map),this.assetsManager=new U.Sp(e),this.assetsManager.useDefaultLoadingScreen=!1,this.assetsManager.autoHideLoadingUI=!1}}class ej{getCellKey(e){let t=Math.floor(e.x/this.cellSize),i=Math.floor(e.z/this.cellSize);return`${t},${i}`}addObject(e){let t=this.getCellKey(e.mesh.position);this.cells.has(t)||this.cells.set(t,[]),this.cells.get(t).push(e)}clear(){this.cells.clear()}rebuild(e){for(let t of(this.clear(),e))this.addObject(t)}getNearbyObjects(e,t){let i=[],s=Math.ceil(t/this.cellSize),[a,n]=this.getCellKey(e).split(",").map(Number);for(let o=a-s;o<=a+s;o++)for(let a=n-s;a<=n+s;a++){let s=`${o},${a}`,n=this.cells.get(s);if(n)for(let s of n)s.isDisabled()||s.isActive||F.P.Distance(s.mesh.position,e)<=t&&i.push(s)}return i}constructor(e=5){(0,E._)(this,"cells",new Map),(0,E._)(this,"cellSize",void 0),this.cellSize=e}}class eA{handleVisibilityChange(){"visible"===document.visibilityState&&(this.requestFocusAndPointerLock(),this.audioManager.unlock().catch(e=>{console.warn("Failed to unlock audio:",e)}))}handleWindowFocus(){this.requestFocusAndPointerLock(),this.audioManager.unlock().catch(e=>{console.warn("Failed to unlock audio:",e)})}handleCanvasClick(){this.requestFocusAndPointerLock(),this.audioManager.unlock().catch(e=>{console.warn("Failed to unlock audio:",e)})}setupEventListeners(){let e=this.scene.getEngine().getRenderingCanvas();e&&(document.addEventListener("visibilitychange",this.visibilityChangeHandler),window.addEventListener("focus",this.windowFocusHandler),e.addEventListener("click",this.canvasClickHandler))}requestFocusAndPointerLock(){let e=this.scene.getEngine().getRenderingCanvas();e&&(e.focus(),setTimeout(()=>{"visible"===document.visibilityState&&document.hasFocus()&&(e.requestPointerLock().catch(e=>{console.warn("Failed to acquire pointer lock:",e)}),this.audioManager.unlock().catch(e=>{console.warn("Failed to unlock audio:",e)}))},100))}dispose(){let e=this.scene.getEngine().getRenderingCanvas();e&&(document.removeEventListener("visibilitychange",this.visibilityChangeHandler),window.removeEventListener("focus",this.windowFocusHandler),e.removeEventListener("click",this.canvasClickHandler))}constructor(e,t){(0,E._)(this,"scene",void 0),(0,E._)(this,"audioManager",void 0),(0,E._)(this,"visibilityChangeHandler",void 0),(0,E._)(this,"windowFocusHandler",void 0),(0,E._)(this,"canvasClickHandler",void 0),this.scene=e,this.audioManager=t,this.visibilityChangeHandler=this.handleVisibilityChange.bind(this),this.windowFocusHandler=this.handleWindowFocus.bind(this),this.canvasClickHandler=this.handleCanvasClick.bind(this),this.setupEventListeners()}}var eD=i(94396),eO=i(26807),eL=i(87462);class eF{applySettings(){this.setShowFps(eS.getShowFps()),this.setGraphicsQuality(eS.getGraphicsQuality())}setShowFps(e){e&&!this.fpsUI?(this.fpsUI=eO.i.CreateFullscreenUI("PerformanceUI",!0,this.scene,D.x.BILINEAR_SAMPLINGMODE,!0),this.fpsText=new eD.a("fpsText","FPS: 0"),this.fpsText.color="white",this.fpsText.fontSize=20,this.fpsText.textHorizontalAlignment=eL.o.HORIZONTAL_ALIGNMENT_RIGHT,this.fpsText.textVerticalAlignment=eL.o.VERTICAL_ALIGNMENT_BOTTOM,this.fpsText.paddingRight="10px",this.fpsText.paddingBottom="10px",this.fpsUI.addControl(this.fpsText),this.lastPerformanceUpdate=0):!e&&this.fpsUI&&(this.fpsUI.dispose(),this.fpsUI=void 0,this.fpsText=void 0)}setGraphicsQuality(e){let t=this.scene.getEngine();if(this.shadowGenerator){switch(e){case"low":this.shadowGenerator.shadowMaxZ=20,this.shadowGenerator.mapSize=512,this.shadowGenerator.blurKernel=8,this.shadowGenerator.lambda=.9,t.setHardwareScalingLevel(1.6),console.log("Graphics Quality set to LOW");break;case"medium":this.shadowGenerator.shadowMaxZ=30,this.shadowGenerator.mapSize=1024,this.shadowGenerator.blurKernel=16,this.shadowGenerator.lambda=.8,t.setHardwareScalingLevel(1.3),console.log("Graphics Quality set to MEDIUM");break;default:this.shadowGenerator.shadowMaxZ=40,this.shadowGenerator.mapSize=2048,this.shadowGenerator.blurKernel=16,this.shadowGenerator.lambda=.7,t.setHardwareScalingLevel(1),console.log("Graphics Quality set to HIGH")}this.shadowGenerator.usePercentageCloserFiltering=!0,this.shadowGenerator.stabilizeCascades=!0,this.shadowGenerator.cascadeBlendPercentage=.1,this.shadowGenerator.depthClamp=!0,this.shadowGenerator.autoCalcDepthBounds=!0,this.shadowGenerator.bias=.001,this.shadowGenerator.normalBias=.03,this.shadowGenerator.depthScale=50}else switch(e){case"low":t.setHardwareScalingLevel(2),console.log("Graphics Quality set to LOW (No Shadows)");break;case"medium":t.setHardwareScalingLevel(1.5),console.log("Graphics Quality set to MEDIUM (No Shadows)");break;default:t.setHardwareScalingLevel(1),console.log("Graphics Quality set to HIGH (No Shadows)")}}update(){if(this.fpsText){let e=Date.now();if(e-this.lastPerformanceUpdate>this.PERFORMANCE_UPDATE_INTERVAL){let t=this.scene.getEngine().getFps().toFixed();this.fpsText.text=`FPS: ${t}`,this.lastPerformanceUpdate=e}}}dispose(){this.fpsUI&&(this.fpsUI.dispose(),this.fpsUI=void 0,this.fpsText=void 0),console.log("PerformanceManager disposed.")}constructor(e,t){(0,E._)(this,"scene",void 0),(0,E._)(this,"shadowGenerator",void 0),(0,E._)(this,"fpsText",void 0),(0,E._)(this,"fpsUI",void 0),(0,E._)(this,"lastPerformanceUpdate",0),(0,E._)(this,"PERFORMANCE_UPDATE_INTERVAL",1e3),this.scene=e,this.shadowGenerator=t,this.applySettings()}}var eR=i(55415),eB=i(74038);class eU{async initialize(){try{this.audioEngine=await (0,eR.I)(),this.applyVolumesToLoadedSounds()}catch(e){console.error("AudioManager: Failed to create Audio Engine.",e),this.audioEngine=null}}async unlock(){if(!this.audioEngine)return void console.warn("AudioManager: Cannot unlock, Audio Engine not initialized.");if(!this.isUnlocked)try{await this.audioEngine.unlockAsync(),this.isUnlocked=!0}catch(e){console.error("AudioManager: Failed to unlock Audio Engine.",e),this.isUnlocked=!1}}loadSounds(e,t,i){if(!this.audioEngine){console.error("AudioManager: Cannot load sounds, Audio Engine not initialized. Call initialize() first."),null==i||i();return}this.isReady=!1;let s=e.length,a=0;if(0===s){this.isReady=!0,null==i||i();return}e.forEach(e=>{this.soundsConfig.set(e.name,e);let n=this.assetsManager.addBinaryFileTask(`load_sound_${e.name}`,e.path);n.onSuccess=async n=>{try{var o,r,l,c,d,h,m;let t=await (0,eB.HB)(e.name,n.data,{loop:(null==(o=e.options)?void 0:o.loop)??!1,autoplay:(null==(r=e.options)?void 0:r.autoplay)??!1,volume:(null==(l=e.options)?void 0:l.volume)??1,spatialEnabled:(null==(c=e.options)?void 0:c.spatialSound)??!1,spatialMaxDistance:(null==(d=e.options)?void 0:d.maxDistance)??100,spatialRolloffFactor:(null==(h=e.options)?void 0:h.rolloffFactor)??1,spatialDistanceModel:(null==(m=e.options)?void 0:m.distanceModel)??"linear"});this.staticSounds.set(e.name,t),this.applyVolumeToSound(t,e)}catch(t){console.error(`Error creating sound ${e.name}:`,t)}finally{a++,null==t||t(s-a,s),a===s&&(this.isReady=!0,console.log("AudioManager: All sound files attempted to load."),null==i||i())}},n.onError=(n,o,r)=>{console.error(`Error loading sound file ${e.path} for ${e.name}:`,o,r),a++,null==t||t(s-a,s),a===s&&(this.isReady=!0,console.warn("AudioManager: Finished loading sounds, but some failed."),null==i||i())}}),this.assetsManager.load()}applyVolumeToSound(e,t){var i;e.volume=((null==(i=t.options)?void 0:i.volume)??1)*(t.isMusic?this.musicVolume:this.sfxVolume)*this.masterVolume}applyVolumesToLoadedSounds(){this.masterVolume=eS.getMasterVolume(),this.staticSounds.forEach((e,t)=>{let i=this.soundsConfig.get(t);i&&this.applyVolumeToSound(e,i)})}setMasterVolume(e){this.masterVolume=Math.max(0,Math.min(e,1)),this.applyVolumesToLoadedSounds()}setMusicVolume(e){this.musicVolume=Math.max(0,Math.min(e,1)),this.staticSounds.forEach((e,t)=>{let i=this.soundsConfig.get(t);(null==i?void 0:i.isMusic)&&this.applyVolumeToSound(e,i)})}setSfxVolume(e){this.sfxVolume=Math.max(0,Math.min(e,1)),this.staticSounds.forEach((e,t)=>{let i=this.soundsConfig.get(t);i&&!i.isMusic&&this.applyVolumeToSound(e,i)})}playSound(e){var t,i,s;let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2?arguments[2]:void 0,o=arguments.length>3?arguments[3]:void 0;if(!this.isReady||!this.isUnlocked)return;let r=this.staticSounds.get(e),l=this.soundsConfig.get(e);if(!r||!l)return void console.warn(`Sound not found: ${e}`);r.volume=((null==(t=l.options)?void 0:t.volume)??1)*(l.isMusic?this.musicVolume:this.sfxVolume)*this.masterVolume*a,void 0!==n?r.loop=n:r.loop=(null==(s=l.options)?void 0:s.loop)??!1,(null==(i=l.options)?void 0:i.spatialSound)&&o&&r.spatial.attach(o),r.play()}stopSound(e){if(!this.isReady)return;let t=this.staticSounds.get(e);null==t||t.stop()}dispose(){var e;this.staticSounds.forEach(e=>{e.stop(),e.dispose()}),this.staticSounds.clear(),this.soundsConfig.clear(),this.assetsManager.reset(),null==(e=this.audioEngine)||e.dispose(),this.audioEngine=null,this.isReady=!1,this.isUnlocked=!1,console.log("AudioManager disposed.")}constructor(e){(0,E._)(this,"assetsManager",void 0),(0,E._)(this,"staticSounds",new Map),(0,E._)(this,"soundsConfig",new Map),(0,E._)(this,"masterVolume",eS.getMasterVolume()),(0,E._)(this,"musicVolume",eS.getMusicVolume()),(0,E._)(this,"sfxVolume",eS.getSfxVolume()),(0,E._)(this,"isReady",!1),(0,E._)(this,"isUnlocked",!1),(0,E._)(this,"audioEngine",null),this.assetsManager=new U.Sp(e),this.assetsManager.useDefaultLoadingScreen=!1,this.assetsManager.autoHideLoadingUI=!1}}var eV=i(51425);let eG={onigiri_recipe:{id:"onigiri_recipe",name:"Onigiri",result:{ingredient:et.Onigiri,quantity:1},requiredIngredients:[{ingredient:et.CookedRice,quantity:1},{ingredient:et.Nori,quantity:1}],stationType:ee.ChoppingBoard,scoreValue:100,forServing:!0},cooked_rice_recipe:{id:"cooked_rice_recipe",name:"Cooked Rice",result:{ingredient:et.CookedRice,quantity:1},requiredIngredients:[{ingredient:et.Rice,quantity:1}],stationType:ee.Oven,processingTime:5e3},ebi_nigiri_recipe:{id:"ebi_nigiri_recipe",name:"Ebi Nigiri",result:{ingredient:et.EbiNigiri,quantity:1},requiredIngredients:[{ingredient:et.CookedRice,quantity:1},{ingredient:et.Ebi,quantity:1}],stationType:ee.ChoppingBoard,scoreValue:150,forServing:!0,upgradesFrom:"onigiri_recipe"},salmon_nigiri_recipe:{id:"salmon_nigiri_recipe",name:"Salmon Nigiri",result:{ingredient:et.SalmonNigiri,quantity:2},requiredIngredients:[{ingredient:et.CookedRice,quantity:1},{ingredient:et.Salmon,quantity:1},{ingredient:et.Nori,quantity:1}],stationType:ee.ChoppingBoard,scoreValue:150,forServing:!0,upgradesFrom:"onigiri_recipe"},sea_urchin_recipe:{id:"sea_urchin_recipe",name:"Sea Urchin",result:{ingredient:et.SeaUrchinOpen,quantity:1},requiredIngredients:[{ingredient:et.SeaUrchin,quantity:1}],stationType:ee.ChoppingBoard,scoreValue:100},sea_urchin_roll_recipe:{id:"sea_urchin_roll_recipe",name:"Sea Urchin Roll",result:{ingredient:et.SeaUrchinRoll,quantity:1},requiredIngredients:[{ingredient:et.CookedRice,quantity:1},{ingredient:et.SeaUrchinOpen,quantity:1},{ingredient:et.Nori,quantity:1}],stationType:ee.ChoppingBoard,scoreValue:200,forServing:!0,upgradesFrom:"onigiri_recipe"}};function e$(e){if(e!==et.None)for(let t in eG){let i=eG[t];if(i.result.ingredient===e)return i}}var eH=i(58805);let eK=(0,i(777).U)(e=>({mode:"menu",roomToJoin:void 0,setMode:t=>e({mode:t}),setRoomToJoin:t=>e({roomToJoin:t}),inGameSettingsVisible:!1,setInGameSettingsVisible:t=>e({inGameSettingsVisible:t}),username:eS.getUsername(),setUsername:t=>{let i=t.trim().slice(0,16);i?(eS.setUsername(i),e({username:i})):(console.warn("Attempted to set an empty username."),e({username:eS.getUsername()}))}})),eW=function(e){for(let t of e)eT.parse(t);return e}(function(e){let t={};for(let i of e)for(let e of i.instances)if(e.interaction??i.interaction){if(i.interaction&&!e.interaction&&(e.interaction={...i.interaction}),!e.interaction)continue;let s=e.interaction.interactType,a=e.interaction.ingredient??et.None,n=`${s}_${a}`;t[n]||(t[n]=0),e.interaction.id=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:et.None,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return(e+1)*1e6+1e3*t+Math.min(Math.max(i,0),999)}(s,a,t[n]),t[n]++}let i=eI(e);for(let t of e)t.hash=i;return e}([{map:"japan",fileName:"Table.glb",defaultScaling:{x:.5,y:.5,z:.5},defaultPhysics:{shapeType:eu.Bq.BOX,mass:0,friction:.8,restitution:.1},instances:[{position:{x:5,y:3.5,z:-5},rotation:{y:Math.PI},scaling:{x:1,y:.5,z:1}},{position:{x:-5,y:3.5,z:-5},rotation:{y:Math.PI},scaling:{x:1,y:.5,z:1}},{position:{x:0,y:2,z:-2},rotation:{y:Math.PI/2},scaling:{x:2.5,y:.5,z:.75}},{position:{x:-8,y:0,z:-8},rotation:{y:Math.PI},scaling:{x:.75,y:.5,z:.75}},{position:{x:8,y:0,z:-8},rotation:{y:Math.PI},scaling:{x:.75,y:.5,z:.75}},{position:{x:0,y:0,z:-7.85},rotation:{y:Math.PI},scaling:{x:1,y:.5,z:1}},{position:{x:-8,y:0,z:8},rotation:{y:Math.PI},scaling:{x:.75,y:.5,z:.75}},{position:{x:8,y:0,z:8},rotation:{y:Math.PI},scaling:{x:.75,y:.5,z:.75}},{position:{x:-7.85,y:0,z:0},rotation:{y:Math.PI},scaling:{x:1,y:.5,z:1}},{position:{x:7.85,y:0,z:0},rotation:{y:Math.PI},scaling:{x:1,y:.5,z:1}}]},{map:"japan",fileName:"cloud1.glb",defaultScaling:{x:.2,y:.2,z:.2},defaultPhysics:{shapeType:eu.Bq.BOX,mass:0,friction:.8,restitution:.1},instances:[{position:{x:5.95,y:3.5,z:-4.2},scaling:{x:.1,y:.1,z:.1}},{position:{x:4.07,y:3.5,z:-4.2},scaling:{x:.1,y:.1,z:.1}},{position:{x:5.95,y:3.5,z:-5.95},scaling:{x:.1,y:.1,z:.1}},{position:{x:4.07,y:3.5,z:-5.85},scaling:{x:.1,y:.1,z:.1}},{position:{x:-2.2,y:2,z:-1.3},scaling:{x:.2,y:.1,z:.1}},{position:{x:2.1,y:2,z:-1.3},scaling:{x:.2,y:.1,z:.1}},{position:{x:-2.2,y:2,z:-2.7},scaling:{x:.2,y:.1,z:.1}},{position:{x:2.1,y:2,z:-2.7},scaling:{x:.2,y:.1,z:.1}},{position:{x:-5.95,y:3.5,z:-4.2},scaling:{x:.1,y:.1,z:.1}},{position:{x:-4.07,y:3.5,z:-4.2},scaling:{x:.1,y:.1,z:.1}},{position:{x:-5.95,y:3.5,z:-5.95},scaling:{x:.1,y:.1,z:.1}},{position:{x:-4.07,y:3.5,z:-5.85},scaling:{x:.1,y:.1,z:.1}}]},{map:"japan",fileName:"cloud1.glb",defaultScaling:{x:.2,y:.2,z:.2},defaultPhysics:{shapeType:eu.Bq.BOX,mass:0,friction:.8,restitution:.1},interaction:{interactType:ee.ServingOrder},instances:[{position:{x:8,y:.4,z:-6.8},rotation:{y:Math.PI}},{position:{x:6.8,y:.4,z:-8},rotation:{y:Math.PI/2}},{position:{x:-6.8,y:.4,z:-8},rotation:{y:-Math.PI/2}},{position:{x:-8,y:.4,z:-6.8},rotation:{y:Math.PI}},{position:{x:5,y:3.9,z:-3.5},rotation:{y:Math.PI}},{position:{x:5,y:3.9,z:-6.5}},{position:{x:3.5,y:3.9,z:-5},rotation:{y:Math.PI/2}},{position:{x:6.5,y:3.9,z:-5},rotation:{y:-Math.PI/2}},{position:{x:-5,y:3.9,z:-3.5},rotation:{y:Math.PI}},{position:{x:-5,y:3.9,z:-6.5}},{position:{x:-3.5,y:3.9,z:-5},rotation:{y:-Math.PI/2}},{position:{x:-6.5,y:3.9,z:-5},rotation:{y:Math.PI/2}},{position:{x:0,y:2.4,z:-.75},rotation:{y:Math.PI}},{position:{x:0,y:2.4,z:-3.2}},{position:{x:-1.5,y:2.4,z:-.75},rotation:{y:Math.PI}},{position:{x:-1.5,y:2.4,z:-3.2}},{position:{x:1.5,y:2.4,z:-.75},rotation:{y:Math.PI}},{position:{x:1.5,y:2.4,z:-3.2}},{position:{x:8,y:.4,z:6.8}},{position:{x:6.8,y:.4,z:8},rotation:{y:Math.PI/2}},{position:{x:-6.8,y:.4,z:8},rotation:{y:-Math.PI/2}},{position:{x:-8,y:.4,z:6.8}},{position:{x:-7.8,y:.4,z:1.35},rotation:{y:-Math.PI}},{position:{x:-6.5,y:.4,z:0},rotation:{y:-Math.PI/2}},{position:{x:-7.8,y:.4,z:-1.35}},{position:{x:7.8,y:.4,z:1.35},rotation:{y:Math.PI}},{position:{x:6.5,y:.4,z:0},rotation:{y:Math.PI/2}},{position:{x:7.8,y:.4,z:-1.35}},{position:{x:1.35,y:.4,z:-7.8},rotation:{y:-Math.PI/2}},{position:{x:0,y:.4,z:-6.5},rotation:{y:Math.PI}},{position:{x:-1.35,y:.4,z:-7.8},rotation:{y:Math.PI/2}}]},{map:"japan",fileName:"Shoji Wall.glb",defaultScaling:{x:.5,y:.5,z:.5},defaultPhysics:{shapeType:eu.Bq.BOX,mass:0,friction:.8,restitution:.1},instances:[{position:{x:-8,y:.1,z:8}},{position:{x:-8,y:.1,z:8},rotation:{y:-Math.PI/2}},{position:{x:8,y:.1,z:8}},{position:{x:8,y:.1,z:8},rotation:{y:Math.PI/2}},{position:{x:8,y:.1,z:-8},rotation:{y:Math.PI/2}},{position:{x:8,y:.1,z:-8},rotation:{y:-Math.PI}},{position:{x:-8,y:.1,z:-8},rotation:{y:Math.PI}},{position:{x:-8,y:.1,z:-8},rotation:{y:-Math.PI/2}},{position:{x:0,y:.1,z:8}},{position:{x:0,y:.1,z:-8},rotation:{y:Math.PI}},{position:{x:-8,y:.1,z:0},rotation:{y:-Math.PI/2}},{position:{x:8,y:.1,z:0},rotation:{y:Math.PI/2}}]},{map:"japan",fileName:"Normal Wall.glb",defaultScaling:{x:.5,y:.5,z:.5},defaultPhysics:{shapeType:eu.Bq.BOX,mass:0,friction:.8,restitution:.1},instances:[{position:{x:2,y:.1,z:8}},{position:{x:6,y:.1,z:8}},{position:{x:-2,y:.1,z:8}},{position:{x:-6,y:.1,z:8}},{position:{x:4,y:.1,z:8}},{position:{x:-4,y:.1,z:8}},{position:{x:2,y:.1,z:-8},rotation:{y:Math.PI}},{position:{x:6,y:.1,z:-8},rotation:{y:Math.PI}},{position:{x:-2,y:.1,z:-8},rotation:{y:Math.PI}},{position:{x:-6,y:.1,z:-8},rotation:{y:Math.PI}},{position:{x:-8,y:.1,z:2},rotation:{y:-Math.PI/2}},{position:{x:-8,y:.1,z:6},rotation:{y:-Math.PI/2}},{position:{x:-8,y:.1,z:-2},rotation:{y:-Math.PI/2}},{position:{x:-8,y:.1,z:-6},rotation:{y:-Math.PI/2}},{position:{x:8,y:.1,z:2},rotation:{y:Math.PI/2}},{position:{x:8,y:.1,z:6},rotation:{y:Math.PI/2}},{position:{x:8,y:.1,z:-2},rotation:{y:Math.PI/2}},{position:{x:8,y:.1,z:-6},rotation:{y:Math.PI/2}}]},{map:"japan",fileName:"Wall with Shelves.glb",defaultScaling:{x:.5,y:.5,z:.5},defaultPhysics:{shapeType:eu.Bq.BOX,mass:0,friction:.8,restitution:.1},instances:[{position:{x:4,y:.1,z:-8},rotation:{y:Math.PI}},{position:{x:-4,y:.1,z:-8},rotation:{y:Math.PI}},{position:{x:-8,y:.1,z:4},rotation:{y:-Math.PI/2}},{position:{x:-8,y:.1,z:-4},rotation:{y:-Math.PI/2}},{position:{x:8,y:.1,z:4},rotation:{y:Math.PI/2}},{position:{x:8,y:.1,z:-4},rotation:{y:Math.PI/2}}]},{map:"japan",fileName:"Fridge.glb",defaultScaling:{x:.5,y:.5,z:.5},defaultPhysics:{shapeType:eu.Bq.BOX,mass:0,friction:.8,restitution:.1},billboardOffset:{x:0,y:1,z:-.8},instances:[{position:{x:3,y:.15,z:8.6}},{position:{x:-3,y:.15,z:8.6}}]},{map:"japan",fileName:"Oven.glb",defaultScaling:{x:.375,y:.3,z:.5},defaultPhysics:{shapeType:eu.Bq.BOX,mass:0,friction:.8,restitution:.1},billboardOffset:{x:0,y:1.5,z:0},instances:[{interaction:{interactType:ee.Oven},position:{x:-2,y:.1,z:8.57}},{interaction:{interactType:ee.Oven},position:{x:2,y:.1,z:8.57}}]},{map:"japan",fileName:"Cupcake.glb",defaultScaling:{x:.65,y:.65,z:.65},instances:[{position:{x:0,y:.67,z:2},rotation:{y:Math.PI}},{position:{x:4,y:.67,z:6.5},rotation:{y:Math.PI}},{position:{x:-4,y:.67,z:6.5},rotation:{y:Math.PI}},{position:{x:1.25,y:.67,z:8.5},rotation:{y:Math.PI}},{position:{x:-1.25,y:.67,z:8.5},rotation:{y:Math.PI}},{position:{x:3.1,y:.67,z:2},rotation:{y:Math.PI}},{position:{x:-3.1,y:.67,z:2},rotation:{y:Math.PI}},{position:{x:4,y:.67,z:2.8},rotation:{y:Math.PI}},{position:{x:-4,y:.67,z:2.8},rotation:{y:Math.PI}},{position:{x:4,y:.67,z:8.25},rotation:{y:Math.PI}},{position:{x:-4,y:.67,z:8.25},rotation:{y:Math.PI}}]},{map:"japan",fileName:"Lollipop 2.glb",defaultScaling:{x:.024,y:.024,z:.024},instances:[{position:{x:0,y:2.7,z:9},rotation:{x:-Math.PI/2}},{position:{x:0,y:2.7,z:-9},rotation:{x:-Math.PI/2}},{position:{x:9,y:2.7,z:0},rotation:{x:-Math.PI/2}},{position:{x:-9,y:2.7,z:0},rotation:{x:-Math.PI/2}}]},{map:"japan",fileName:"Dango.glb",defaultScaling:{x:1.75,y:1.75,z:1.75},instances:[{position:{x:1.875,y:3.25,z:9},rotation:{z:Math.PI/2}},{position:{x:-1.875,y:3.25,z:9},rotation:{z:Math.PI/2}},{position:{x:1.875,y:3.25,z:-9},rotation:{z:Math.PI/2}},{position:{x:-1.875,y:3.25,z:-9},rotation:{z:Math.PI/2}},{position:{x:9,y:3.25,z:1.875},rotation:{z:Math.PI/2}},{position:{x:9,y:3.25,z:-1.875},rotation:{z:Math.PI/2}},{position:{x:-9,y:3.25,z:1.875},rotation:{z:Math.PI/2}},{position:{x:-9,y:3.25,z:-1.875},rotation:{z:Math.PI/2}},{position:{x:5.625,y:3.25,z:9},rotation:{z:Math.PI/2}},{position:{x:-5.625,y:3.25,z:9},rotation:{z:Math.PI/2}},{position:{x:5.625,y:3.25,z:-9},rotation:{z:Math.PI/2}},{position:{x:-5.625,y:3.25,z:-9},rotation:{z:Math.PI/2}},{position:{x:9,y:3.25,z:5.625},rotation:{z:Math.PI/2}},{position:{x:9,y:3.25,z:-5.625},rotation:{z:Math.PI/2}},{position:{x:-9,y:3.25,z:5.625},rotation:{z:Math.PI/2}},{position:{x:-9,y:3.25,z:-5.625},rotation:{z:Math.PI/2}},{position:{x:9,y:3.25,z:9},rotation:{z:Math.PI/2}},{position:{x:9,y:3.25,z:-9},rotation:{z:Math.PI/2}},{position:{x:-9,y:3.25,z:-9},rotation:{z:Math.PI/2}},{position:{x:-9,y:3.25,z:9},rotation:{z:Math.PI/2}}]},{map:"japan",fileName:"Platform.glb",defaultScaling:{x:.5,y:.5,z:.5},defaultPhysics:{shapeType:eu.Bq.BOX,mass:0,friction:.8,restitution:.1},instances:[{position:{x:6,y:1.9,z:2.75},rotation:{y:Math.PI/2}},{position:{x:-6,y:1.9,z:2.75},rotation:{y:Math.PI/2}},{position:{x:4.3,y:1.9,z:.75},rotation:{y:Math.PI/2}},{position:{x:-4.3,y:1.9,z:.75},rotation:{y:Math.PI/2}},{position:{x:5,y:3.8,z:0},rotation:{y:Math.PI/2}},{position:{x:-5,y:3.8,z:0},rotation:{y:Math.PI/2}},{position:{x:5,y:3.8,z:-1.5},rotation:{y:Math.PI/2}},{position:{x:-5,y:3.8,z:-1.5},rotation:{y:Math.PI/2}},{position:{x:6.4,y:3.8,z:-2.6},rotation:{y:Math.PI/2}},{position:{x:-6.4,y:3.8,z:-2.6},rotation:{y:Math.PI/2}},{position:{x:3.7,y:3.8,z:-2.6},rotation:{y:Math.PI/2}},{position:{x:-3.7,y:3.8,z:-2.6},rotation:{y:Math.PI/2}},{position:{x:2.1,y:3.8,z:-5.8},rotation:{y:Math.PI/2}},{position:{x:-2.1,y:3.8,z:-5.8},rotation:{y:Math.PI/2}},{position:{x:2.1,y:1,z:-5.5},rotation:{y:Math.PI/2}},{position:{x:-2.1,y:1,z:-5.5},rotation:{y:Math.PI/2}}]},{map:"japan",fileName:"Grass Platform.glb",defaultScaling:{x:2,y:2,z:2},defaultPhysics:{shapeType:eu.Bq.BOX,mass:0,friction:.8,restitution:.1},instances:[{position:{x:7,y:.75,z:4},rotation:{y:Math.PI/2}},{position:{x:-7,y:.75,z:4},rotation:{y:Math.PI/2}},{position:{x:5.8,y:2.5,z:1.25},rotation:{y:Math.PI/2}},{position:{x:-5.8,y:2.5,z:1.25},rotation:{y:Math.PI/2}},{position:{x:2.65,y:1.6,z:.25},rotation:{y:Math.PI/2}},{position:{x:-2.65,y:1.6,z:.25},rotation:{y:Math.PI}},{position:{x:-.9,y:1.6,z:.25},rotation:{y:Math.PI/2}},{position:{x:.9,y:1.6,z:.25},rotation:{y:Math.PI/2}},{position:{x:7.7,y:3.5,z:-4},rotation:{y:Math.PI/2}},{position:{x:-7.7,y:3.5,z:-4},rotation:{y:Math.PI/2}},{position:{x:2.3,y:3.5,z:-4},rotation:{y:Math.PI/2}},{position:{x:-2.3,y:3.5,z:-4},rotation:{y:Math.PI/2}},{position:{x:.85,y:1.6,z:-4},rotation:{y:Math.PI/2}},{position:{x:-.85,y:1.6,z:-4},rotation:{y:Math.PI/2}},{position:{x:3.3,y:3.5,z:-7.3},rotation:{y:Math.PI/2}},{position:{x:-3.3,y:3.5,z:-7.3},rotation:{y:Math.PI/2}},{position:{x:0,y:2.5,z:-7.3},rotation:{y:Math.PI/2}},{position:{x:0,y:2.5,z:-5.5},rotation:{y:Math.PI/2}}]},{map:"japan",fileName:"Donut.glb",defaultScaling:{x:1,y:1,z:1},instances:[{position:{x:4,y:.6,z:2}},{position:{x:-4,y:.6,z:2}}]},{map:"japan",fileName:"Candy cane.glb",defaultScaling:{x:.03,y:.05,z:.035},instances:[{position:{x:4,y:0,z:3.9},rotation:{y:-Math.PI/2}},{position:{x:4,y:0,z:4.61},rotation:{y:Math.PI/2}},{position:{x:-4,y:0,z:3.9},rotation:{y:-Math.PI/2}},{position:{x:-4,y:0,z:4.61},rotation:{y:Math.PI/2}}]},{map:"japan",fileName:"Lollipop.glb",defaultScaling:{x:.25,y:.25,z:.25},instances:[{position:{x:7.5,y:2.7,z:9},rotation:{y:Math.PI/2},scaling:{x:.2,y:.2,z:.2}},{position:{x:3.75,y:2.7,z:9},rotation:{y:Math.PI/2}},{position:{x:-7.5,y:2.7,z:9},rotation:{y:Math.PI/2}},{position:{x:-3.75,y:2.7,z:9},rotation:{y:Math.PI/2},scaling:{x:.2,y:.2,z:.2}},{position:{x:3.75,y:2.7,z:-9},rotation:{y:Math.PI/2},scaling:{x:.2,y:.2,z:.2}},{position:{x:7.5,y:2.7,z:-9},rotation:{y:Math.PI/2}},{position:{x:-3.75,y:2.7,z:-9},rotation:{y:Math.PI/2}},{position:{x:-7.5,y:2.7,z:-9},rotation:{y:Math.PI/2},scaling:{x:.2,y:.2,z:.2}},{position:{x:9,y:2.7,z:3.75},rotation:{y:Math.PI},scaling:{x:.2,y:.2,z:.2}},{position:{x:9,y:2.7,z:7.5},rotation:{y:Math.PI}},{position:{x:9,y:2.7,z:-3.75},rotation:{y:Math.PI}},{position:{x:9,y:2.7,z:-7.75},rotation:{y:Math.PI},scaling:{x:.2,y:.2,z:.2}},{position:{x:-9,y:2.7,z:7.5},rotation:{y:Math.PI},scaling:{x:.2,y:.2,z:.2}},{position:{x:-9,y:2.7,z:3.75},rotation:{y:Math.PI}},{position:{x:-9,y:2.7,z:-7.5},rotation:{y:Math.PI}},{position:{x:-9,y:2.7,z:-3.75},rotation:{y:Math.PI},scaling:{x:.2,y:.2,z:.2}}]},{map:"japan",fileName:"Nori.glb",defaultScaling:{x:.4,y:.4,z:.4},defaultPhysics:{shapeType:eu.Bq.BOX,mass:0,friction:.8,restitution:.1},billboardOffset:{x:0,y:.5,z:0},instances:[{position:{x:-1.05,y:.72,z:4.65},rotation:{x:0,y:0,z:0}},{interaction:{interactType:ee.Stock,ingredient:et.Nori},position:{x:-1.05,y:.77,z:4.75},rotation:{x:0,y:0,z:0}},{position:{x:-1.05,y:.72,z:4.85},rotation:{x:0,y:0,z:0}}]},{map:"japan",fileName:"Rice Ball.glb",defaultScaling:{x:.4,y:.4,z:.4},defaultPhysics:{shapeType:eu.Bq.BOX,mass:0,friction:.8,restitution:.1},billboardOffset:{x:0,y:.5,z:0},instances:[{interaction:{interactType:ee.Stock,ingredient:et.Rice},position:{x:1.05,y:.77,z:4.75},rotation:{x:0,y:0,z:0}}]},{map:"japan",fileName:"Plate.glb",defaultScaling:{x:.7,y:.35,z:.7},defaultPhysics:{shapeType:eu.Bq.BOX,mass:0,friction:.8,restitution:.1},billboardOffset:{x:0,y:.5,z:0},instances:[{position:{x:0,y:.67,z:4.75},rotation:{x:0,y:0,z:0}},{position:{x:0,y:.71,z:4.75},rotation:{x:0,y:0,z:0}},{position:{x:0,y:.75,z:4.75},rotation:{x:0,y:0,z:0}},{position:{x:0,y:.79,z:4.75},rotation:{x:0,y:0,z:0}},{interaction:{interactType:ee.Stock,ingredient:et.Plate},position:{x:0,y:.83,z:4.75},rotation:{x:0,y:0,z:0}}]},{map:"japan",fileName:"Chopping board.glb",defaultScaling:{x:.4,y:.4,z:.4},defaultPhysics:{shapeType:eu.Bq.BOX,mass:0,friction:.8,restitution:.1},billboardOffset:{x:0,y:.5,z:0},instances:[{position:{x:.5,y:.67,z:8.5},rotation:{x:0,y:0,z:0},interaction:{interactType:ee.ChoppingBoard}},{position:{x:-.5,y:.67,z:8.5},rotation:{x:0,y:0,z:0},interaction:{interactType:ee.ChoppingBoard}}]},{map:"japan",fileName:"Counter Straight.glb",defaultScaling:{x:.5,y:.3,z:.5},defaultPhysics:{shapeType:eu.Bq.BOX,mass:0,friction:.8,restitution:.1},instances:[{position:{x:0,y:.1,z:2},rotation:{y:Math.PI}},{position:{x:4,y:.1,z:6},rotation:{y:Math.PI/2}},{position:{x:4,y:.1,z:8},rotation:{y:Math.PI/2}},{position:{x:4,y:.1,z:3},rotation:{y:Math.PI/2},scaling:{x:.5,y:.3,z:.25}},{position:{x:-4,y:.1,z:6},rotation:{y:-Math.PI/2}},{position:{x:-4,y:.1,z:8},rotation:{y:-Math.PI/2}},{position:{x:-4,y:.1,z:3},rotation:{y:-Math.PI/2},scaling:{x:.5,y:.3,z:.25}},{position:{x:0,y:.1,z:8.6},rotation:{y:Math.PI},scaling:{x:.8,y:.3,z:.6}},{position:{x:0,y:.1,z:5.25},scaling:{x:.9,y:.3,z:1.25}}]},{map:"japan",fileName:"Counter Corner.glb",defaultScaling:{x:.5,y:.3,z:.5},defaultPhysics:{shapeType:eu.Bq.MESH,mass:0,friction:.8,restitution:.1},instances:[{position:{x:4,y:.1,z:2},rotation:{y:Math.PI/2}},{position:{x:-4,y:.1,z:2},rotation:{y:Math.PI}}]},{map:"japan",fileName:"Counter Sink.glb",defaultScaling:{x:.5,y:.3,z:.5},defaultPhysics:{shapeType:eu.Bq.MESH,mass:0,friction:.8,restitution:.1},billboardOffset:{x:0,y:1.5,z:0},instances:[{position:{x:-2,y:.1,z:2},rotation:{y:Math.PI},interaction:{interactType:ee.Trash}},{position:{x:2,y:.1,z:2},rotation:{y:Math.PI},interaction:{interactType:ee.Trash}}]},{map:"fastfood",fileName:"Crate.glb",defaultScaling:{x:.35,y:.3,z:.35},defaultPhysics:{shapeType:eu.Bq.MESH,mass:0,friction:.8,restitution:.1},instances:[{position:{x:1.05,y:.67,z:4.75},rotation:{y:Math.PI}},{position:{x:-1.05,y:.67,z:4.75},rotation:{y:Math.PI}},{position:{x:-1.05,y:.67,z:5.75},rotation:{y:Math.PI}},{position:{x:0,y:.67,z:5.75},rotation:{y:Math.PI}},{position:{x:1.05,y:.67,z:5.75},rotation:{y:Math.PI}}]},{map:"fastfood",fileName:"Pot A.glb",defaultScaling:{x:.5,y:.7,z:.5},defaultPhysics:{shapeType:eu.Bq.MESH,mass:0,friction:.8,restitution:.1},instances:[{position:{x:2,y:.77,z:8.4},rotation:{y:Math.PI}},{position:{x:-2,y:.77,z:8.4},rotation:{y:Math.PI}}]},{map:"japan",fileName:"Salmon.glb",defaultScaling:{x:.65,y:.5,z:.6},defaultPhysics:{shapeType:eu.Bq.MESH,mass:0,friction:.8,restitution:.1},billboardOffset:{x:0,y:.5,z:0},instances:[{position:{x:.05,y:.67,z:5.77},rotation:{y:Math.PI},interaction:{interactType:ee.Stock,ingredient:et.Salmon}}]},{map:"japan",fileName:"Sea Urchin.glb",defaultScaling:{x:.35,y:.35,z:.35},defaultPhysics:{shapeType:eu.Bq.MESH,mass:0,friction:.8,restitution:.1},billboardOffset:{x:0,y:.5,z:0},instances:[{position:{x:1.17,y:.77,z:5.85},rotation:{y:Math.PI}},{position:{x:.93,y:.77,z:5.85},rotation:{y:Math.PI}},{position:{x:1.05,y:.77,z:5.66},rotation:{y:Math.PI},interaction:{interactType:ee.Stock,ingredient:et.SeaUrchin}}]},{map:"japan",fileName:"Ebi.glb",defaultScaling:{x:.75,y:.75,z:.75},defaultPhysics:{shapeType:eu.Bq.MESH,mass:0,friction:.8,restitution:.1},billboardOffset:{x:0,y:.5,z:0},instances:[{position:{x:-1.17,y:.67,z:5.85},rotation:{y:Math.PI}},{position:{x:-.93,y:.67,z:5.85},rotation:{y:Math.PI}},{position:{x:-1.05,y:.67,z:5.66},rotation:{y:Math.PI},interaction:{interactType:ee.Stock,ingredient:et.Ebi}}]},{map:"japan",fileName:"Board.glb",defaultScaling:{x:.15,y:.05,z:.25},defaultPhysics:{shapeType:eu.Bq.MESH,mass:0,friction:.8,restitution:.1},billboardOffset:{x:0,y:.5,z:0},interaction:{interactType:ee.ServingBoard},instances:[{position:{x:-4,y:.67,z:5.85},rotation:{y:Math.PI}},{position:{x:4,y:.67,z:5.85},rotation:{x:Math.PI}},{position:{x:-4,y:.67,z:7.15},rotation:{y:-Math.PI}},{position:{x:4,y:.67,z:7.15},rotation:{x:-Math.PI}},{position:{x:-.65,y:.67,z:2},scaling:{x:.25,y:.05,z:.15},rotation:{y:Math.PI/2}},{position:{x:.65,y:.67,z:2},scaling:{x:.25,y:.05,z:.15},rotation:{y:Math.PI/2}}]},{map:"japan",fileName:"Wood Floor.glb",defaultScaling:{x:.5,y:.5,z:.5},defaultPhysics:{shapeType:eu.Bq.BOX,mass:0,friction:.8,restitution:.1},instances:(()=>{let e=[];for(let t=-4;t<5;t++)for(let i=-4;i<5;i++)e.push({position:{x:2*t,y:.1,z:2*i}});return e})()}]));class eq{setupPointerLockListener(){document.addEventListener("pointerlockchange",this._boundPointerLockChangeListener,!1)}handlePointerLockChange(){let e=this.scene.getEngine().getRenderingCanvas(),t=eK.getState().inGameSettingsVisible;if(document.pointerLockElement)document.pointerLockElement===e&&t&&(eK.getState().setInGameSettingsVisible(!1),this.setPaused(!1));else{let i=document.activeElement===e||document.activeElement===document.body;!t&&i?(eK.getState().setInGameSettingsVisible(!0),this.setPaused(!0)):t&&i&&!this.isPaused&&this.setPaused(!0)}}dispose(){var e,t,i,s,a;null==(e=this.chickAssetContainer)||e.dispose(),this.chickAssetContainer=null,null==(t=this.chickenAssetContainer)||t.dispose(),this.chickenAssetContainer=null,this.chickTemplateMesh=null,this.poufParticleTexture&&(this.poufParticleTexture.dispose(),this.poufParticleTexture=null),this.stopMusic(),this.spawnedCustomers.forEach(e=>{e.dispose()}),this.spawnedCustomers.clear(),null==(i=this.localController)||i.dispose(),this.remoteControllers.forEach(e=>e.dispose()),this.remoteControllers.clear(),this.audioManager.dispose(),this.inputManager.dispose(),null==(s=this.performanceManager)||s.dispose(),er.reset(),null==(a=this.ingredientLoader)||a.dispose(),this.uiRenderObserver&&(this.scene.onBeforeRenderObservable.remove(this.uiRenderObserver),this.uiRenderObserver=null),this.customerOrderMeshes.forEach(e=>e.dispose()),this.customerOrderMeshes.clear(),this.orderUITextures.forEach(e=>e.dispose()),this.orderUITextures.clear(),this.orderUIMaterials.forEach(e=>e.dispose()),this.orderUIMaterials.clear(),this.customerOrderData.clear(),this.customerOrderIcons.clear(),this.lastOrderUIUpdateTimes.clear(),this.boundaryWalls.forEach(e=>{var t;null==(t=e.getPhysicsBody())||t.dispose(),e.dispose()}),this.boundaryWalls=[],document.removeEventListener("pointerlockchange",this._boundPointerLockChangeListener,!1),this.interactables.forEach(e=>{e.dispose()}),this.scene.dispose(),console.log("GameEngine disposed")}playSfx(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2?arguments[2]:void 0,s=arguments.length>3?arguments[3]:void 0;this.audioManager.playSound(e,t,i,s)}stopSfx(e){this.audioManager.stopSound(e)}updateAllInteractablePrompts(){try{var e;let t=null==(e=eS.getKeyBindings())?void 0:e.interact;if(!t){console.warn("Interact keybind not found in settings. Prompts will use '?'."),this.interactables.forEach(e=>{e.updateKeyPromptVisuals("?")});return}this.interactables.forEach(e=>{e.updateKeyPromptVisuals(t)})}catch(e){console.error("Error updating interactable key prompts:",e)}}async init(){var e;let t=this.scene.getEngine();t.displayLoadingUI(),await this.audioManager.initialize(),this.applyAudioSettings(),this.assetsManager=new U.Sp(this.scene),this.assetsManager.useDefaultLoadingScreen=!1,this.assetsManager.autoHideLoadingUI=!1,this.ingredientLoader=new ez(this.scene);let i=this.assetsManager.addContainerTask("characterTask","","assets/characters/","character.glb"),s=new V.a(!0,await (0,H.Z)());this.scene.enablePhysics(new F.P(0,-20,0),s),new j.e("hemilight",new F.P(0,1,0),this.scene).intensity=.3;let a=new z.O("sun",new F.P(-5,-10,5).normalize(),this.scene);a.position=a.direction.negate().scaleInPlace(40),this.shadowGenerator=new C.R(256,a),this.shadowGenerator.useKernelBlur=!0,this.shadowGenerator.depthClamp=!0,this.shadowGenerator.autoCalcDepthBounds=!0,this.performanceManager=new eF(this.scene,this.shadowGenerator),new j.e("extraHemi",F.P.Up(),this.scene).intensity=.4;let n=B.V.CreateBox("skyBox",{size:150},this.scene),o=new O.K("skyBox",this.scene);o.backFaceCulling=!1,o.reflectionTexture=new A.B("assets/skybox/skybox",this.scene),o.reflectionTexture.coordinatesMode=D.x.SKYBOX_MODE,o.diffuseColor=new L.Wo(0,0,0),o.specularColor=new L.Wo(0,0,0),n.material=o;let r=new G.x("ref",512,this.scene);null==(e=r.renderList)||e.push(n),this.scene.environmentTexture=r.cubeTexture,this.scene.fogMode=$.x.FOGMODE_EXP2,this.scene.fogColor=L.Wo.Lerp(L.Wo.FromHexString("#FBCFE8"),L.Wo.White(),.2),this.scene.fogDensity=.015,this.scene.fogEnabled=!0,i.onSuccess=e=>{this.loadedCharacterContainer=e.loadedContainer},this.assetsManager.onProgress=(e,t,i)=>{let s=this.scene.getEngine();s.loadingScreen instanceof q&&s.loadingScreen.updateProgress((t-e)/t*100)};let l=this.assetsManager.addContainerTask("chickTask","","assets/map/japan/","Chick.glb");l.onSuccess=e=>{this.chickAssetContainer=e.loadedContainer;let t=e.loadedContainer.rootNodes[0];t instanceof eV.x?(this.chickTemplateMesh=t,this.chickTemplateMesh.setEnabled(!1),this.chickTemplateMesh.isVisible=!1,this.chickTemplateMesh.isPickable=!1,this.chickTemplateMesh.getChildMeshes().forEach(e=>{e.setEnabled(!1),e.isVisible=!1,e.isPickable=!1})):console.error("Chick GLB loaded, but root node is not a mesh.")},l.onError=(e,t,i)=>{console.error("Error loading Chick.glb:",t,i)};let c=this.assetsManager.addContainerTask("chickenTask","","assets/map/japan/","Chicken.glb");c.onSuccess=e=>{this.chickenAssetContainer=e.loadedContainer;let t=e.loadedContainer.rootNodes[0];t instanceof eV.x?(this.chickenTemplateMesh=t,this.chickenTemplateMesh.setEnabled(!1),this.chickenTemplateMesh.isVisible=!1,this.chickenTemplateMesh.isPickable=!1,this.chickenTemplateMesh.getChildMeshes().forEach(e=>{e.setEnabled(!1),e.isVisible=!1,e.isPickable=!1})):console.error("Chick GLB loaded, but root node is not a mesh.")},c.onError=(e,t,i)=>{console.error("Error loading Chick.glb:",t,i)};try{this.poufParticleTexture=new D.x("assets/particles/Star-Texture.png",this.scene),this.poufParticleTexture.hasAlpha=!0}catch(e){console.error("Failed to load pouf particle texture:",e)}try{this.portalParticleTexture=new D.x("assets/particles/Runes1.png",this.scene),this.portalParticleTexture.hasAlpha=!0}catch(e){console.error("Failed to load portal particle texture, falling back to pouf:",e);try{this.poufParticleTexture=new D.x("assets/particles/Star-Texture.png",this.scene),this.poufParticleTexture.hasAlpha=!0}catch(e){console.error("Failed to load fallback pouf texture:",e)}}this.assetsManager.onFinish=()=>{this.loadingState.assets.progress=100,this.loadingState.currentTask="Assets loaded, preparing map and sounds...";let e=this.scene.getEngine();e.loadingScreen instanceof q&&(e.loadingScreen.loadingUIText=this.loadingState.currentTask),h=!0,y()};let d=new eE(this.scene,this.shadowGenerator,this.ingredientLoader),h=!1,m=!1,p=!1,g=!1,y=()=>{if(h&&m&&p&&g){let e=this.scene.getEngine();e.loadingScreen instanceof q&&(this.loadingState.currentTask="Initializing game...",e.loadingScreen.loadingUIText=this.loadingState.currentTask,e.loadingScreen.updateProgress(100),this.createBoundaryWalls(),this.initializePlayers(),this.checkAndPlayMusic(),setTimeout(()=>{this.loadingState.currentTask="Ready!",e.loadingScreen instanceof q&&(e.loadingScreen.loadingUIText=this.loadingState.currentTask,e.loadingScreen.updateProgress(100)),setTimeout(()=>e.hideLoadingUI(),500)},500))}};this.audioManager.loadSounds(this.soundList,void 0,()=>{p=!0,y()}),this.ingredientLoader.loadIngredientModels().then(()=>{g=!0,y()}).catch(e=>{console.error("Error loading ingredient models:",e)}),this.assetsManager.load(),d.loadAndPlaceModels("assets/map/",eW,()=>{if(this.interactables=d.interactables,m=!0,this.loadingState.map.loaded=!0,this.loadingState.map.progress=100,this.loadingState.currentTask="Map loading complete",t.loadingScreen instanceof q){let e=(this.loadingState.assets.progress+this.loadingState.map.progress)/2;t.loadingScreen.updateProgress(e),t.loadingScreen.loadingUIText=this.loadingState.currentTask}let e=(0,u.getStateCallbacks)(this.room);e(this.room.state).interactableObjects.onAdd((t,i)=>{let s=this.interactables.find(e=>e.id===Number(i));if(!s)return void console.warn(`Interactable ${i} added to state but not found in client list.`);let a=e=>{s.setDisabled(e.disabled),e.isActive?s.activate(e.isActive):s.deactivate(),s.updateProcessingProgress(e.processingTimeLeft,e.totalProcessingDuration);let i=e.ingredientsOnBoard.map(e=>e);if(s.updateIngredientsOnBoard(i),s.interactType===ee.Oven){let i=t.isActive&&t.processingRecipeId&&t.processingTimeLeft>0,a=i?eG[e.processingRecipeId]:null;i&&a&&a.requiredIngredients.length>0?s.showCookingVisual(a.requiredIngredients[0].ingredient):s.hideCookingVisual()}s.interactType===ee.ServingOrder?s.showDirtyPlateVisual(e.hasDirtyPlate):s.showDirtyPlateVisual(!1)};if(a(t),e(t).onChange(()=>{this.interactables.find(e=>e.id===Number(i))&&a(t)}),s.interactType===ee.Oven&&(e(t).listen("isActive",(e,t)=>{e&&!t?this.audioManager.playSound("ovenLoop",.6,!0,s.mesh):!e&&t&&this.audioManager.stopSound("ovenLoop")}),t.isActive&&this.audioManager.playSound("ovenLoop",.6,!0,s.mesh)),s.interactType===ee.ChoppingBoard){let i=t.ingredientsOnBoard.length;e(t).listen("ingredientsOnBoard",e=>{e.length!==i&&(this.playSfx("pickupPlace"),i=e.length)})}}),this.setupGameEventListeners(),this.updateAllInteractablePrompts(),y()},e=>{this.loadingState.map.progress=e,this.loadingState.currentTask=`Loading map: ${e.toFixed(0)}%`;let t=this.scene.getEngine();if(t.loadingScreen instanceof q){let e=(this.loadingState.assets.progress+this.loadingState.map.progress)/2;t.loadingScreen.updateProgress(e),t.loadingScreen.loadingUIText=this.loadingState.currentTask}},this.room.state.mapHash),this.inputManager.requestFocusAndPointerLock()}setPaused(e){if(this.isPaused===e)return;this.isPaused=e;let t=this.scene.getEngine().getRenderingCanvas();if(e)document.pointerLockElement===t&&document.exitPointerLock(),this.scene.animationGroups.forEach(e=>e.pause());else{this.scene.animationGroups.forEach(e=>e.play());let e=eK.getState().inGameSettingsVisible;e||document.pointerLockElement===t?e||document.pointerLockElement:this.inputManager.requestFocusAndPointerLock()}}_setupUIRenderObserver(){this.uiRenderObserver&&this.scene.onBeforeRenderObservable.remove(this.uiRenderObserver),this.uiRenderObserver=this.scene.onBeforeRenderObservable.add(()=>{let e=Date.now();this.customerOrderMeshes.forEach((t,i)=>{let s=this.spawnedCustomers.get(i);if(s&&s.isEnabled()){if(s.getAbsolutePosition().addToRef(this.customerUIOffset,this._uiUpdatePosVector),t.setAbsolutePosition(this._uiUpdatePosVector),t.isEnabled()||t.setEnabled(!0),e-(this.lastOrderUIUpdateTimes.get(i)??0)>this.orderUIUpdateInterval){let t=this.orderUITextures.get(i),s=this.customerOrderData.get(i),a=this.customerOrderIcons.get(i);t&&s&&a&&a.complete&&(this.drawOrderUIWithTimer(t,s,a),this.lastOrderUIUpdateTimes.set(i,e))}}else t.isEnabled()&&t.setEnabled(!1),this.lastOrderUIUpdateTimes.has(i)&&this.lastOrderUIUpdateTimes.delete(i)})})}getScene(){return this.scene}applySettings(){this.applyAudioSettings(),this.applyPerformanceSettings(),this.applyControllerSettings(),this.checkAndPlayMusic(),this.updateAllInteractablePrompts()}applyAudioSettings(){this.audioManager.setMasterVolume(eS.getMasterVolume()),this.audioManager.setMusicVolume(eS.getMusicVolume()),this.audioManager.setSfxVolume(eS.getSfxVolume())}applyPerformanceSettings(){var e;null==(e=this.performanceManager)||e.applySettings()}applyControllerSettings(){var e,t;null==(e=this.localController)||e.applyCameraSettings(),null==(t=this.localController)||t.applyKeybindings()}checkAndPlayMusic(){let e=eS.getMusicEnabled();e&&!this.isMusicPlaying?(this.audioManager.setMusicVolume(eS.getMusicVolume()),this.audioManager.playSound("themeMusic"),this.isMusicPlaying=!0):!e&&this.isMusicPlaying?(this.audioManager.stopSound("themeMusic"),this.isMusicPlaying=!1):e&&this.isMusicPlaying&&this.audioManager.setMusicVolume(eS.getMusicVolume())}stopMusic(){this.isMusicPlaying&&(this.audioManager.stopSound("themeMusic"),this.isMusicPlaying=!1)}createBoundaryWalls(){let e=(e,t,i)=>{let s=B.V.CreateBox(e,{width:i.x,height:i.y,depth:i.z},this.scene);s.position=t,s.visibility=0,s.isPickable=!1,new em.p(s,eu.Bq.BOX,{mass:0,friction:.5,restitution:.1},this.scene),this.boundaryWalls.push(s)};e("BoundaryWall_Back",new F.P(0,10,-9.25),new F.P(18.5,20,.5)),e("BoundaryWall_Front",new F.P(0,10,9.25),new F.P(18.5,20,.5)),e("BoundaryWall_Left",new F.P(-9.25,10,0),new F.P(.5,20,18.5)),e("BoundaryWall_Right",new F.P(9.25,10,0),new F.P(.5,20,18.5))}setupGameEventListeners(){let e=(0,u.getStateCallbacks)(this.room);e(this.room.state).interactableObjects.onAdd((t,i)=>{let s=this.interactables.find(e=>e.id===Number(i));if(!s)return;if(s.interactType===ee.Oven&&(t.isActive&&"cooked_rice_recipe"===t.processingRecipeId?s.showCookingVisual(et.Rice):s.hideCookingVisual(),e(t).onChange(()=>{if(t.isActive&&"cooked_rice_recipe"===t.processingRecipeId?s.showCookingVisual(et.Rice):s.hideCookingVisual(),!t.isActive&&t.ingredientsOnBoard.length>0){let e=t.ingredientsOnBoard.map(e=>e);s.updateIngredientsOnBoard(e)}else t.isActive||s.clearIngredientsOnBoard()}),e(t).listen("isActive",(e,t)=>{e&&!t?this.audioManager.playSound("ovenLoop",.6,!0,s.mesh):!e&&t&&this.audioManager.stopSound("ovenLoop")}),t.isActive&&this.audioManager.playSound("ovenLoop",.6,!0,s.mesh)),s.interactType===ee.ChoppingBoard){let i=[...t.ingredientsOnBoard.values()];e(t).onChange(()=>{let e=[...t.ingredientsOnBoard.values()];e.length!==i.length&&this.playSfx("pickupPlace"),i=e})}e(t).onChange(()=>{let e=this.interactables.find(e=>e.id===Number(t.id));if(!e)return;e.setDisabled(t.disabled),e.updateProcessingProgress(t.processingTimeLeft,t.totalProcessingDuration),e.interactType!==ee.Oven&&(t.isActive?e.activate(t.isActive):e.deactivate());let i=t.ingredientsOnBoard.map(e=>e);e.updateIngredientsOnBoard(i),e.interactType===ee.ServingOrder?e.showDirtyPlateVisual(t.hasDirtyPlate):e.showDirtyPlateVisual(!1)});let a=this.interactables.find(e=>e.id===Number(t.id));if(a){a.setDisabled(t.disabled),a.updateProcessingProgress(t.processingTimeLeft,t.totalProcessingDuration);let e=t.ingredientsOnBoard.map(e=>e);a.updateIngredientsOnBoard(e),a.interactType!==ee.Oven&&t.isActive&&a.activate(t.isActive),a.interactType===ee.ServingOrder&&a.showDirtyPlateVisual(t.hasDirtyPlate)}}),e(this.room.state).orders.onAdd(t=>{-1!==t.chairId&&(this.handleSpawnChick(t.chairId,t.customerType),this.customerOrderData.set(t.chairId,{timeLeft:t.timeLeft,totalDuration:t.totalDuration}),this.createCustomerOrderUI_3D(t.chairId,t.recipeId)),e(t).listen("timeLeft",e=>{this.customerOrderData.has(t.chairId)&&(this.customerOrderData.set(t.chairId,{timeLeft:e,totalDuration:t.totalDuration}),this.lastOrderUIUpdateTimes.set(t.chairId,0))})}),e(this.room.state).orders.onRemove(e=>{-1!==e.chairId&&(this.handleRemoveChick(e.chairId),this.removeCustomerOrderUI_3D(e.chairId),this.customerOrderData.delete(e.chairId),this.lastOrderUIUpdateTimes.delete(e.chairId))});let t=e=>{ek.Am.error(e.message),this.playSfx("error")};e(this.room.state).listen("timeLeft",e=>{let t=e<=1e4&&e>0;t&&!this.isTimerTickingSoundPlaying?(this.isTimerTickingSoundPlaying=!0,null!==this.timerTickIntervalId&&clearInterval(this.timerTickIntervalId),this.playSfx("timerTick"),this.timerTickIntervalId=window.setInterval(()=>{this.room.state.timeLeft<=1e4&&this.room.state.timeLeft>0?this.playSfx("timerTick"):this.stopTimerTickingSound()},1e3)):!t&&this.isTimerTickingSoundPlaying&&this.stopTimerTickingSound()}),this.room.onMessage("alreadyCarrying",t),this.room.onMessage("noIngredient",t),this.room.onMessage("invalidIngredient",t),this.room.onMessage("noMatchingOrder",t),this.room.onMessage("needPlate",t),this.room.onMessage("wrongIngredient",t),this.room.onMessage("wrongOrder",t),this.room.onMessage("orderCompleted",()=>this.playSfx("orderComplete")),this.room.onMessage("invalidServe",t),this.room.onMessage("stationBusy",t),this.room.onMessage("cannotPickup",t),this.room.onMessage("invalidPickup",t),this.room.onMessage("boardFull",t),this.room.onMessage("invalidCombination",t),this.room.onMessage("boardNotEmpty",t),this.room.onMessage("boardEmpty",t),this.room.onMessage("cannotPlaceRaw",t),this.room.onMessage("invalidPlacement",t),this.room.onMessage("error",e=>{console.warn("Received error from server:",(null==e?void 0:e.message)||"Unknown error"),t(e)}),this.room.onMessage("gameOver",e=>{var t;console.log("Game Over! Final Score:",e.finalScore),this.onGameOverCallback(e.finalScore),null==(t=this.localController)||t.inputMap.clear(),this.audioManager.stopSound("ovenLoop"),this.stopTimerTickingSound(),this.scene.getEngine().isPointerLock&&document.exitPointerLock(),this.dispose()})}createCustomerOrderUI_3D(e,t){this.customerOrderMeshes.has(e)&&this.removeCustomerOrderUI_3D(e);let i=this.spawnedCustomers.get(e);if(!i)return;let s=eG[t];if(!s)return;let a=ea[s.result.ingredient];if(!a||!a.icon)return;let n=`/ingredients/${a.icon}.png`,o=B.V.CreatePlane(`orderPlane_${e}`,{size:.6},this.scene);o.billboardMode=R.Kj.BILLBOARDMODE_ALL,o.isPickable=!1,o.renderingGroupId=1,o.position=i.getAbsolutePosition().add(this.customerUIOffset),o.setEnabled(!0);let r=new J.c(`orderTex_${e}`,{width:128,height:128},this.scene,!1,D.x.TRILINEAR_SAMPLINGMODE);r.hasAlpha=!0;let l=new Image;l.src=n,l.onload=()=>{this.customerOrderIcons.set(e,l);let t=this.customerOrderData.get(e);t&&this.drawOrderUIWithTimer(r,t,l)},l.onerror=()=>{console.error(`[UI 3D] Failed to load icon: ${n}`);let t=new Image;t.width=1,t.height=1,this.customerOrderIcons.set(e,t);let i=this.customerOrderData.get(e);i&&this.drawOrderUIWithTimer(r,i,t,!0)};let c=new O.K(`orderMat_${e}`,this.scene);c.diffuseTexture=r,c.opacityTexture=r,c.useAlphaFromDiffuseTexture=!1,c.specularColor=new L.Wo(0,0,0),c.emissiveColor=L.Wo.White(),c.disableLighting=!0,c.backFaceCulling=!1,o.material=c,this.customerOrderMeshes.set(e,o),this.orderUITextures.set(e,r),this.orderUIMaterials.set(e,c),this.lastOrderUIUpdateTimes.set(e,0)}drawOrderUIWithTimer(e,t,i){let s=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=e.getSize().width,n=e.getSize().height,o=e.getContext();if(!o)return;let r=1;t.totalDuration>0?r=eH.R.Clamp(t.timeLeft/t.totalDuration,0,1):t.timeLeft<=0&&(r=0);let l=n-18-48,c=16+l+16;if(o.clearRect(0,0,a,n),o.fillStyle="rgba(0, 0, 0, 0.5)",o.beginPath(),o.roundRect(8,8,a-16,n-16,15),o.fill(),!s&&i.complete&&i.naturalWidth>0){let e=.9*Math.min(a-32,l),t=(a-e)/2,s=16+(l-e)/2;o.drawImage(i,t,s,e,e)}else s&&(o.fillStyle="white",o.font="bold 30px Arial",o.textAlign="center",o.textBaseline="middle",o.fillText("?",a/2,16+l/2));if(t.totalDuration>0){let e=a-32,t=e*r;o.fillStyle="rgba(50, 50, 50, 0.8)",o.fillRect(16,c,e,18);let i="#4ade80";r<.25?i="#f87171":r<.6&&(i="#facc15"),o.fillStyle=i,o.fillRect(16,c,t,18),o.strokeStyle="rgba(200, 200, 200, 0.7)",o.lineWidth=1,o.strokeRect(16,c,e,18)}e.update(!0)}removeCustomerOrderUI_3D(e){let t=this.customerOrderMeshes.get(e);t&&(t.dispose(),this.customerOrderMeshes.delete(e));let i=this.orderUITextures.get(e);i&&(i.dispose(),this.orderUITextures.delete(e));let s=this.orderUIMaterials.get(e);s&&(s.dispose(),this.orderUIMaterials.delete(e)),this.customerOrderData.delete(e),this.customerOrderIcons.delete(e),this.lastOrderUIUpdateTimes.delete(e)}handleSpawnChick(e,t){if(this.spawnedCustomers.has(e))return;let i="chick"===t?this.chickTemplateMesh:this.chickenTemplateMesh,s="chick"===t?this.chickAssetContainer:this.chickenAssetContainer;if(!i||!s)return void console.error(`${"chick"===t?"Chick":"Chicken"} template mesh or container is not loaded or available. Cannot spawn.`);let a=this.interactables.find(t=>t.id===e&&t.interactType===ee.ServingOrder);if(!a)return void console.error(`Could not find chair object with ID ${e} to spawn customer.`);let n=s.instantiateModelsToScene(t=>`${t}_${e}`,!1,{doNotInstantiate:!0}).rootNodes[0];if(!n)return void console.error(`Failed to clone customer template mesh for chair ${e}.`);n.setEnabled(!0),n.isVisible=!0,n.isPickable=!1,n.getChildMeshes().forEach(t=>{t.setEnabled(!0),t.isVisible=!0,t.isPickable=!1,t.material&&(t.material=t.material.clone(`${t.material.name}_${e}`))});let o=new F.P(.075,.075,.075);n.scaling=F.P.Zero();let r=a.mesh,l=r.getAbsolutePosition().add(new F.P(0,.05,0));n.position=l,n.rotation=r.rotation?r.rotation.clone():F.P.Zero(),this.spawnedCustomers.set(e,n);let c=new en.fwF(`customerSpawnScale_${e}`,"scaling",60,en.fwF.ANIMATIONTYPE_VECTOR3,en.fwF.ANIMATIONLOOPMODE_CONSTANT),d=[];d.push({frame:0,value:F.P.Zero()}),d.push({frame:24,value:o}),c.setKeys(d);let h=new en.udg(.6);h.setEasingMode(en.KpW.EASINGMODE_EASEOUT),c.setEasingFunction(h),n.animations=n.animations||[],n.animations.push(c),this.scene.beginAnimation(n,0,24,!1,1,()=>{n.scaling.copyFrom(o)}),this.createPortalSpawnEffect(l)}handleRemoveChick(e){let t=this.spawnedCustomers.get(e);if(t){let i=new en.fwF(`customerDespawnScale_${e}`,"scaling",60,en.fwF.ANIMATIONTYPE_VECTOR3,en.fwF.ANIMATIONLOOPMODE_CONSTANT),s=[];s.push({frame:0,value:t.scaling.clone()}),s.push({frame:18,value:F.P.Zero()}),i.setKeys(s);let a=new en.va5;a.setEasingMode(en.KpW.EASINGMODE_EASEIN),i.setEasingFunction(a),this.scene.stopAnimation(t,`customerSpawnScale_${e}`),t.animations=t.animations||[],t.animations.push(i),this.scene.beginAnimation(t,0,18,!1,1,()=>{t&&!t.isDisposed()&&t.dispose(),this.spawnedCustomers.delete(e)})}else this.spawnedCustomers.delete(e);this.removeCustomerOrderUI_3D(e),this.customerOrderData.delete(e)}createPortalSpawnEffect(e){let t=new Q.p(`portalSpawn_${e.x}_${e.z}`,150,this.scene);if(this.portalParticleTexture)t.particleTexture=this.portalParticleTexture;else{if(!this.poufParticleTexture)return void console.error("No particle texture available for portal effect.");console.warn("Using fallback pouf texture for portal effect."),t.particleTexture=this.poufParticleTexture}t.emitter=e.clone().addInPlace(new F.P(0,.1,0)),t.particleEmitterType=t.createSphereEmitter(.15),t.color1=new L.HE(.5,.8,1,1),t.color2=new L.HE(.7,.5,1,1),t.colorDead=new L.HE(.1,.1,.2,0),t.addColorGradient(0,new L.HE(.8,.9,1,1)),t.addColorGradient(.6,new L.HE(.6,.5,1,.7)),t.addColorGradient(1,t.colorDead.clone()),t.minSize=.03,t.maxSize=.15,t.addSizeGradient(0,.02),t.addSizeGradient(.4,.15),t.addSizeGradient(1,.01),t.minLifeTime=.4,t.maxLifeTime=.8,t.emitRate=150/t.minLifeTime,t.manualEmitCount=150,t.minEmitPower=1.5,t.maxEmitPower=3,t.updateSpeed=.008,t.gravity=new F.P(0,-1.5,0),t.direction1=new F.P(-.8,.5,-.8),t.direction2=new F.P(.8,1,.8),t.minAngularSpeed=-(3*Math.PI),t.maxAngularSpeed=3*Math.PI,t.blendMode=Q.p.BLENDMODE_ADD,t.disposeOnStop=!0,t.start(),setTimeout(()=>{t.stop()},1e3*t.maxLifeTime+100)}stopTimerTickingSound(){null!==this.timerTickIntervalId&&(clearInterval(this.timerTickIntervalId),this.timerTickIntervalId=null),this.isTimerTickingSoundPlaying=!1}update(e){var t,i,s;let a=e/1e3;if(null==(t=this.localController)||t.update(a),this.scene.getFrameId()%120==0&&this.checkAndPlayMusic(),this.localController){this._playerPosTemp.copyFrom(this.localController.position),this.scene.getFrameId()%60==0&&this.spatialGrid.rebuild(this.interactables);let e=this.MAX_INTERACTION_DISTANCE/2,t=this.spatialGrid.getNearbyObjects(this._playerPosTemp,e),i=null,s=1/0;for(let e of t){let t=F.P.Distance(e.mesh.position,this._playerPosTemp);t<e.interactionDistance&&t<s&&(s=t,i=e)}i!==this._nearestInteractable&&(this._nearestInteractable&&this._nearestInteractable.showPrompt(!1),i&&i.showPrompt(!0),this._nearestInteractable=i)}if(this.room&&this.localController){let e=Date.now(),t=this.localController.getTransform(),i=t.position,a=(null==(s=t.rotationQuaternion)?void 0:s.toEulerAngles().y)||0,n=this.localController.getTargetAnim.name,o=e-this.lastNetworkUpdateTime,r=F.P.Distance(i,this.lastSentPosition)>this.POSITION_THRESHOLD,l=Math.abs(a-this.lastSentRotation)>this.ROTATION_THRESHOLD,c=this.lastSentAnimationState!==n;(o>=this.MAX_NETWORK_UPDATE_INTERVAL||o>=this.NETWORK_UPDATE_INTERVAL&&(r||l||c))&&(this.room.send("move",{position:{x:i.x,y:i.y,z:i.z},rotation:{y:a},animationState:n,timestamp:e}),this.lastSentPosition.copyFrom(i),this.lastSentRotation=a,this.lastSentAnimationState=n,this.lastNetworkUpdateTime=e)}this.remoteControllers.forEach(e=>{e.update(a)}),null==(i=this.performanceManager)||i.update()}tryInteract(e){if(this._nearestInteractable&&F.P.Distance(this._nearestInteractable.mesh.position,e.position)<=this._nearestInteractable.interactionDistance){this._nearestInteractable.interact(),this.room.send("interact",{objectId:this._nearestInteractable.id,timestamp:Date.now()});return}this._playerPosTemp.copyFrom(e.position);let t=this.spatialGrid.getNearbyObjects(this._playerPosTemp,this.MAX_INTERACTION_DISTANCE),i=null,s=1/0;for(let e of t){let t=F.P.Distance(e.mesh.position,this._playerPosTemp);t<e.interactionDistance&&t<s&&(s=t,i=e)}i&&(this._nearestInteractable=i,i.interact(),this.room.send("interact",{objectId:i.id,timestamp:Date.now()}))}initializePlayers(){if(!this.loadedCharacterContainer)return void console.error("Character container not loaded!");let e=this.loadedCharacterContainer.instantiateModelsToScene(e=>e),t=e.rootNodes[0];t.scaling=new F.P(.9,.9,.9),t.rotation=new F.P(0,0,0),this.localController=new e_(this,t,this.ingredientLoader,e.animationGroups,this.scene,this.audioManager),this.localController.model.receiveShadows=!0,this.shadowGenerator.addShadowCaster(this.localController.model);let i=(0,u.getStateCallbacks)(this.room);i(this.room.state).players.onAdd(async(e,t)=>{if(t===this.room.sessionId){var s,a,n;null==(s=this.localController)||s.setPosition(new F.P(e.x,e.y,e.z)),null==(a=this.localController)||a.setRotationY(e.rot),null==(n=this.localController)||n.setUsernameDisplay(e.name),i(e).listen("holdingPlate",e=>{this.localController&&(e&&!this.localController.isHoldingPlate?this.localController.forcePickupPlate():!e&&this.localController.isHoldingPlate&&this.localController.dropPlate())}),i(e).listen("holdedIngredient",e=>{this.localController&&this.localController.forceSetIngredient(e)}),i(e).listen("name",e=>{var t;null==(t=this.localController)||t.setUsernameDisplay(e)});return}let o=this.loadedCharacterContainer.instantiateModelsToScene(e=>e),r=o.rootNodes[0];r.scaling=new F.P(.9,.9,.9),r.rotation=new F.P(0,0,0);let l=new eC(r,this.scene,this.ingredientLoader,o.animationGroups,this.audioManager);l.setPosition(new F.P(e.x,e.y,e.z)),l.setRotationY(e.rot),r.receiveShadows=!0,this.shadowGenerator.addShadowCaster(r),this.remoteControllers.set(t,l),l.receiveFirstState(e);let c=0;i(e).onChange(()=>{let t=Date.now();t-c>50&&(l.receiveState(e),c=t)}),i(e).listen("name",e=>{let i=this.remoteControllers.get(t);null==i||i.setUsernameDisplay(e)})}),i(this.room.state).players.onRemove((e,t)=>{let i=this.remoteControllers.get(t);i&&(i.dispose(),this.remoteControllers.delete(t))})}constructor(e,t,i){var s;(0,E._)(this,"interactables",[]),(0,E._)(this,"spatialGrid",new ej(2.5)),(0,E._)(this,"scene",void 0),(0,E._)(this,"room",void 0),(0,E._)(this,"localController",void 0),(0,E._)(this,"remoteControllers",new Map),(0,E._)(this,"shadowGenerator",void 0),(0,E._)(this,"assetsManager",void 0),(0,E._)(this,"ingredientLoader",void 0),(0,E._)(this,"inputManager",void 0),(0,E._)(this,"performanceManager",void 0),(0,E._)(this,"loadedCharacterContainer",void 0),(0,E._)(this,"poufParticleTexture",null),(0,E._)(this,"portalParticleTexture",null),(0,E._)(this,"onGameOverCallback",()=>{}),(0,E._)(this,"chickTemplateMesh",null),(0,E._)(this,"chickAssetContainer",null),(0,E._)(this,"chickenTemplateMesh",null),(0,E._)(this,"chickenAssetContainer",null),(0,E._)(this,"spawnedCustomers",new Map),(0,E._)(this,"customerOrderMeshes",new Map),(0,E._)(this,"orderUITextures",new Map),(0,E._)(this,"orderUIMaterials",new Map),(0,E._)(this,"uiRenderObserver",null),(0,E._)(this,"customerUIOffset",new F.P(0,2,0)),(0,E._)(this,"_uiUpdatePosVector",new F.P),(0,E._)(this,"customerOrderData",new Map),(0,E._)(this,"customerOrderIcons",new Map),(0,E._)(this,"lastOrderUIUpdateTimes",new Map),(0,E._)(this,"orderUIUpdateInterval",250),(0,E._)(this,"_playerPosTemp",new F.P),(0,E._)(this,"loadingState",{assets:{progress:0,total:0,current:0},map:{progress:0,loaded:!1},currentTask:""}),(0,E._)(this,"lastNetworkUpdateTime",0),(0,E._)(this,"NETWORK_UPDATE_INTERVAL",10),(0,E._)(this,"MAX_NETWORK_UPDATE_INTERVAL",100),(0,E._)(this,"POSITION_THRESHOLD",.01),(0,E._)(this,"ROTATION_THRESHOLD",.05),(0,E._)(this,"lastSentPosition",new F.P),(0,E._)(this,"lastSentRotation",0),(0,E._)(this,"lastSentAnimationState",""),(0,E._)(this,"audioManager",void 0),(0,E._)(this,"boundaryWalls",[]),(0,E._)(this,"soundList",[{name:"pickupPlace",path:"assets/audio/pickup_place.ogg",options:{volume:.3}},{name:"trash",path:"assets/audio/trash.ogg",options:{volume:.2}},{name:"orderComplete",path:"assets/audio/order_complete.ogg",options:{volume:.4}},{name:"error",path:"assets/audio/error.ogg",options:{volume:.2}},{name:"ovenLoop",path:"assets/audio/oven_loop.ogg",options:{volume:.025,spatialSound:!0,loop:!0}},{name:"footstep_wood_01",path:"assets/audio/footstep_wood_001.ogg",options:{volume:.7,spatialSound:!0,distanceModel:"linear"}},{name:"footstep_wood_02",path:"assets/audio/footstep_wood_002.ogg",options:{volume:.7,spatialSound:!0,distanceModel:"linear"}},{name:"footstep_wood_03",path:"assets/audio/footstep_wood_003.ogg",options:{volume:.7,spatialSound:!0,distanceModel:"linear"}},{name:"footstep_wood_04",path:"assets/audio/footstep_wood_004.ogg",options:{volume:.7,spatialSound:!0,distanceModel:"linear"}},{name:"jumpLand",path:"assets/audio/jump_land.ogg",options:{volume:.5,spatialSound:!0,distanceModel:"linear"}},{name:"timerTick",path:"assets/audio/timer_tick.ogg",options:{volume:.4}},{name:"themeMusic",path:"assets/music/theme.mp3",isMusic:!0,options:{loop:!0,volume:.05}}]),(0,E._)(this,"isMusicPlaying",!1),(0,E._)(this,"isTimerTickingSoundPlaying",!1),(0,E._)(this,"timerTickIntervalId",null),(0,E._)(this,"isPaused",!1),(0,E._)(this,"_boundPointerLockChangeListener",void 0),(0,E._)(this,"MAX_INTERACTION_DISTANCE",5),(0,E._)(this,"_nearestInteractable",null),this.scene=e,this.room=t,this.onGameOverCallback=i,this.audioManager=new eU(this.scene),this.inputManager=new eA(this.scene,this.audioManager),this._boundPointerLockChangeListener=this.handlePointerLockChange.bind(this),e.getEngine().setHardwareScalingLevel(1),e.skipFrustumClipping=!1,e.skipPointerMovePicking=!0,e.shadowsEnabled=!0,e.lightsEnabled=!0,e.particlesEnabled=!0,e.collisionsEnabled=!0,e.fogEnabled=!0,e.fogStart=15,null==(s=e.getPhysicsEngine())||s.setTimeStep(1/60),this._setupUIRenderObserver(),this.setupPointerLockListener()}}var eZ=i(50900),eY=i(90945);let eQ=()=>{var e;let t,i,s,a,n,o,r=(0,p.c)(11),l=v(),c=null==l?void 0:l.sessionId;r[0]!==c?(t=e=>c?e.players.get(c):void 0,r[0]=c,r[1]=t):t=r[1];let h=S(t),m=(null==h?void 0:h.holdedIngredient)??et.None,u=(null==h?void 0:h.holdingPlate)??!1;r[2]!==m?(s=ea[m],r[2]=m,r[3]=s):s=r[3],i=s,a=null==(e=ea[et.Plate])?void 0:e.icon;let g=m!==et.None||u;return r[4]!==g||r[5]!==m||r[6]!==i||r[7]!==u?(n=g&&(0,d.jsxs)(eZ.E.div,{initial:{opacity:0,y:10,scale:.9},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:10,scale:.9},transition:{duration:.2,ease:"easeOut"},className:"flex items-center gap-2 bg-base-100/80 backdrop-blur-sm p-2 rounded-lg shadow-md border border-primary/30",children:[(0,d.jsxs)("div",{className:`w-12 h-12 flex items-center justify-center rounded ${u?"bg-secondary/30 ring-2 ring-secondary":"bg-base-300/50 opacity-60"}`,children:[u&&a&&(0,d.jsx)("img",{src:`/ingredients/${a}.png`,alt:"Plate",className:"w-10 h-10 object-contain"}),!u&&(0,d.jsx)("span",{className:"text-xs text-base-content/50",children:"Plate"})]}),(0,d.jsxs)("div",{className:`w-12 h-12 flex items-center justify-center rounded ${m!==et.None?"bg-accent/30 ring-2 ring-accent":"bg-base-300/50 opacity-60"}`,children:[m!==et.None&&(null==i?void 0:i.icon)&&(0,d.jsx)("img",{src:`/ingredients/${i.icon}.png`,alt:i.name,className:"w-10 h-10 object-contain"}),m===et.None&&(0,d.jsx)("span",{className:"text-xs text-base-content/50",children:"Item"})]})]}),r[4]=g,r[5]=m,r[6]=i,r[7]=u,r[8]=n):n=r[8],r[9]!==n?(o=(0,d.jsx)("div",{className:"fixed bottom-4 left-1/2 transform -translate-x-1/2 z-10 flex items-end justify-center gap-2 pointer-events-none",children:(0,d.jsx)(eY.M,{children:n})}),r[9]=n,r[10]=o):o=r[10],o};var eJ=i(40792),eX=i(50371),e0=i(56841),e1=i(83509),e2=i(79178);let e5=e=>{let t={tasks:[],allBaseIngredients:[]};if(!e)return t;let i=function(e){let t=eG[e];if(!t)return[];let i=[],s=new Set;return!function e(t,i,s){let a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(s.has(t)||t===et.None)return;let n=e$(t);if(n)n.requiredIngredients.forEach(t=>{e(t.ingredient,i,s)}),i.push({type:"PROCESS",ingredient:t,stationType:n.stationType,requiredIngredients:n.requiredIngredients.map(e=>e.ingredient),isFinalStep:a}),s.add(t);else{if(!ea[t])return;let e=ee.Fridge;i.push({type:"GET",ingredient:t,stationType:e,requiredIngredients:[]}),s.add(t)}}(t.result.ingredient,i,s,!0),i}(e);if(0===i.length)return t;let s=new Set,a=new Map;i.forEach(e=>{if("GET"===e.type)s.add(e.ingredient);else if("PROCESS"===e.type){var t;null==(t=e.requiredIngredients)||t.forEach(e=>{e$(e)||s.add(e)})}}),i.forEach(e=>{if("PROCESS"===e.type){var t;let i=e.stationType,s=a.get(i)||new Set;null==(t=e.requiredIngredients)||t.forEach(e=>{let t=e$(e);t&&t.stationType===i||s.add(e)}),s.size>0&&a.set(i,s)}}),a.forEach((e,i)=>{e.size>0&&t.tasks.push({station:i,ingredients:Array.from(e)})}),s.size>0&&(t.tasks.push({station:ee.Stock,ingredients:Array.from(s)}),t.allBaseIngredients=Array.from(s));let n=[ee.Stock,ee.Oven,ee.ChoppingBoard,ee.ServingBoard,null];return t.tasks.sort((e,t)=>{let i=n.indexOf(e.station),s=n.indexOf(t.station);return(-1===i?1/0:i)-(-1===s?1/0:s)}),t},e3=e=>{let t,i=(0,p.c)(10),{type:s,size:a}=e,n=void 0===a?16:a;i[0]!==n?(t={size:n,strokeWidth:2,className:"flex-shrink-0"},i[0]=n,i[1]=t):t=i[1];let o=t;switch(s){case ee.Oven:{let e;return i[2]!==o?(e=(0,d.jsx)(eJ.Z,{...o,className:"text-rose-600"}),i[2]=o,i[3]=e):e=i[3],e}case ee.ChoppingBoard:{let e;return i[4]!==o?(e=(0,d.jsx)(eX.Z,{...o,className:"text-purple-700"}),i[4]=o,i[5]=e):e=i[5],e}case ee.Fridge:case ee.Stock:{let e;return i[6]!==o?(e=(0,d.jsx)(e0.Z,{...o,className:"text-yellow-700"}),i[6]=o,i[7]=e):e=i[7],e}default:{let e;return i[8]!==o?(e=(0,d.jsx)(e1.Z,{...o,className:"text-gray-700"}),i[8]=o,i[9]=e):e=i[9],e}}},e4=(0,h.memo)(e=>{let t,i,s,a=(0,p.c)(10),{ingredient:n,sizeClass:o,station:r}=e;a[0]!==n?(t=ea[n],a[0]=n,a[1]=t):t=a[1];let l=t,c=(null==l?void 0:l.icon)?`/ingredients/${l.icon}.png`:"/icons/placeholder.png",h=r===ee.Oven?"bg-rose-400/50":r===ee.ChoppingBoard?"bg-purple-400/50":r===ee.Fridge||r===ee.Stock?"bg-yellow-400/50":"bg-gray-300/50",m=`flex items-center gap-0.5 ${r?h:"bg-gray-300/30"} rounded-md px-0.5 py-0.5`,u=(null==l?void 0:l.name)||"Unknown",g=null==l?void 0:l.name,y=`${void 0===o?"w-7 h-7":o} object-contain rounded-full`;return a[2]!==c||a[3]!==u||a[4]!==g||a[5]!==y?(i=(0,d.jsx)("img",{src:c,alt:u,title:g,className:y,onError:e7}),a[2]=c,a[3]=u,a[4]=g,a[5]=y,a[6]=i):i=a[6],a[7]!==m||a[8]!==i?(s=(0,d.jsx)("div",{className:m,children:i}),a[7]=m,a[8]=i,a[9]=s):s=a[9],s}),e8=e=>{let{order:t}=e,i=(0,h.useMemo)(()=>eG[t.recipeId],[t.recipeId]),s=(0,h.useMemo)(()=>e5(t.recipeId),[t.recipeId]),{timeLeft:a,totalDuration:n}=t,o=n>0?Math.max(0,Math.min(100,a/n*100)):0,r=Math.floor(a/6e4),l=Math.floor(a%6e4/1e3),c=`${String(r).padStart(2,"0")}:${String(l).padStart(2,"0")}`,m=a<=1e4&&a>0;if(!i)return(0,d.jsx)("div",{className:"bg-red-100 border border-red-400 text-red-700 px-2 py-1 rounded text-xs",children:"Error: Recipe not found!"});let p=ea[i.result.ingredient],u=(null==p?void 0:p.icon)?`/ingredients/${p.icon}.png`:"/icons/placeholder.png";return(0,d.jsxs)("div",{className:`bg-gradient-to-br from-purple-300 via-pink-200 to-yellow-100 rounded-lg shadow-md p-0.5 flex flex-col gap-1 w-full ${m?"border-2 border-red-500":""} ${a<=0&&n>0?"animate-blink":""}`,children:[(0,d.jsx)("div",{className:"flex justify-center mt-1 mb-1",children:(0,d.jsxs)(eZ.E.div,{className:"relative bg-white/100 rounded-full shadow-lg p-1",style:{boxShadow:"0 0 10px rgba(159, 122, 234, 0.5)"},animate:{scale:[1,1.05,1]},transition:{repeat:1/0,duration:2},children:[(0,d.jsx)("div",{className:"absolute inset-0 rounded-full",style:{background:"radial-gradient(circle, rgba(255, 255, 255, 0.2) 0%, rgba(244, 114, 182, 0.3) 70%, transparent 100%)"}}),(0,d.jsx)("img",{src:u,alt:"Final dish",className:"w-10 h-10 object-contain rounded-full relative z-10",onError:e=>e.currentTarget.src="/icons/placeholder.png"})]})}),(0,d.jsx)("div",{className:"flex flex-col gap-1",children:s.tasks.map((e,i)=>(0,d.jsxs)("div",{className:"flex items-center gap-0.5 justify-center",children:[e.station&&(0,d.jsx)(e3,{type:e.station,size:16}),(0,d.jsx)("div",{className:"flex gap-0.5",children:e.ingredients.map((s,a)=>(0,d.jsx)(e4,{ingredient:s,sizeClass:"w-5 h-5",station:e.station},`${t.id}-task-${i}-item-${a}`))})]},`${t.id}-task-${i}`))}),n>0&&(0,d.jsxs)("div",{className:"flex items-center gap-1 mt-1",children:[(0,d.jsx)("div",{className:"flex-grow h-2 bg-gray-400 rounded-full overflow-hidden",children:(0,d.jsx)("div",{className:`h-full ${m?"bg-red-500":"bg-green-400"} transition-all duration-1000`,style:{width:`${o}%`}})}),(0,d.jsx)("span",{className:`text-sm ${m?"text-red-500":"text-gray-800"} font-semibold`,children:c})]})]})};function e6(){let e=S(e=>e.orders),t=(0,h.useMemo)(()=>e&&0!==e.length?[...e].sort((e,t)=>{let i=e.timeLeft<=0&&e.totalDuration>0,s=t.timeLeft<=0&&t.totalDuration>0;if(i&&!s)return 1;if(!i&&s)return -1;if(i&&s)return 0;let a=e.timeLeft-t.timeLeft;return Math.abs(a)>50?a:0}):[],[e]);return(0,d.jsxs)("div",{className:"fixed top-4 right-2 z-10 w-52 max-h-[calc(100vh-8rem)] overflow-y-auto p-1 bg-black/40 backdrop-blur-sm rounded-lg shadow-lg",children:[(0,d.jsxs)("h3",{className:"text-center font-bold text-white/90 text-xl mb-2 flex items-center justify-center gap-1 flex-shrink-0",children:[(0,d.jsx)(e2.Z,{size:18,strokeWidth:3})," Orders"]}),(0,d.jsx)("div",{className:"flex flex-col gap-0.5",children:(0,d.jsx)(eY.M,{children:t.length>0?t.map(e=>(0,d.jsx)(eZ.E.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,x:20},transition:{duration:.2},children:(0,d.jsx)(e8,{order:e})},e.id)):(0,d.jsx)(eZ.E.p,{initial:{opacity:0},animate:{opacity:1},className:"text-center text-gray-300/70 text-xs py-2",children:"No orders"})})})]})}function e7(e){return e.currentTarget.src="/icons/placeholder.png"}var e9=i(74927);function te(){let e,t,i=(0,p.c)(3),s=S(tt)??0;return i[0]===Symbol.for("react.memo_cache_sentinel")?(e=(0,d.jsx)(e9.Z,{strokeWidth:3,className:"inline-block h-5 w-5 mr-2 transition-colors duration-300 ease-in-out text-gradient-to-br from-purple-300 via-pink-200 to-yellow-100"}),i[0]=e):e=i[0],i[1]!==s?(t=(0,d.jsx)("div",{className:"border border-gradient-to-br from-purple-300 via-pink-200 to-yellow-100 rounded-full shadow-lg px-3 py-1 w-fit absolute bottom-3 left-4 z-10 pointer-events-none transition-colors duration-300 ease-in-out bg-gray-800",children:(0,d.jsxs)("div",{className:"flex items-center",children:[e,(0,d.jsx)("span",{className:"text-2xl font-bold transition-colors duration-300 ease-in-out text-gradient-to-br from-purple-300 via-pink-200 to-yellow-100",children:s})]})}),i[1]=s,i[2]=t):t=i[2],t}function tt(e){return e.score}var ti=i(45077);function ts(){let e,t,i,s,a=(0,p.c)(11),n=S(ta)??0,o=n<=1e4,r=Math.max(0,Math.floor(n/6e4)),l=Math.max(0,Math.floor(n%6e4/1e3)),c=`${String(r).padStart(2,"0")}:${String(l).padStart(2,"0")}`,h=`rounded-full shadow-lg px-4 py-1 w-fit absolute top-4 left-1/2 transform -translate-x-1/2 z-10 pointer-events-none transition-colors duration-300 ease-in-out ${o?"bg-gradient-to-br from-red-400 via-orange-300 to-yellow-200":"bg-gradient-to-br from-purple-300 via-pink-200 to-yellow-100"} ${o?"animate-pulse":""}`,m=`inline-block h-5 w-5 mr-2 transition-colors duration-300 ease-in-out ${o?"text-red-700":"text-gray-800"}`;a[0]!==m?(e=(0,d.jsx)(ti.Z,{strokeWidth:4,className:m}),a[0]=m,a[1]=e):e=a[1];let u=`text-2xl font-md transition-colors duration-300 ease-in-out ${o?"text-red-700 font-extrabold":"text-gray-800"}`;return a[2]!==c||a[3]!==u?(t=(0,d.jsx)("span",{className:u,children:c}),a[2]=c,a[3]=u,a[4]=t):t=a[4],a[5]!==e||a[6]!==t?(i=(0,d.jsxs)("div",{className:"flex items-center justify-center",children:[e,t]}),a[5]=e,a[6]=t,a[7]=i):i=a[7],a[8]!==h||a[9]!==i?(s=(0,d.jsx)("div",{className:h,children:i}),a[8]=h,a[9]=i,a[10]=s):s=a[10],s}function ta(e){return e.timeLeft}var tn=i(53219);function to(e){let t,i,s,a,n,o,r,l=(0,p.c)(9),{onBackToMenu:c}=e;return l[0]===Symbol.for("react.memo_cache_sentinel")?(t=(0,d.jsx)(tn.Z,{className:"h-6 w-5",strokeWidth:4}),l[0]=t):t=l[0],l[1]!==c?(i=(0,d.jsxs)("button",{onClick:c,className:"absolute top-3 left-3 btn-dream-small pointer-events-auto flex items-center gap-2 text-lg",children:[t,"Main menu"]}),l[1]=c,l[2]=i):i=l[2],l[3]===Symbol.for("react.memo_cache_sentinel")?(s=(0,d.jsx)(eQ,{}),a=(0,d.jsx)(ts,{}),n=(0,d.jsx)(e6,{}),o=(0,d.jsx)(te,{}),l[3]=s,l[4]=a,l[5]=n,l[6]=o):(s=l[3],a=l[4],n=l[5],o=l[6]),l[7]!==i?(r=(0,d.jsxs)("div",{className:"absolute top-0 left-0 w-full h-full pointer-events-none",children:[i,s,a,n,o]}),l[7]=i,l[8]=r):r=l[8],r}var tr=i(91652);let tl=["#A78BFA","#FBCFE8","#FDE68A","#FFFFFF"],tc=e=>{let t,i,s,a,n,o,r=(0,p.c)(10),{finalScore:l,onBackToMenu:c}=e;return r[0]===Symbol.for("react.memo_cache_sentinel")?(t=(0,d.jsx)(tr.Z,{recycle:!0,numberOfPieces:200,gravity:.01,initialVelocityX:{min:-7,max:7},initialVelocityY:{min:4,max:8},colors:tl,tweenDuration:7e3,opacity:.9}),r[0]=t):t=r[0],r[1]===Symbol.for("react.memo_cache_sentinel")?(i=(0,d.jsx)("h2",{className:"text-4xl font-bold mb-3 bg-gradient-to-br from-purple-300 via-pink-200 to-yellow-100 bg-clip-text text-transparent",children:"Game Over!"}),s=(0,d.jsx)("p",{className:"text-xl text-base-content opacity-90 mb-6",children:"Your final score is:"}),r[1]=i,r[2]=s):(i=r[1],s=r[2]),r[3]!==l?(a=(0,d.jsx)("p",{className:"text-6xl font-extrabold mb-6",children:l}),r[3]=l,r[4]=a):a=r[4],r[5]!==c?(n=(0,d.jsx)("button",{onClick:c,className:"btn-dream w-full",children:"Back to Main Menu"}),r[5]=c,r[6]=n):n=r[6],r[7]!==a||r[8]!==n?(o=(0,d.jsxs)("div",{className:"absolute inset-0 bg-base-200 bg-opacity-90 flex flex-col items-center justify-center z-20 pointer-events-auto overflow-hidden",children:[t,(0,d.jsxs)("div",{className:"relative z-10 bg-base-100 p-8 rounded-lg shadow-xl text-center max-w-md w-full transform transition-all scale-100 opacity-100",children:[i,s,a,n]})]}),r[7]=a,r[8]=n,r[9]=o):o=r[9],o};var td=i(13742),th=i(76915),tm=i(49525),tp=i(49482),tu=i(78051);let tg=e=>{let t,i,s,a,n,o,r,l,c,m,u,g,y,f,x,b,P,_,w,M,I,N=(0,p.c)(43),{onLeaveLobby:T,onStartGame:k}=e,E=S(ty),C=S(tf),z=S(tx),j=v(),A=null==j?void 0:j.sessionId,D=null==j?void 0:j.roomId,[O,L]=(0,h.useState)(!1),F=h.useRef(null);e:{let e;if(!C){let e;N[0]===Symbol.for("react.memo_cache_sentinel")?(e=[],N[0]=e):e=N[0],t=e;break e}N[1]!==C?(e=Array.from(C.entries()).map(tb),N[1]=C,N[2]=e):e=N[2],t=e}let R=t,B=A===E;N[3]===Symbol.for("react.memo_cache_sentinel")?(i=()=>()=>{F.current&&clearTimeout(F.current)},s=[],N[3]=i,N[4]=s):(i=N[3],s=N[4]),(0,h.useEffect)(i,s),N[5]!==O||N[6]!==D?(a=()=>{D&&!O&&navigator.clipboard.writeText(D).then(()=>{L(!0),F.current&&clearTimeout(F.current),F.current=setTimeout(()=>{L(!1),F.current=null},1500)}).catch(tP)},N[5]=O,N[6]=D,N[7]=a):a=N[7];let U=a;N[8]===Symbol.for("react.memo_cache_sentinel")?(n={opacity:0,scale:.9},o={opacity:1,scale:1},r={opacity:0,scale:.9},l={duration:.3},N[8]=n,N[9]=o,N[10]=r,N[11]=l):(n=N[8],o=N[9],r=N[10],l=N[11]),N[12]===Symbol.for("react.memo_cache_sentinel")?(c=(0,d.jsx)("h2",{className:"text-4xl font-bold mb-4 bg-gradient-to-br from-purple-300 via-pink-200 to-yellow-100 bg-clip-text text-transparent",children:"Game Lobby"}),N[12]=c):c=N[12],N[13]!==U||N[14]!==O||N[15]!==D?(m=D&&(0,d.jsxs)("div",{className:"mb-6 flex items-center justify-center gap-2 text-sm text-base-content opacity-70",children:[(0,d.jsxs)("span",{children:["Room ID: ",D]}),(0,d.jsx)("button",{onClick:U,title:"Copy Room ID",className:"p-1 rounded hover:bg-base-300 transition-colors cursor-pointer relative overflow-hidden h-5 w-5 flex items-center justify-center",disabled:O,children:(0,d.jsx)(eY.M,{mode:"wait",initial:!1,children:O?(0,d.jsx)(eZ.E.div,{initial:{opacity:0,scale:.5},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.5},transition:{duration:.2},className:"flex items-center justify-center text-success",children:(0,d.jsx)(td.Z,{size:16,strokeWidth:3})},"copied"):(0,d.jsx)(eZ.E.div,{initial:{opacity:0,scale:.5},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.5},transition:{duration:.2},className:"flex items-center justify-center",children:(0,d.jsx)(th.Z,{size:14})},"copy")})})]}),N[13]=U,N[14]=O,N[15]=D,N[16]=m):m=N[16],N[17]===Symbol.for("react.memo_cache_sentinel")?(u=(0,d.jsx)(tm.Z,{size:20}),N[17]=u):u=N[17],N[18]!==z||N[19]!==R.length?(g=(0,d.jsxs)("h3",{className:"text-xl font-semibold mb-3 text-base-content opacity-90 flex items-center justify-center gap-2",children:[u," Players (",R.length," / ",z,")"]}),N[18]=z,N[19]=R.length,N[20]=g):g=N[20],N[21]!==A||N[22]!==R?(y=R.length>0?R.map(e=>{let{sessionId:t,player:i}=e;return(0,d.jsxs)("li",{className:`text-lg p-2 rounded ${t===A?"bg-gradient-to-br from-purple-300 via-pink-200 to-yellow-100 text-primary-content font-semibold":"bg-base-100 text-base-content"}`,children:[i.name," ",t===A&&"(You)"]},t)}):(0,d.jsx)("li",{className:"text-base-content opacity-60 italic",children:"Waiting for players..."}),N[21]=A,N[22]=R,N[23]=y):y=N[23],N[24]!==y?(f=(0,d.jsx)("ul",{className:"space-y-2 max-h-40 overflow-y-auto bg-base-200 p-3 rounded-lg border",children:y}),N[24]=y,N[25]=f):f=N[25],N[26]!==g||N[27]!==f?(x=(0,d.jsxs)("div",{className:"mb-6",children:[g,f]}),N[26]=g,N[27]=f,N[28]=x):x=N[28];let V=!B;return N[29]===Symbol.for("react.memo_cache_sentinel")?(b=(0,d.jsx)(tp.Z,{size:20,strokeWidth:3}),N[29]=b):b=N[29],N[30]!==k||N[31]!==V?(P=(0,d.jsxs)("button",{onClick:k,className:"btn-dream flex-1 flex items-center justify-center gap-2 disabled:opacity-50",disabled:V,children:[b," Start Game"]}),N[30]=k,N[31]=V,N[32]=P):P=N[32],N[33]===Symbol.for("react.memo_cache_sentinel")?(_=(0,d.jsx)(tu.Z,{size:18,strokeWidth:2.5}),N[33]=_):_=N[33],N[34]!==T?(w=(0,d.jsxs)("button",{onClick:T,className:"btn-dream bg-error/80 hover:bg-error text-error-content flex items-center justify-center gap-1.5",children:[_," Leave"]}),N[34]=T,N[35]=w):w=N[35],N[36]!==P||N[37]!==w?(M=(0,d.jsxs)("div",{className:"flex flex-col sm:flex-row gap-4 justify-center",children:[P,w]}),N[36]=P,N[37]=w,N[38]=M):M=N[38],N[39]!==m||N[40]!==x||N[41]!==M?(I=(0,d.jsx)(eZ.E.div,{initial:n,animate:o,exit:r,transition:l,className:"absolute inset-0 bg-base-200 bg-opacity-95 flex flex-col items-center justify-center z-10 pointer-events-auto p-6",children:(0,d.jsxs)("div",{className:"bg-base-100 p-8 rounded-xl shadow-2xl w-full max-w-md text-center",children:[c,m,x,M]})}),N[39]=m,N[40]=x,N[41]=M,N[42]=I):I=N[42],I};function ty(e){return e.hostId}function tf(e){return e.players}function tx(e){return e.maxClients}function tb(e){let[t,i]=e;return{sessionId:t,player:i}}function tP(e){console.error("Failed to copy Room ID: ",e)}var tv=i(41352),tS=i(13542),t_=i(72761),tw=i(92559);let tM=e=>{let t,i,s,a,n,o,r,l,c,m,u,g,y,f,x,b,P,v,S,_,w,M,I,N,T,k,E,C,z,j,A,D,O,L,F,R,B,U,V,G,$,H,K,W,q,Z,Y,Q,J,X,ee,et,ei,es,ea,en,eo,er,el,ec,ed,eh,em,ep,eu,eg,ey,ef,ex,eb,eP,ev,e_,ew,eM,eI,eN,eT,ek,eE,eC,ez,ej,eA,eD,eO,eL,eF,eR,eB,eU,eV,eG,e$,eH,eK,eW,eq,eY,eQ,eJ,eX=(0,p.c)(261),{applySettingsChanges:e0,size:e1}=e;eX[0]===Symbol.for("react.memo_cache_sentinel")?(t=eS.getSensitivityX(),eX[0]=t):t=eX[0];let[e2,e5]=(0,h.useState)(t);eX[1]===Symbol.for("react.memo_cache_sentinel")?(i=eS.getSensitivityY(),eX[1]=i):i=eX[1];let[e3,e4]=(0,h.useState)(i);eX[2]===Symbol.for("react.memo_cache_sentinel")?(s=eS.getWheelPrecision(),eX[2]=s):s=eX[2];let[e8,e6]=(0,h.useState)(s);eX[3]===Symbol.for("react.memo_cache_sentinel")?(a=eS.getInvertY(),eX[3]=a):a=eX[3];let[e7,e9]=(0,h.useState)(a);eX[4]===Symbol.for("react.memo_cache_sentinel")?(n=eS.getFov(),eX[4]=n):n=eX[4];let[te,tt]=(0,h.useState)(n);eX[5]===Symbol.for("react.memo_cache_sentinel")?(o=eS.getShowFps(),eX[5]=o):o=eX[5];let[ti,ts]=(0,h.useState)(o);eX[6]===Symbol.for("react.memo_cache_sentinel")?(r=eS.getGraphicsQuality(),eX[6]=r):r=eX[6];let[ta,tn]=(0,h.useState)(r);eX[7]===Symbol.for("react.memo_cache_sentinel")?(l=eS.getMasterVolume(),eX[7]=l):l=eX[7];let[to,tr]=(0,h.useState)(l);eX[8]===Symbol.for("react.memo_cache_sentinel")?(c=eS.getMusicEnabled(),eX[8]=c):c=eX[8];let[tl,tc]=(0,h.useState)(c);eX[9]===Symbol.for("react.memo_cache_sentinel")?(m=eS.getMusicVolume(),eX[9]=m):m=eX[9];let[td,th]=(0,h.useState)(m);eX[10]===Symbol.for("react.memo_cache_sentinel")?(u=eS.getSfxVolume(),eX[10]=u):u=eX[10];let[tm,tp]=(0,h.useState)(u);eX[11]!==e0?(g=(e,t,i)=>{e(i),t(i),e0()},eX[11]=e0,eX[12]=g):g=eX[12];let tu=g;eX[13]!==tu?(y=e=>tu(tn,eS.setGraphicsQuality,e.target.value),eX[13]=tu,eX[14]=y):y=eX[14];let tg=y;eX[15]!==tu?(f=e=>tu(e5,eS.setSensitivityX,parseFloat(e.target.value)),eX[15]=tu,eX[16]=f):f=eX[16];let ty=f;eX[17]!==tu?(x=e=>tu(e4,eS.setSensitivityY,parseFloat(e.target.value)),eX[17]=tu,eX[18]=x):x=eX[18];let tf=x;eX[19]!==tu?(b=e=>tu(e6,eS.setWheelPrecision,parseFloat(e.target.value)),eX[19]=tu,eX[20]=b):b=eX[20];let tx=b;eX[21]!==tu?(P=e=>tu(e9,eS.setInvertY,e.target.checked),eX[21]=tu,eX[22]=P):P=eX[22];let tb=P;eX[23]!==tu?(v=e=>tu(tt,eS.setFov,parseFloat(e.target.value)),eX[23]=tu,eX[24]=v):v=eX[24];let tP=v;eX[25]!==tu?(S=e=>tu(ts,eS.setShowFps,e.target.checked),eX[25]=tu,eX[26]=S):S=eX[26];let tv=S;eX[27]!==tu?(_=e=>tu(tr,eS.setMasterVolume,parseFloat(e.target.value)),eX[27]=tu,eX[28]=_):_=eX[28];let tM=_;eX[29]!==tu?(w=e=>tu(tc,eS.setMusicEnabled,e.target.checked),eX[29]=tu,eX[30]=w):w=eX[30];let tI=w;eX[31]!==tu?(M=e=>tu(th,eS.setMusicVolume,parseFloat(e.target.value)),eX[31]=tu,eX[32]=M):M=eX[32];let tN=M;eX[33]!==tu?(I=e=>tu(tp,eS.setSfxVolume,parseFloat(e.target.value)),eX[33]=tu,eX[34]=I):I=eX[34];let tT=I,tk="small"===(void 0===e1?"large":e1),tE=tk?"p-2":"p-4",tC=tk?"border border-secondary/10":"border border-base-300",tz=tk?"bg-base-200/50":"bg-base-200/40",tj=tk?"text-md font-semibold mb-1 flex items-center gap-1":"text-lg font-bold mb-3 border-b pb-1 flex items-center gap-2",tA=tk?"block text-[14px] opacity-70":"block text-md font-medium mb-1 opacity-80",tD=tk?"range range-xs":"range range-sm",tO=tk?"text-[14px] font-mono w-8 text-right opacity-70":"text-md font-mono w-10 text-right opacity-70",tL=`${(180/Math.PI*te).toFixed(0)}\xb0`;eX[35]===Symbol.for("react.memo_cache_sentinel")?(N={opacity:0,y:-10},T={opacity:1,y:0},k={delay:.1},eX[35]=N,eX[36]=T,eX[37]=k):(N=eX[35],T=eX[36],k=eX[37]);let tF=`${tE} ${tz} rounded-lg ${tC}`,tR=`${tj} text-secondary border-secondary/30`,tB=tk?12:18;eX[38]!==tB?(E=(0,d.jsx)(tS.Z,{size:tB}),eX[38]=tB,eX[39]=E):E=eX[39];let tU=tk?"Sensitivity":"Mouse & Camera";eX[40]!==tR||eX[41]!==E||eX[42]!==tU?(C=(0,d.jsxs)("h3",{className:tR,children:[E," ",tU]}),eX[40]=tR,eX[41]=E,eX[42]=tU,eX[43]=C):C=eX[43];let tV=`space-y-${tk?1:3}`;eX[44]!==tA?(z=(0,d.jsx)("label",{htmlFor:"sensX",className:tA,children:"Horizontal Sensitivity"}),eX[44]=tA,eX[45]=z):z=eX[45];let tG=`${tD} range-primary flex-grow`;eX[46]!==ty||eX[47]!==e2||eX[48]!==tG?(j=(0,d.jsx)("input",{type:"range",id:"sensX",min:"0.1",max:"5",step:"0.1",value:e2,onChange:ty,className:tG}),eX[46]=ty,eX[47]=e2,eX[48]=tG,eX[49]=j):j=eX[49],eX[50]!==e2?(A=e2.toFixed(1),eX[50]=e2,eX[51]=A):A=eX[51],eX[52]!==A||eX[53]!==tO?(D=(0,d.jsx)("span",{className:tO,children:A}),eX[52]=A,eX[53]=tO,eX[54]=D):D=eX[54],eX[55]!==j||eX[56]!==D?(O=(0,d.jsxs)("div",{className:"flex items-center gap-3",children:[j,D]}),eX[55]=j,eX[56]=D,eX[57]=O):O=eX[57],eX[58]!==z||eX[59]!==O?(L=(0,d.jsxs)("div",{children:[z,O]}),eX[58]=z,eX[59]=O,eX[60]=L):L=eX[60],eX[61]!==tA?(F=(0,d.jsx)("label",{htmlFor:"sensY",className:tA,children:"Vertical Sensitivity"}),eX[61]=tA,eX[62]=F):F=eX[62];let t$=`${tD} range-accent flex-grow`;eX[63]!==tf||eX[64]!==e3||eX[65]!==t$?(R=(0,d.jsx)("input",{type:"range",id:"sensY",min:"0.1",max:"5",step:"0.1",value:e3,onChange:tf,className:t$}),eX[63]=tf,eX[64]=e3,eX[65]=t$,eX[66]=R):R=eX[66],eX[67]!==e3?(B=e3.toFixed(1),eX[67]=e3,eX[68]=B):B=eX[68],eX[69]!==B||eX[70]!==tO?(U=(0,d.jsx)("span",{className:tO,children:B}),eX[69]=B,eX[70]=tO,eX[71]=U):U=eX[71],eX[72]!==R||eX[73]!==U?(V=(0,d.jsxs)("div",{className:"flex items-center gap-3",children:[R,U]}),eX[72]=R,eX[73]=U,eX[74]=V):V=eX[74],eX[75]!==F||eX[76]!==V?(G=(0,d.jsxs)("div",{children:[F,V]}),eX[75]=F,eX[76]=V,eX[77]=G):G=eX[77];let tH=`cursor-pointer label justify-start gap-2 p-0 ${tk?"mt-1":""}`;eX[78]!==tb||eX[79]!==e7?($=(0,d.jsx)("input",{type:"checkbox",className:"toggle toggle-sm toggle-secondary",checked:e7,onChange:tb}),eX[78]=tb,eX[79]=e7,eX[80]=$):$=eX[80];let tK=`label-text ${tk?"text-[14px]":"text-md"}`;eX[81]!==tK?(H=(0,d.jsx)("span",{className:tK,children:"Invert Vertical Axis"}),eX[81]=tK,eX[82]=H):H=eX[82],eX[83]!==tH||eX[84]!==$||eX[85]!==H?(K=(0,d.jsx)("div",{className:"form-control",children:(0,d.jsxs)("label",{className:tH,children:[$,H]})}),eX[83]=tH,eX[84]=$,eX[85]=H,eX[86]=K):K=eX[86],eX[87]!==tA?(W=(0,d.jsx)("label",{htmlFor:"wheelPrec",className:tA,children:"Zoom Precision (Wheel)"}),eX[87]=tA,eX[88]=W):W=eX[88];let tW=`${tD} range-secondary flex-grow`;eX[89]!==tx||eX[90]!==tW||eX[91]!==e8?(q=(0,d.jsx)("input",{type:"range",id:"wheelPrec",min:"1",max:"100",step:"1",value:e8,onChange:tx,className:tW}),eX[89]=tx,eX[90]=tW,eX[91]=e8,eX[92]=q):q=eX[92],eX[93]!==tO||eX[94]!==e8?(Z=(0,d.jsx)("span",{className:tO,children:e8}),eX[93]=tO,eX[94]=e8,eX[95]=Z):Z=eX[95],eX[96]!==q||eX[97]!==Z?(Y=(0,d.jsxs)("div",{className:"flex items-center gap-3",children:[q,Z]}),eX[96]=q,eX[97]=Z,eX[98]=Y):Y=eX[98],eX[99]!==W||eX[100]!==Y?(Q=(0,d.jsxs)("div",{children:[W,Y]}),eX[99]=W,eX[100]=Y,eX[101]=Q):Q=eX[101],eX[102]!==tA?(J=(0,d.jsx)("label",{htmlFor:"fov",className:tA,children:"Field of View (FOV)"}),eX[102]=tA,eX[103]=J):J=eX[103];let tq=`${tD} range-info flex-grow`;eX[104]!==te||eX[105]!==tP||eX[106]!==tq?(X=(0,d.jsx)("input",{type:"range",id:"fov",min:"0.5",max:"1.4",step:"0.05",value:te,onChange:tP,className:tq}),eX[104]=te,eX[105]=tP,eX[106]=tq,eX[107]=X):X=eX[107],eX[108]!==tL||eX[109]!==tO?(ee=(0,d.jsx)("span",{className:tO,children:tL}),eX[108]=tL,eX[109]=tO,eX[110]=ee):ee=eX[110],eX[111]!==X||eX[112]!==ee?(et=(0,d.jsxs)("div",{className:"flex items-center gap-3",children:[X,ee]}),eX[111]=X,eX[112]=ee,eX[113]=et):et=eX[113],eX[114]!==J||eX[115]!==et?(ei=(0,d.jsxs)("div",{children:[J,et]}),eX[114]=J,eX[115]=et,eX[116]=ei):ei=eX[116],eX[117]!==tV||eX[118]!==L||eX[119]!==G||eX[120]!==K||eX[121]!==Q||eX[122]!==ei?(es=(0,d.jsxs)("div",{className:tV,children:[L,G,K,Q,ei]}),eX[117]=tV,eX[118]=L,eX[119]=G,eX[120]=K,eX[121]=Q,eX[122]=ei,eX[123]=es):es=eX[123],eX[124]!==tF||eX[125]!==C||eX[126]!==es?(ea=(0,d.jsxs)(eZ.E.section,{initial:N,animate:T,transition:k,className:tF,children:[C,es]}),eX[124]=tF,eX[125]=C,eX[126]=es,eX[127]=ea):ea=eX[127],eX[128]===Symbol.for("react.memo_cache_sentinel")?(en={opacity:0,y:-10},eo={opacity:1,y:0},er={delay:.2},eX[128]=en,eX[129]=eo,eX[130]=er):(en=eX[128],eo=eX[129],er=eX[130]);let tZ=`${tE} ${tz} rounded-lg ${tC}`,tY=`${tj} text-info border-info/30`,tQ=tk?12:18;eX[131]!==tQ?(el=(0,d.jsx)(t_.Z,{size:tQ}),eX[131]=tQ,eX[132]=el):el=eX[132],eX[133]!==tY||eX[134]!==el?(ec=(0,d.jsxs)("h3",{className:tY,children:[el," Display"]}),eX[133]=tY,eX[134]=el,eX[135]=ec):ec=eX[135];let tJ=tk?"space-y-1":"flex flex-col md:flex-row md:items-end gap-4",tX=tk?"":"flex-1";eX[136]!==tA?(ed=(0,d.jsx)("label",{htmlFor:"graphicsQuality",className:tA,children:"Overall Quality"}),eX[136]=tA,eX[137]=ed):ed=eX[137];let t0=tk?"\uD83D\uDC22":"(Perf ++)";eX[138]!==t0?(eh=(0,d.jsxs)("option",{value:"low",children:["Low ",t0]}),eX[138]=t0,eX[139]=eh):eh=eX[139];let t1=tk?"\uD83D\uDC07":"(Balanced)";eX[140]!==t1?(em=(0,d.jsxs)("option",{value:"medium",children:["Medium ",t1]}),eX[140]=t1,eX[141]=em):em=eX[141];let t2=tk?"\uD83D\uDE80":"(Quality ++)";eX[142]!==t2?(ep=(0,d.jsxs)("option",{value:"high",children:["High ",t2]}),eX[142]=t2,eX[143]=ep):ep=eX[143],eX[144]!==ta||eX[145]!==tg||eX[146]!==eh||eX[147]!==em||eX[148]!==ep?(eu=(0,d.jsxs)("select",{id:"graphicsQuality",className:"select select-bordered select-md select-info w-full",value:ta,onChange:tg,children:[eh,em,ep]}),eX[144]=ta,eX[145]=tg,eX[146]=eh,eX[147]=em,eX[148]=ep,eX[149]=eu):eu=eX[149],eX[150]!==tX||eX[151]!==ed||eX[152]!==eu?(eg=(0,d.jsxs)("div",{className:tX,children:[ed,eu]}),eX[150]=tX,eX[151]=ed,eX[152]=eu,eX[153]=eg):eg=eX[153];let t5=`form-control ${tk?"":"w-auto mb-1"}`,t3=`cursor-pointer label ${tk?"justify-start gap-2 p-0 mt-1":"py-0"}`,t4=`label-text ${tk?"text-[10px]":"text-md mr-2 opacity-80"}`,t8=tk?"⏱️":"";eX[154]!==t4||eX[155]!==t8?(ey=(0,d.jsxs)("span",{className:t4,children:["Show FPS ",t8]}),eX[154]=t4,eX[155]=t8,eX[156]=ey):ey=eX[156],eX[157]!==tv||eX[158]!==ti?(ef=(0,d.jsx)("input",{type:"checkbox",className:"toggle toggle-sm toggle-info",checked:ti,onChange:tv}),eX[157]=tv,eX[158]=ti,eX[159]=ef):ef=eX[159],eX[160]!==t3||eX[161]!==ey||eX[162]!==ef?(ex=(0,d.jsxs)("label",{className:t3,children:[ey,ef]}),eX[160]=t3,eX[161]=ey,eX[162]=ef,eX[163]=ex):ex=eX[163],eX[164]!==t5||eX[165]!==ex?(eb=(0,d.jsx)("div",{className:t5,children:ex}),eX[164]=t5,eX[165]=ex,eX[166]=eb):eb=eX[166],eX[167]!==tJ||eX[168]!==eg||eX[169]!==eb?(eP=(0,d.jsxs)("div",{className:tJ,children:[eg,eb]}),eX[167]=tJ,eX[168]=eg,eX[169]=eb,eX[170]=eP):eP=eX[170],eX[171]!==tZ||eX[172]!==ec||eX[173]!==eP?(ev=(0,d.jsxs)(eZ.E.section,{initial:en,animate:eo,transition:er,className:tZ,children:[ec,eP]}),eX[171]=tZ,eX[172]=ec,eX[173]=eP,eX[174]=ev):ev=eX[174],eX[175]===Symbol.for("react.memo_cache_sentinel")?(e_={opacity:0,y:-10},ew={opacity:1,y:0},eM={delay:.3},eX[175]=e_,eX[176]=ew,eX[177]=eM):(e_=eX[175],ew=eX[176],eM=eX[177]);let t6=`${tE} ${tz} rounded-lg ${tC}`,t7=`${tj} text-warning border-warning/30`,t9=tk?12:18;eX[178]!==t9?(eI=(0,d.jsx)(tw.Z,{size:t9}),eX[178]=t9,eX[179]=eI):eI=eX[179];let ie=tk?"\uD83D\uDD0A":"";eX[180]!==t7||eX[181]!==eI||eX[182]!==ie?(eN=(0,d.jsxs)("h3",{className:t7,children:[eI," Audio ",ie]}),eX[180]=t7,eX[181]=eI,eX[182]=ie,eX[183]=eN):eN=eX[183];let it=`space-y-${tk?1:3}`;eX[184]!==tA?(eT=(0,d.jsx)("label",{htmlFor:"masterVol",className:tA,children:"Master Volume \uD83D\uDCE2"}),eX[184]=tA,eX[185]=eT):eT=eX[185];let ii=`${tD} range-primary flex-grow`;eX[186]!==tM||eX[187]!==to||eX[188]!==ii?(ek=(0,d.jsx)("input",{type:"range",id:"masterVol",min:"0",max:"1",step:"0.05",value:to,onChange:tM,className:ii}),eX[186]=tM,eX[187]=to,eX[188]=ii,eX[189]=ek):ek=eX[189],eX[190]!==to?(eE=Math.round(100*to),eX[190]=to,eX[191]=eE):eE=eX[191],eX[192]!==eE||eX[193]!==tO?(eC=(0,d.jsxs)("span",{className:tO,children:[eE,"%"]}),eX[192]=eE,eX[193]=tO,eX[194]=eC):eC=eX[194],eX[195]!==ek||eX[196]!==eC?(ez=(0,d.jsxs)("div",{className:"flex items-center gap-3",children:[ek,eC]}),eX[195]=ek,eX[196]=eC,eX[197]=ez):ez=eX[197],eX[198]!==eT||eX[199]!==ez?(ej=(0,d.jsxs)("div",{children:[eT,ez]}),eX[198]=eT,eX[199]=ez,eX[200]=ej):ej=eX[200];let is=tk?"flex items-center gap-2":"flex flex-col md:flex-row md:items-center gap-4",ia=`label-text ${tk?"text-[14px]":"text-md mr-2"}`,io=tk?"\uD83C\uDFB6":"";eX[201]!==ia||eX[202]!==io?(eA=(0,d.jsxs)("span",{className:ia,children:["Music ",io]}),eX[201]=ia,eX[202]=io,eX[203]=eA):eA=eX[203],eX[204]!==tI||eX[205]!==tl?(eD=(0,d.jsx)("input",{type:"checkbox",className:"toggle toggle-sm toggle-warning",checked:tl,onChange:tI}),eX[204]=tI,eX[205]=tl,eX[206]=eD):eD=eX[206],eX[207]!==eA||eX[208]!==eD?(eO=(0,d.jsx)("div",{className:"form-control w-auto",children:(0,d.jsxs)("label",{className:"cursor-pointer label justify-start gap-2 p-0",children:[eA,eD]})}),eX[207]=eA,eX[208]=eD,eX[209]=eO):eO=eX[209];let ir=tk?"flex-grow":"flex-1",il=`${tD} range-warning flex-grow`,ic=!tl;eX[210]!==tN||eX[211]!==td||eX[212]!==il||eX[213]!==ic?(eL=(0,d.jsx)("input",{type:"range",id:"musicVol",min:"0",max:"1",step:"0.05",value:td,onChange:tN,className:il,disabled:ic}),eX[210]=tN,eX[211]=td,eX[212]=il,eX[213]=ic,eX[214]=eL):eL=eX[214];let id=`${tO} ${!tl?"opacity-50":""}`;eX[215]!==td?(eF=Math.round(100*td),eX[215]=td,eX[216]=eF):eF=eX[216],eX[217]!==id||eX[218]!==eF?(eR=(0,d.jsxs)("span",{className:id,children:[eF,"%"]}),eX[217]=id,eX[218]=eF,eX[219]=eR):eR=eX[219],eX[220]!==eL||eX[221]!==eR?(eB=(0,d.jsxs)("div",{className:"flex items-center gap-3",children:[eL,eR]}),eX[220]=eL,eX[221]=eR,eX[222]=eB):eB=eX[222],eX[223]!==ir||eX[224]!==eB?(eU=(0,d.jsx)("div",{className:ir,children:eB}),eX[223]=ir,eX[224]=eB,eX[225]=eU):eU=eX[225],eX[226]!==is||eX[227]!==eO||eX[228]!==eU?(eV=(0,d.jsxs)("div",{className:is,children:[eO,eU]}),eX[226]=is,eX[227]=eO,eX[228]=eU,eX[229]=eV):eV=eX[229];let ih=tk?"\uD83D\uDCA5":"";eX[230]!==tA||eX[231]!==ih?(eG=(0,d.jsxs)("label",{htmlFor:"sfxVol",className:tA,children:["Effects Volume ",ih]}),eX[230]=tA,eX[231]=ih,eX[232]=eG):eG=eX[232];let im=`${tD} range-error flex-grow`;return eX[233]!==tT||eX[234]!==tm||eX[235]!==im?(e$=(0,d.jsx)("input",{type:"range",id:"sfxVol",min:"0",max:"1",step:"0.05",value:tm,onChange:tT,className:im}),eX[233]=tT,eX[234]=tm,eX[235]=im,eX[236]=e$):e$=eX[236],eX[237]!==tm?(eH=Math.round(100*tm),eX[237]=tm,eX[238]=eH):eH=eX[238],eX[239]!==eH||eX[240]!==tO?(eK=(0,d.jsxs)("span",{className:tO,children:[eH,"%"]}),eX[239]=eH,eX[240]=tO,eX[241]=eK):eK=eX[241],eX[242]!==e$||eX[243]!==eK?(eW=(0,d.jsxs)("div",{className:"flex items-center gap-3",children:[e$,eK]}),eX[242]=e$,eX[243]=eK,eX[244]=eW):eW=eX[244],eX[245]!==eG||eX[246]!==eW?(eq=(0,d.jsxs)("div",{children:[eG,eW]}),eX[245]=eG,eX[246]=eW,eX[247]=eq):eq=eX[247],eX[248]!==it||eX[249]!==ej||eX[250]!==eV||eX[251]!==eq?(eY=(0,d.jsxs)("div",{className:it,children:[ej,eV,eq]}),eX[248]=it,eX[249]=ej,eX[250]=eV,eX[251]=eq,eX[252]=eY):eY=eX[252],eX[253]!==t6||eX[254]!==eN||eX[255]!==eY?(eQ=(0,d.jsxs)(eZ.E.section,{initial:e_,animate:ew,transition:eM,className:t6,children:[eN,eY]}),eX[253]=t6,eX[254]=eN,eX[255]=eY,eX[256]=eQ):eQ=eX[256],eX[257]!==eQ||eX[258]!==ea||eX[259]!==ev?(eJ=(0,d.jsxs)(d.Fragment,{children:[ea,ev,eQ]}),eX[257]=eQ,eX[258]=ea,eX[259]=ev,eX[260]=eJ):eJ=eX[260],eJ},tI=e=>{let t,i,s=(0,p.c)(6),{applySettingsChanges:a}=e,n=eK(tN),o=eK(tT);return s[0]!==a||s[1]!==o||s[2]!==n?(t=o&&(0,d.jsx)(eZ.E.div,{initial:{opacity:0,y:-20,scale:.95},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:-10,scale:.95},transition:{duration:.2,ease:"easeOut"},className:"fixed inset-x-0 top-[10%] sm:top-[15%] mx-auto w-[90%] max-w-xs z-30 pointer-events-auto",onClick:tk,children:(0,d.jsxs)("div",{className:"bg-base-100/90 backdrop-blur-md p-4 rounded-xl shadow-lg border border-primary/30 text-base-content",children:[(0,d.jsx)("button",{onClick:()=>n(!1),className:"absolute top-1.5 right-1.5 btn btn-ghost btn-xs btn-circle text-primary/70 hover:bg-error/20 hover:text-error","aria-label":"Close",children:(0,d.jsx)(tv.Z,{size:16,strokeWidth:3})}),(0,d.jsx)("h2",{className:"text-base font-bold mb-3 text-center text-lg",children:"Quick Options ☕"}),(0,d.jsx)("div",{className:"space-y-3",children:(0,d.jsx)(tM,{applySettingsChanges:a,size:"small"})})]})}),s[0]=a,s[1]=o,s[2]=n,s[3]=t):t=s[3],s[4]!==t?(i=(0,d.jsx)(eY.M,{children:t}),s[4]=t,s[5]=i):i=s[5],i};function tN(e){return e.setInGameSettingsVisible}function tT(e){return e.inGameSettingsVisible}function tk(e){return e.stopPropagation()}let tE=e=>{let t,i,s=(0,p.c)(11),{onBackToMenu:a,gameEngineRef:n}=e,o=_(),r=w();if(s[0]!==(null==r?void 0:r.message)||s[1]!==o||s[2]!==n||s[3]!==a?(t=()=>{if(o===y.ERROR){var e;console.error("Connection error:",null==r?void 0:r.message),null==(e=n.current)||e.dispose(),a()}else o===y.RECONNECTING&&console.log("Attempting to reconnect to game server...")},s[0]=null==r?void 0:r.message,s[1]=o,s[2]=n,s[3]=a,s[4]=t):t=s[4],s[5]!==r||s[6]!==o||s[7]!==n||s[8]!==a?(i=[o,r,n,a],s[5]=r,s[6]=o,s[7]=n,s[8]=a,s[9]=i):i=s[9],(0,h.useEffect)(t,i),o===y.RECONNECTING){let e;return s[10]===Symbol.for("react.memo_cache_sentinel")?(e=(0,d.jsx)("div",{className:"absolute top-4 right-4 bg-warning text-white px-4 py-2 rounded-md shadow-lg",children:"Reconnecting to server..."}),s[10]=e):e=s[10],e}return null},tC=e=>{let{onBackToMenu:t,setGameEngineInstance:i,applySettingsChanges:s}=e,a=v(),n=(0,h.useRef)(null),[o,r]=(0,h.useState)(!1),[l,c]=(0,h.useState)(null),m=eK(e=>e.setMode),p=S(e=>e.gamePhase)??ei.WAITING,u=(0,h.useCallback)(e=>{c(e)},[]),g=(0,h.useCallback)(async e=>{if(!a)return;let t=new eq(e,a,u);n.current=t,i(t),t.getScene().getEngine().onEndFrameObservable.add(()=>{r(!0)}),await t.init()},[a,u,i]),y=(0,h.useCallback)(e=>{if(p===ei.PLAYING&&n.current){var t;let i=e.getEngine().getDeltaTime();null==(t=n.current)||t.update(i)}},[p]),f=(0,h.useCallback)(()=>{var e;null==(e=n.current)||e.dispose(),n.current=null,i(null)},[i]);(0,h.useEffect)(()=>()=>{var e;null==(e=n.current)||e.dispose(),n.current=null,i(null)},[i]);let x=(0,h.useCallback)(async()=>{try{await P()}catch(e){console.error("Error disconnecting from lobby room:",e),ek.Am.error("Couldn't cleanly leave the lobby, returning to list.")}finally{m("roomList")}},[m]);return(0,d.jsxs)("div",{className:"relative w-full h-full",children:[p===ei.WAITING&&(0,d.jsx)(tg,{onLeaveLobby:x,onStartGame:()=>{a&&a.send("startGame")}}),p===ei.PLAYING&&(0,d.jsx)(Z,{antialias:!0,onDispose:f,onSceneReady:g,onRender:y,id:"my-canvas",className:"w-full h-full"}),p===ei.PLAYING&&(0,d.jsx)(tI,{applySettingsChanges:s}),p===ei.PLAYING&&o&&(0,d.jsx)(to,{onBackToMenu:t}),p===ei.FINISHED&&(0,d.jsx)(tc,{finalScore:l??0,onBackToMenu:t}),(0,d.jsx)(tE,{onBackToMenu:t,gameEngineRef:n})]})};i(99518);var tz=i(73163),tj=i(45977),tA=i(95440),tD=i(96085),tO=i(87764),tL=i(37419),tF=i(13371),tR=i(39283);let tB=e=>{let t,i,s,a,n,o,r=(0,p.c)(17),{isOpen:l,onClose:c,onJoinAttempt:m,roomId:u,roomName:g}=e,[y,f]=(0,h.useState)(""),x=(0,h.useRef)(null);r[0]!==l?(t=()=>{l&&(setTimeout(()=>{var e;return null==(e=x.current)?void 0:e.focus()},100),f(""))},i=[l],r[0]=l,r[1]=t,r[2]=i):(t=r[1],i=r[2]),(0,h.useEffect)(t,i),r[3]!==m||r[4]!==y||r[5]!==u?(s=()=>{if(u){if(!y){var e;ek.ZP.error("Password cannot be empty."),null==(e=x.current)||e.focus();return}m(u,y)}},r[3]=m,r[4]=y,r[5]=u,r[6]=s):s=r[6];let b=s;r[7]!==b?(a=e=>{e.preventDefault(),b()},r[7]=b,r[8]=a):a=r[8];let P=a;return u&&g?(r[9]!==P||r[10]!==l||r[11]!==c||r[12]!==y||r[13]!==g?(n=l&&(0,d.jsx)(eZ.E.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4",onClick:c,children:(0,d.jsxs)(eZ.E.div,{initial:{scale:.8,opacity:0,y:-20},animate:{scale:1,opacity:1,y:0},exit:{scale:.8,opacity:0,y:-10},transition:{type:"spring",stiffness:150,damping:15},className:"bg-base-100 p-6 md:p-8 rounded-xl shadow-xl w-full max-w-sm border border-rose-200 relative",onClick:tU,children:[(0,d.jsx)("button",{onClick:c,className:"absolute top-3 right-3 btn btn-ghost btn-sm btn-circle text-base-content/70 hover:bg-error/20 hover:text-error","aria-label":"Close",children:(0,d.jsx)(tv.Z,{size:20,strokeWidth:3})}),(0,d.jsxs)("h3",{className:"text-3xl font-bold mb-4 text-center bg-gradient-to-br from-purple-300 via-pink-200 to-yellow-100 bg-clip-text text-transparent flex items-center justify-center gap-2",children:[(0,d.jsx)(tF.Z,{size:26})," Enter Password"]}),(0,d.jsxs)("p",{className:"text-center mb-6 text-base-content/100 text-lg",children:["Joining room: ",(0,d.jsx)("span",{className:"font-semibold text-rose-200",children:g})]}),(0,d.jsxs)("form",{onSubmit:P,className:"space-y-4",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{htmlFor:"joinPassword",className:"block text-md font-medium mb-1 opacity-80",children:"Room Password"}),(0,d.jsxs)("div",{className:"relative",children:[(0,d.jsx)("span",{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-base-content/40",children:(0,d.jsx)(tF.Z,{size:16})}),(0,d.jsx)("input",{ref:x,type:"password",id:"joinPassword",value:y,onChange:e=>f(e.target.value.slice(0,20)),maxLength:20,className:"input input-bordered input-rose-50 w-full pl-8",placeholder:"Enter room password..."})]})]}),(0,d.jsxs)("div",{className:"flex justify-end gap-3 pt-4",children:[(0,d.jsxs)("button",{type:"submit",className:"btn-dream flex-1 flex items-center justify-center gap-2",children:[(0,d.jsx)(tR.Z,{size:20,strokeWidth:2.5})," Join Room"]}),(0,d.jsx)("button",{type:"button",onClick:c,className:"btn-dream flex",children:"Cancel"})]})]})]})}),r[9]=P,r[10]=l,r[11]=c,r[12]=y,r[13]=g,r[14]=n):n=r[14],r[15]!==n?(o=(0,d.jsx)(eY.M,{children:n}),r[15]=n,r[16]=o):o=r[16],o):null};function tU(e){return e.stopPropagation()}let tV=e=>{var t,i,s,a,n,o;let r,l,c,h,m,u,g,y,f,x,b,P,v,S,_,w,M,I,N,T,k,E,C=(0,p.c)(46),{room:z,onJoin:j}=e,A=z.clients>=z.maxClients;C[0]!==z.createdAt?(r=function(e){let t=new Date(e),i=Math.round((new Date().getTime()-t.getTime())/1e3),s=Math.round(i/60),a=Math.round(s/60),n=Math.round(a/24);return i<60?`${i} sec ago`:s<60?`${s} min ago`:a<24?`${a} hr ago`:`${n} day(s) ago`}(z.createdAt),C[0]=z.createdAt,C[1]=r):r=C[1];let D=r,O=(null==(t=z.metadata)?void 0:t.roomName)||`Room ${z.roomId.substring(0,4)}`;C[2]!==O||C[3]!==j||C[4]!==(null==(i=z.metadata)?void 0:i.isPrivate)||C[5]!==z.roomId?(l=()=>{var e;j(z.roomId,(null==(e=z.metadata)?void 0:e.isPrivate)??!1,O)},C[2]=O,C[3]=j,C[4]=null==(a=z.metadata)?void 0:a.isPrivate,C[5]=z.roomId,C[6]=l):l=C[6];let L=l;C[7]===Symbol.for("react.memo_cache_sentinel")?(c={opacity:0,y:10},h={opacity:1,y:0},m={opacity:0,y:-10},u={duration:.2,ease:"easeOut"},C[7]=c,C[8]=h,C[9]=m,C[10]=u):(c=C[7],h=C[8],m=C[9],u=C[10]),C[11]===Symbol.for("react.memo_cache_sentinel")?(g=(0,d.jsx)(tz.Z,{size:20,strokeWidth:2.5}),C[11]=g):g=C[11],C[12]!==O?(y=(0,d.jsx)("span",{children:O}),C[12]=O,C[13]=y):y=C[13],C[14]!==(null==(s=z.metadata)?void 0:s.isPrivate)?(f=(null==(n=z.metadata)?void 0:n.isPrivate)&&(0,d.jsx)("span",{title:"Private Room",className:"text-secondary tooltip tooltip-right","data-tip":"Password Required",children:(0,d.jsx)(tj.Z,{size:16,strokeWidth:2.5})}),C[14]=null==(o=z.metadata)?void 0:o.isPrivate,C[15]=f):f=C[15],C[16]!==y||C[17]!==f?(x=(0,d.jsxs)("div",{className:"flex items-center gap-2 text-xl font-semibold",children:[g,y,f]}),C[16]=y,C[17]=f,C[18]=x):x=C[18],C[19]===Symbol.for("react.memo_cache_sentinel")?(b=(0,d.jsx)(tA.Z,{size:14,strokeWidth:2.5}),C[19]=b):b=C[19],C[20]!==z.roomId?(P=(0,d.jsxs)("div",{className:"flex items-center gap-2 text-lg text-base-content/80 font-mono",children:[b,(0,d.jsx)("span",{children:z.roomId})]}),C[20]=z.roomId,C[21]=P):P=C[21],C[22]===Symbol.for("react.memo_cache_sentinel")?(v=(0,d.jsx)(ti.Z,{size:12}),C[22]=v):v=C[22],C[23]!==D?(S=(0,d.jsxs)("div",{className:"flex items-center gap-1",children:[v,(0,d.jsxs)("span",{children:["Created ",D]})]}),C[23]=D,C[24]=S):S=C[24],C[25]===Symbol.for("react.memo_cache_sentinel")?(_=(0,d.jsx)(tm.Z,{size:12}),C[25]=_):_=C[25],C[26]!==z.clients||C[27]!==z.maxClients?(w=(0,d.jsxs)("div",{className:"flex items-center gap-1",children:[_,(0,d.jsxs)("span",{children:[z.clients," / ",z.maxClients," players"]})]}),C[26]=z.clients,C[27]=z.maxClients,C[28]=w):w=C[28],C[29]!==S||C[30]!==w?(M=(0,d.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center text-s text-base-content/60 gap-x-4 gap-y-1",children:[S,w]}),C[29]=S,C[30]=w,C[31]=M):M=C[31],C[32]!==x||C[33]!==P||C[34]!==M?(I=(0,d.jsxs)("div",{className:"flex-grow space-y-2",children:[x,P,M]}),C[32]=x,C[33]=P,C[34]=M,C[35]=I):I=C[35],C[36]===Symbol.for("react.memo_cache_sentinel")?(N={scale:1.05},T={scale:.95},C[36]=N,C[37]=T):(N=C[36],T=C[37]);let F=`btn-dream-small w-full sm:w-auto ${A||z.locked?"opacity-50 cursor-not-allowed !bg-gray-400":""}`,R=`Join room ${z.roomId}`,B=A||z.locked;return C[38]!==L||C[39]!==F||C[40]!==R||C[41]!==B?(k=(0,d.jsx)("div",{className:"flex-shrink-0 w-full sm:w-auto pt-2 sm:pt-0",children:(0,d.jsx)(eZ.E.button,{whileHover:N,whileTap:T,className:F,"aria-label":R,onClick:L,disabled:B,children:"Join"})}),C[38]=L,C[39]=F,C[40]=R,C[41]=B,C[42]=k):k=C[42],C[43]!==I||C[44]!==k?(E=(0,d.jsx)(eZ.E.li,{layout:!0,initial:c,animate:h,exit:m,transition:u,className:"bg-base-100 rounded-xl shadow-lg border border-rose-200 overflow-hidden transition-all duration-200 ease-out",children:(0,d.jsxs)("div",{className:"p-4 flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[I,k]})}),C[43]=I,C[44]=k,C[45]=E):E=C[45],E},tG=()=>{let e,t,i,s,a,n,o,r,l,c,m,u,g,f,x,b,P,v,S,w,M,I,T,k,E,C,z,j,A,D,O=(0,p.c)(63),L=N(),F=eK(t$),R=eK(tH),[B,U]=(0,h.useState)(""),[V,G]=(0,h.useState)(!1),[$,H]=(0,h.useState)(null),[K,W]=(0,h.useState)(null),q=_();if(O[0]!==L||O[1]!==B){let e=B.toLowerCase();t=L.filter(t=>{var i;let s=((null==(i=t.metadata)?void 0:i.roomName)||`Room ${t.roomId.substring(0,4)}`).toLowerCase(),a=t.roomId.toLowerCase(),n=""===e||s.includes(e)||a.includes(e);return!t.locked&&!t.unlisted&&n}),O[0]=L,O[1]=B,O[2]=t}else t=O[2];e=t,O[3]!==F?(i=()=>F("menu"),O[3]=F,O[4]=i):i=O[4];let Z=i;O[5]!==F?(s=()=>F("createRoom"),O[5]=F,O[6]=s):s=O[6];let Y=s;O[7]===Symbol.for("react.memo_cache_sentinel")?(a=()=>G(!1),O[7]=a):a=O[7];let Q=a;O[8]!==F||O[9]!==R?(n=(e,t,i)=>{t?(H(e),W(i),G(!0)):(R({roomId:e,options:{}}),F("game"))},O[8]=F,O[9]=R,O[10]=n):n=O[10];let J=n;O[11]!==F||O[12]!==R?(o=(e,t)=>{if(!t)return void ek.ZP.error("Password is required for private rooms.");console.log(`Attempting to join private room ${e} with password.`),R({roomId:e,options:{password:t}}),F("game"),G(!1)},O[11]=F,O[12]=R,O[13]=o):o=O[13];let X=o;O[14]!==q||O[15]!==V||O[16]!==$?(r=()=>{V&&(q===y.CONNECTED||q===y.ERROR)&&(G(!1),H(null),W(null)),!V&&$&&(H(null),W(null))},l=[q,V,$],O[14]=q,O[15]=V,O[16]=$,O[17]=r,O[18]=l):(r=O[17],l=O[18]),(0,h.useEffect)(r,l),O[19]!==e||O[20]!==F||O[21]!==R?(c=()=>{let t=e.find(tK);t?(console.log(`Quick Play: Joining room ${t.roomId}`),R({roomId:t.roomId,options:{}})):(console.log("Quick Play: No suitable public room found, creating new one..."),R({roomName:"game",forceCreate:!0,options:{roomName:`Quick Kitchen #${Math.floor(1e3*Math.random())}`,maxClients:4}})),F("game")},O[19]=e,O[20]=F,O[21]=R,O[22]=c):c=O[22];let ee=c;return O[23]===Symbol.for("react.memo_cache_sentinel")?(m={opacity:0},u={opacity:1},g={opacity:0},f={duration:.3},O[23]=m,O[24]=u,O[25]=g,O[26]=f):(m=O[23],u=O[24],g=O[25],f=O[26]),O[27]===Symbol.for("react.memo_cache_sentinel")?(x=(0,d.jsx)(tn.Z,{size:18,strokeWidth:3}),O[27]=x):x=O[27],O[28]!==Z?(b=(0,d.jsxs)("button",{className:"btn-dream flex-grow md:flex-grow-0 flex items-center justify-center gap-1 !py-2 !px-5 !text-md",onClick:Z,children:[x," Menu"]}),O[28]=Z,O[29]=b):b=O[29],O[30]===Symbol.for("react.memo_cache_sentinel")?(P=(0,d.jsx)(tp.Z,{size:18,strokeWidth:3}),O[30]=P):P=O[30],O[31]!==ee?(v=(0,d.jsxs)("button",{className:"btn-dream flex-grow md:flex-grow-0 flex items-center justify-center gap-1 !py-2 !px-5 !text-md",onClick:ee,children:[P," Quick Play"]}),O[31]=ee,O[32]=v):v=O[32],O[33]===Symbol.for("react.memo_cache_sentinel")?(S=(0,d.jsx)(tD.Z,{size:16,strokeWidth:3}),O[33]=S):S=O[33],O[34]!==Y?(w=(0,d.jsxs)("button",{className:"btn-dream flex-grow md:flex-grow-0 flex items-center justify-center gap-1 !py-2 !px-5 !text-md",onClick:Y,children:[S," Create"]}),O[34]=Y,O[35]=w):w=O[35],O[36]!==b||O[37]!==v||O[38]!==w?(M=(0,d.jsxs)("div",{className:"flex items-center gap-2 w-full md:w-auto",children:[b,v,w]}),O[36]=b,O[37]=v,O[38]=w,O[39]=M):M=O[39],O[40]===Symbol.for("react.memo_cache_sentinel")?(I=e=>U(e.target.value),O[40]=I):I=O[40],O[41]!==B?(T=(0,d.jsx)("input",{type:"text",placeholder:"Search rooms...",value:B,onChange:I,className:"input input-bordered input-md w-full pr-8"}),O[41]=B,O[42]=T):T=O[42],O[43]===Symbol.for("react.memo_cache_sentinel")?(k=(0,d.jsx)(tO.Z,{size:16,className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-base-content/50"}),O[43]=k):k=O[43],O[44]!==T?(E=(0,d.jsxs)("div",{className:"relative w-full md:w-64",children:[T,k]}),O[44]=T,O[45]=E):E=O[45],O[46]!==M||O[47]!==E?(C=(0,d.jsx)("div",{className:"w-full max-w-4xl mb-6 px-2 sticky top-0 z-10 bg-base-200/80 backdrop-blur-sm py-3 rounded-b-lg shadow-sm",children:(0,d.jsxs)("div",{className:"flex flex-col md:flex-row justify-between items-center gap-3 md:gap-4",children:[M,E]})}),O[46]=M,O[47]=E,O[48]=C):C=O[48],O[49]===Symbol.for("react.memo_cache_sentinel")?(z=(0,d.jsx)(eZ.E.h1,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},transition:{delay:.1,duration:.3},className:"text-3xl font-bold mb-6 text-center bg-gradient-to-br from-purple-300 via-pink-200 to-yellow-100 bg-clip-text text-transparent drop-shadow-sm",children:"Join a Game"}),O[49]=z):z=O[49],O[50]!==e||O[51]!==J||O[52]!==B?(j=(0,d.jsxs)("div",{className:"w-full max-w-4xl flex-1 overflow-y-auto pb-6 custom-scrollbar",children:[z,(0,d.jsx)(eY.M,{children:e.length>0?(0,d.jsx)(eZ.E.ul,{className:"space-y-4",children:e.map(e=>(0,d.jsx)(tV,{room:e,onJoin:J},e.roomId))}):(0,d.jsxs)(eZ.E.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},transition:{delay:.2},className:"text-center mt-10 p-6 bg-base-100 rounded-xl border border-base-300 shadow",children:[(0,d.jsx)(tL.Z,{size:48,className:"mx-auto mb-4 opacity-60"}),B?(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("p",{className:"text-xl font-semibold text-base-content opacity-80",children:"No kitchens match your search!"}),(0,d.jsx)("p",{className:"text-base-content/60 mt-2",children:"Try a different search term or create a new room."})]}):(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("p",{className:"text-xl font-semibold text-base-content opacity-80",children:"No public kitchens open right now !"}),(0,d.jsx)("p",{className:"text-base-content/60 mt-2",children:"Try 'Quick Play' or 'Create' one above !"})]})]},"no-rooms")})]}),O[50]=e,O[51]=J,O[52]=B,O[53]=j):j=O[53],O[54]!==X||O[55]!==V||O[56]!==$||O[57]!==K?(A=(0,d.jsx)(tB,{isOpen:V,onClose:Q,onJoinAttempt:X,roomId:$,roomName:K}),O[54]=X,O[55]=V,O[56]=$,O[57]=K,O[58]=A):A=O[58],O[59]!==C||O[60]!==j||O[61]!==A?(D=(0,d.jsxs)(eZ.E.div,{initial:m,animate:u,exit:g,transition:f,className:"flex flex-col items-center justify-start flex-1 bg-base-200 p-4 pt-6 md:pt-10 overflow-y-auto h-full",children:[C,j,A]}),O[59]=C,O[60]=j,O[61]=A,O[62]=D):D=O[62],D};function t$(e){return e.setMode}function tH(e){return e.setRoomToJoin}function tK(e){var t;return!(null==(t=e.metadata)?void 0:t.isPrivate)&&e.clients<e.maxClients}var tW=i(98814),tq=i(63618),tZ=i(73696),tY=i(30713),tQ=i(40116);let tJ={forward:"Move Forward",backward:"Move Backward",left:"Move Left",right:"Move Right",jump:"Jump",interact:"Interact",dance:"Dance"},tX=["Escape","F1","F2","F3","F4","F5","F6","F7","F8","F9","F10","F11","F12","PrintScreen","ScrollLock","Pause","ContextMenu","MetaLeft","MetaRight","ShiftLeft","ShiftRight","ControlLeft","ControlRight","AltLeft","AltRight","Enter","NumpadEnter","Tab"],t0=e=>{let t,i,s,a,n,o,r,l,c,m,u,g,y,f,x,b,P,v,S,_,w,M,I,N,T,k,E,C,z,j,A,D,O,L,F,R,B,U,V,G,$,H,K,W,q,Z,Y,Q,J,X,ee,et=(0,p.c)(81),{applySettingsChanges:ei}=e,es=eK(t1),ea=eK(t2);et[0]===Symbol.for("react.memo_cache_sentinel")?(t=eS.getUsername(),et[0]=t):t=et[0];let[en,eo]=(0,h.useState)(t);et[1]===Symbol.for("react.memo_cache_sentinel")?(i=eS.getKeyBindings(),et[1]=i):i=et[1];let[er,el]=(0,h.useState)(i),[ec,ed]=(0,h.useState)(null),[eh,em]=(0,h.useState)(null),[ep,eu]=(0,h.useState)(!1),eg=(0,h.useRef)(null);et[2]===Symbol.for("react.memo_cache_sentinel")?(s=e=>{eo(e.target.value.slice(0,16))},et[2]=s):s=et[2];let ey=s;et[3]!==en||et[4]!==ea?(a=e=>{null==e||e.preventDefault();let t=en.trim();if(t&&t.length>=3)ea(t),ek.ZP.success("Nickname saved!");else{var i;t?ek.ZP.error("Nickname must be at least 3 characters."):ek.ZP.error("Nickname cannot be empty."),eo(eS.getUsername()),null==(i=eg.current)||i.focus()}},et[3]=en,et[4]=ea,et[5]=a):a=et[5];let ef=a;et[6]===Symbol.for("react.memo_cache_sentinel")?(n=e=>{ed(e),em(null)},et[6]=n):n=et[6];let eb=n;et[7]!==ei?(o=()=>{let e={...ex};el(e),eS.setKeyBindings(e),em(null),ei(),ek.ZP.success("Keys reset to default.")},et[7]=ei,et[8]=o):o=et[8];let eP=o;return et[9]!==er||et[10]!==ec?(r=()=>{if(!ec)return;let e=e=>{e.preventDefault(),e.stopPropagation();let t=e.code;if(tX.includes(t)){em(`Reserved key: ${t}`),ed(null);return}let i=null;for(let e in er)if(er[e]===t&&e!==ec){i=e;break}if(i){em(`Key "${t}" already used by "${tJ[i]}"`),ed(null);return}let s={...er,[ec]:t};el(s),eS.setKeyBindings(s),ed(null),em(null)};return window.addEventListener("keydown",e,!0),()=>window.removeEventListener("keydown",e,!0)},l=[ec,er],et[9]=er,et[10]=ec,et[11]=r,et[12]=l):(r=et[11],l=et[12]),(0,h.useEffect)(r,l),et[13]===Symbol.for("react.memo_cache_sentinel")?(g={opacity:0},c={opacity:1},m={opacity:0},u={duration:.2},et[13]=c,et[14]=m,et[15]=u,et[16]=g):(c=et[13],m=et[14],u=et[15],g=et[16]),et[17]===Symbol.for("react.memo_cache_sentinel")?(y={y:-30,opacity:0,scale:.95},f={y:0,opacity:1,scale:1},x={delay:.1,duration:.3,ease:"easeOut"},et[17]=y,et[18]=f,et[19]=x):(y=et[17],f=et[18],x=et[19]),et[20]!==es?(b=()=>es("menu"),et[20]=es,et[21]=b):b=et[21],et[22]===Symbol.for("react.memo_cache_sentinel")?(P=(0,d.jsx)(tW.Z,{className:"text-rose-100",size:24,strokeWidth:2.5}),et[22]=P):P=et[22],et[23]!==b?(v=(0,d.jsx)("button",{onClick:b,className:"absolute top-3 left-3 btn btn-ghost btn-sm btn-circle z-10 hover:bg-base-content/10","aria-label":"Back",children:P}),et[23]=b,et[24]=v):v=et[24],et[25]===Symbol.for("react.memo_cache_sentinel")?(S=(0,d.jsx)("h2",{className:"w-full text-4xl font-extrabold mb-6 text-center bg-gradient-to-br from-purple-300 via-pink-200 to-yellow-100 bg-clip-text text-transparent flex items-center justify-center gap-3",children:"Settings"}),et[25]=S):S=et[25],et[26]===Symbol.for("react.memo_cache_sentinel")?(_={opacity:0,y:-10},w={opacity:1,y:0},M={delay:0},et[26]=_,et[27]=w,et[28]=M):(_=et[26],w=et[27],M=et[28]),et[29]===Symbol.for("react.memo_cache_sentinel")?(I=(0,d.jsxs)("h3",{className:"text-lg font-bold mb-4 border-b border-primary/30 pb-1 text-primary flex items-center gap-2",children:[(0,d.jsx)(tq.Z,{size:18})," Player Profile"]}),et[29]=I):I=et[29],et[30]===Symbol.for("react.memo_cache_sentinel")?(N=(0,d.jsx)("label",{htmlFor:"username",className:"block text-md font-medium mb-1 opacity-80",children:"In-game Nickname"}),et[30]=N):N=et[30],et[31]!==en?(T=(0,d.jsx)("input",{ref:eg,type:"text",id:"username",value:en,onChange:ey,maxLength:16,className:"input input-bordered input-primary input-md flex-grow",placeholder:"Your name..."}),et[31]=en,et[32]=T):T=et[32],et[33]===Symbol.for("react.memo_cache_sentinel")?(k=(0,d.jsx)("button",{type:"submit",className:"btn btn-primary btn-sm btn-outline btn-square","aria-label":"Save",children:(0,d.jsx)(tZ.Z,{size:16})}),et[33]=k):k=et[33],et[34]!==ef||et[35]!==T?(E=(0,d.jsxs)("form",{onSubmit:ef,className:"flex items-center gap-2",children:[T,k]}),et[34]=ef,et[35]=T,et[36]=E):E=et[36],et[37]===Symbol.for("react.memo_cache_sentinel")?(C=(0,d.jsx)("p",{className:"text-sm text-base-content/60 mt-1",children:"Visible to other players."}),et[37]=C):C=et[37],et[38]!==E?(z=(0,d.jsxs)(eZ.E.section,{initial:_,animate:w,transition:M,className:"p-4 bg-base-200/40 rounded-lg border border-base-300",children:[I,(0,d.jsx)("div",{className:"flex flex-col sm:flex-row items-center gap-4",children:(0,d.jsxs)("div",{className:"flex-grow w-full sm:w-auto",children:[N,E,C]})})]}),et[38]=E,et[39]=z):z=et[39],et[40]!==ei?(j=(0,d.jsx)(tM,{applySettingsChanges:ei,size:"large"}),et[40]=ei,et[41]=j):j=et[41],et[42]===Symbol.for("react.memo_cache_sentinel")?(A={opacity:0,y:-10},D={opacity:1,y:0},O={delay:.4},et[42]=A,et[43]=D,et[44]=O):(A=et[42],D=et[43],O=et[44]),et[45]===Symbol.for("react.memo_cache_sentinel")?(L=(0,d.jsxs)("h3",{className:"text-lg font-bold mb-3 border-b border-accent/30 pb-1 text-accent flex items-center gap-2",children:[(0,d.jsx)(tz.Z,{size:18})," Keyboard Controls"]}),et[45]=L):L=et[45],et[46]!==eh?(F=eh&&(0,d.jsxs)(eZ.E.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},role:"alert",className:"alert alert-error alert-sm mb-3 text-xs py-1 px-2 overflow-hidden",children:[(0,d.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"stroke-current shrink-0 h-4 w-4",fill:"none",viewBox:"0 0 24 24",children:(0,d.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M10 14l2-2m0 0l2-2m-2 2l-2 2m2-2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"})}),(0,d.jsx)("span",{children:eh})]}),et[46]=eh,et[47]=F):F=et[47],et[48]!==F?(R=(0,d.jsx)(eY.M,{children:F}),et[48]=F,et[49]=R):R=et[49],et[50]!==er||et[51]!==ec?(B=Object.entries(tJ).map(e=>{let[t,i]=e;return(0,d.jsxs)("div",{className:"flex justify-between items-center gap-3 py-1",children:[(0,d.jsx)("span",{className:"text-md font-medium w-28 flex-shrink-0 opacity-90",children:i}),(0,d.jsx)("kbd",{className:"kbd kbd-lg min-w-[80px] text-center border-secondary/50",children:er[t]||"N/A"}),(0,d.jsx)("button",{onClick:()=>eb(t),className:`btn btn-md w-20 font-semibold ${ec===t?"btn-secondary loading":"btn-outline btn-secondary"}`,disabled:null!==ec&&ec!==t,children:ec===t?"...":"Edit"})]},t)}),et[50]=er,et[51]=ec,et[52]=B):B=et[52],et[53]!==B?(U=(0,d.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-2.5",children:B}),et[53]=B,et[54]=U):U=et[54],et[55]===Symbol.for("react.memo_cache_sentinel")?(V=(0,d.jsx)(tY.Z,{size:14}),et[55]=V):V=et[55],et[56]!==eP?(G=(0,d.jsxs)("button",{onClick:eP,className:"btn btn-md btn-outline btn-warning mt-4 flex items-center gap-1",children:[V," Reset Keys"]}),et[56]=eP,et[57]=G):G=et[57],et[58]!==R||et[59]!==U||et[60]!==G?($=(0,d.jsxs)(eZ.E.section,{initial:A,animate:D,transition:O,className:"p-4 bg-base-200/40 rounded-lg border border-base-300",children:[L,R,U,G]}),et[58]=R,et[59]=U,et[60]=G,et[61]=$):$=et[61],et[62]===Symbol.for("react.memo_cache_sentinel")?(H={opacity:0,y:-10},K={opacity:1,y:0},W={delay:.5},et[62]=H,et[63]=K,et[64]=W):(H=et[62],K=et[63],W=et[64]),et[65]===Symbol.for("react.memo_cache_sentinel")?(q=(0,d.jsxs)("h3",{className:"text-lg font-bold mb-3 border-b border-error/30 pb-1 text-error flex items-center gap-2",children:[(0,d.jsx)(tQ.Z,{size:18})," Danger Zone"]}),et[65]=q):q=et[65],et[66]===Symbol.for("react.memo_cache_sentinel")?(Z=(0,d.jsxs)(eZ.E.section,{initial:H,animate:K,transition:W,className:"p-4 bg-error/10 rounded-lg border border-error/30",children:[q,(0,d.jsxs)("div",{className:"flex items-center justify-between",children:[(0,d.jsx)("p",{className:"text-md text-error/80",children:"Reset all settings to their defaults ?"}),(0,d.jsx)("button",{onClick:()=>eu(!0),className:"btn btn-md btn-outline btn-error",children:"Reset All"})]})]}),et[66]=Z):Z=et[66],et[67]!==z||et[68]!==j||et[69]!==$?(Y=(0,d.jsxs)("div",{className:"max-h-[60vh] lg:max-h-[65vh] overflow-y-auto pr-3 space-y-6 custom-scrollbar",children:[z,j,$,Z]}),et[67]=z,et[68]=j,et[69]=$,et[70]=Y):Y=et[70],et[71]!==v||et[72]!==Y?(Q=(0,d.jsxs)(eZ.E.div,{initial:y,animate:f,transition:x,className:"bg-base-100 p-6 md:p-8 rounded-2xl shadow-xl w-full max-w-3xl text-base-content relative border border-secondary/20",children:[v,S,Y]}),et[71]=v,et[72]=Y,et[73]=Q):Q=et[73],et[74]!==ep?(J=ep&&(0,d.jsx)(eZ.E.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50",onClick:()=>eu(!1),children:(0,d.jsxs)(eZ.E.div,{initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.8,opacity:0},transition:{type:"spring",stiffness:200,damping:15},className:"bg-base-100 p-6 rounded-lg shadow-xl max-w-sm w-full border border-error",onClick:t3,children:[(0,d.jsxs)("h4",{className:"text-xl font-bold text-error mb-3 flex items-center gap-2",children:[(0,d.jsx)(tQ.Z,{})," Confirm Reset"]}),(0,d.jsx)("p",{className:"mb-5 text-base-content/80",children:"Are you sure you want to reset all settings to default? This action cannot be undone."}),(0,d.jsxs)("div",{className:"flex justify-end gap-3",children:[(0,d.jsx)("button",{onClick:()=>eu(!1),className:"btn-dream btn-md",children:"Cancel"}),(0,d.jsx)("button",{onClick:t5,className:"btn-md btn-reset",children:"Yes, Reset All"})]})]})}),et[74]=ep,et[75]=J):J=et[75],et[76]!==J?(X=(0,d.jsx)(eY.M,{children:J}),et[76]=J,et[77]=X):X=et[77],et[78]!==Q||et[79]!==X?(ee=(0,d.jsxs)(eZ.E.div,{initial:g,animate:c,exit:m,transition:u,className:"absolute inset-0  backdrop-blur-md flex flex-col items-center justify-center p-4 z-20 pointer-events-auto",children:[Q,X]}),et[78]=Q,et[79]=X,et[80]=ee):ee=et[80],ee};function t1(e){return e.setMode}function t2(e){return e.setUsername}function t5(){eS.resetAllSettings()}function t3(e){return e.stopPropagation()}var t4=i(19567),t8=i(13761),t6=i(71408);function t7(e){return ek.ZP.dismiss(e.id)}function t9(e){return e.visible}function ie(e){let t,i,s,a,n,o=(0,p.c)(5);o[0]!==e?({max:i,...t}=e,o[0]=e,o[1]=t,o[2]=i):(t=o[1],i=o[2]);var r=void 0===i?3:i;let l=(0,p.c)(4),{toasts:c}=(0,ek.TB)();return l[0]!==r||l[1]!==c?(a=()=>{c.filter(t9).filter((e,t)=>t>=r).forEach(t7)},n=[c,r],l[0]=r,l[1]=c,l[2]=a,l[3]=n):(a=l[2],n=l[3]),(0,h.useEffect)(a,n),o[3]!==t?(s=(0,d.jsx)(ek.x7,{...t}),o[3]=t,o[4]=s):s=o[4],s}let it=e=>{let t,i,s,a,n,o,r,l,c,m,u,g,y,f,x,b,P,v,S,_,w,M,I,N,T,k,E,C,z,j,A=(0,p.c)(58),{onBack:D,onCreate:O}=e,[L,F]=(0,h.useState)(""),[R,B]=(0,h.useState)(4),[U,V]=(0,h.useState)(!1),[G,$]=(0,h.useState)(""),H=(0,h.useRef)(null),K=(0,h.useRef)(null);A[0]===Symbol.for("react.memo_cache_sentinel")?(t=()=>{F(""),B(4),V(!1),$(""),setTimeout(()=>{var e;return null==(e=H.current)?void 0:e.focus()},150)},i=[],A[0]=t,A[1]=i):(t=A[0],i=A[1]),(0,h.useEffect)(t,i),A[2]!==U?(s=()=>{U&&setTimeout(()=>{var e;return null==(e=K.current)?void 0:e.focus()},100)},a=[U],A[2]=U,A[3]=s,A[4]=a):(s=A[3],a=A[4]),(0,h.useEffect)(s,a),A[5]!==U||A[6]!==R||A[7]!==O||A[8]!==G||A[9]!==L?(n=()=>{var e,t;let i=L.trim().slice(0,30);if(!i){ek.ZP.error("Please enter a room name."),null==(e=H.current)||e.focus();return}if(U&&(!G||G.length<3)){ek.ZP.error("Password must be at least 3 characters for private rooms."),null==(t=K.current)||t.focus();return}let s={roomName:i,maxClients:R};U&&G&&(s.password=G.slice(0,20),s.isPrivate=!0),O(s)},A[5]=U,A[6]=R,A[7]=O,A[8]=G,A[9]=L,A[10]=n):n=A[10];let W=n;A[11]!==W?(o=e=>{e.preventDefault(),W()},A[11]=W,A[12]=o):o=A[12];let q=o;A[13]===Symbol.for("react.memo_cache_sentinel")?(l={opacity:0,scale:.9},c={opacity:1,scale:1},m={opacity:0,scale:.9},r={duration:.3},A[13]=r,A[14]=l,A[15]=c,A[16]=m):(r=A[13],l=A[14],c=A[15],m=A[16]),A[17]===Symbol.for("react.memo_cache_sentinel")?(u=(0,d.jsx)("h3",{className:"text-4xl font-bold mb-4 bg-gradient-to-br from-purple-300 via-pink-200 to-yellow-100 bg-clip-text text-transparent flex items-center justify-center gap-3",children:"Create Kitchen"}),A[17]=u):u=A[17],A[18]===Symbol.for("react.memo_cache_sentinel")?(g=(0,d.jsx)("label",{htmlFor:"roomName",className:"block text-md font-medium mb-1 opacity-80",children:"Room Name"}),A[18]=g):g=A[18],A[19]===Symbol.for("react.memo_cache_sentinel")?(y=(0,d.jsx)("span",{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-base-content/40",children:(0,d.jsx)(tA.Z,{size:16})}),A[19]=y):y=A[19],A[20]===Symbol.for("react.memo_cache_sentinel")?(f=e=>F(e.target.value),A[20]=f):f=A[20],A[21]!==L?(x=(0,d.jsxs)("div",{children:[g,(0,d.jsxs)("div",{className:"relative",children:[y,(0,d.jsx)("input",{ref:H,type:"text",id:"roomName",value:L,onChange:f,maxLength:30,className:"input input-bordered w-full pl-8",placeholder:"My Awesome Kitchen",required:!0})]})]}),A[21]=L,A[22]=x):x=A[22],A[23]!==R?(b=(0,d.jsxs)("label",{htmlFor:"maxPlayers",className:"block text-md font-medium mb-1 opacity-80",children:["Max Players (",R,")"]}),A[23]=R,A[24]=b):b=A[24],A[25]===Symbol.for("react.memo_cache_sentinel")?(P=(0,d.jsx)(tm.Z,{size:18,className:"text-base-content/50 flex-shrink-0",strokeWidth:3}),A[25]=P):P=A[25],A[26]===Symbol.for("react.memo_cache_sentinel")?(v=e=>B(parseInt(e.target.value,10)),A[26]=v):v=A[26],A[27]!==R?(S=(0,d.jsxs)("div",{className:"flex items-center gap-3",children:[P,(0,d.jsx)("input",{type:"range",id:"maxPlayers",min:"1",max:"4",step:"1",value:R,onChange:v,className:"range range-sm flex-grow"})]}),A[27]=R,A[28]=S):S=A[28],A[29]!==b||A[30]!==S?(_=(0,d.jsxs)("div",{children:[b,S]}),A[29]=b,A[30]=S,A[31]=_):_=A[31];let Z=`transition-colors ${U?"text-base-content/80":"text-base-content/50"}`;A[32]!==Z?(w=(0,d.jsx)(tj.Z,{size:18,className:Z}),A[32]=Z,A[33]=w):w=A[33];let Y=`label-text transition-opacity ${U?"opacity-100 font-medium":"opacity-70"}`;return A[34]!==Y?(M=(0,d.jsx)("span",{className:Y,children:"Private Room (Password Required)"}),A[34]=Y,A[35]=M):M=A[35],A[36]===Symbol.for("react.memo_cache_sentinel")?(I=e=>V(e.target.checked),A[36]=I):I=A[36],A[37]!==U?(N=(0,d.jsx)("input",{type:"checkbox",checked:U,onChange:I,className:"toggle toggle-sm ml-auto"}),A[37]=U,A[38]=N):N=A[38],A[39]!==w||A[40]!==M||A[41]!==N?(T=(0,d.jsx)("div",{className:"form-control",children:(0,d.jsxs)("label",{className:"label cursor-pointer justify-start gap-3 px-0",children:[w,M,N]})}),A[39]=w,A[40]=M,A[41]=N,A[42]=T):T=A[42],A[43]!==U||A[44]!==G?(k=U&&(0,d.jsxs)(eZ.E.div,{initial:{height:0,opacity:0,marginTop:0},animate:{height:"auto",opacity:1,marginTop:"1.25rem"},exit:{height:0,opacity:0,marginTop:0},transition:{duration:.2,ease:"easeInOut"},children:[(0,d.jsxs)("label",{htmlFor:"password",className:"block text-md font-medium mb-1 opacity-80",children:["Password (min ",3," chars)"]}),(0,d.jsx)("input",{ref:K,type:"password",id:"password",value:G,onChange:e=>$(e.target.value),maxLength:20,className:"input input-bordered w-full",placeholder:"Enter password...",required:U,minLength:U?3:void 0})]},"password-input"),A[43]=U,A[44]=G,A[45]=k):k=A[45],A[46]!==k?(E=(0,d.jsx)(eY.M,{children:k}),A[46]=k,A[47]=E):E=A[47],A[48]===Symbol.for("react.memo_cache_sentinel")?(C=(0,d.jsxs)("button",{type:"submit",className:"btn-dream flex-1 flex items-center justify-center gap-2",children:[(0,d.jsx)(tD.Z,{size:20,strokeWidth:2.5})," Create Room"]}),A[48]=C):C=A[48],A[49]!==D?(z=(0,d.jsxs)("div",{className:"flex flex-col sm:flex-row gap-4 justify-center pt-6",children:[C,(0,d.jsx)("button",{type:"button",onClick:D,className:"btn-dream flex",children:"Cancel"})]}),A[49]=D,A[50]=z):z=A[50],A[51]!==q||A[52]!==x||A[53]!==_||A[54]!==T||A[55]!==E||A[56]!==z?(j=(0,d.jsx)(eZ.E.div,{initial:l,animate:c,exit:m,transition:r,className:"absolute inset-0 bg-base-200 bg-opacity-95 flex flex-col items-center justify-center z-10 pointer-events-auto p-6",children:(0,d.jsxs)("div",{className:"bg-base-100 p-8 rounded-xl shadow-2xl w-full max-w-md text-center relative",children:[u,(0,d.jsxs)("form",{onSubmit:q,className:"space-y-5 text-left mt-6",children:[x,_,T,E,z]})]})},"create-room-page"),A[51]=q,A[52]=x,A[53]=_,A[54]=T,A[55]=E,A[56]=z,A[57]=j):j=A[57],j},ii=[{imageSrc:"/tuto/step1_move.png",description:"Utilise ZQSD (ou WASD) pour te d\xe9placer dans la cuisine."},{imageSrc:"/tuto/step2_interact.png",description:"Appuie sur E pour interagir avec les objets (prendre, poser, utiliser)."},{imageSrc:"/tuto/step3_orders.png",description:"Consulte les commandes en haut \xe0 droite et pr\xe9pare les plats demand\xe9s."},{imageSrc:"/tuto/step4_stations.png",description:"Utilise les diff\xe9rentes stations (four, planche) pour transformer les ingr\xe9dients."},{imageSrc:"/tuto/step5_serve.png",description:"Place le plat final sur une assiette et sers-le au bon client !"}],is=()=>{let e,t,i,s,a,n,o,r,l,c,h,m,u,g=(0,p.c)(19),y=eK(ia);g[0]!==y?(e=()=>{y("roomList")},g[0]=y,g[1]=e):e=g[1];let f=e;g[2]!==y?(t=()=>{y("menu")},g[2]=y,g[3]=t):t=g[3];let x=t;return g[4]===Symbol.for("react.memo_cache_sentinel")?(i={opacity:0,scale:.95},s={opacity:1,scale:1},a={opacity:0,scale:.9},n={duration:.3},g[4]=i,g[5]=s,g[6]=a,g[7]=n):(i=g[4],s=g[5],a=g[6],n=g[7]),g[8]===Symbol.for("react.memo_cache_sentinel")?(o=(0,d.jsx)(tn.Z,{className:"text-secondary",size:24,strokeWidth:2.5}),g[8]=o):o=g[8],g[9]!==x?(r=(0,d.jsx)("button",{onClick:x,className:"absolute top-3 left-3 btn btn-ghost btn-sm btn-circle z-10 hover:bg-base-content/10","aria-label":"Retour au Menu",children:o}),g[9]=x,g[10]=r):r=g[10],g[11]===Symbol.for("react.memo_cache_sentinel")?(l=(0,d.jsx)("h2",{className:"text-3xl md:text-4xl font-bold mb-6 text-center bg-gradient-to-br from-purple-300 via-pink-200 to-yellow-100 bg-clip-text text-transparent",children:"Comment Jouer ?"}),g[11]=l):l=g[11],g[12]===Symbol.for("react.memo_cache_sentinel")?(c=(0,d.jsx)("div",{className:"flex-grow overflow-y-auto pr-2 space-y-4 custom-scrollbar max-h-[65vh]",children:ii.map(ir)}),g[12]=c):c=g[12],g[13]===Symbol.for("react.memo_cache_sentinel")?(h=(0,d.jsx)(tp.Z,{size:20,strokeWidth:2.5}),g[13]=h):h=g[13],g[14]!==f?(m=(0,d.jsx)("div",{className:"mt-6 text-center",children:(0,d.jsxs)("button",{onClick:f,className:"btn-dream flex items-center justify-center gap-2 mx-auto",children:[h," Compris, allons jouer !"]})}),g[14]=f,g[15]=m):m=g[15],g[16]!==m||g[17]!==r?(u=(0,d.jsx)(eZ.E.div,{initial:i,animate:s,exit:a,transition:n,className:"absolute inset-0 bg-base-200 bg-opacity-95 flex flex-col items-center justify-center z-10 pointer-events-auto p-4 md:p-6",children:(0,d.jsxs)("div",{className:"bg-base-100 p-6 md:p-8 rounded-2xl shadow-2xl w-full max-w-3xl text-base-content relative border border-secondary/20 flex flex-col",children:[r,l,c,m]})},"tutorial-page"),g[16]=m,g[17]=r,g[18]=u):u=g[18],u};function ia(e){return e.setMode}function io(e){return e.currentTarget.src="/icons/placeholder.png"}function ir(e,t){return(0,d.jsxs)(eZ.E.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.05*t,duration:.2},className:"flex flex-col sm:flex-row items-center gap-4 bg-base-200/50 p-3 rounded-lg border border-base-300",children:[(0,d.jsx)("img",{src:e.imageSrc,alt:`Tutoriel \xe9tape ${t+1}`,className:"w-32 h-32 object-contain rounded-md flex-shrink-0 border bg-base-100",onError:io}),(0,d.jsx)("p",{className:"text-base-content/90 text-center sm:text-left text-md",children:e.description})]},t)}let il=e=>{let t,i,s,a,n,o,r,l,c,m,u,g,y,f,x,b,P,v,S,_,w,M,I,N,T,k,E,C,z,j,A=(0,p.c)(36),{onPseudoSet:D}=e,[O,L]=(0,h.useState)(""),F=(0,h.useRef)(null);A[0]!==D||A[1]!==O?(t=e=>{null==e||e.preventDefault();let t=O.trim();if(t&&t.length>=3)D(t);else{var i;ek.Am.error("Your nickname must be at least 3 characters long! \uD83D\uDE05"),null==(i=F.current)||i.focus()}},A[0]=D,A[1]=O,A[2]=t):t=A[2];let R=t;return A[3]===Symbol.for("react.memo_cache_sentinel")?(i=()=>{var e;null==(e=F.current)||e.focus()},s=[],A[3]=i,A[4]=s):(i=A[3],s=A[4]),(0,h.useEffect)(i,s),A[5]===Symbol.for("react.memo_cache_sentinel")?(a={opacity:0},n={opacity:1},o={opacity:0},A[5]=a,A[6]=n,A[7]=o):(a=A[5],n=A[6],o=A[7]),A[8]===Symbol.for("react.memo_cache_sentinel")?(r=(0,d.jsx)("span",{className:"float-element",style:{top:"18%",left:"24%",animationDelay:"0s",fontSize:"2.5rem"},children:"\uD83C\uDF38"}),A[8]=r):r=A[8],A[9]===Symbol.for("react.memo_cache_sentinel")?(l=(0,d.jsx)("span",{className:"float-element",style:{top:"75%",left:"5%",animationDelay:"2.2s",fontSize:"1.8rem"},children:"\uD83C\uDF70"}),A[9]=l):l=A[9],A[10]===Symbol.for("react.memo_cache_sentinel")?(c=(0,d.jsx)("span",{className:"float-element",style:{top:"20%",left:"86%",animationDelay:"1.1s",fontSize:"2.8rem"},children:"✨"}),A[10]=c):c=A[10],A[11]===Symbol.for("react.memo_cache_sentinel")?(m=(0,d.jsx)("span",{className:"float-element",style:{top:"82%",left:"85%",animationDelay:"3.5s",fontSize:"1.7rem"},children:"\uD83C\uDF1F"}),A[11]=m):m=A[11],A[12]===Symbol.for("react.memo_cache_sentinel")?(u=(0,d.jsx)("span",{className:"float-element",style:{top:"50%",left:"16%",animationDelay:"0.5s",fontSize:"2rem"},children:"\uD83D\uDC96"}),A[12]=u):u=A[12],A[13]===Symbol.for("react.memo_cache_sentinel")?(g=(0,d.jsx)("span",{className:"float-element",style:{top:"5%",left:"40%",animationDelay:"4.0s",fontSize:"1.4rem"},children:"☁️"}),A[13]=g):g=A[13],A[14]===Symbol.for("react.memo_cache_sentinel")?(y=(0,d.jsx)("span",{className:"float-element",style:{top:"50%",left:"70%",animationDelay:"1.8s",fontSize:"2.8rem"},children:"\uD83C\uDF53"}),A[14]=y):y=A[14],A[15]===Symbol.for("react.memo_cache_sentinel")?(f=(0,d.jsx)("span",{className:"float-element",style:{top:"90%",left:"30%",animationDelay:"0.8s",fontSize:"2.2rem"},children:"\uD83C\uDF6D"}),A[15]=f):f=A[15],A[16]===Symbol.for("react.memo_cache_sentinel")?(x=(0,d.jsx)("span",{className:"float-element",style:{top:"87%",left:"66%",animationDelay:"5.0s",fontSize:"1.9rem"},children:"\uD83C\uDF59"}),A[16]=x):x=A[16],A[17]===Symbol.for("react.memo_cache_sentinel")?(b=(0,d.jsx)("span",{className:"float-element",style:{top:"5%",left:"5%",animationDelay:"3.0s",fontSize:"2.1rem"},children:"\uD83C\uDF89"}),A[17]=b):b=A[17],A[18]===Symbol.for("react.memo_cache_sentinel")?(P=(0,d.jsx)("span",{className:"float-element",style:{top:"45%",left:"95%",animationDelay:"2.8s",fontSize:"1.9rem"},children:"\uD83C\uDF69"}),A[18]=P):P=A[18],A[19]===Symbol.for("react.memo_cache_sentinel")?(v=(0,d.jsxs)(eY.M,{children:[r,l,c,m,u,g,y,f,x,b,P,(0,d.jsx)("span",{className:"float-element",style:{top:"13%",left:"70%",animationDelay:"0.2s",fontSize:"2.4rem"},children:"\uD83C\uDF90"})]}),A[19]=v):v=A[19],A[20]===Symbol.for("react.memo_cache_sentinel")?(S={scale:.7,opacity:0,rotate:-5},_={scale:1,opacity:1,rotate:0},w={delay:.2,type:"spring",stiffness:120,damping:10},A[20]=S,A[21]=_,A[22]=w):(S=A[20],_=A[21],w=A[22]),A[23]===Symbol.for("react.memo_cache_sentinel")?(M=(0,d.jsx)(e1.Z,{size:28}),A[23]=M):M=A[23],A[24]===Symbol.for("react.memo_cache_sentinel")?(I=(0,d.jsxs)("h2",{className:"text-3xl font-bold mb-4 flex items-center justify-center gap-2 bg-gradient-to-br from-purple-300 via-pink-200 to-yellow-100 bg-clip-text text-transparent drop-shadow",children:[M," Welcome Chef ! ",(0,d.jsx)(t4.Z,{size:28})]}),N=(0,d.jsx)("p",{className:"mb-6 text-base-content/80 text-md",children:"Choose your amazing cooking name !"}),A[24]=I,A[25]=N):(I=A[24],N=A[25]),A[26]===Symbol.for("react.memo_cache_sentinel")?(T=e=>L(e.target.value.slice(0,16)),A[26]=T):T=A[26],A[27]!==O?(k=(0,d.jsx)("input",{ref:F,type:"text",value:O,onChange:T,maxLength:16,className:"input input-bordered w-full mb-5 shadow-sm border-rose-50 focus:ring-1",placeholder:"SuperChefName..."}),A[27]=O,A[28]=k):k=A[28],A[29]===Symbol.for("react.memo_cache_sentinel")?(E=(0,d.jsx)(eZ.E.button,{type:"submit",whileHover:{scale:1.05,y:-2,transition:{duration:.1}},whileTap:{scale:.95},className:"btn-dream",children:"Let's get cooking ! \uD83C\uDF89"}),A[29]=E):E=A[29],A[30]!==R||A[31]!==k?(C=(0,d.jsxs)("form",{onSubmit:R,children:[k,E]}),A[30]=R,A[31]=k,A[32]=C):C=A[32],A[33]===Symbol.for("react.memo_cache_sentinel")?(z=(0,d.jsxs)("p",{className:"text-xs mt-4 text-base-content/60 flex items-center justify-center gap-1",children:[(0,d.jsx)(tL.Z,{size:16})," You can change it later."]}),A[33]=z):z=A[33],A[34]!==C?(j=(0,d.jsxs)(eZ.E.div,{initial:a,animate:n,exit:o,className:"fixed inset-0 backdrop-blur-md flex flex-col items-center justify-center z-50 p-4",children:[v,(0,d.jsxs)(eZ.E.div,{initial:S,animate:_,transition:w,className:"bg-base-100 p-8 rounded-2xl shadow-xl text-center border-2 border-base-300 w-full max-w-sm",children:[I,N,C,z]})]}),A[34]=C,A[35]=j):j=A[35],j};(0,m.createRoot)(document.getElementById("root")).render((0,d.jsx)(h.StrictMode,{children:(0,d.jsx)(()=>{let e=eK(e=>e.mode),t=eK(e=>e.setMode),i=eK(e=>e.roomToJoin),s=eK(e=>e.setRoomToJoin),a=eK(e=>e.username),n=eK(e=>e.setUsername),[o,r]=(0,h.useState)(!1),l=(0,h.useRef)(null),c=(0,h.useCallback)(e=>{l.current=e},[]),m=(0,h.useCallback)(()=>{var e;null==(e=l.current)||e.applySettings()},[]);(0,h.useEffect)(()=>{r(!a)},[a]),(0,h.useEffect)(()=>{o||m()},[o,m]),(0,h.useEffect)(()=>{if(!a&&"menu"!==e&&"settings"!==e){r(!0),t("menu");return}if("game"===e&&i){let e={...i.options||{},clientPseudo:a};return b({roomName:i.roomName||"game",roomId:i.roomId,forceCreate:i.forceCreate,options:e}).catch(e=>{console.error("Game Connect Error:",e),ek.Am.error("Failed to join room: "+(e.message||"Server error")),t("roomList")}),I().catch(console.error),()=>{P().catch(console.error),s(void 0)}}if("roomList"===e)return M({roomName:"lobby",isLobby:!0}).catch(e=>{console.error("Lobby Connect Error:",e),ek.Am.error("Failed to connect to lobby: "+(e.message||"Server error")),t("menu")}),P().catch(console.error),()=>{I().catch(console.error)};P().catch(console.error),I().catch(console.error)},[e,i,s,a,t]);let p=(0,h.useCallback)(()=>{if(!a)return void r(!0);t("roomList")},[a,t]),u=(0,h.useCallback)(()=>{t("settings")},[t]),g=(0,h.useCallback)(()=>{t("tutorial")},[t]),y=(0,h.useCallback)(async()=>{try{await P(),await I()}catch(e){console.error("Error disconnecting:",e)}finally{t("menu"),s(void 0)}},[t,s]),f=(0,h.useCallback)(e=>{s({roomName:"game",forceCreate:!0,options:e}),t("game")},[s,t]),x=(0,h.useCallback)(()=>{t("roomList"),s(void 0)},[t,s]);return(0,d.jsxs)("div",{className:"min-h-screen h-screen flex flex-col bg-base-200 overflow-hidden relative",children:[(0,d.jsx)(ie,{position:"bottom-center",reverseOrder:!1,toastOptions:{duration:3e3,style:{background:"#333",color:"#fff"},success:{iconTheme:{primary:"#10B981",secondary:"white"}},error:{iconTheme:{primary:"#EF4444",secondary:"white"}}}}),(0,d.jsx)(eY.M,{children:!o&&"menu"===e&&(0,d.jsxs)(eZ.E.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3},className:"floating-decorations-container","aria-hidden":"true",children:[(0,d.jsx)("span",{className:"float-element",style:{top:"18%",left:"24%",animationDelay:"0s",fontSize:"2.5rem"},children:"\uD83C\uDF38"}),(0,d.jsx)("span",{className:"float-element",style:{top:"75%",left:"5%",animationDelay:"2.2s",fontSize:"1.8rem"},children:"\uD83C\uDF70"}),(0,d.jsx)("span",{className:"float-element",style:{top:"20%",left:"86%",animationDelay:"1.1s",fontSize:"2.8rem"},children:"✨"}),(0,d.jsx)("span",{className:"float-element",style:{top:"82%",left:"85%",animationDelay:"3.5s",fontSize:"1.7rem"},children:"\uD83C\uDF1F"}),(0,d.jsx)("span",{className:"float-element",style:{top:"50%",left:"16%",animationDelay:"0.5s",fontSize:"2rem"},children:"\uD83D\uDC96"}),(0,d.jsx)("span",{className:"float-element",style:{top:"5%",left:"40%",animationDelay:"4.0s",fontSize:"1.4rem"},children:"☁️"}),(0,d.jsx)("span",{className:"float-element",style:{top:"50%",left:"70%",animationDelay:"1.8s",fontSize:"2.8rem"},children:"\uD83C\uDF53"}),(0,d.jsx)("span",{className:"float-element",style:{top:"90%",left:"30%",animationDelay:"0.8s",fontSize:"2.2rem"},children:"\uD83C\uDF6D"}),(0,d.jsx)("span",{className:"float-element",style:{top:"87%",left:"66%",animationDelay:"5.0s",fontSize:"1.9rem"},children:"\uD83C\uDF59"}),(0,d.jsx)("span",{className:"float-element",style:{top:"5%",left:"5%",animationDelay:"3.0s",fontSize:"2.1rem"},children:"\uD83C\uDF89"}),(0,d.jsx)("span",{className:"float-element",style:{top:"45%",left:"95%",animationDelay:"2.8s",fontSize:"1.9rem"},children:"\uD83C\uDF69"}),(0,d.jsx)("span",{className:"float-element",style:{top:"13%",left:"70%",animationDelay:"0.2s",fontSize:"2.4rem"},children:"\uD83C\uDF90"})]},"decorations")}),(0,d.jsx)(eY.M,{mode:"wait",children:o?(0,d.jsx)(il,{onPseudoSet:e=>{n(e),r(!1),t("menu")}},"initial-setup"):"menu"===e?(0,d.jsxs)(eZ.E.div,{initial:{opacity:0,y:20,scale:.98},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:20,scale:.98},transition:{duration:.3,ease:"easeInOut"},className:"flex flex-col items-center justify-center flex-1 z-10",children:[a&&(0,d.jsxs)(eZ.E.h2,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.1,duration:.3},className:"text-2xl mb-4 text-base-content/90",children:["Ready to cook, ",(0,d.jsx)("span",{className:"font-bold text-primary drop-shadow",children:a}),"? \uD83C\uDF73"]}),(0,d.jsx)(eZ.E.h1,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.15,duration:.3},className:"text-6xl font-bold mb-2 bg-gradient-to-br from-purple-300 via-pink-200 to-yellow-100 bg-clip-text text-transparent",children:"Delixia"}),(0,d.jsxs)(eZ.E.p,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.2,duration:.3},className:"text-lg md:text-xl mb-8 text-base-content opacity-80 font-semibold",children:["The cutest & most fun ",(0,d.jsx)("span",{className:"text-secondary font-bold",children:"kitchen"})," on the web! \uD83C\uDF89"]}),(0,d.jsxs)(eZ.E.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.25,duration:.3},className:"flex flex-col gap-4 w-64",children:[(0,d.jsxs)("button",{onClick:p,className:"btn-dream flex items-center justify-center gap-2",children:[(0,d.jsx)(tp.Z,{size:24})," Play"]}),(0,d.jsxs)("button",{onClick:g,className:"btn-dream flex items-center justify-center gap-2",children:[(0,d.jsx)(t8.Z,{size:22})," How to Play"]}),(0,d.jsxs)("button",{onClick:u,className:"btn-dream flex items-center justify-center gap-2",children:[(0,d.jsx)(t6.Z,{size:22})," Settings"]}),(0,d.jsx)("button",{onClick:()=>{window.open("https://github.com/TriForMine/delixia","_blank")},className:"btn btn-outline btn-sm text-base-content/70 hover:bg-base-content/10 border-base-content/30",children:"GitHub"})]}),(0,d.jsxs)(eZ.E.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.3,duration:.3},className:"absolute bottom-4 text-sm opacity-70 text-base-content/70",children:["Version ","0.0.0"]})]},"menu"):"settings"===e?(0,d.jsx)(t0,{applySettingsChanges:m},"settings"):"tutorial"===e?(0,d.jsx)(is,{},"tutorial"):"game"===e?(0,d.jsx)(tC,{onBackToMenu:y,setGameEngineInstance:c,applySettingsChanges:m},"game"):"roomList"===e?(0,d.jsx)(tG,{},"roomList"):"createRoom"===e?(0,d.jsx)(it,{onCreate:f,onBack:x},"create-room"):null})]})},{})}))},19505:function(){},1078:function(){}},t={};function i(s){var a=t[s];if(void 0!==a)return a.exports;var n=t[s]={exports:{}};return e[s].call(n.exports,n,n.exports,i),n.exports}i.m=e,i.d=(e,t)=>{for(var s in t)i.o(t,s)&&!i.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},i.g=(()=>{if("object"==typeof globalThis)return globalThis;try{return this||Function("return this")()}catch(e){if("object"==typeof window)return window}})(),i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),i.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e=[];i.O=(t,s,a,n)=>{if(s){n=n||0;for(var o=e.length;o>0&&e[o-1][2]>n;o--)e[o]=e[o-1];e[o]=[s,a,n];return}for(var r=1/0,o=0;o<e.length;o++){for(var[s,a,n]=e[o],l=!0,c=0;c<s.length;c++)(!1&n||r>=n)&&Object.keys(i.O).every(e=>i.O[e](s[c]))?s.splice(c--,1):(l=!1,n<r&&(r=n));if(l){e.splice(o--,1);var d=a();void 0!==d&&(t=d)}}return t}})(),i.p="/Delixia/",i.rv=()=>"1.3.5",(()=>{i.b=document.baseURI||self.location.href;var e={980:0};i.O.j=t=>0===e[t];var t=(t,s)=>{var a,n,[o,r,l]=s,c=0;if(o.some(t=>0!==e[t])){for(a in r)i.o(r,a)&&(i.m[a]=r[a]);if(l)var d=l(i)}for(t&&t(s);c<o.length;c++)n=o[c],i.o(e,n)&&e[n]&&e[n][0](),e[n]=0;return i.O(d)},s=self.webpackChunkdelixia=self.webpackChunkdelixia||[];s.forEach(t.bind(null,0)),s.push=t.bind(null,s.push.bind(s))})(),i.ruid="bundler=rspack@1.3.5";var s=i.O(void 0,["361","644"],function(){return i(1934)});s=i.O(s)})();